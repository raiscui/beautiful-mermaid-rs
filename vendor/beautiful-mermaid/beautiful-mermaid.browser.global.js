var beautifulMermaid=(function(exports){'use strict';var Ir=Object.create;var tn=Object.defineProperty;var Tr=Object.getOwnPropertyDescriptor;var Pr=Object.getOwnPropertyNames;var Dr=Object.getPrototypeOf,Rr=Object.prototype.hasOwnProperty;var re=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,n)=>(typeof require<"u"?require:e)[n]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var Or=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Nr=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Pr(e))!Rr.call(t,o)&&o!==n&&tn(t,o,{get:()=>e[o],enumerable:!(r=Tr(e,o))||r.enumerable});return t};var Me=(t,e,n)=>(n=t!=null?Ir(Dr(t)):{},Nr(tn(n,"default",{value:t,enumerable:true}),t));var ye=Or((Jn,He)=>{(function(t){if(typeof Jn=="object"&&typeof He<"u")He.exports=t();else if(typeof define=="function"&&define.amd)define([],t);else {var e;typeof window<"u"?e=window:typeof global<"u"?e=global:typeof self<"u"?e=self:e=this,e.dagre=t();}})(function(){return (function(){function r(o,i,c){function s(u,h){if(!i[u]){if(!o[u]){var a=typeof re=="function"&&re;if(!h&&a)return a(u,true);if(l)return l(u,true);var d=new Error("Cannot find module '"+u+"'");throw d.code="MODULE_NOT_FOUND",d}var m=i[u]={exports:{}};o[u][0].call(m.exports,function(x){var g=o[u][1][x];return s(g||x)},m,m.exports,r,o,i,c);}return i[u].exports}for(var l=typeof re=="function"&&re,f=0;f<c.length;f++)s(c[f]);return s}return r})()({1:[function(r,o,i){o.exports={graphlib:r("@dagrejs/graphlib"),layout:r("./lib/layout"),debug:r("./lib/debug"),util:{time:r("./lib/util").time,notime:r("./lib/util").notime},version:r("./lib/version")};},{"./lib/debug":6,"./lib/layout":8,"./lib/util":27,"./lib/version":28,"@dagrejs/graphlib":29}],2:[function(r,o,i){let c=r("./greedy-fas"),s=r("./util").uniqueId;o.exports={run:l,undo:u};function l(h){(h.graph().acyclicer==="greedy"?c(h,d(h)):f(h)).forEach(m=>{let x=h.edge(m);h.removeEdge(m),x.forwardName=m.name,x.reversed=true,h.setEdge(m.w,m.v,x,s("rev"));});function d(m){return x=>m.edge(x).weight}}function f(h){let a=[],d={},m={};function x(g){Object.hasOwn(m,g)||(m[g]=true,d[g]=true,h.outEdges(g).forEach(p=>{Object.hasOwn(d,p.w)?a.push(p):x(p.w);}),delete d[g]);}return h.nodes().forEach(x),a}function u(h){h.edges().forEach(a=>{let d=h.edge(a);if(d.reversed){h.removeEdge(a);let m=d.forwardName;delete d.reversed,delete d.forwardName,h.setEdge(a.w,a.v,d,m);}});}},{"./greedy-fas":7,"./util":27}],3:[function(r,o,i){let c=r("./util");o.exports=s;function s(f){function u(h){let a=f.children(h),d=f.node(h);if(a.length&&a.forEach(u),Object.hasOwn(d,"minRank")){d.borderLeft=[],d.borderRight=[];for(let m=d.minRank,x=d.maxRank+1;m<x;++m)l(f,"borderLeft","_bl",h,d,m),l(f,"borderRight","_br",h,d,m);}}f.children().forEach(u);}function l(f,u,h,a,d,m){let x={width:0,height:0,rank:m,borderType:u},g=d[u][m-1],p=c.addDummyNode(f,"border",x,h);d[u][m]=p,f.setParent(p,a),g&&f.setEdge(g,p,{weight:1});}},{"./util":27}],4:[function(r,o,i){o.exports={adjust:c,undo:s};function c(m){let x=m.graph().rankdir.toLowerCase();(x==="lr"||x==="rl")&&l(m);}function s(m){let x=m.graph().rankdir.toLowerCase();(x==="bt"||x==="rl")&&u(m),(x==="lr"||x==="rl")&&(a(m),l(m));}function l(m){m.nodes().forEach(x=>f(m.node(x))),m.edges().forEach(x=>f(m.edge(x)));}function f(m){let x=m.width;m.width=m.height,m.height=x;}function u(m){m.nodes().forEach(x=>h(m.node(x))),m.edges().forEach(x=>{let g=m.edge(x);g.points.forEach(h),Object.hasOwn(g,"y")&&h(g);});}function h(m){m.y=-m.y;}function a(m){m.nodes().forEach(x=>d(m.node(x))),m.edges().forEach(x=>{let g=m.edge(x);g.points.forEach(d),Object.hasOwn(g,"x")&&d(g);});}function d(m){let x=m.x;m.x=m.y,m.y=x;}},{}],5:[function(r,o,i){class c{constructor(){let u={};u._next=u._prev=u,this._sentinel=u;}dequeue(){let u=this._sentinel,h=u._prev;if(h!==u)return s(h),h}enqueue(u){let h=this._sentinel;u._prev&&u._next&&s(u),u._next=h._next,h._next._prev=u,h._next=u,u._prev=h;}toString(){let u=[],h=this._sentinel,a=h._prev;for(;a!==h;)u.push(JSON.stringify(a,l)),a=a._prev;return "["+u.join(", ")+"]"}}function s(f){f._prev._next=f._next,f._next._prev=f._prev,delete f._next,delete f._prev;}function l(f,u){if(f!=="_next"&&f!=="_prev")return u}o.exports=c;},{}],6:[function(r,o,i){let c=r("./util"),s=r("@dagrejs/graphlib").Graph;o.exports={debugOrdering:l};function l(f){let u=c.buildLayerMatrix(f),h=new s({compound:true,multigraph:true}).setGraph({});return f.nodes().forEach(a=>{h.setNode(a,{label:a}),h.setParent(a,"layer"+f.node(a).rank);}),f.edges().forEach(a=>h.setEdge(a.v,a.w,{},a.name)),u.forEach((a,d)=>{let m="layer"+d;h.setNode(m,{rank:"same"}),a.reduce((x,g)=>(h.setEdge(x,g,{style:"invis"}),g));}),h}},{"./util":27,"@dagrejs/graphlib":29}],7:[function(r,o,i){let c=r("@dagrejs/graphlib").Graph,s=r("./data/list");o.exports=f;let l=()=>1;function f(x,g){if(x.nodeCount()<=1)return [];let p=a(x,g||l);return u(p.graph,p.buckets,p.zeroIdx).flatMap(C=>x.outEdges(C.v,C.w))}function u(x,g,p){let b=[],C=g[g.length-1],T=g[0],N;for(;x.nodeCount();){for(;N=T.dequeue();)h(x,g,p,N);for(;N=C.dequeue();)h(x,g,p,N);if(x.nodeCount()){for(let v=g.length-2;v>0;--v)if(N=g[v].dequeue(),N){b=b.concat(h(x,g,p,N,true));break}}}return b}function h(x,g,p,b,C){let T=C?[]:void 0;return x.inEdges(b.v).forEach(N=>{let v=x.edge(N),M=x.node(N.v);C&&T.push({v:N.v,w:N.w}),M.out-=v,d(g,p,M);}),x.outEdges(b.v).forEach(N=>{let v=x.edge(N),M=N.w,$=x.node(M);$.in-=v,d(g,p,$);}),x.removeNode(b.v),T}function a(x,g){let p=new c,b=0,C=0;x.nodes().forEach(v=>{p.setNode(v,{v,in:0,out:0});}),x.edges().forEach(v=>{let M=p.edge(v.v,v.w)||0,$=g(v),D=M+$;p.setEdge(v.v,v.w,D),C=Math.max(C,p.node(v.v).out+=$),b=Math.max(b,p.node(v.w).in+=$);});let T=m(C+b+3).map(()=>new s),N=b+1;return p.nodes().forEach(v=>{d(T,N,p.node(v));}),{graph:p,buckets:T,zeroIdx:N}}function d(x,g,p){p.out?p.in?x[p.out-p.in+g].enqueue(p):x[x.length-1].enqueue(p):x[0].enqueue(p);}function m(x){let g=[];for(let p=0;p<x;p++)g.push(p);return g}},{"./data/list":5,"@dagrejs/graphlib":29}],8:[function(r,o,i){let c=r("./acyclic"),s=r("./normalize"),l=r("./rank"),f=r("./util").normalizeRanks,u=r("./parent-dummy-chains"),h=r("./util").removeEmptyRanks,a=r("./nesting-graph"),d=r("./add-border-segments"),m=r("./coordinate-system"),x=r("./order"),g=r("./position"),p=r("./util"),b=r("@dagrejs/graphlib").Graph;o.exports=C;function C(k,I){let F=I&&I.debugTiming?p.time:p.notime;F("layout",()=>{let V=F("  buildLayoutGraph",()=>E(k));F("  runLayout",()=>T(V,F,I)),F("  updateInputGraph",()=>N(k,V));});}function T(k,I,F){I("    makeSpaceForEdgeLabels",()=>O(k)),I("    removeSelfEdges",()=>P(k)),I("    acyclic",()=>c.run(k)),I("    nestingGraph.run",()=>a.run(k)),I("    rank",()=>l(p.asNonCompoundGraph(k))),I("    injectEdgeLabelProxies",()=>L(k)),I("    removeEmptyRanks",()=>h(k)),I("    nestingGraph.cleanup",()=>a.cleanup(k)),I("    normalizeRanks",()=>f(k)),I("    assignRankMinMax",()=>G(k)),I("    removeEdgeLabelProxies",()=>w(k)),I("    normalize.run",()=>s.run(k)),I("    parentDummyChains",()=>u(k)),I("    addBorderSegments",()=>d(k)),I("    order",()=>x(k,F)),I("    insertSelfEdges",()=>X(k)),I("    adjustCoordinateSystem",()=>m.adjust(k)),I("    position",()=>g(k)),I("    positionSelfEdges",()=>H(k)),I("    removeBorderNodes",()=>S(k)),I("    normalize.undo",()=>s.undo(k)),I("    fixupEdgeLabelCoords",()=>A(k)),I("    undoCoordinateSystem",()=>m.undo(k)),I("    translateGraph",()=>j(k)),I("    assignNodeIntersects",()=>Y(k)),I("    reversePoints",()=>y(k)),I("    acyclic.undo",()=>c.undo(k));}function N(k,I){k.nodes().forEach(F=>{let V=k.node(F),K=I.node(F);V&&(V.x=K.x,V.y=K.y,V.rank=K.rank,I.children(F).length&&(V.width=K.width,V.height=K.height));}),k.edges().forEach(F=>{let V=k.edge(F),K=I.edge(F);V.points=K.points,Object.hasOwn(K,"x")&&(V.x=K.x,V.y=K.y);}),k.graph().width=I.graph().width,k.graph().height=I.graph().height;}let v=["nodesep","edgesep","ranksep","marginx","marginy"],M={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},$=["acyclicer","ranker","rankdir","align"],D=["width","height","rank"],_={width:0,height:0},R=["minlen","weight","width","height","labeloffset"],B={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},z=["labelpos"];function E(k){let I=new b({multigraph:true,compound:true}),F=U(k.graph());return I.setGraph(Object.assign({},M,W(F,v),p.pick(F,$))),k.nodes().forEach(V=>{let K=U(k.node(V)),Z=W(K,D);Object.keys(_).forEach(rt=>{Z[rt]===void 0&&(Z[rt]=_[rt]);}),I.setNode(V,Z),I.setParent(V,k.parent(V));}),k.edges().forEach(V=>{let K=U(k.edge(V));I.setEdge(V,Object.assign({},B,W(K,R),p.pick(K,z)));}),I}function O(k){let I=k.graph();I.ranksep/=2,k.edges().forEach(F=>{let V=k.edge(F);V.minlen*=2,V.labelpos.toLowerCase()!=="c"&&(I.rankdir==="TB"||I.rankdir==="BT"?V.width+=V.labeloffset:V.height+=V.labeloffset);});}function L(k){k.edges().forEach(I=>{let F=k.edge(I);if(F.width&&F.height){let V=k.node(I.v),Z={rank:(k.node(I.w).rank-V.rank)/2+V.rank,e:I};p.addDummyNode(k,"edge-proxy",Z,"_ep");}});}function G(k){let I=0;k.nodes().forEach(F=>{let V=k.node(F);V.borderTop&&(V.minRank=k.node(V.borderTop).rank,V.maxRank=k.node(V.borderBottom).rank,I=Math.max(I,V.maxRank));}),k.graph().maxRank=I;}function w(k){k.nodes().forEach(I=>{let F=k.node(I);F.dummy==="edge-proxy"&&(k.edge(F.e).labelRank=F.rank,k.removeNode(I));});}function j(k){let I=Number.POSITIVE_INFINITY,F=0,V=Number.POSITIVE_INFINITY,K=0,Z=k.graph(),rt=Z.marginx||0,ht=Z.marginy||0;function kt(yt){let mt=yt.x,ne=yt.y,Ze=yt.width,Qe=yt.height;I=Math.min(I,mt-Ze/2),F=Math.max(F,mt+Ze/2),V=Math.min(V,ne-Qe/2),K=Math.max(K,ne+Qe/2);}k.nodes().forEach(yt=>kt(k.node(yt))),k.edges().forEach(yt=>{let mt=k.edge(yt);Object.hasOwn(mt,"x")&&kt(mt);}),I-=rt,V-=ht,k.nodes().forEach(yt=>{let mt=k.node(yt);mt.x-=I,mt.y-=V;}),k.edges().forEach(yt=>{let mt=k.edge(yt);mt.points.forEach(ne=>{ne.x-=I,ne.y-=V;}),Object.hasOwn(mt,"x")&&(mt.x-=I),Object.hasOwn(mt,"y")&&(mt.y-=V);}),Z.width=F-I+rt,Z.height=K-V+ht;}function Y(k){k.edges().forEach(I=>{let F=k.edge(I),V=k.node(I.v),K=k.node(I.w),Z,rt;F.points?(Z=F.points[0],rt=F.points[F.points.length-1]):(F.points=[],Z=K,rt=V),F.points.unshift(p.intersectRect(V,Z)),F.points.push(p.intersectRect(K,rt));});}function A(k){k.edges().forEach(I=>{let F=k.edge(I);if(Object.hasOwn(F,"x"))switch((F.labelpos==="l"||F.labelpos==="r")&&(F.width-=F.labeloffset),F.labelpos){case "l":F.x-=F.width/2+F.labeloffset;break;case "r":F.x+=F.width/2+F.labeloffset;break}});}function y(k){k.edges().forEach(I=>{let F=k.edge(I);F.reversed&&F.points.reverse();});}function S(k){k.nodes().forEach(I=>{if(k.children(I).length){let F=k.node(I),V=k.node(F.borderTop),K=k.node(F.borderBottom),Z=k.node(F.borderLeft[F.borderLeft.length-1]),rt=k.node(F.borderRight[F.borderRight.length-1]);F.width=Math.abs(rt.x-Z.x),F.height=Math.abs(K.y-V.y),F.x=Z.x+F.width/2,F.y=V.y+F.height/2;}}),k.nodes().forEach(I=>{k.node(I).dummy==="border"&&k.removeNode(I);});}function P(k){k.edges().forEach(I=>{if(I.v===I.w){var F=k.node(I.v);F.selfEdges||(F.selfEdges=[]),F.selfEdges.push({e:I,label:k.edge(I)}),k.removeEdge(I);}});}function X(k){var I=p.buildLayerMatrix(k);I.forEach(F=>{var V=0;F.forEach((K,Z)=>{var rt=k.node(K);rt.order=Z+V,(rt.selfEdges||[]).forEach(ht=>{p.addDummyNode(k,"selfedge",{width:ht.label.width,height:ht.label.height,rank:rt.rank,order:Z+ ++V,e:ht.e,label:ht.label},"_se");}),delete rt.selfEdges;});});}function H(k){k.nodes().forEach(I=>{var F=k.node(I);if(F.dummy==="selfedge"){var V=k.node(F.e.v),K=V.x+V.width/2,Z=V.y,rt=F.x-K,ht=V.height/2;k.setEdge(F.e,F.label),k.removeNode(I),F.label.points=[{x:K+2*rt/3,y:Z-ht},{x:K+5*rt/6,y:Z-ht},{x:K+rt,y:Z},{x:K+5*rt/6,y:Z+ht},{x:K+2*rt/3,y:Z+ht}],F.label.x=F.x,F.label.y=F.y;}});}function W(k,I){return p.mapValues(p.pick(k,I),Number)}function U(k){var I={};return k&&Object.entries(k).forEach(([F,V])=>{typeof F=="string"&&(F=F.toLowerCase()),I[F]=V;}),I}},{"./acyclic":2,"./add-border-segments":3,"./coordinate-system":4,"./nesting-graph":9,"./normalize":10,"./order":15,"./parent-dummy-chains":20,"./position":22,"./rank":24,"./util":27,"@dagrejs/graphlib":29}],9:[function(r,o,i){let c=r("./util");o.exports={run:s,cleanup:h};function s(a){let d=c.addDummyNode(a,"root",{},"_root"),m=f(a),x=Object.values(m),g=c.applyWithChunking(Math.max,x)-1,p=2*g+1;a.graph().nestingRoot=d,a.edges().forEach(C=>a.edge(C).minlen*=p);let b=u(a)+1;a.children().forEach(C=>l(a,d,p,b,g,m,C)),a.graph().nodeRankFactor=p;}function l(a,d,m,x,g,p,b){let C=a.children(b);if(!C.length){b!==d&&a.setEdge(d,b,{weight:0,minlen:m});return}let T=c.addBorderNode(a,"_bt"),N=c.addBorderNode(a,"_bb"),v=a.node(b);a.setParent(T,b),v.borderTop=T,a.setParent(N,b),v.borderBottom=N,C.forEach(M=>{l(a,d,m,x,g,p,M);let $=a.node(M),D=$.borderTop?$.borderTop:M,_=$.borderBottom?$.borderBottom:M,R=$.borderTop?x:2*x,B=D!==_?1:g-p[b]+1;a.setEdge(T,D,{weight:R,minlen:B,nestingEdge:true}),a.setEdge(_,N,{weight:R,minlen:B,nestingEdge:true});}),a.parent(b)||a.setEdge(d,T,{weight:0,minlen:g+p[b]});}function f(a){var d={};function m(x,g){var p=a.children(x);p&&p.length&&p.forEach(b=>m(b,g+1)),d[x]=g;}return a.children().forEach(x=>m(x,1)),d}function u(a){return a.edges().reduce((d,m)=>d+a.edge(m).weight,0)}function h(a){var d=a.graph();a.removeNode(d.nestingRoot),delete d.nestingRoot,a.edges().forEach(m=>{var x=a.edge(m);x.nestingEdge&&a.removeEdge(m);});}},{"./util":27}],10:[function(r,o,i){let c=r("./util");o.exports={run:s,undo:f};function s(u){u.graph().dummyChains=[],u.edges().forEach(h=>l(u,h));}function l(u,h){let a=h.v,d=u.node(a).rank,m=h.w,x=u.node(m).rank,g=h.name,p=u.edge(h),b=p.labelRank;if(x===d+1)return;u.removeEdge(h);let C,T,N;for(N=0,++d;d<x;++N,++d)p.points=[],T={width:0,height:0,edgeLabel:p,edgeObj:h,rank:d},C=c.addDummyNode(u,"edge",T,"_d"),d===b&&(T.width=p.width,T.height=p.height,T.dummy="edge-label",T.labelpos=p.labelpos),u.setEdge(a,C,{weight:p.weight},g),N===0&&u.graph().dummyChains.push(C),a=C;u.setEdge(a,m,{weight:p.weight},g);}function f(u){u.graph().dummyChains.forEach(h=>{let a=u.node(h),d=a.edgeLabel,m;for(u.setEdge(a.edgeObj,d);a.dummy;)m=u.successors(h)[0],u.removeNode(h),d.points.push({x:a.x,y:a.y}),a.dummy==="edge-label"&&(d.x=a.x,d.y=a.y,d.width=a.width,d.height=a.height),h=m,a=u.node(h);});}},{"./util":27}],11:[function(r,o,i){o.exports=c;function c(s,l,f){let u={},h;f.forEach(a=>{let d=s.parent(a),m,x;for(;d;){if(m=s.parent(d),m?(x=u[m],u[m]=d):(x=h,h=d),x&&x!==d){l.setEdge(x,d);return}d=m;}});}},{}],12:[function(r,o,i){o.exports=c;function c(s,l=[]){return l.map(f=>{let u=s.inEdges(f);if(u.length){let h=u.reduce((a,d)=>{let m=s.edge(d),x=s.node(d.v);return {sum:a.sum+m.weight*x.order,weight:a.weight+m.weight}},{sum:0,weight:0});return {v:f,barycenter:h.sum/h.weight,weight:h.weight}}else return {v:f}})}},{}],13:[function(r,o,i){let c=r("@dagrejs/graphlib").Graph,s=r("../util");o.exports=l;function l(u,h,a,d){d||(d=u.nodes());let m=f(u),x=new c({compound:true}).setGraph({root:m}).setDefaultNodeLabel(g=>u.node(g));return d.forEach(g=>{let p=u.node(g),b=u.parent(g);(p.rank===h||p.minRank<=h&&h<=p.maxRank)&&(x.setNode(g),x.setParent(g,b||m),u[a](g).forEach(C=>{let T=C.v===g?C.w:C.v,N=x.edge(T,g),v=N!==void 0?N.weight:0;x.setEdge(T,g,{weight:u.edge(C).weight+v});}),Object.hasOwn(p,"minRank")&&x.setNode(g,{borderLeft:p.borderLeft[h],borderRight:p.borderRight[h]}));}),x}function f(u){for(var h;u.hasNode(h=s.uniqueId("_root")););return h}},{"../util":27,"@dagrejs/graphlib":29}],14:[function(r,o,i){let c=r("../util").zipObject;o.exports=s;function s(f,u){let h=0;for(let a=1;a<u.length;++a)h+=l(f,u[a-1],u[a]);return h}function l(f,u,h){let a=c(h,h.map((b,C)=>C)),d=u.flatMap(b=>f.outEdges(b).map(C=>({pos:a[C.w],weight:f.edge(C).weight})).sort((C,T)=>C.pos-T.pos)),m=1;for(;m<h.length;)m<<=1;let x=2*m-1;m-=1;let g=new Array(x).fill(0),p=0;return d.forEach(b=>{let C=b.pos+m;g[C]+=b.weight;let T=0;for(;C>0;)C%2&&(T+=g[C+1]),C=C-1>>1,g[C]+=b.weight;p+=b.weight*T;}),p}},{"../util":27}],15:[function(r,o,i){let c=r("./init-order"),s=r("./cross-count"),l=r("./sort-subgraph"),f=r("./build-layer-graph"),u=r("./add-subgraph-constraints"),h=r("@dagrejs/graphlib").Graph,a=r("../util");o.exports=d;function d(p,b){if(b&&typeof b.customOrder=="function"){b.customOrder(p,d);return}let C=a.maxRank(p),T=m(p,a.range(1,C+1),"inEdges"),N=m(p,a.range(C-1,-1,-1),"outEdges"),v=c(p);if(g(p,v),b&&b.disableOptimalOrderHeuristic)return;let M=Number.POSITIVE_INFINITY,$;for(let D=0,_=0;_<4;++D,++_){x(D%2?T:N,D%4>=2),v=a.buildLayerMatrix(p);let R=s(p,v);R<M&&(_=0,$=Object.assign({},v),M=R);}g(p,$);}function m(p,b,C){let T=new Map,N=(v,M)=>{T.has(v)||T.set(v,[]),T.get(v).push(M);};for(let v of p.nodes()){let M=p.node(v);if(typeof M.rank=="number"&&N(M.rank,v),typeof M.minRank=="number"&&typeof M.maxRank=="number")for(let $=M.minRank;$<=M.maxRank;$++)$!==M.rank&&N($,v);}return b.map(function(v){return f(p,v,C,T.get(v)||[])})}function x(p,b){let C=new h;p.forEach(function(T){let N=T.graph().root,v=l(T,N,C,b);v.vs.forEach((M,$)=>T.node(M).order=$),u(T,C,v.vs);});}function g(p,b){Object.values(b).forEach(C=>C.forEach((T,N)=>p.node(T).order=N));}},{"../util":27,"./add-subgraph-constraints":11,"./build-layer-graph":13,"./cross-count":14,"./init-order":16,"./sort-subgraph":18,"@dagrejs/graphlib":29}],16:[function(r,o,i){let c=r("../util");o.exports=s;function s(l){let f={},u=l.nodes().filter(g=>!l.children(g).length),h=u.map(g=>l.node(g).rank),a=c.applyWithChunking(Math.max,h),d=c.range(a+1).map(()=>[]);function m(g){if(f[g])return;f[g]=true;let p=l.node(g);d[p.rank].push(g),l.successors(g).forEach(m);}return u.sort((g,p)=>l.node(g).rank-l.node(p).rank).forEach(m),d}},{"../util":27}],17:[function(r,o,i){let c=r("../util");o.exports=s;function s(u,h){let a={};u.forEach((m,x)=>{let g=a[m.v]={indegree:0,in:[],out:[],vs:[m.v],i:x};m.barycenter!==void 0&&(g.barycenter=m.barycenter,g.weight=m.weight);}),h.edges().forEach(m=>{let x=a[m.v],g=a[m.w];x!==void 0&&g!==void 0&&(g.indegree++,x.out.push(a[m.w]));});let d=Object.values(a).filter(m=>!m.indegree);return l(d)}function l(u){let h=[];function a(m){return x=>{x.merged||(x.barycenter===void 0||m.barycenter===void 0||x.barycenter>=m.barycenter)&&f(m,x);}}function d(m){return x=>{x.in.push(m),--x.indegree===0&&u.push(x);}}for(;u.length;){let m=u.pop();h.push(m),m.in.reverse().forEach(a(m)),m.out.forEach(d(m));}return h.filter(m=>!m.merged).map(m=>c.pick(m,["vs","i","barycenter","weight"]))}function f(u,h){let a=0,d=0;u.weight&&(a+=u.barycenter*u.weight,d+=u.weight),h.weight&&(a+=h.barycenter*h.weight,d+=h.weight),u.vs=h.vs.concat(u.vs),u.barycenter=a/d,u.weight=d,u.i=Math.min(h.i,u.i),h.merged=true;}},{"../util":27}],18:[function(r,o,i){let c=r("./barycenter"),s=r("./resolve-conflicts"),l=r("./sort");o.exports=f;function f(a,d,m,x){let g=a.children(d),p=a.node(d),b=p?p.borderLeft:void 0,C=p?p.borderRight:void 0,T={};b&&(g=g.filter($=>$!==b&&$!==C));let N=c(a,g);N.forEach($=>{if(a.children($.v).length){let D=f(a,$.v,m,x);T[$.v]=D,Object.hasOwn(D,"barycenter")&&h($,D);}});let v=s(N,m);u(v,T);let M=l(v,x);if(b&&(M.vs=[b,M.vs,C].flat(true),a.predecessors(b).length)){let $=a.node(a.predecessors(b)[0]),D=a.node(a.predecessors(C)[0]);Object.hasOwn(M,"barycenter")||(M.barycenter=0,M.weight=0),M.barycenter=(M.barycenter*M.weight+$.order+D.order)/(M.weight+2),M.weight+=2;}return M}function u(a,d){a.forEach(m=>{m.vs=m.vs.flatMap(x=>d[x]?d[x].vs:x);});}function h(a,d){a.barycenter!==void 0?(a.barycenter=(a.barycenter*a.weight+d.barycenter*d.weight)/(a.weight+d.weight),a.weight+=d.weight):(a.barycenter=d.barycenter,a.weight=d.weight);}},{"./barycenter":12,"./resolve-conflicts":17,"./sort":19}],19:[function(r,o,i){let c=r("../util");o.exports=s;function s(u,h){let a=c.partition(u,T=>Object.hasOwn(T,"barycenter")),d=a.lhs,m=a.rhs.sort((T,N)=>N.i-T.i),x=[],g=0,p=0,b=0;d.sort(f(!!h)),b=l(x,m,b),d.forEach(T=>{b+=T.vs.length,x.push(T.vs),g+=T.barycenter*T.weight,p+=T.weight,b=l(x,m,b);});let C={vs:x.flat(true)};return p&&(C.barycenter=g/p,C.weight=p),C}function l(u,h,a){let d;for(;h.length&&(d=h[h.length-1]).i<=a;)h.pop(),u.push(d.vs),a++;return a}function f(u){return (h,a)=>h.barycenter<a.barycenter?-1:h.barycenter>a.barycenter?1:u?a.i-h.i:h.i-a.i}},{"../util":27}],20:[function(r,o,i){o.exports=c;function c(f){let u=l(f);f.graph().dummyChains.forEach(h=>{let a=f.node(h),d=a.edgeObj,m=s(f,u,d.v,d.w),x=m.path,g=m.lca,p=0,b=x[p],C=true;for(;h!==d.w;){if(a=f.node(h),C){for(;(b=x[p])!==g&&f.node(b).maxRank<a.rank;)p++;b===g&&(C=false);}if(!C){for(;p<x.length-1&&f.node(b=x[p+1]).minRank<=a.rank;)p++;b=x[p];}f.setParent(h,b),h=f.successors(h)[0];}});}function s(f,u,h,a){let d=[],m=[],x=Math.min(u[h].low,u[a].low),g=Math.max(u[h].lim,u[a].lim),p,b;p=h;do p=f.parent(p),d.push(p);while(p&&(u[p].low>x||g>u[p].lim));for(b=p,p=a;(p=f.parent(p))!==b;)m.push(p);return {path:d.concat(m.reverse()),lca:b}}function l(f){let u={},h=0;function a(d){let m=h;f.children(d).forEach(a),u[d]={low:m,lim:h++};}return f.children().forEach(a),u}},{}],21:[function(r,o,i){let c=r("@dagrejs/graphlib").Graph,s=r("../util");o.exports={positionX:C,findType1Conflicts:l,findType2Conflicts:f,addConflict:h,hasConflict:a,verticalAlignment:d,horizontalCompaction:m,alignCoordinates:p,findSmallestWidthAlignment:g,balance:b};function l(v,M){let $={};function D(_,R){let B=0,z=0,E=_.length,O=R[R.length-1];return R.forEach((L,G)=>{let w=u(v,L),j=w?v.node(w).order:E;(w||L===O)&&(R.slice(z,G+1).forEach(Y=>{v.predecessors(Y).forEach(A=>{let y=v.node(A),S=y.order;(S<B||j<S)&&!(y.dummy&&v.node(Y).dummy)&&h($,A,Y);});}),z=G+1,B=j);}),R}return M.length&&M.reduce(D),$}function f(v,M){let $={};function D(R,B,z,E,O){let L;s.range(B,z).forEach(G=>{L=R[G],v.node(L).dummy&&v.predecessors(L).forEach(w=>{let j=v.node(w);j.dummy&&(j.order<E||j.order>O)&&h($,w,L);});});}function _(R,B){let z=-1,E,O=0;return B.forEach((L,G)=>{if(v.node(L).dummy==="border"){let w=v.predecessors(L);w.length&&(E=v.node(w[0]).order,D(B,O,G,z,E),O=G,z=E);}D(B,O,B.length,E,R.length);}),B}return M.length&&M.reduce(_),$}function u(v,M){if(v.node(M).dummy)return v.predecessors(M).find($=>v.node($).dummy)}function h(v,M,$){if(M>$){let _=M;M=$,$=_;}let D=v[M];D||(v[M]=D={}),D[$]=true;}function a(v,M,$){if(M>$){let D=M;M=$,$=D;}return !!v[M]&&Object.hasOwn(v[M],$)}function d(v,M,$,D){let _={},R={},B={};return M.forEach(z=>{z.forEach((E,O)=>{_[E]=E,R[E]=E,B[E]=O;});}),M.forEach(z=>{let E=-1;z.forEach(O=>{let L=D(O);if(L.length){L=L.sort((w,j)=>B[w]-B[j]);let G=(L.length-1)/2;for(let w=Math.floor(G),j=Math.ceil(G);w<=j;++w){let Y=L[w];R[O]===O&&E<B[Y]&&!a($,O,Y)&&(R[Y]=O,R[O]=_[O]=_[Y],E=B[Y]);}}});}),{root:_,align:R}}function m(v,M,$,D,_){let R={},B=x(v,M,$,_),z=_?"borderLeft":"borderRight";function E(G,w){let j=B.nodes(),Y=j.pop(),A={};for(;Y;)A[Y]?G(Y):(A[Y]=true,j.push(Y),j=j.concat(w(Y))),Y=j.pop();}function O(G){R[G]=B.inEdges(G).reduce((w,j)=>Math.max(w,R[j.v]+B.edge(j)),0);}function L(G){let w=B.outEdges(G).reduce((Y,A)=>Math.min(Y,R[A.w]-B.edge(A)),Number.POSITIVE_INFINITY),j=v.node(G);w!==Number.POSITIVE_INFINITY&&j.borderType!==z&&(R[G]=Math.max(R[G],w));}return E(O,B.predecessors.bind(B)),E(L,B.successors.bind(B)),Object.keys(D).forEach(G=>R[G]=R[$[G]]),R}function x(v,M,$,D){let _=new c,R=v.graph(),B=T(R.nodesep,R.edgesep,D);return M.forEach(z=>{let E;z.forEach(O=>{let L=$[O];if(_.setNode(L),E){var G=$[E],w=_.edge(G,L);_.setEdge(G,L,Math.max(B(v,O,E),w||0));}E=O;});}),_}function g(v,M){return Object.values(M).reduce(($,D)=>{let _=Number.NEGATIVE_INFINITY,R=Number.POSITIVE_INFINITY;Object.entries(D).forEach(([z,E])=>{let O=N(v,z)/2;_=Math.max(E+O,_),R=Math.min(E-O,R);});let B=_-R;return B<$[0]&&($=[B,D]),$},[Number.POSITIVE_INFINITY,null])[1]}function p(v,M){let $=Object.values(M),D=s.applyWithChunking(Math.min,$),_=s.applyWithChunking(Math.max,$);["u","d"].forEach(R=>{["l","r"].forEach(B=>{let z=R+B,E=v[z];if(E===M)return;let O=Object.values(E),L=D-s.applyWithChunking(Math.min,O);B!=="l"&&(L=_-s.applyWithChunking(Math.max,O)),L&&(v[z]=s.mapValues(E,G=>G+L));});});}function b(v,M){return s.mapValues(v.ul,($,D)=>{if(M)return v[M.toLowerCase()][D];{let _=Object.values(v).map(R=>R[D]).sort((R,B)=>R-B);return (_[1]+_[2])/2}})}function C(v){let M=s.buildLayerMatrix(v),$=Object.assign(l(v,M),f(v,M)),D={},_;["u","d"].forEach(B=>{_=B==="u"?M:Object.values(M).reverse(),["l","r"].forEach(z=>{z==="r"&&(_=_.map(G=>Object.values(G).reverse()));let E=(B==="u"?v.predecessors:v.successors).bind(v),O=d(v,_,$,E),L=m(v,_,O.root,O.align,z==="r");z==="r"&&(L=s.mapValues(L,G=>-G)),D[B+z]=L;});});let R=g(v,D);return p(D,R),b(D,v.graph().align)}function T(v,M,$){return (D,_,R)=>{let B=D.node(_),z=D.node(R),E=0,O;if(E+=B.width/2,Object.hasOwn(B,"labelpos"))switch(B.labelpos.toLowerCase()){case "l":O=-B.width/2;break;case "r":O=B.width/2;break}if(O&&(E+=$?O:-O),O=0,E+=(B.dummy?M:v)/2,E+=(z.dummy?M:v)/2,E+=z.width/2,Object.hasOwn(z,"labelpos"))switch(z.labelpos.toLowerCase()){case "l":O=z.width/2;break;case "r":O=-z.width/2;break}return O&&(E+=$?O:-O),O=0,E}}function N(v,M){return v.node(M).width}},{"../util":27,"@dagrejs/graphlib":29}],22:[function(r,o,i){let c=r("../util"),s=r("./bk").positionX;o.exports=l;function l(u){u=c.asNonCompoundGraph(u),f(u),Object.entries(s(u)).forEach(([h,a])=>u.node(h).x=a);}function f(u){let h=c.buildLayerMatrix(u),a=u.graph().ranksep,d=0;h.forEach(m=>{let x=m.reduce((g,p)=>{let b=u.node(p).height;return g>b?g:b},0);m.forEach(g=>u.node(g).y=d+x/2),d+=x+a;});}},{"../util":27,"./bk":21}],23:[function(r,o,i){var c=r("@dagrejs/graphlib").Graph,s=r("./util").slack;o.exports=l;function l(a){var d=new c({directed:false}),m=a.nodes()[0],x=a.nodeCount();d.setNode(m,{});for(var g,p;f(d,a)<x;)g=u(d,a),p=d.hasNode(g.v)?s(a,g):-s(a,g),h(d,a,p);return d}function f(a,d){function m(x){d.nodeEdges(x).forEach(g=>{var p=g.v,b=x===p?g.w:p;!a.hasNode(b)&&!s(d,g)&&(a.setNode(b,{}),a.setEdge(x,b,{}),m(b));});}return a.nodes().forEach(m),a.nodeCount()}function u(a,d){return d.edges().reduce((x,g)=>{let p=Number.POSITIVE_INFINITY;return a.hasNode(g.v)!==a.hasNode(g.w)&&(p=s(d,g)),p<x[0]?[p,g]:x},[Number.POSITIVE_INFINITY,null])[1]}function h(a,d,m){a.nodes().forEach(x=>d.node(x).rank+=m);}},{"./util":26,"@dagrejs/graphlib":29}],24:[function(r,o,i){var c=r("./util"),s=c.longestPath,l=r("./feasible-tree"),f=r("./network-simplex");o.exports=u;function u(m){var x=m.graph().ranker;if(x instanceof Function)return x(m);switch(m.graph().ranker){case "network-simplex":d(m);break;case "tight-tree":a(m);break;case "longest-path":h(m);break;case "none":break;default:d(m);}}var h=s;function a(m){s(m),l(m);}function d(m){f(m);}},{"./feasible-tree":23,"./network-simplex":25,"./util":26}],25:[function(r,o,i){var c=r("./feasible-tree"),s=r("./util").slack,l=r("./util").longestPath,f=r("@dagrejs/graphlib").alg.preorder,u=r("@dagrejs/graphlib").alg.postorder,h=r("../util").simplify;o.exports=a,a.initLowLimValues=g,a.initCutValues=d,a.calcCutValue=x,a.leaveEdge=b,a.enterEdge=C,a.exchangeEdges=T;function a($){$=h($),l($);var D=c($);g(D),d(D,$);for(var _,R;_=b(D);)R=C(D,$,_),T(D,$,_,R);}function d($,D){var _=u($,$.nodes());_=_.slice(0,_.length-1),_.forEach(R=>m($,D,R));}function m($,D,_){var R=$.node(_),B=R.parent;$.edge(_,B).cutvalue=x($,D,_);}function x($,D,_){var R=$.node(_),B=R.parent,z=true,E=D.edge(_,B),O=0;return E||(z=false,E=D.edge(B,_)),O=E.weight,D.nodeEdges(_).forEach(L=>{var G=L.v===_,w=G?L.w:L.v;if(w!==B){var j=G===z,Y=D.edge(L).weight;if(O+=j?Y:-Y,v($,_,w)){var A=$.edge(_,w).cutvalue;O+=j?-A:A;}}}),O}function g($,D){arguments.length<2&&(D=$.nodes()[0]),p($,{},1,D);}function p($,D,_,R,B){var z=_,E=$.node(R);return D[R]=true,$.neighbors(R).forEach(O=>{Object.hasOwn(D,O)||(_=p($,D,_,O,R));}),E.low=z,E.lim=_++,B?E.parent=B:delete E.parent,_}function b($){return $.edges().find(D=>$.edge(D).cutvalue<0)}function C($,D,_){var R=_.v,B=_.w;D.hasEdge(R,B)||(R=_.w,B=_.v);var z=$.node(R),E=$.node(B),O=z,L=false;z.lim>E.lim&&(O=E,L=true);var G=D.edges().filter(w=>L===M($,$.node(w.v),O)&&L!==M($,$.node(w.w),O));return G.reduce((w,j)=>s(D,j)<s(D,w)?j:w)}function T($,D,_,R){var B=_.v,z=_.w;$.removeEdge(B,z),$.setEdge(R.v,R.w,{}),g($),d($,D),N($,D);}function N($,D){var _=$.nodes().find(B=>!D.node(B).parent),R=f($,_);R=R.slice(1),R.forEach(B=>{var z=$.node(B).parent,E=D.edge(B,z),O=false;E||(E=D.edge(z,B),O=true),D.node(B).rank=D.node(z).rank+(O?E.minlen:-E.minlen);});}function v($,D,_){return $.hasEdge(D,_)}function M($,D,_){return _.low<=D.lim&&D.lim<=_.lim}},{"../util":27,"./feasible-tree":23,"./util":26,"@dagrejs/graphlib":29}],26:[function(r,o,i){let{applyWithChunking:c}=r("../util");o.exports={longestPath:s,slack:l};function s(f){var u={};function h(a){var d=f.node(a);if(Object.hasOwn(u,a))return d.rank;u[a]=true;let m=f.outEdges(a).map(g=>g==null?Number.POSITIVE_INFINITY:h(g.w)-f.edge(g).minlen);var x=c(Math.min,m);return x===Number.POSITIVE_INFINITY&&(x=0),d.rank=x}f.sources().forEach(h);}function l(f,u){return f.node(u.w).rank-f.node(u.v).rank-f.edge(u).minlen}},{"../util":27}],27:[function(r,o,i){let c=r("@dagrejs/graphlib").Graph;o.exports={addBorderNode:g,addDummyNode:s,applyWithChunking:C,asNonCompoundGraph:f,buildLayerMatrix:d,intersectRect:a,mapValues:B,maxRank:T,normalizeRanks:m,notime:M,partition:N,pick:R,predecessorWeights:h,range:_,removeEmptyRanks:x,simplify:l,successorWeights:u,time:v,uniqueId:D,zipObject:z};function s(E,O,L,G){for(var w=G;E.hasNode(w);)w=D(G);return L.dummy=O,E.setNode(w,L),w}function l(E){let O=new c().setGraph(E.graph());return E.nodes().forEach(L=>O.setNode(L,E.node(L))),E.edges().forEach(L=>{let G=O.edge(L.v,L.w)||{weight:0,minlen:1},w=E.edge(L);O.setEdge(L.v,L.w,{weight:G.weight+w.weight,minlen:Math.max(G.minlen,w.minlen)});}),O}function f(E){let O=new c({multigraph:E.isMultigraph()}).setGraph(E.graph());return E.nodes().forEach(L=>{E.children(L).length||O.setNode(L,E.node(L));}),E.edges().forEach(L=>{O.setEdge(L,E.edge(L));}),O}function u(E){let O=E.nodes().map(L=>{let G={};return E.outEdges(L).forEach(w=>{G[w.w]=(G[w.w]||0)+E.edge(w).weight;}),G});return z(E.nodes(),O)}function h(E){let O=E.nodes().map(L=>{let G={};return E.inEdges(L).forEach(w=>{G[w.v]=(G[w.v]||0)+E.edge(w).weight;}),G});return z(E.nodes(),O)}function a(E,O){let L=E.x,G=E.y,w=O.x-L,j=O.y-G,Y=E.width/2,A=E.height/2;if(!w&&!j)throw new Error("Not possible to find intersection inside of the rectangle");let y,S;return Math.abs(j)*Y>Math.abs(w)*A?(j<0&&(A=-A),y=A*w/j,S=A):(w<0&&(Y=-Y),y=Y,S=Y*j/w),{x:L+y,y:G+S}}function d(E){let O=_(T(E)+1).map(()=>[]);return E.nodes().forEach(L=>{let G=E.node(L),w=G.rank;w!==void 0&&(O[w][G.order]=L);}),O}function m(E){let O=E.nodes().map(G=>{let w=E.node(G).rank;return w===void 0?Number.MAX_VALUE:w}),L=C(Math.min,O);E.nodes().forEach(G=>{let w=E.node(G);Object.hasOwn(w,"rank")&&(w.rank-=L);});}function x(E){let O=E.nodes().map(Y=>E.node(Y).rank),L=C(Math.min,O),G=[];E.nodes().forEach(Y=>{let A=E.node(Y).rank-L;G[A]||(G[A]=[]),G[A].push(Y);});let w=0,j=E.graph().nodeRankFactor;Array.from(G).forEach((Y,A)=>{Y===void 0&&A%j!==0?--w:Y!==void 0&&w&&Y.forEach(y=>E.node(y).rank+=w);});}function g(E,O,L,G){let w={width:0,height:0};return arguments.length>=4&&(w.rank=L,w.order=G),s(E,"border",w,O)}function p(E,O=b){let L=[];for(let G=0;G<E.length;G+=O){let w=E.slice(G,G+O);L.push(w);}return L}let b=65535;function C(E,O){if(O.length>b){let L=p(O);return E.apply(null,L.map(G=>E.apply(null,G)))}else return E.apply(null,O)}function T(E){let L=E.nodes().map(G=>{let w=E.node(G).rank;return w===void 0?Number.MIN_VALUE:w});return C(Math.max,L)}function N(E,O){let L={lhs:[],rhs:[]};return E.forEach(G=>{O(G)?L.lhs.push(G):L.rhs.push(G);}),L}function v(E,O){let L=Date.now();try{return O()}finally{console.log(E+" time: "+(Date.now()-L)+"ms");}}function M(E,O){return O()}let $=0;function D(E){var O=++$;return E+(""+O)}function _(E,O,L=1){O==null&&(O=E,E=0);let G=j=>j<O;L<0&&(G=j=>O<j);let w=[];for(let j=E;G(j);j+=L)w.push(j);return w}function R(E,O){let L={};for(let G of O)E[G]!==void 0&&(L[G]=E[G]);return L}function B(E,O){let L=O;return typeof O=="string"&&(L=G=>G[O]),Object.entries(E).reduce((G,[w,j])=>(G[w]=L(j,w),G),{})}function z(E,O){return E.reduce((L,G,w)=>(L[G]=O[w],L),{})}},{"@dagrejs/graphlib":29}],28:[function(r,o,i){o.exports="1.1.8";},{}],29:[function(r,o,i){var c=r("./lib");o.exports={Graph:c.Graph,json:r("./lib/json"),alg:r("./lib/alg"),version:c.version};},{"./lib":45,"./lib/alg":36,"./lib/json":46}],30:[function(r,o,i){o.exports=c;function c(s){var l={},f=[],u;function h(a){Object.hasOwn(l,a)||(l[a]=true,u.push(a),s.successors(a).forEach(h),s.predecessors(a).forEach(h));}return s.nodes().forEach(function(a){u=[],h(a),u.length&&f.push(u);}),f}},{}],31:[function(r,o,i){o.exports=c;function c(u,h,a){Array.isArray(h)||(h=[h]);var d=u.isDirected()?p=>u.successors(p):p=>u.neighbors(p),m=a==="post"?s:l,x=[],g={};return h.forEach(p=>{if(!u.hasNode(p))throw new Error("Graph does not have node: "+p);m(p,d,g,x);}),x}function s(u,h,a,d){for(var m=[[u,false]];m.length>0;){var x=m.pop();x[1]?d.push(x[0]):Object.hasOwn(a,x[0])||(a[x[0]]=true,m.push([x[0],true]),f(h(x[0]),g=>m.push([g,false])));}}function l(u,h,a,d){for(var m=[u];m.length>0;){var x=m.pop();Object.hasOwn(a,x)||(a[x]=true,d.push(x),f(h(x),g=>m.push(g)));}}function f(u,h){for(var a=u.length;a--;)h(u[a],a,u);return u}},{}],32:[function(r,o,i){var c=r("./dijkstra");o.exports=s;function s(l,f,u){return l.nodes().reduce(function(h,a){return h[a]=c(l,a,f,u),h},{})}},{"./dijkstra":33}],33:[function(r,o,i){var c=r("../data/priority-queue");o.exports=l;var s=()=>1;function l(u,h,a,d){return f(u,String(h),a||s,d||function(m){return u.outEdges(m)})}function f(u,h,a,d){var m={},x=new c,g,p,b=function(C){var T=C.v!==g?C.v:C.w,N=m[T],v=a(C),M=p.distance+v;if(v<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+C+" Weight: "+v);M<N.distance&&(N.distance=M,N.predecessor=g,x.decrease(T,M));};for(u.nodes().forEach(function(C){var T=C===h?0:Number.POSITIVE_INFINITY;m[C]={distance:T},x.add(C,T);});x.size()>0&&(g=x.removeMin(),p=m[g],p.distance!==Number.POSITIVE_INFINITY);)d(g).forEach(b);return m}},{"../data/priority-queue":43}],34:[function(r,o,i){var c=r("./tarjan");o.exports=s;function s(l){return c(l).filter(function(f){return f.length>1||f.length===1&&l.hasEdge(f[0],f[0])})}},{"./tarjan":41}],35:[function(r,o,i){o.exports=s;var c=()=>1;function s(f,u,h){return l(f,u||c,h||function(a){return f.outEdges(a)})}function l(f,u,h){var a={},d=f.nodes();return d.forEach(function(m){a[m]={},a[m][m]={distance:0},d.forEach(function(x){m!==x&&(a[m][x]={distance:Number.POSITIVE_INFINITY});}),h(m).forEach(function(x){var g=x.v===m?x.w:x.v,p=u(x);a[m][g]={distance:p,predecessor:m};});}),d.forEach(function(m){var x=a[m];d.forEach(function(g){var p=a[g];d.forEach(function(b){var C=p[m],T=x[b],N=p[b],v=C.distance+T.distance;v<N.distance&&(N.distance=v,N.predecessor=T.predecessor);});});}),a}},{}],36:[function(r,o,i){o.exports={components:r("./components"),dijkstra:r("./dijkstra"),dijkstraAll:r("./dijkstra-all"),findCycles:r("./find-cycles"),floydWarshall:r("./floyd-warshall"),isAcyclic:r("./is-acyclic"),postorder:r("./postorder"),preorder:r("./preorder"),prim:r("./prim"),tarjan:r("./tarjan"),topsort:r("./topsort")};},{"./components":30,"./dijkstra":33,"./dijkstra-all":32,"./find-cycles":34,"./floyd-warshall":35,"./is-acyclic":37,"./postorder":38,"./preorder":39,"./prim":40,"./tarjan":41,"./topsort":42}],37:[function(r,o,i){var c=r("./topsort");o.exports=s;function s(l){try{c(l);}catch(f){if(f instanceof c.CycleException)return  false;throw f}return  true}},{"./topsort":42}],38:[function(r,o,i){var c=r("./dfs");o.exports=s;function s(l,f){return c(l,f,"post")}},{"./dfs":31}],39:[function(r,o,i){var c=r("./dfs");o.exports=s;function s(l,f){return c(l,f,"pre")}},{"./dfs":31}],40:[function(r,o,i){var c=r("../graph"),s=r("../data/priority-queue");o.exports=l;function l(f,u){var h=new c,a={},d=new s,m;function x(p){var b=p.v===m?p.w:p.v,C=d.priority(b);if(C!==void 0){var T=u(p);T<C&&(a[b]=m,d.decrease(b,T));}}if(f.nodeCount()===0)return h;f.nodes().forEach(function(p){d.add(p,Number.POSITIVE_INFINITY),h.setNode(p);}),d.decrease(f.nodes()[0],0);for(var g=false;d.size()>0;){if(m=d.removeMin(),Object.hasOwn(a,m))h.setEdge(m,a[m]);else {if(g)throw new Error("Input graph is not connected: "+f);g=true;}f.nodeEdges(m).forEach(x);}return h}},{"../data/priority-queue":43,"../graph":44}],41:[function(r,o,i){o.exports=c;function c(s){var l=0,f=[],u={},h=[];function a(d){var m=u[d]={onStack:true,lowlink:l,index:l++};if(f.push(d),s.successors(d).forEach(function(p){Object.hasOwn(u,p)?u[p].onStack&&(m.lowlink=Math.min(m.lowlink,u[p].index)):(a(p),m.lowlink=Math.min(m.lowlink,u[p].lowlink));}),m.lowlink===m.index){var x=[],g;do g=f.pop(),u[g].onStack=false,x.push(g);while(d!==g);h.push(x);}}return s.nodes().forEach(function(d){Object.hasOwn(u,d)||a(d);}),h}},{}],42:[function(r,o,i){function c(l){var f={},u={},h=[];function a(d){if(Object.hasOwn(u,d))throw new s;Object.hasOwn(f,d)||(u[d]=true,f[d]=true,l.predecessors(d).forEach(a),delete u[d],h.push(d));}if(l.sinks().forEach(a),Object.keys(f).length!==l.nodeCount())throw new s;return h}class s extends Error{constructor(){super(...arguments);}}o.exports=c,c.CycleException=s;},{}],43:[function(r,o,i){class c{_arr=[];_keyIndices={};size(){return this._arr.length}keys(){return this._arr.map(function(l){return l.key})}has(l){return Object.hasOwn(this._keyIndices,l)}priority(l){var f=this._keyIndices[l];if(f!==void 0)return this._arr[f].priority}min(){if(this.size()===0)throw new Error("Queue underflow");return this._arr[0].key}add(l,f){var u=this._keyIndices;if(l=String(l),!Object.hasOwn(u,l)){var h=this._arr,a=h.length;return u[l]=a,h.push({key:l,priority:f}),this._decrease(a),true}return  false}removeMin(){this._swap(0,this._arr.length-1);var l=this._arr.pop();return delete this._keyIndices[l.key],this._heapify(0),l.key}decrease(l,f){var u=this._keyIndices[l];if(f>this._arr[u].priority)throw new Error("New priority is greater than current priority. Key: "+l+" Old: "+this._arr[u].priority+" New: "+f);this._arr[u].priority=f,this._decrease(u);}_heapify(l){var f=this._arr,u=2*l,h=u+1,a=l;u<f.length&&(a=f[u].priority<f[a].priority?u:a,h<f.length&&(a=f[h].priority<f[a].priority?h:a),a!==l&&(this._swap(l,a),this._heapify(a)));}_decrease(l){for(var f=this._arr,u=f[l].priority,h;l!==0&&(h=l>>1,!(f[h].priority<u));)this._swap(l,h),l=h;}_swap(l,f){var u=this._arr,h=this._keyIndices,a=u[l],d=u[f];u[l]=d,u[f]=a,h[d.key]=l,h[a.key]=f;}}o.exports=c;},{}],44:[function(r,o,i){var c="\0",s="\0",l="";class f{_isDirected=true;_isMultigraph=false;_isCompound=false;_label;_defaultNodeLabelFn=()=>{};_defaultEdgeLabelFn=()=>{};_nodes={};_in={};_preds={};_out={};_sucs={};_edgeObjs={};_edgeLabels={};_nodeCount=0;_edgeCount=0;_parent;_children;constructor(g){g&&(this._isDirected=Object.hasOwn(g,"directed")?g.directed:true,this._isMultigraph=Object.hasOwn(g,"multigraph")?g.multigraph:false,this._isCompound=Object.hasOwn(g,"compound")?g.compound:false),this._isCompound&&(this._parent={},this._children={},this._children[s]={});}isDirected(){return this._isDirected}isMultigraph(){return this._isMultigraph}isCompound(){return this._isCompound}setGraph(g){return this._label=g,this}graph(){return this._label}setDefaultNodeLabel(g){return this._defaultNodeLabelFn=g,typeof g!="function"&&(this._defaultNodeLabelFn=()=>g),this}nodeCount(){return this._nodeCount}nodes(){return Object.keys(this._nodes)}sources(){var g=this;return this.nodes().filter(p=>Object.keys(g._in[p]).length===0)}sinks(){var g=this;return this.nodes().filter(p=>Object.keys(g._out[p]).length===0)}setNodes(g,p){var b=arguments,C=this;return g.forEach(function(T){b.length>1?C.setNode(T,p):C.setNode(T);}),this}setNode(g,p){return Object.hasOwn(this._nodes,g)?(arguments.length>1&&(this._nodes[g]=p),this):(this._nodes[g]=arguments.length>1?p:this._defaultNodeLabelFn(g),this._isCompound&&(this._parent[g]=s,this._children[g]={},this._children[s][g]=true),this._in[g]={},this._preds[g]={},this._out[g]={},this._sucs[g]={},++this._nodeCount,this)}node(g){return this._nodes[g]}hasNode(g){return Object.hasOwn(this._nodes,g)}removeNode(g){var p=this;if(Object.hasOwn(this._nodes,g)){var b=C=>p.removeEdge(p._edgeObjs[C]);delete this._nodes[g],this._isCompound&&(this._removeFromParentsChildList(g),delete this._parent[g],this.children(g).forEach(function(C){p.setParent(C);}),delete this._children[g]),Object.keys(this._in[g]).forEach(b),delete this._in[g],delete this._preds[g],Object.keys(this._out[g]).forEach(b),delete this._out[g],delete this._sucs[g],--this._nodeCount;}return this}setParent(g,p){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(p===void 0)p=s;else {p+="";for(var b=p;b!==void 0;b=this.parent(b))if(b===g)throw new Error("Setting "+p+" as parent of "+g+" would create a cycle");this.setNode(p);}return this.setNode(g),this._removeFromParentsChildList(g),this._parent[g]=p,this._children[p][g]=true,this}_removeFromParentsChildList(g){delete this._children[this._parent[g]][g];}parent(g){if(this._isCompound){var p=this._parent[g];if(p!==s)return p}}children(g=s){if(this._isCompound){var p=this._children[g];if(p)return Object.keys(p)}else {if(g===s)return this.nodes();if(this.hasNode(g))return []}}predecessors(g){var p=this._preds[g];if(p)return Object.keys(p)}successors(g){var p=this._sucs[g];if(p)return Object.keys(p)}neighbors(g){var p=this.predecessors(g);if(p){let C=new Set(p);for(var b of this.successors(g))C.add(b);return Array.from(C.values())}}isLeaf(g){var p;return this.isDirected()?p=this.successors(g):p=this.neighbors(g),p.length===0}filterNodes(g){var p=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});p.setGraph(this.graph());var b=this;Object.entries(this._nodes).forEach(function([N,v]){g(N)&&p.setNode(N,v);}),Object.values(this._edgeObjs).forEach(function(N){p.hasNode(N.v)&&p.hasNode(N.w)&&p.setEdge(N,b.edge(N));});var C={};function T(N){var v=b.parent(N);return v===void 0||p.hasNode(v)?(C[N]=v,v):v in C?C[v]:T(v)}return this._isCompound&&p.nodes().forEach(N=>p.setParent(N,T(N))),p}setDefaultEdgeLabel(g){return this._defaultEdgeLabelFn=g,typeof g!="function"&&(this._defaultEdgeLabelFn=()=>g),this}edgeCount(){return this._edgeCount}edges(){return Object.values(this._edgeObjs)}setPath(g,p){var b=this,C=arguments;return g.reduce(function(T,N){return C.length>1?b.setEdge(T,N,p):b.setEdge(T,N),N}),this}setEdge(){var g,p,b,C,T=false,N=arguments[0];typeof N=="object"&&N!==null&&"v"in N?(g=N.v,p=N.w,b=N.name,arguments.length===2&&(C=arguments[1],T=true)):(g=N,p=arguments[1],b=arguments[3],arguments.length>2&&(C=arguments[2],T=true)),g=""+g,p=""+p,b!==void 0&&(b=""+b);var v=a(this._isDirected,g,p,b);if(Object.hasOwn(this._edgeLabels,v))return T&&(this._edgeLabels[v]=C),this;if(b!==void 0&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(g),this.setNode(p),this._edgeLabels[v]=T?C:this._defaultEdgeLabelFn(g,p,b);var M=d(this._isDirected,g,p,b);return g=M.v,p=M.w,Object.freeze(M),this._edgeObjs[v]=M,u(this._preds[p],g),u(this._sucs[g],p),this._in[p][v]=M,this._out[g][v]=M,this._edgeCount++,this}edge(g,p,b){var C=arguments.length===1?m(this._isDirected,arguments[0]):a(this._isDirected,g,p,b);return this._edgeLabels[C]}edgeAsObj(){let g=this.edge(...arguments);return typeof g!="object"?{label:g}:g}hasEdge(g,p,b){var C=arguments.length===1?m(this._isDirected,arguments[0]):a(this._isDirected,g,p,b);return Object.hasOwn(this._edgeLabels,C)}removeEdge(g,p,b){var C=arguments.length===1?m(this._isDirected,arguments[0]):a(this._isDirected,g,p,b),T=this._edgeObjs[C];return T&&(g=T.v,p=T.w,delete this._edgeLabels[C],delete this._edgeObjs[C],h(this._preds[p],g),h(this._sucs[g],p),delete this._in[p][C],delete this._out[g][C],this._edgeCount--),this}inEdges(g,p){var b=this._in[g];if(b){var C=Object.values(b);return p?C.filter(T=>T.v===p):C}}outEdges(g,p){var b=this._out[g];if(b){var C=Object.values(b);return p?C.filter(T=>T.w===p):C}}nodeEdges(g,p){var b=this.inEdges(g,p);if(b)return b.concat(this.outEdges(g,p))}}function u(x,g){x[g]?x[g]++:x[g]=1;}function h(x,g){--x[g]||delete x[g];}function a(x,g,p,b){var C=""+g,T=""+p;if(!x&&C>T){var N=C;C=T,T=N;}return C+l+T+l+(b===void 0?c:b)}function d(x,g,p,b){var C=""+g,T=""+p;if(!x&&C>T){var N=C;C=T,T=N;}var v={v:C,w:T};return b&&(v.name=b),v}function m(x,g){return a(x,g.v,g.w,g.name)}o.exports=f;},{}],45:[function(r,o,i){o.exports={Graph:r("./graph"),version:r("./version")};},{"./graph":44,"./version":47}],46:[function(r,o,i){var c=r("./graph");o.exports={write:s,read:u};function s(h){var a={options:{directed:h.isDirected(),multigraph:h.isMultigraph(),compound:h.isCompound()},nodes:l(h),edges:f(h)};return h.graph()!==void 0&&(a.value=structuredClone(h.graph())),a}function l(h){return h.nodes().map(function(a){var d=h.node(a),m=h.parent(a),x={v:a};return d!==void 0&&(x.value=d),m!==void 0&&(x.parent=m),x})}function f(h){return h.edges().map(function(a){var d=h.edge(a),m={v:a.v,w:a.w};return a.name!==void 0&&(m.name=a.name),d!==void 0&&(m.value=d),m})}function u(h){var a=new c(h.options).setGraph(h.value);return h.nodes.forEach(function(d){a.setNode(d.v,d.value),d.parent&&a.setParent(d.v,d.parent);}),h.edges.forEach(function(d){a.setEdge({v:d.v,w:d.w,name:d.name},d.value);}),a}},{"./graph":44}],47:[function(r,o,i){o.exports="2.2.4";},{}]},{},[1])(1)});});var Wt={bg:"#FFFFFF",fg:"#27272A"},Mt={textSec:60,textMuted:40,textFaint:25,line:30,arrow:50,nodeFill:3,nodeStroke:20,groupHeader:5,innerStroke:12,keyBadge:10},$e={"zinc-light":{bg:"#FFFFFF",fg:"#27272A"},"zinc-dark":{bg:"#18181B",fg:"#FAFAFA"},"tokyo-night":{bg:"#1a1b26",fg:"#a9b1d6",line:"#3d59a1",accent:"#7aa2f7",muted:"#565f89"},"tokyo-night-storm":{bg:"#24283b",fg:"#a9b1d6",line:"#3d59a1",accent:"#7aa2f7",muted:"#565f89"},"tokyo-night-light":{bg:"#d5d6db",fg:"#343b58",line:"#34548a",accent:"#34548a",muted:"#9699a3"},"catppuccin-mocha":{bg:"#1e1e2e",fg:"#cdd6f4",line:"#585b70",accent:"#cba6f7",muted:"#6c7086"},"catppuccin-latte":{bg:"#eff1f5",fg:"#4c4f69",line:"#9ca0b0",accent:"#8839ef",muted:"#9ca0b0"},nord:{bg:"#2e3440",fg:"#d8dee9",line:"#4c566a",accent:"#88c0d0",muted:"#616e88"},"nord-light":{bg:"#eceff4",fg:"#2e3440",line:"#aab1c0",accent:"#5e81ac",muted:"#7b88a1"},dracula:{bg:"#282a36",fg:"#f8f8f2",line:"#6272a4",accent:"#bd93f9",muted:"#6272a4"},"github-light":{bg:"#ffffff",fg:"#1f2328",line:"#d1d9e0",accent:"#0969da",muted:"#59636e"},"github-dark":{bg:"#0d1117",fg:"#e6edf3",line:"#3d444d",accent:"#4493f8",muted:"#9198a1"},"solarized-light":{bg:"#fdf6e3",fg:"#657b83",line:"#93a1a1",accent:"#268bd2",muted:"#93a1a1"},"solarized-dark":{bg:"#002b36",fg:"#839496",line:"#586e75",accent:"#268bd2",muted:"#586e75"},"one-dark":{bg:"#282c34",fg:"#abb2bf",line:"#4b5263",accent:"#c678dd",muted:"#5c6370"}};function Ee(t){let e=t.colors??{},n=t.type==="dark",r=o=>t.tokenColors?.find(i=>Array.isArray(i.scope)?i.scope.includes(o):i.scope===o)?.settings?.foreground;return {bg:e["editor.background"]??(n?"#1e1e1e":"#ffffff"),fg:e["editor.foreground"]??(n?"#d4d4d4":"#333333"),line:e["editorLineNumber.foreground"]??void 0,accent:e.focusBorder??r("keyword")??void 0,muted:r("comment")??e["editorLineNumber.foreground"]??void 0,surface:e["editor.selectionBackground"]??void 0,border:e["editorWidget.border"]??void 0}}function Tt(t,e){let n=[`@import url('https://fonts.googleapis.com/css2?family=${encodeURIComponent(t)}:wght@400;500;600;700&amp;display=swap');`,...e?["@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&amp;display=swap');"]:[]],r=`
    /* Derived from --bg and --fg (overridable via --line, --accent, etc.) */
    --_text:          var(--fg);
    --_text-sec:      var(--muted, color-mix(in srgb, var(--fg) ${Mt.textSec}%, var(--bg)));
    --_text-muted:    var(--muted, color-mix(in srgb, var(--fg) ${Mt.textMuted}%, var(--bg)));
    --_text-faint:    color-mix(in srgb, var(--fg) ${Mt.textFaint}%, var(--bg));
    --_line:          var(--line, color-mix(in srgb, var(--fg) ${Mt.line}%, var(--bg)));
    --_arrow:         var(--accent, color-mix(in srgb, var(--fg) ${Mt.arrow}%, var(--bg)));
    --_node-fill:     var(--surface, color-mix(in srgb, var(--fg) ${Mt.nodeFill}%, var(--bg)));
    --_node-stroke:   var(--border, color-mix(in srgb, var(--fg) ${Mt.nodeStroke}%, var(--bg)));
    --_group-fill:    var(--bg);
    --_group-hdr:     color-mix(in srgb, var(--fg) ${Mt.groupHeader}%, var(--bg));
    --_inner-stroke:  color-mix(in srgb, var(--fg) ${Mt.innerStroke}%, var(--bg));
    --_key-badge:     color-mix(in srgb, var(--fg) ${Mt.keyBadge}%, var(--bg));`;return ["<style>",`  ${n.join(`
  `)}`,`  text { font-family: '${t}', system-ui, sans-serif; }`,...e?["  .mono { font-family: 'JetBrains Mono', 'SF Mono', 'Fira Code', ui-monospace, monospace; }"]:[],`  svg {${r}`,"  }","</style>"].join(`
`)}function Pt(t,e,n,r){let o=[`--bg:${n.bg}`,`--fg:${n.fg}`,n.line?`--line:${n.line}`:"",n.accent?`--accent:${n.accent}`:"",n.muted?`--muted:${n.muted}`:"",n.surface?`--surface:${n.surface}`:"",n.border?`--border:${n.border}`:""].filter(Boolean).join(";");return `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${t} ${e}" width="${t}" height="${e}" style="${o}${r?"":";background:var(--bg)"}">`}function ie(t){let e=t.split(/[\n;]/).map(r=>r.trim()).filter(r=>r.length>0&&!r.startsWith("%%"));if(e.length===0)throw new Error("Empty mermaid diagram");let n=e[0];return /^stateDiagram(-v2)?\s*$/i.test(n)?Br(e):Gr(e)}function Gr(t){let e=t[0].match(/^(?:graph|flowchart)\s+(TD|TB|LR|BT|RL)\s*$/i);if(!e)throw new Error(`Invalid mermaid header: "${t[0]}". Expected "graph TD", "flowchart LR", "stateDiagram-v2", etc.`);let r={direction:e[1].toUpperCase(),nodes:new Map,edges:[],subgraphs:[],classDefs:new Map,classAssignments:new Map,nodeStyles:new Map},o=[];for(let i=1;i<t.length;i++){let c=t[i],s=c.match(/^classDef\s+(\w+)\s+(.+)$/);if(s){let a=s[1],d=s[2],m=nn(d);r.classDefs.set(a,m);continue}let l=c.match(/^class\s+([^\s]+)\s+(\w+)$/);if(l){let a=l[1].split(",").map(m=>m.trim()),d=l[2];for(let m of a)r.classAssignments.set(m,d);continue}let f=c.match(/^style\s+([^\s]+)\s+(.+)$/);if(f){let a=f[1].split(",").map(m=>m.trim()),d=nn(f[2]);for(let m of a)r.nodeStyles.set(m,{...r.nodeStyles.get(m),...d});continue}let u=c.match(/^direction\s+(TD|TB|LR|BT|RL)\s*$/i);if(u&&o.length>0){o[o.length-1].direction=u[1].toUpperCase();continue}let h=c.match(/^subgraph\s+(.+)$/);if(h){let a=h[1].trim(),d=a.match(/^([\p{L}\p{N}_-]+)\s*\[(.+)\]$/u),m,x;d?(m=d[1],x=d[2]):(x=a,m=a.replace(/\s+/g,"_").replace(/[^\p{L}\p{N}_]/gu,""));let g={id:m,label:x,nodeIds:[],children:[]};o.push(g);continue}if(c==="end"){let a=o.pop();a&&(o.length>0?o[o.length-1].children.push(a):r.subgraphs.push(a));continue}Wr(c,r,o);}return r}function Br(t){let e={direction:"TD",nodes:new Map,edges:[],subgraphs:[],classDefs:new Map,classAssignments:new Map,nodeStyles:new Map},n=[],r=0,o=0;for(let i=1;i<t.length;i++){let c=t[i],s=c.match(/^direction\s+(TD|TB|LR|BT|RL)\s*$/i);if(s){n.length>0?n[n.length-1].direction=s[1].toUpperCase():e.direction=s[1].toUpperCase();continue}let l=c.match(/^state\s+(?:"([^"]+)"\s+as\s+)?([\p{L}\p{N}_-]+)\s*\{$/u);if(l){let a=l[1]??l[2],m={id:l[2],label:a,nodeIds:[],children:[]};n.push(m);continue}if(c==="}"){let a=n.pop();a&&(n.length>0?n[n.length-1].children.push(a):e.subgraphs.push(a));continue}let f=c.match(/^state\s+"([^"]+)"\s+as\s+([\p{L}\p{N}_-]+)\s*$/u);if(f){let a=f[1],d=f[2];oe(e,n,{id:d,label:a,shape:"rounded"});continue}let u=c.match(/^(\[\*\]|[\p{L}\p{N}_-]+)\s*(-->)\s*(\[\*\]|[\p{L}\p{N}_-]+)(?:\s*:\s*(.+))?$/u);if(u){let a=u[1],d=u[3],m=u[4]?.trim()||void 0;a==="[*]"?(r++,a=`_start${r>1?r:""}`,oe(e,n,{id:a,label:"",shape:"state-start"})):en(e,n,a),d==="[*]"?(o++,d=`_end${o>1?o:""}`,oe(e,n,{id:d,label:"",shape:"state-end"})):en(e,n,d),e.edges.push({source:a,target:d,label:m,style:"solid",hasArrowStart:false,hasArrowEnd:true});continue}let h=c.match(/^([\p{L}\p{N}_-]+)\s*:\s*(.+)$/u);if(h){let a=h[1],d=h[2].trim();oe(e,n,{id:a,label:d,shape:"rounded"});continue}}return e}function oe(t,e,n){if(!t.nodes.has(n.id)&&t.nodes.set(n.id,n),e.length>0){let o=e[e.length-1];o.nodeIds.includes(n.id)||o.nodeIds.push(n.id);}}function en(t,e,n){if(!t.nodes.has(n))oe(t,e,{id:n,label:n,shape:"rounded"});else if(e.length>0){let r=e[e.length-1];r.nodeIds.includes(n)||r.nodeIds.push(n);}}function nn(t){let e={};for(let n of t.split(",")){let r=n.indexOf(":");if(r>0){let o=n.slice(0,r).trim(),i=n.slice(r+1).trim();o&&i&&(e[o]=i);}}return e}var an=/^(<)?(-->|-.->|==>|---|-\.-|===)(?:\|([^|]*)\|)?/,Xr=[{regex:/^([\p{L}\p{N}_-]+)\(\(\((.+?)\)\)\)/u,shape:"doublecircle"},{regex:/^([\p{L}\p{N}_-]+)\(\[(.+?)\]\)/u,shape:"stadium"},{regex:/^([\p{L}\p{N}_-]+)\(\((.+?)\)\)/u,shape:"circle"},{regex:/^([\p{L}\p{N}_-]+)\[\[(.+?)\]\]/u,shape:"subroutine"},{regex:/^([\p{L}\p{N}_-]+)\[\((.+?)\)\]/u,shape:"cylinder"},{regex:/^([\p{L}\p{N}_-]+)\[\/(.+?)\\\]/u,shape:"trapezoid"},{regex:/^([\p{L}\p{N}_-]+)\[\\(.+?)\/\]/u,shape:"trapezoid-alt"},{regex:/^([\p{L}\p{N}_-]+)>(.+?)\]/u,shape:"asymmetric"},{regex:/^([\p{L}\p{N}_-]+)\{\{(.+?)\}\}/u,shape:"hexagon"},{regex:/^([\p{L}\p{N}_-]+)\[(.+?)\]/u,shape:"rectangle"},{regex:/^([\p{L}\p{N}_-]+)\((.+?)\)/u,shape:"rounded"},{regex:/^([\p{L}\p{N}_-]+)\{(.+?)\}/u,shape:"diamond"}],cn=/^([\p{L}\p{N}_-]+)/u,Fr=/^:::([\w][\w-]*)/;function Yr(t){let e=t.trim();return e.length>=2&&e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1).replaceAll('\\"','"'):t}function Wr(t,e,n){let r=t.trim(),o=rn(r,e,n);if(!o||o.ids.length===0)return;r=o.remaining.trim();let i=o.ids;for(;r.length>0;){let c=r.match(an);if(!c)break;let s=!!c[1],l=c[2],f=c[3]?.trim()||void 0;r=r.slice(c[0].length).trim();let u=jr(l),h=l.endsWith(">"),a=rn(r,e,n);if(!a||a.ids.length===0)break;r=a.remaining.trim();for(let d of i)for(let m of a.ids)e.edges.push({source:d,target:m,label:f,style:u,hasArrowStart:s,hasArrowEnd:h});i=a.ids;}}function rn(t,e,n){let r=on(t,e,n);if(!r)return null;let o=[r.id],i=r.remaining.trim();for(;i.startsWith("&");){i=i.slice(1).trim();let c=on(i,e,n);if(!c)break;o.push(c.id),i=c.remaining.trim();}return {ids:o,remaining:i}}function on(t,e,n){let r=null,o=t;for(let{regex:c,shape:s}of Xr){let l=t.match(c);if(l){r=l[1];let f=Yr(l[2]);sn(e,n,{id:r,label:f,shape:s}),o=t.slice(l[0].length);break}}if(r===null){let c=t.match(cn);if(c){let s=c[1],l=Hr(t,s.length);r=t.slice(0,l),e.nodes.has(r)?ln(n,r):sn(e,n,{id:r,label:r,shape:"rectangle"}),o=t.slice(l);}}if(r===null)return null;let i=o.match(Fr);return i&&(e.classAssignments.set(r,i[1]),o=o.slice(i[0].length)),{id:r,remaining:o}}function Hr(t,e){for(let n=e;n>=1;n--){let r=t.slice(n),o=r.match(an);if(!o)continue;let i=r.slice(o[0].length).trimStart();if(i.length!==0&&cn.test(i))return n}for(let n=e;n>=1;n--){let r=t.slice(n);if(r.length===0)return n;let o=r[0];if(/\s/.test(o)||o==="&"||r.startsWith(":::"))return n}return Math.max(1,e)}function sn(t,e,n){!t.nodes.has(n.id)&&t.nodes.set(n.id,n),ln(e,n.id);}function ln(t,e){if(t.length>0){let n=t[t.length-1];n.nodeIds.includes(e)||n.nodeIds.push(e);}}function jr(t){return t==="-.->"||t==="-.-"?"dotted":t==="==>"||t==="==="?"thick":"solid"}var ot={x:1,y:0},Q={x:1,y:2},it={x:0,y:1},tt={x:2,y:1},gt={x:2,y:0},pt={x:0,y:0},wt={x:2,y:2},xt={x:0,y:2},Ht={x:1,y:1};function Ot(t,e){return t.x===e.x&&t.y===e.y}function Ae(t,e){return t.x===e.x&&t.y===e.y}function Nt(t,e){return {x:t.x+e.x,y:t.y+e.y}}function _e(t){return `${t.x},${t.y}`}var dn={name:"",styles:{}};function Ur(t){return t>=768&&t<=879||t>=6832&&t<=6911||t>=7616&&t<=7679||t>=8400&&t<=8447||t>=65056&&t<=65071}function zr(t){return t>=4352&&t<=4447||t>=11904&&t<=42191||t>=44032&&t<=55203||t>=63744&&t<=64255||t>=65040&&t<=65049||t>=65072&&t<=65135||t>=65280&&t<=65376||t>=65504&&t<=65510||t>=127744&&t<=129791||t>=129280&&t<=129535}function jt(t){let e=t.codePointAt(0);return e==null||e===0||e<32||e>=127&&e<160||Ur(e)?0:zr(e)?2:1}function st(t){let e=0;for(let n of t)e+=jt(n);return e}function se(t,e){if(e<=0)return "";let n=0,r="";for(let o of t){let i=jt(o);if(n+i>e)break;r+=o,n+=i;}return r}function dt(t,e){let n=[];for(let r=0;r<=t;r++){let o=[];for(let i=0;i<=e;i++)o.push(" ");n.push(o);}return n}function Gt(t){let[e,n]=bt(t);return dt(e,n)}function bt(t){return [t.length-1,(t[0]?.length??1)-1]}function Ut(t,e,n){let[r,o]=bt(t),i=Math.max(e,r),c=Math.max(n,o),s=dt(i,c);for(let l=0;l<s.length;l++)for(let f=0;f<s[0].length;f++)l<t.length&&f<t[0].length&&(s[l][f]=t[l][f]);return t.length=0,t.push(...s),t}var Vr=new Set(["\u2500","\u2502","\u250C","\u2510","\u2514","\u2518","\u251C","\u2524","\u252C","\u2534","\u253C","\u2574","\u2575","\u2576","\u2577"]);function un(t){return Vr.has(t)}var qr={"\u2500":{"\u2502":"\u253C","\u250C":"\u252C","\u2510":"\u252C","\u2514":"\u2534","\u2518":"\u2534","\u251C":"\u253C","\u2524":"\u253C","\u252C":"\u252C","\u2534":"\u2534"},"\u2502":{"\u2500":"\u253C","\u250C":"\u251C","\u2510":"\u2524","\u2514":"\u251C","\u2518":"\u2524","\u251C":"\u251C","\u2524":"\u2524","\u252C":"\u253C","\u2534":"\u253C"},"\u250C":{"\u2500":"\u252C","\u2502":"\u251C","\u2510":"\u252C","\u2514":"\u251C","\u2518":"\u253C","\u251C":"\u251C","\u2524":"\u253C","\u252C":"\u252C","\u2534":"\u253C"},"\u2510":{"\u2500":"\u252C","\u2502":"\u2524","\u250C":"\u252C","\u2514":"\u253C","\u2518":"\u2524","\u251C":"\u253C","\u2524":"\u2524","\u252C":"\u252C","\u2534":"\u253C"},"\u2514":{"\u2500":"\u2534","\u2502":"\u251C","\u250C":"\u251C","\u2510":"\u253C","\u2518":"\u2534","\u251C":"\u251C","\u2524":"\u253C","\u252C":"\u253C","\u2534":"\u2534"},"\u2518":{"\u2500":"\u2534","\u2502":"\u2524","\u250C":"\u253C","\u2510":"\u2524","\u2514":"\u2534","\u251C":"\u253C","\u2524":"\u2524","\u252C":"\u253C","\u2534":"\u2534"},"\u251C":{"\u2500":"\u253C","\u2502":"\u251C","\u250C":"\u251C","\u2510":"\u253C","\u2514":"\u251C","\u2518":"\u253C","\u2524":"\u253C","\u252C":"\u253C","\u2534":"\u253C"},"\u2524":{"\u2500":"\u253C","\u2502":"\u2524","\u250C":"\u253C","\u2510":"\u2524","\u2514":"\u253C","\u2518":"\u2524","\u251C":"\u253C","\u252C":"\u253C","\u2534":"\u253C"},"\u252C":{"\u2500":"\u252C","\u2502":"\u253C","\u250C":"\u252C","\u2510":"\u252C","\u2514":"\u253C","\u2518":"\u253C","\u251C":"\u253C","\u2524":"\u253C","\u2534":"\u253C"},"\u2534":{"\u2500":"\u2534","\u2502":"\u253C","\u250C":"\u253C","\u2510":"\u253C","\u2514":"\u2534","\u2518":"\u2534","\u251C":"\u253C","\u2524":"\u253C","\u252C":"\u253C"}};function Kr(t,e){return qr[t]?.[e]??t}function $t(t,e,n,...r){let[o,i]=bt(t);for(let s of r){let[l,f]=bt(s);o=Math.max(o,l+e.x),i=Math.max(i,f+e.y);}let c=dt(o,i);for(let s=0;s<=o;s++)for(let l=0;l<=i;l++)s<t.length&&l<t[0].length&&(c[s][l]=t[s][l]);for(let s of r)for(let l=0;l<s.length;l++)for(let f=0;f<s[0].length;f++){let u=s[l][f];if(u!==" "){let h=l+e.x,a=f+e.y,d=c[h][a];!n&&un(u)&&un(d)?c[h][a]=Kr(d,u):c[h][a]=u;}}return c}function Jr(t){return t==="\u2500"||t==="\u253C"||t==="\u252C"||t==="\u2534"||t==="\u2524"||t==="\u2510"||t==="\u2518"}function Zr(t){return t==="\u2500"||t==="\u253C"||t==="\u252C"||t==="\u2534"||t==="\u251C"||t==="\u250C"||t==="\u2514"}function Qr(t){return t==="\u2502"||t==="\u253C"||t==="\u251C"||t==="\u2524"||t==="\u2534"||t==="\u2514"||t==="\u2518"}function to(t){return t==="\u2502"||t==="\u253C"||t==="\u251C"||t==="\u2524"||t==="\u252C"||t==="\u250C"||t==="\u2510"}function fn(t){let[e,n]=bt(t);for(let r=0;r<=e;r++)for(let o=0;o<=n;o++){if(t[r][o]!=="\u253C")continue;let i=r>0?t[r-1][o]:" ",c=r<e?t[r+1][o]:" ",s=o>0?t[r][o-1]:" ",l=o<n?t[r][o+1]:" ",f=(Zr(i)?1:0)+(Jr(c)?1:0),u=(to(s)?1:0)+(Qr(l)?1:0);t[r][o]=u>f?"\u2502":"\u2500";}}function Et(t){let[e,n]=bt(t),r=[];for(let o=0;o<=n;o++){let i="";for(let c=0;c<=e;c++){let s=t[c][o];i+=s,jt(s)===2&&(c+=1);}r.push(i);}return r.join(`
`)}var eo={"\u25B2":"\u25BC","\u25BC":"\u25B2","\u25E4":"\u25E3","\u25E3":"\u25E4","\u25E5":"\u25E2","\u25E2":"\u25E5","^":"v",v:"^","\u250C":"\u2514","\u2514":"\u250C","\u2510":"\u2518","\u2518":"\u2510","\u252C":"\u2534","\u2534":"\u252C","\u2575":"\u2577","\u2577":"\u2575"};function hn(t){for(let e of t)e.reverse();for(let e of t)for(let n=0;n<e.length;n++){let r=eo[e[n]];r&&(e[n]=r);}return t}function ft(t,e,n){Ut(t,e.x+st(n),e.y);let r=e.x;for(let o of n)t[r][e.y]=o,r+=jt(o);}function mn(t,e,n){let r=0,o=0;for(let i of e.values())r+=i;for(let i of n.values())o+=i;Ut(t,r-1,o-1);}function pn(t,e){let n=new Map,r=0;for(let[s,l]of t.nodes){let f={name:s,displayLabel:l.label,index:r,gridCoord:null,drawingCoord:null,drawing:null,drawn:false,styleClassName:"",styleClass:dn};n.set(s,f),r++;}let o=[...n.values()],i=[];for(let s of t.edges){let l=n.get(s.source),f=n.get(s.target);!l||!f||i.push({from:l,to:f,text:s.label??"",path:[],labelLine:[],startDir:{x:0,y:0},endDir:{x:0,y:0}});}let c=[];for(let s of t.subgraphs)gn(s,null,n,c);no(t.subgraphs,c,n);for(let[s,l]of t.classAssignments){let f=n.get(s),u=t.classDefs.get(l);f&&u&&(f.styleClassName=l,f.styleClass={name:l,styles:u});}return {nodes:o,edges:i,canvas:dt(0,0),grid:new Map,columnWidth:new Map,rowHeight:new Map,subgraphs:c,config:e,offsetX:0,offsetY:0}}function gn(t,e,n,r){let o={name:t.label,nodes:[],parent:e,children:[],minX:0,minY:0,maxX:0,maxY:0};for(let i of t.nodeIds){let c=n.get(i);c&&o.nodes.push(c);}r.push(o);for(let i of t.children){let c=gn(i,o,n,r);o.children.push(c);for(let s of c.nodes)o.nodes.includes(s)||o.nodes.push(s);}return o}function no(t,e,n,r){let o=new Map;oo(t,e,o);let i=new Map;function c(s){let l=o.get(s);if(l){for(let f of s.children)c(f);for(let f of s.nodeIds)i.has(f)||i.set(f,l);}}for(let s of t)c(s);for(let s of e)s.nodes=s.nodes.filter(l=>{let f;for(let[h,a]of n)if(a===l){f=h;break}if(!f)return  false;let u=i.get(f);return u?ro(s,u):true});}function ro(t,e){let n=e;for(;n!==null;){if(n===t)return  true;n=n.parent;}return  false}function oo(t,e,n){let r=[];function o(i){for(let c of i)r.push(c),o(c.children);}o(t);for(let i=0;i<r.length&&i<e.length;i++)n.set(r[i],e[i]);}var Le=class{idxs=[];priorities=[];costs=[];poppedIdx=-1;poppedPriority=0;poppedCost=0;get length(){return this.idxs.length}clear(){this.idxs.length=0,this.priorities.length=0,this.costs.length=0,this.poppedIdx=-1,this.poppedPriority=0,this.poppedCost=0;}push(e,n,r){this.idxs.push(e),this.priorities.push(n),this.costs.push(r),this.bubbleUp(this.idxs.length-1);}pop(){if(this.idxs.length===0)return  false;this.poppedIdx=this.idxs[0],this.poppedPriority=this.priorities[0],this.poppedCost=this.costs[0];let e=this.idxs.pop(),n=this.priorities.pop(),r=this.costs.pop();return this.idxs.length>0&&(this.idxs[0]=e,this.priorities[0]=n,this.costs[0]=r,this.sinkDown(0)),true}bubbleUp(e){for(;e>0;){let n=e-1>>1;if(this.priorities[e]<this.priorities[n])[this.idxs[e],this.idxs[n]]=[this.idxs[n],this.idxs[e]],[this.priorities[e],this.priorities[n]]=[this.priorities[n],this.priorities[e]],[this.costs[e],this.costs[n]]=[this.costs[n],this.costs[e]],e=n;else break}}sinkDown(e){let n=this.idxs.length;for(;;){let r=e,o=2*e+1,i=2*e+2;if(o<n&&this.priorities[o]<this.priorities[r]&&(r=o),i<n&&this.priorities[i]<this.priorities[r]&&(r=i),r!==e)[this.idxs[e],this.idxs[r]]=[this.idxs[r],this.idxs[e]],[this.priorities[e],this.priorities[r]]=[this.priorities[r],this.priorities[e]],[this.costs[e],this.costs[r]]=[this.costs[r],this.costs[e]],e=r;else break}}};function xn(t,e){let n=t*e;return {stride:t,height:e,blocked:new Uint8Array(n),stamp:0,costStamp:new Uint32Array(n),costSoFar:new Float64Array(n),cameFrom:new Int32Array(n),heap:new Le}}function At(t,e){return e.x+e.y*t}function bn(t,e){let n=e/t|0;return {x:e-n*t,y:n}}function Jt(t,e){if(t.length<=2)return t.length;let n=0,r=t[1]-t[0];for(let o=2;o<t.length;o++){let i=t[o]-t[o-1];i!==r&&(n++,r=i);}return 2+n}function yn(t,e){if(t.length<=2)return t;let n=[t[0]],r=t[1]-t[0];for(let o=2;o<t.length;o++){let i=t[o]-t[o-1];i!==r&&(n.push(t[o-1]),r=i);}return n.push(t[t.length-1]),n}function wn(t,e,n,r){let o=globalThis.__bm_getPath;if(typeof o=="function")return o(t.stride,e,n,r.maxX,r.maxY,t.blocked);let{stride:i}=t,c=r.maxX,s=r.maxY;if(c<0||s<0)return null;let l=n/i|0,f=n-l*i;t.stamp=t.stamp+1>>>0,t.stamp===0&&(t.stamp=1);let u=t.stamp;for(t.heap.clear(),t.costStamp[e]=u,t.costSoFar[e]=0,t.cameFrom[e]=-1,t.heap.push(e,0,0);t.heap.pop();){let h=t.heap.poppedIdx,a=t.heap.poppedCost;if(t.costStamp[h]!==u||a!==t.costSoFar[h])continue;if(h===n){let g=[],p=h;for(;p!==-1;)g.push(p),p=t.cameFrom[p];return g.reverse(),g}let d=t.costSoFar[h],m=h/i|0,x=h-m*i;if(x<c){let g=h+1;if(!t.blocked[g]||g===n){let p=d+1;if(t.costStamp[g]!==u||p<t.costSoFar[g]){t.costStamp[g]=u,t.costSoFar[g]=p,t.cameFrom[g]=h;let b=x+1>=f?x+1-f:f-(x+1),C=m>=l?m-l:l-m,T=b===0||C===0?b+C:b+C+1;t.heap.push(g,p+T,p);}}}if(x>0){let g=h-1;if(!t.blocked[g]||g===n){let p=d+1;if(t.costStamp[g]!==u||p<t.costSoFar[g]){t.costStamp[g]=u,t.costSoFar[g]=p,t.cameFrom[g]=h;let b=x-1>=f?x-1-f:f-(x-1),C=m>=l?m-l:l-m,T=b===0||C===0?b+C:b+C+1;t.heap.push(g,p+T,p);}}}if(m<s){let g=h+i;if(!t.blocked[g]||g===n){let p=d+1;if(t.costStamp[g]!==u||p<t.costSoFar[g]){t.costStamp[g]=u,t.costSoFar[g]=p,t.cameFrom[g]=h;let b=x>=f?x-f:f-x,C=m+1>=l?m+1-l:l-(m+1),T=b===0||C===0?b+C:b+C+1;t.heap.push(g,p+T,p);}}}if(m>0){let g=h-i;if(!t.blocked[g]||g===n){let p=d+1;if(t.costStamp[g]!==u||p<t.costSoFar[g]){t.costStamp[g]=u,t.costSoFar[g]=p,t.cameFrom[g]=h;let b=x>=f?x-f:f-x,C=m-1>=l?m-1-l:l-(m-1),T=b===0||C===0?b+C:b+C+1;t.heap.push(g,p+T,p);}}}}return null}var zt=1,Vt=2,qt=4,Kt=8;function Cn(t,e,n,r,o){let i=globalThis.__bm_getPathStrict;if(typeof i=="function")return i(t.stride,e,n,r.maxX,r.maxY,t.blocked,o);let c=t.stride,s=r.maxX,l=r.maxY;if(s<0||l<0)return null;let f=n/c|0,u=n-f*c;t.stamp=t.stamp+1>>>0,t.stamp===0&&(t.stamp=1);let h=t.stamp,a=t.heap,d=t.blocked,m=t.costStamp,x=t.costSoFar,g=t.cameFrom;a.clear(),m[e]=h,x[e]=0,g[e]=-1,a.push(e,0,0);let p=o.usedPoints,b=o.segmentUsage,C=b.segmentUsed,T=b.usedAsMiddle,N=b.startSource,v=b.startSourceMulti,M=b.endTarget,$=b.endTargetMulti,D=o.routeFromIdx,_=o.routeToIdx,R=o.edgeFromId,B=o.edgeToId,z=zt|Vt,E=qt|Kt;for(;a.pop();){let O=a.poppedIdx,L=a.poppedCost;if(m[O]!==h||L!==x[O])continue;if(O===n){let Y=[],A=O;for(;A!==-1;)Y.push(A),A=g[A];return Y.reverse(),Y}let G=x[O],w=O/c|0,j=O-w*c;if(j<s){let Y=O+1;if(!d[Y]||Y===n){let A=true;if(p){let y=p[O];if(y!==0){let S=y|Vt;(S&z)===z&&(S&E)===E&&(A=false);}if(A){let S=p[Y];if(S!==0){let P=S|zt;(P&z)===z&&(P&E)===E&&(A=false);}}}if(A){let y=O*2;if(C[y]&&(A=false,!T[y])){let S=O===D,P=Y===_,X=N[y],H=M[y],W=v[y]!==0,U=$[y]!==0;S&&P?A=!W&&(X===0||X===R)&&(!U&&(H===0||H===B)):S?A=!U&&H===0&&!W&&X===R:P&&(A=!W&&X===0&&!U&&H===B);}}if(A){let y=G+1;if(m[Y]!==h||y<x[Y]){m[Y]=h,x[Y]=y,g[Y]=O;let S=j+1,P=S>=u?S-u:u-S,X=w>=f?w-f:f-w,H=P===0||X===0?P+X:P+X+1;a.push(Y,y+H,y);}}}}if(j>0){let Y=O-1;if(!d[Y]||Y===n){let A=true;if(p){let y=p[O];if(y!==0){let S=y|zt;(S&z)===z&&(S&E)===E&&(A=false);}if(A){let S=p[Y];if(S!==0){let P=S|Vt;(P&z)===z&&(P&E)===E&&(A=false);}}}if(A){let y=Y*2;if(C[y]&&(A=false,!T[y])){let S=O===D,P=Y===_,X=N[y],H=M[y],W=v[y]!==0,U=$[y]!==0;S&&P?A=!W&&(X===0||X===R)&&(!U&&(H===0||H===B)):S?A=!U&&H===0&&!W&&X===R:P&&(A=!W&&X===0&&!U&&H===B);}}if(A){let y=G+1;if(m[Y]!==h||y<x[Y]){m[Y]=h,x[Y]=y,g[Y]=O;let S=j-1,P=S>=u?S-u:u-S,X=w>=f?w-f:f-w,H=P===0||X===0?P+X:P+X+1;a.push(Y,y+H,y);}}}}if(w<l){let Y=O+c;if(!d[Y]||Y===n){let A=true;if(p){let y=p[O];if(y!==0){let S=y|Kt;(S&z)===z&&(S&E)===E&&(A=false);}if(A){let S=p[Y];if(S!==0){let P=S|qt;(P&z)===z&&(P&E)===E&&(A=false);}}}if(A){let y=O*2+1;if(C[y]&&(A=false,!T[y])){let S=O===D,P=Y===_,X=N[y],H=M[y],W=v[y]!==0,U=$[y]!==0;S&&P?A=!W&&(X===0||X===R)&&(!U&&(H===0||H===B)):S?A=!U&&H===0&&!W&&X===R:P&&(A=!W&&X===0&&!U&&H===B);}}if(A){let y=G+1;if(m[Y]!==h||y<x[Y]){m[Y]=h,x[Y]=y,g[Y]=O;let S=w+1,P=j>=u?j-u:u-j,X=S>=f?S-f:f-S,H=P===0||X===0?P+X:P+X+1;a.push(Y,y+H,y);}}}}if(w>0){let Y=O-c;if(!d[Y]||Y===n){let A=true;if(p){let y=p[O];if(y!==0){let S=y|qt;(S&z)===z&&(S&E)===E&&(A=false);}if(A){let S=p[Y];if(S!==0){let P=S|Kt;(P&z)===z&&(P&E)===E&&(A=false);}}}if(A){let y=Y*2+1;if(C[y]&&(A=false,!T[y])){let S=O===D,P=Y===_,X=N[y],H=M[y],W=v[y]!==0,U=$[y]!==0;S&&P?A=!W&&(X===0||X===R)&&(!U&&(H===0||H===B)):S?A=!U&&H===0&&!W&&X===R:P&&(A=!W&&X===0&&!U&&H===B);}}if(A){let y=G+1;if(m[Y]!==h||y<x[Y]){m[Y]=h,x[Y]=y,g[Y]=O;let S=w-1,P=j>=u?j-u:u-j,X=S>=f?S-f:f-S,H=P===0||X===0?P+X:P+X+1;a.push(Y,y+H,y);}}}}}return null}var io=1;function vn(t,e,n,r,o){let i=globalThis.__bm_getPathRelaxed;if(typeof i=="function")return i(t.stride,e,n,r.maxX,r.maxY,t.blocked,o);let c=t.stride,s=r.maxX,l=r.maxY;if(s<0||l<0)return null;let f=n/c|0,u=n-f*c;t.stamp=t.stamp+1>>>0,t.stamp===0&&(t.stamp=1);let h=t.stamp,a=t.heap,d=t.blocked,m=t.costStamp,x=t.costSoFar,g=t.cameFrom;a.clear(),m[e]=h,x[e]=0,g[e]=-1,a.push(e,0,0);let p=o.usedPoints,b=o.segmentUsage,C=b.segmentUsed,T=b.usedAsMiddle,N=b.startSource,v=b.startSourceMulti,M=b.endTarget,$=b.endTargetMulti,D=o.routeFromIdx,_=o.routeToIdx,R=o.edgeFromId,B=o.edgeToId,z=o.relaxedAllowEndSegmentReuse===true,E=zt|Vt,O=qt|Kt;function L(w,j){if(w===0)return 0;let Y=w|j;return (Y&E)===E&&(Y&O)===O?io:0}function G(w,j,Y){if(!C[w])return  true;if(T[w]||Y&&!z)return  false;let A=N[w],y=M[w],S=v[w]!==0,P=$[w]!==0;return j&&Y?!S&&(A===0||A===R)&&(!P&&(y===0||y===B)):j?!P&&y===0&&!S&&A===R:Y?!S&&A===0&&!P&&y===B:false}for(;a.pop();){let w=a.poppedIdx,j=a.poppedCost;if(m[w]!==h||j!==x[w])continue;if(w===n){let S=[],P=w;for(;P!==-1;)S.push(P),P=g[P];return S.reverse(),{path:S,cost:x[w]}}let Y=x[w],A=w/c|0,y=w-A*c;if(y<s){let S=w+1;if(!d[S]||S===n){let P=0;p&&(P+=L(p[w],Vt),P+=L(p[S],zt));let X=w*2;if(G(X,w===D,S===_)){let H=Y+1+P;if(m[S]!==h||H<x[S]){m[S]=h,x[S]=H,g[S]=w;let W=y+1,U=W>=u?W-u:u-W,k=A>=f?A-f:f-A,I=U===0||k===0?U+k:U+k+1;a.push(S,H+I,H);}}}}if(y>0){let S=w-1;if(!d[S]||S===n){let P=0;p&&(P+=L(p[w],zt),P+=L(p[S],Vt));let X=S*2;if(G(X,w===D,S===_)){let H=Y+1+P;if(m[S]!==h||H<x[S]){m[S]=h,x[S]=H,g[S]=w;let W=y-1,U=W>=u?W-u:u-W,k=A>=f?A-f:f-A,I=U===0||k===0?U+k:U+k+1;a.push(S,H+I,H);}}}}if(A<l){let S=w+c;if(!d[S]||S===n){let P=0;p&&(P+=L(p[w],Kt),P+=L(p[S],qt));let X=w*2+1;if(G(X,w===D,S===_)){let H=Y+1+P;if(m[S]!==h||H<x[S]){m[S]=h,x[S]=H,g[S]=w;let W=A+1,U=y>=u?y-u:u-y,k=W>=f?W-f:f-W,I=U===0||k===0?U+k:U+k+1;a.push(S,H+I,H);}}}}if(A>0){let S=w-c;if(!d[S]||S===n){let P=0;p&&(P+=L(p[w],qt),P+=L(p[S],Kt));let X=S*2+1;if(G(X,w===D,S===_)){let H=Y+1+P;if(m[S]!==h||H<x[S]){m[S]=h,x[S]=H,g[S]=w;let W=A-1,U=y>=u?y-u:u-y,k=W>=f?W-f:f-W,I=U===0||k===0?U+k:U+k+1;a.push(S,H+I,H);}}}}}return null}function Ie(t){if(t.length<=2)return t;let e=new Set,n=t[0],r=t[1];for(let o=2;o<t.length;o++){let i=t[o],c=r.x-n.x,s=r.y-n.y,l=i.x-r.x,f=i.y-r.y;c===l&&s===f&&e.add(o-1),n=r,r=i;}return t.filter((o,i)=>!e.has(i))}var Bt=[12,24,48],_t=[12,24,48,96,192,384],Oe=_t[_t.length-1];function fe(t){return t===ot?Q:t===Q?ot:t===it?tt:t===tt?it:t===gt?xt:t===pt?wt:t===wt?pt:t===xt?gt:Ht}function q(t,e){return t.x===e.x&&t.y===e.y}function Ct(t,e){return t.x===e.x?t.y<e.y?Q:ot:t.y===e.y?t.x<e.x?tt:it:t.x<e.x?t.y<e.y?wt:gt:t.y<e.y?xt:pt}function so(t){return t==="LR"?[tt,Q,Q,tt]:[Q,tt,tt,Q]}function ao(t,e){if(t.from===t.to)return so(e);let n=Ct(t.from.gridCoord,t.to.gridCoord),r,o,i,c,s=e==="LR"?q(n,it)||q(n,pt)||q(n,xt):q(n,ot)||q(n,pt)||q(n,gt);return q(n,wt)?e==="LR"?(r=Q,o=it,i=tt,c=ot):(r=tt,o=ot,i=Q,c=it):q(n,gt)?e==="LR"?(r=ot,o=it,i=tt,c=Q):(r=tt,o=Q,i=ot,c=it):q(n,xt)?e==="LR"?(r=Q,o=Q,i=it,c=ot):(r=it,o=ot,i=Q,c=tt):q(n,pt)?e==="LR"?(r=Q,o=Q,i=it,c=Q):(r=tt,o=tt,i=ot,c=tt):s?e==="LR"&&q(n,it)?(r=Q,o=Q,i=it,c=tt):e==="TD"&&q(n,ot)?(r=tt,o=tt,i=ot,c=Q):(r=n,o=fe(n),i=n,c=fe(n)):(r=n,o=fe(n),i=n,c=fe(n)),[r,o,i,c]}function En(t){let e=t*2;return {segmentUsed:new Uint8Array(e),usedAsMiddle:new Uint8Array(e),startSource:new Uint32Array(e),startSourceMulti:new Uint8Array(e),endTarget:new Uint32Array(e),endTargetMulti:new Uint8Array(e),usedCount:0}}var Te=1,Pe=2,De=4,Re=8;function An(t,e){let n=e-t,r=n===1||n===-1;return (t<e?t:e)*2+(r?0:1)}function Sn(t,e,n){if(n.length<2)return;let r=e.from.index+1,o=e.to.index+1;for(let i=1;i<n.length;i++){let c=n[i-1],s=n[i],l=An(c,s),f=i===1,u=i===n.length-1;if(t.segmentUsed[l]||(t.segmentUsed[l]=1,t.usedCount++),f){let h=t.startSource[l];h===0?t.startSource[l]=r:h!==r&&(t.startSourceMulti[l]=1);}if(u){let h=t.endTarget[l];h===0?t.endTarget[l]=o:h!==o&&(t.endTargetMulti[l]=1);}!f&&!u&&(t.usedAsMiddle[l]=1);}}function _n(t,e,n){let r=e-t;return r===1?{fromBit:Pe,toBit:Te}:r===-1?{fromBit:Te,toBit:Pe}:r===n?{fromBit:Re,toBit:De}:r===-n?{fromBit:De,toBit:Re}:null}function kn(t,e,n){if(n.length<2)return;let r=e.stride;for(let o=1;o<n.length;o++){let i=n[o-1],c=n[o],s=_n(i,c,r);s&&(e.blocked[i]||(t[i]=t[i]|s.fromBit),e.blocked[c]||(t[c]=t[c]|s.toBit));}}function Mn(t,e){let n=t|e,r=(n&Te)!==0&&(n&Pe)!==0,o=(n&De)!==0&&(n&Re)!==0;return r&&o}function co(t,e,n,r){if(!e)return  true;let o=_n(n,r,t.stride);if(!o)return  true;if(!t.blocked[n]){let i=e[n];if(i!==0&&Mn(i,o.fromBit))return  false}if(!t.blocked[r]){let i=e[r];if(i!==0&&Mn(i,o.toBit))return  false}return  true}function lo(t,e,n,r,o,i,c,s){if(t.usedAsMiddle[s])return  false;let l=i===r,f=c===o,u=t.startSource[s],h=t.endTarget[s],a=t.startSourceMulti[s]!==0,d=t.endTargetMulti[s]!==0;return l&&f?!a&&(u===0||u===e)&&(!d&&(h===0||h===n)):l?!d&&h===0&&!a&&u===e:f?!a&&u===0&&!d&&h===n:false}function Ln(t,e,n,r,o,i,c){let s=e.from===e.to,l=t.config.routing,[f,u,h,a]=ao(e,t.config.graphDirection);function d(y){let S=[];for(let P of y)S.some(X=>q(X,P))||S.push(P);return S}function m(y,S){let P=[];for(let X of y)for(let H of S){let W=Nt(e.from.gridCoord,X),U=Nt(e.to.gridCoord,H);Ot(W,U)||P.push({startDir:X,endDir:H,routeFrom:W,routeTo:U,routeFromIdx:At(n.stride,W),routeToIdx:At(n.stride,U)});}return P}function x(y){return q(y,ot)||q(y,Q)||q(y,it)||q(y,tt)?0:l==="relaxed"?10:100}function g(y){return y.x===0||y.y===0?200:0}let p=6;function b(y,S){if(l!=="relaxed"||!t.portUsage)return 0;let P=S.x+S.y*3,X=y.index*9+P;return (t.portUsage[X]??0)*p}function C(y,S){return Jt(S,n.stride)+x(y.startDir)+x(y.endDir)+g(y.routeFrom)+g(y.routeTo)}function T(y,S){return S.cost+Jt(S.path,n.stride)+x(y.startDir)+x(y.endDir)+g(y.routeFrom)+g(y.routeTo)+b(e.from,y.startDir)+b(e.to,y.endDir)}let N=[];{let y=Nt(e.from.gridCoord,f),S=Nt(e.to.gridCoord,u);Ot(y,S)||N.push({startDir:f,endDir:u,routeFrom:y,routeTo:S,routeFromIdx:At(n.stride,y),routeToIdx:At(n.stride,S)});}if(!q(f,h)||!q(u,a)){let y=Nt(e.from.gridCoord,h),S=Nt(e.to.gridCoord,a);Ot(y,S)||N.push({startDir:h,endDir:a,routeFrom:y,routeTo:S,routeFromIdx:At(n.stride,y),routeToIdx:At(n.stride,S)});}function v(y){return q(y,ot)?{x:0,y:-1}:q(y,Q)?{x:0,y:1}:q(y,it)?{x:-1,y:0}:q(y,tt)?{x:1,y:0}:null}function M(y,S){let P=y[y.length-1];if(P.x===S.x){let X=S.y>P.y?1:-1;for(let H=P.y+X;H!==S.y+X;H+=X)y.push({x:P.x,y:H});return}if(P.y===S.y){let X=S.x>P.x?1:-1;for(let H=P.x+X;H!==S.x+X;H+=X)y.push({x:H,y:P.y});return}throw new Error(`appendStraightLine expects straight line, got from=(${P.x},${P.y}) to=(${S.x},${S.y})`)}function $(y,S){if(S.length<4)return  false;let P=[];for(let X=0;X<S.length;X++){let H=S[X];if(H.x<0||H.y<0||H.x>=n.stride||H.y>=n.height||(P.push(At(n.stride,H)),!(Ot(H,y.routeFrom)||Ot(H,y.routeTo))&&n.blocked[P[P.length-1]]))return  false}for(let X=1;X<P.length;X++){let H=P[X-1],W=P[X];if(!co(n,c,H,W))return  false;if(i){let U=An(H,W);if(i.segmentUsed[U]&&!lo(i,e.from.index+1,e.to.index+1,y.routeFromIdx,y.routeToIdx,H,W,U))return  false}}return  true}function D(y,S){let P=v(y.startDir),X=v(y.endDir);if(!P||!X||S<1)return null;let H={x:y.routeFrom.x+P.x*S,y:y.routeFrom.y+P.y*S},W={x:y.routeTo.x+X.x*S,y:y.routeTo.y+X.y*S},U=[{x:H.x,y:W.y},{x:W.x,y:H.y}];for(let k of U){let I=[y.routeFrom];M(I,H),M(I,k),M(I,W),M(I,y.routeTo);let F=I.filter((V,K)=>K===0||!Ot(V,I[K-1]));if($(y,F)&&Ie(F).length>=4)return F}return null}if(s){let y=N.length>0?N:E;for(let S of y)for(let P=1;P<=12;P++){let X=D(S,P);if(!X)continue;e.startDir=S.startDir,e.endDir=S.endDir,e.path=Ie(X);let H=X.map(W=>At(n.stride,W));if(i&&Sn(i,e,H),c&&kn(c,n,H),l==="relaxed"&&t.portUsage){let W=e.startDir.x+e.startDir.y*3,U=e.endDir.x+e.endDir.y*3;t.portUsage[e.from.index*9+W]=(t.portUsage[e.from.index*9+W]??0)+1,t.portUsage[e.to.index*9+U]=(t.portUsage[e.to.index*9+U]??0)+1;}return}}let _=d([u,a]),R=l==="relaxed"&&t.config.useAscii,B=d([f,h,tt,it,Q,ot,...R?[gt,pt,wt,xt]:[]]),z=d([u,a,tt,it,Q,ot,...R?[gt,pt,wt,xt]:[]]),E=m(B,_),O=m(B,z);function L(y){return {maxX:Math.min(n.stride-1,r+y),maxY:Math.min(n.height-1,o+y)}}function G(y,S=_t){for(let P of S){let X=L(P),H=null;for(let W of y){let U=wn(n,W.routeFromIdx,W.routeToIdx,X);if(!U||s&&Jt(U,n.stride)<4)continue;let k=C(W,U);(!H||k<H.cost)&&(H={candidate:W,pathIdx:U,cost:k});}if(H)return H}return null}function w(y,S){if(!i||i.usedCount===0)return null;let P={segmentUsage:i,usedPoints:c,routeFromIdx:0,routeToIdx:0,edgeFromId:e.from.index+1,edgeToId:e.to.index+1};for(let X of S){let H=L(X),W=null;for(let U of y){P.routeFromIdx=U.routeFromIdx,P.routeToIdx=U.routeToIdx;let k=Cn(n,U.routeFromIdx,U.routeToIdx,H,P);if(!k||s&&Jt(k,n.stride)<4)continue;let I=C(U,k);(!W||I<W.cost)&&(W={candidate:U,pathIdx:k,cost:I});}if(W)return W}return null}function j(y,S,P){if(!i)return null;let X={segmentUsage:i,usedPoints:c,routeFromIdx:0,routeToIdx:0,edgeFromId:e.from.index+1,edgeToId:e.to.index+1,relaxedAllowEndSegmentReuse:P};for(let H of S){let W=L(H),U=null;for(let k of y){X.routeFromIdx=k.routeFromIdx,X.routeToIdx=k.routeToIdx;let I=vn(n,k.routeFromIdx,k.routeToIdx,W,X);if(!I||s&&Jt(I.path,n.stride)<4)continue;let F=T(k,I);(!U||F<U.cost)&&(U={candidate:k,pathIdx:I.path,cost:F});}if(U)return U}return null}let Y=null;if(l==="relaxed"){let y=function(S){let P=j(N,Bt,S)??j(E,Bt,S)??j(O,Bt,S);return P=P??j(N,_t,S)??j(E,_t,S)??j(O,_t,S),P};Y=y(false)??y(true);}else !i||i.usedCount===0?Y=G(N,Bt):(Y=w(N,Bt)??w(E,Bt)??w(O,Bt),Y=Y??w(N,_t)??w(E,_t),Y=Y??w(O,_t));if(!Y){e.startDir=f,e.endDir=u,e.path=[];return}if(e.startDir=Y.candidate.startDir,e.endDir=Y.candidate.endDir,e.path=yn(Y.pathIdx,n.stride).map(y=>bn(n.stride,y)),i&&Sn(i,e,Y.pathIdx),c&&kn(c,n,Y.pathIdx),l==="relaxed"&&t.portUsage){let y=e.startDir.x+e.startDir.y*3,S=e.endDir.x+e.endDir.y*3;t.portUsage[e.from.index*9+y]=(t.portUsage[e.from.index*9+y]??0)+1,t.portUsage[e.to.index*9+S]=(t.portUsage[e.to.index*9+S]??0)+1;}}function In(t,e){if(e.text.length===0||e.path.length<2)return;let n=st(e.text),r=xo(t),o=po(t),i=e.path[0],c=null,s=[i,e.path[1]],l=0,f=false,u=null,h=-1;for(let g=1;g<e.path.length;g++){let p=e.path[g],b=[i,p],C=uo(t,b);f||(C>=n?(s=b,f=true):C>l&&(l=C,s=b));let T=Tn(t,b,e.text),N=T?r.some(M=>go(M,T)):false,v=T?o.some(M=>mo(T,M)):false;if(!N&&!v&&(C>h&&(h=C,u=b),C>=n)){c=b;break}i=p;}c===null&&(c=u??s);let a=Math.min(c[0].x,c[1].x),d=Math.max(c[0].x,c[1].x),m=a+Math.floor((d-a)/2),x=t.columnWidth.get(m)??0;t.columnWidth.set(m,Math.max(x,n+2)),e.labelLine=[c[0],c[1]];}function uo(t,e){let n=0,r=Math.min(e[0].x,e[1].x),o=Math.max(e[0].x,e[1].x);for(let i=r;i<=o;i++)n+=t.columnWidth.get(i)??0;return n}function $n(t,e){let n=t.offsetX;for(let c=0;c<e.x;c++)n+=t.columnWidth.get(c)??0;let r=t.offsetY;for(let c=0;c<e.y;c++)r+=t.rowHeight.get(c)??0;let o=t.columnWidth.get(e.x)??0,i=t.rowHeight.get(e.y)??0;return {x:n+Math.floor(o/2),y:r+Math.floor(i/2)}}function fo(t,e){let n=t.offsetX;for(let o=0;o<e.x;o++)n+=t.columnWidth.get(o)??0;let r=t.offsetY;for(let o=0;o<e.y;o++)r+=t.rowHeight.get(o)??0;return {x:n,y:r}}function ho(t,e){if(!e.gridCoord)return null;let n=e.gridCoord,r=0;for(let c=0;c<2;c++)r+=t.columnWidth.get(n.x+c)??0;let o=0;for(let c=0;c<2;c++)o+=t.rowHeight.get(n.y+c)??0;let i=fo(t,n);return {minX:i.x,minY:i.y,maxX:i.x+r,maxY:i.y+o}}function mo(t,e){return t.y<e.minY||t.y>e.maxY?false:!(t.endX<e.minX||e.maxX<t.startX)}function po(t){let e=[];for(let n of t.nodes){let r=ho(t,n);r&&e.push(r);}return e}function Tn(t,e,n){let r=st(n);if(r<=0)return null;let o=$n(t,e[0]),i=$n(t,e[1]),c=Math.min(o.x,i.x),s=Math.max(o.x,i.x),l=Math.min(o.y,i.y),f=Math.max(o.y,i.y),u=c+Math.floor((s-c)/2),h=l+Math.floor((f-l)/2),a=u-Math.floor(r/2);return {y:h,startX:a,endX:a+r-1}}function go(t,e){return t.y!==e.y?false:!(t.endX<e.startX||e.endX<t.startX)}function xo(t){let e=[];for(let n of t.edges){if(n.text.length===0||n.labelLine.length<2)continue;let r=Tn(t,[n.labelLine[0],n.labelLine[1]],n.text);r&&e.push(r);}return e}function St(t,e,n){let r=0;if(t.columnStartX&&n.x>=0&&n.x<t.columnStartX.length)r=t.columnStartX[n.x]??0;else for(let h=0;h<n.x;h++)r+=t.columnWidth.get(h)??0;let o=0;if(t.rowStartY&&n.y>=0&&n.y<t.rowStartY.length)o=t.rowStartY[n.y]??0;else for(let h=0;h<n.y;h++)o+=t.rowHeight.get(h)??0;let i=t.columnWidth.get(n.x)??0,c=t.rowHeight.get(n.y)??0,s=Math.floor(i/2),l=Math.floor(c/2),f=e.from.gridCoord;if(f){let h=f.x+1,a=f.y+1;e.startPortOffsetX!=null&&n.x===h&&(s=e.startPortOffsetX),e.startPortOffsetY!=null&&n.y===a&&(l=e.startPortOffsetY);}let u=e.to.gridCoord;if(u){let h=u.x+1,a=u.y+1;e.endPortOffsetX!=null&&n.x===h&&(s=e.endPortOffsetX),e.endPortOffsetY!=null&&n.y===a&&(l=e.endPortOffsetY);}return s<0&&(s=0),l<0&&(l=0),i>0&&s>i-1&&(s=i-1),c>0&&l>c-1&&(l=c-1),{x:r+s+t.offsetX,y:o+l+t.offsetY}}function bo(t,e,n){return n.map(r=>St(t,e,r))}function Pn(t,e){let n=t.gridCoord,r=e.config.useAscii,o=0;for(let d=0;d<2;d++)o+=e.columnWidth.get(n.x+d)??0;let i=0;for(let d=0;d<2;d++)i+=e.rowHeight.get(n.y+d)??0;let c={x:0,y:0},s={x:o,y:i},l=dt(Math.max(c.x,s.x),Math.max(c.y,s.y));if(r){for(let d=c.x+1;d<s.x;d++)l[d][c.y]="-";for(let d=c.x+1;d<s.x;d++)l[d][s.y]="-";for(let d=c.y+1;d<s.y;d++)l[c.x][d]="|";for(let d=c.y+1;d<s.y;d++)l[s.x][d]="|";l[c.x][c.y]="+",l[s.x][c.y]="+",l[c.x][s.y]="+",l[s.x][s.y]="+";}else {for(let d=c.x+1;d<s.x;d++)l[d][c.y]="\u2500";for(let d=c.x+1;d<s.x;d++)l[d][s.y]="\u2500";for(let d=c.y+1;d<s.y;d++)l[c.x][d]="\u2502";for(let d=c.y+1;d<s.y;d++)l[s.x][d]="\u2502";l[c.x][c.y]="\u250C",l[s.x][c.y]="\u2510",l[c.x][s.y]="\u2514",l[s.x][s.y]="\u2518";}let f=t.displayLabel,u=c.y+Math.floor(i/2),h=st(f),a=c.x+Math.floor(o/2)-Math.ceil(h/2)+1;return ft(l,{x:a,y:u},f),l}function he(t,e,n=1){let r=0;for(let C of t)for(let T of C)r=Math.max(r,st(T));let i=r+2*n+2,c=0;for(let C of t)c+=Math.max(C.length,1);let s=t.length-1,l=c+s+2,f=e?"-":"\u2500",u=e?"|":"\u2502",h=e?"+":"\u250C",a=e?"+":"\u2510",d=e?"+":"\u2514",m=e?"+":"\u2518",x=e?"+":"\u251C",g=e?"+":"\u2524",p=dt(i-1,l-1);p[0][0]=h;for(let C=1;C<i-1;C++)p[C][0]=f;p[i-1][0]=a,p[0][l-1]=d;for(let C=1;C<i-1;C++)p[C][l-1]=f;p[i-1][l-1]=m;for(let C=1;C<l-1;C++)p[0][C]=u,p[i-1][C]=u;let b=1;for(let C=0;C<t.length;C++){let T=t[C],N=T.length>0?T:[""];for(let v of N){let M=1+n;ft(p,{x:M,y:b},v),b++;}if(C<t.length-1){p[0][b]=x;for(let v=1;v<i-1;v++)p[v][b]=f;p[i-1][b]=g,b++;}}return p}function yo(t,e,n,r,o,i){let c=Ct(e,n),s=[],l=i?"-":"\u2500",f=i?"|":"\u2502",u=i?"\\":"\u2572",h=i?"/":"\u2571";if(q(c,ot))for(let a=e.y-r;a>=n.y-o;a--)s.push({x:e.x,y:a}),t[e.x][a]=f;else if(q(c,Q))for(let a=e.y+r;a<=n.y+o;a++)s.push({x:e.x,y:a}),t[e.x][a]=f;else if(q(c,it))for(let a=e.x-r;a>=n.x-o;a--)s.push({x:a,y:e.y}),t[a][e.y]=l;else if(q(c,tt))for(let a=e.x+r;a<=n.x+o;a++)s.push({x:a,y:e.y}),t[a][e.y]=l;else if(q(c,pt))for(let a=e.x,d=e.y-r;a>=n.x-o&&d>=n.y-o;a--,d--)s.push({x:a,y:d}),t[a][d]=u;else if(q(c,gt))for(let a=e.x,d=e.y-r;a<=n.x+o&&d>=n.y-o;a++,d--)s.push({x:a,y:d}),t[a][d]=h;else if(q(c,xt))for(let a=e.x,d=e.y+r;a>=n.x-o&&d<=n.y+o;a--,d++)s.push({x:a,y:d}),t[a][d]=h;else if(q(c,wt))for(let a=e.x,d=e.y+r;a<=n.x+o&&d<=n.y+o;a++,d++)s.push({x:a,y:d}),t[a][d]=u;return s}function wo(t,e){if(e.path.length<2){let f=Gt(t.canvas);return [f,f,f,f,f]}let n=Rn(t,e),[r,o,i]=Co(t,e,e.path),c=vo(t,e.path,o[0]),s=So(t,o[o.length-1],i[i.length-1]),l=ko(t,e,e.path);return [r,c,s,l,n]}function Dn(t,e){let n=[],r=new Set;function o(s){let l=`${s.x},${s.y}`;r.has(l)||(r.add(l),n.push(s));}if(e.path.length<2)return n;t.config.useAscii||o(St(t,e,e.path[0]));let i=1,c=-1;for(let s=1;s<e.path.length;s++){let l=e.path[s-1],f=e.path[s],u=St(t,e,l),h=St(t,e,f);if(Ae(u,h))continue;let a=Ct(l,f);if(q(a,ot))for(let d=u.y-i;d>=h.y-c;d--)o({x:u.x,y:d});else if(q(a,Q))for(let d=u.y+i;d<=h.y+c;d++)o({x:u.x,y:d});else if(q(a,it))for(let d=u.x-i;d>=h.x-c;d--)o({x:d,y:u.y});else if(q(a,tt))for(let d=u.x+i;d<=h.x+c;d++)o({x:d,y:u.y});else if(q(a,pt))for(let d=u.x,m=u.y-i;d>=h.x-c&&m>=h.y-c;d--,m--)o({x:d,y:m});else if(q(a,gt))for(let d=u.x,m=u.y-i;d<=h.x+c&&m>=h.y-c;d++,m--)o({x:d,y:m});else if(q(a,xt))for(let d=u.x,m=u.y+i;d>=h.x-c&&m<=h.y+c;d--,m++)o({x:d,y:m});else if(q(a,wt))for(let d=u.x,m=u.y+i;d<=h.x+c&&m<=h.y+c;d++,m++)o({x:d,y:m});if(s<e.path.length-1){let d=Ct(f,e.path[s+1]);!q(a,d)&&!q(a,Ht)&&!q(d,Ht)&&o(St(t,e,f));}}{let s=e.path[e.path.length-1],l=e.path[e.path.length-2],f=Ct(l,s),u=St(t,e,s);q(f,ot)?o({x:u.x,y:u.y+1}):q(f,Q)?o({x:u.x,y:u.y-1}):q(f,it)?o({x:u.x+1,y:u.y}):q(f,tt)&&o({x:u.x-1,y:u.y});}return n}function Co(t,e,n){let r=Gt(t.canvas),o=n[0],i=[],c=[];for(let s=1;s<n.length;s++){let l=n[s],f=St(t,e,o),u=St(t,e,l);if(Ae(f,u)){o=l;continue}let h=Ct(o,l),a=yo(r,f,u,1,-1,t.config.useAscii);a.length===0&&a.push(f),i.push(a),c.push(h),o=l;}return [r,i,c]}function vo(t,e,n){let r=Gt(t.canvas);if(t.config.useAscii)return r;let o=n[0],i=Ct(e[0],e[1]);return q(i,ot)?r[o.x][o.y+1]="\u2534":q(i,Q)?r[o.x][o.y-1]="\u252C":q(i,it)?r[o.x+1][o.y]="\u2524":q(i,tt)&&(r[o.x-1][o.y]="\u251C"),r}function So(t,e,n){let r=Gt(t.canvas);if(e.length===0)return r;let o=e[0],i=e[e.length-1],c=Ct(o,i);(e.length===1||q(c,Ht))&&(c=n);let s;return t.config.useAscii?q(c,ot)?s="^":q(c,Q)?s="v":q(c,it)?s="<":q(c,tt)?s=">":q(n,ot)?s="^":q(n,Q)?s="v":q(n,it)?s="<":q(n,tt)?s=">":s="*":q(c,ot)?s="\u25B2":q(c,Q)?s="\u25BC":q(c,it)?s="\u25C4":q(c,tt)?s="\u25BA":q(c,gt)?s="\u25E5":q(c,pt)?s="\u25E4":q(c,wt)?s="\u25E2":q(c,xt)?s="\u25E3":q(n,ot)?s="\u25B2":q(n,Q)?s="\u25BC":q(n,it)?s="\u25C4":q(n,tt)?s="\u25BA":q(n,gt)?s="\u25E5":q(n,pt)?s="\u25E4":q(n,wt)?s="\u25E2":q(n,xt)?s="\u25E3":s="\u25CF",r[i.x][i.y]=s,r}function ko(t,e,n){let r=Gt(t.canvas);for(let o=1;o<n.length-1;o++){let i=n[o],c=St(t,e,i),s=Ct(n[o-1],i),l=Ct(i,n[o+1]),f;t.config.useAscii?f="+":q(s,tt)&&q(l,Q)||q(s,ot)&&q(l,it)?f="\u2510":q(s,tt)&&q(l,ot)||q(s,Q)&&q(l,it)?f="\u2518":q(s,it)&&q(l,Q)||q(s,ot)&&q(l,tt)?f="\u250C":q(s,it)&&q(l,ot)||q(s,Q)&&q(l,tt)?f="\u2514":f="+",r[c.x][c.y]=f;}return r}function Rn(t,e,n){let r=Gt(t.canvas);if(e.text.length===0)return r;let o=bo(t,e,e.labelLine),i=[],c=Ro(t,e);c&&i.push(c);let s=Oo(t,e);return s&&i.push(s),Do(r,o,e.text,i,n,t.config.useAscii),r}function Mo(t){return t==="\u25B2"||t==="\u25BC"||t==="\u25C4"||t==="\u25BA"||t==="\u25E5"||t==="\u25E4"||t==="\u25E2"||t==="\u25E3"||t==="\u25CF"}function $o(t){return t==="^"||t==="v"||t==="<"||t===">"||t==="*"}function Eo(t){return t==="\u253C"||t==="\u252C"||t==="\u2534"||t==="\u251C"||t==="\u2524"||t==="\u250C"||t==="\u2510"||t==="\u2514"||t==="\u2518"||t==="\u2574"||t==="\u2575"||t==="\u2576"||t==="\u2577"}function Ao(t){return t==="+"}function Ne(t,e){return e?t==="|"||t==="+":t==="\u2502"||t==="\u253C"||t==="\u252C"||t==="\u2534"||t==="\u251C"||t==="\u2524"||t==="\u250C"||t==="\u2510"||t==="\u2514"||t==="\u2518"||t==="\u2577"||t==="\u2575"}function Ge(t,e){return e?t==="-"||t==="+":t==="\u2500"||t==="\u253C"||t==="\u252C"||t==="\u2534"||t==="\u251C"||t==="\u2524"||t==="\u250C"||t==="\u2510"||t==="\u2514"||t==="\u2518"||t==="\u2574"||t==="\u2576"}function _o(t,e,n,r){let[o,i]=bt(t);if(e<0||n<0||e>o||n>i)return  false;let c=t[e][n],s=e>0?t[e-1][n]:" ",l=e<o?t[e+1][n]:" ",f=n>0?t[e][n-1]:" ",u=n<i?t[e][n+1]:" ",h=Ne(f,r)&&Ne(u,r),a=Ge(s,r)&&Ge(l,r);return !!((c===" "||Ge(c,r))&&h||(c===" "||Ne(c,r))&&a)}function Lo(t,e,n,r){let[o,i]=bt(t);if(e<0||n<0||e>o||n>i)return  false;let c=t[e][n];if(r){if($o(c)||Ao(c))return  true}else if(Mo(c)||Eo(c))return  true;return !!_o(t,e,n,r)}function Io(t,e,n,r){for(let o of r)if(o.y===t&&o.x>=e&&o.x<=n)return  true;return  false}function To(t,e,n,r,o){for(let i=n;i<=r;i++)if(Lo(t,i,e,o))return  true;return  false}function Po(t){let{desiredStartX:e,minStartX:n,maxStartX:r,isValid:o}=t;if(o(e))return e;let i=Math.max(0,r-n);for(let c=1;c<=i;c++){let s=e-c;if(s>=n&&o(s))return s;let l=e+c;if(l<=r&&o(l))return l}return e}function Do(t,e,n,r=[],o,i=false){if(e.length<2)return;let c=Math.min(e[0].x,e[1].x),s=Math.max(e[0].x,e[1].x),l=Math.min(e[0].y,e[1].y),f=Math.max(e[0].y,e[1].y),u=c+Math.floor((s-c)/2),h=l+Math.floor((f-l)/2),a=st(n),d=u-Math.floor(a/2);if(o){let[x]=bt(o),g=0,p=Math.max(g,x-a+1),b=e[0].y===e[1].y,C=c,T=s-a+1,N=b&&T>=C?Math.max(g,C):g,v=b&&T>=C?Math.min(p,T):p;v>=N&&(d<N&&(d=N),d>v&&(d=v),d=Po({desiredStartX:d,minStartX:N,maxStartX:v,isValid:M=>{let $=M+a-1;return !(Io(h,M,$,r)||To(o,h,M,$,i))}})),ft(t,{x:d,y:h},n);return}if(e[0].y===e[1].y){let x=c,g=s-a+1;if(g>=x){d<x&&(d=x),d>g&&(d=g);for(let p of r){if(p.y!==h)continue;let b=d+a-1;if(!(p.x>=d&&p.x<=b))continue;let T=p.x-a,N=p.x+1,v=[];T>=x&&T<=g&&v.push(T),N>=x&&N<=g&&v.push(N),v.length!==0&&(v.sort((M,$)=>Math.abs(M-d)-Math.abs($-d)),d=v[0]);}}}ft(t,{x:d,y:h},n);}function Ro(t,e){if(e.path.length<2)return null;let n=e.path[e.path.length-1],r=e.path[e.path.length-2],o=Ct(r,n),i=St(t,e,n);return q(o,ot)?{x:i.x,y:i.y+1}:q(o,Q)?{x:i.x,y:i.y-1}:q(o,it)?{x:i.x+1,y:i.y}:q(o,tt)?{x:i.x-1,y:i.y}:null}function Oo(t,e){return e.path.length<2?null:St(t,e,e.path[0])}function No(t,e){let n=t.maxX-t.minX,r=t.maxY-t.minY;if(n<=0||r<=0)return dt(0,0);let o={x:0,y:0},i={x:n,y:r},c=dt(n,r);if(e.config.useAscii){for(let s=o.x+1;s<i.x;s++)c[s][o.y]="-";for(let s=o.x+1;s<i.x;s++)c[s][i.y]="-";for(let s=o.y+1;s<i.y;s++)c[o.x][s]="|";for(let s=o.y+1;s<i.y;s++)c[i.x][s]="|";c[o.x][o.y]="+",c[i.x][o.y]="+",c[o.x][i.y]="+",c[i.x][i.y]="+";}else {for(let s=o.x+1;s<i.x;s++)c[s][o.y]="\u2500";for(let s=o.x+1;s<i.x;s++)c[s][i.y]="\u2500";for(let s=o.y+1;s<i.y;s++)c[o.x][s]="\u2502";for(let s=o.y+1;s<i.y;s++)c[i.x][s]="\u2502";c[o.x][o.y]="\u250C",c[i.x][o.y]="\u2510",c[o.x][i.y]="\u2514",c[i.x][i.y]="\u2518";}return c}function Go(t,e){let n=t.maxX-t.minX,r=t.maxY-t.minY;if(n<=0||r<=0)return [dt(0,0),{x:0,y:0}];let o=dt(n,r),i=1,c=Math.floor(n/2)-Math.floor(st(t.name)/2);return c<1&&(c=1),ft(o,{x:c,y:i},t.name),[o,{x:t.minX,y:t.minY}]}function Bo(t){function e(r){return r.parent===null?0:1+e(r.parent)}let n=[...t];return n.sort((r,o)=>e(r)-e(o)),n}function On(t){let e=t.config.useAscii,n=Bo(t.subgraphs);for(let u of n){let h=No(u,t),a={x:u.minX,y:u.minY};t.canvas=$t(t.canvas,a,e,h);}for(let u of t.nodes)!u.drawn&&u.drawingCoord&&u.drawing&&(t.canvas=$t(t.canvas,u.drawingCoord,e,u.drawing),u.drawn=true);let r=[],o=[],i=[],c=[];for(let u of t.edges){let[h,a,d,m,x]=wo(t,u);r.push(h),o.push(m),i.push(d),c.push(a);}let s={x:0,y:0};t.canvas=$t(t.canvas,s,e,...r),t.canvas=$t(t.canvas,s,e,...o),t.canvas=$t(t.canvas,s,e,...i),t.canvas=$t(t.canvas,s,e,...c);let l=[],f=t.canvas;for(let u of t.edges)l.push(Rn(t,u,f));t.canvas=$t(t.canvas,s,e,...l);for(let u of t.subgraphs){if(u.nodes.length===0)continue;let[h,a]=Go(u);t.canvas=$t(t.canvas,a,e,h);}return t.canvas}function Xo(t,e,n){let r=e,o=0;if(t.columnStartX&&r.x>=0&&r.x<t.columnStartX.length)o=t.columnStartX[r.x]??0;else for(let l=0;l<r.x;l++)o+=t.columnWidth.get(l)??0;let i=0;if(t.rowStartY&&r.y>=0&&r.y<t.rowStartY.length)i=t.rowStartY[r.y]??0;else for(let l=0;l<r.y;l++)i+=t.rowHeight.get(l)??0;let c=t.columnWidth.get(r.x)??0,s=t.rowHeight.get(r.y)??0;return {x:o+Math.floor(c/2)+t.offsetX,y:i+Math.floor(s/2)+t.offsetY}}function ae(t,e,n){if(t.grid.has(_e(n)))return t.config.graphDirection==="LR"?ae(t,e,{x:n.x,y:n.y+4}):ae(t,e,{x:n.x+4,y:n.y});for(let r=0;r<3;r++)for(let o=0;o<3;o++){let i={x:n.x+r,y:n.y+o};t.grid.set(_e(i),e);}return e.gridCoord=n,n}function Fo(t,e){let n=e.gridCoord,r=t.config.boxBorderPadding,o=[1,2*r+st(e.displayLabel),1],i=[1,1+2*r,1];for(let c=0;c<o.length;c++){let s=n.x+c,l=t.columnWidth.get(s)??0;t.columnWidth.set(s,Math.max(l,o[c]));}for(let c=0;c<i.length;c++){let s=n.y+c,l=t.rowHeight.get(s)??0;t.rowHeight.set(s,Math.max(l,i[c]));}if(n.x>0){let c=t.columnWidth.get(n.x-1)??0;t.columnWidth.set(n.x-1,Math.max(c,t.config.paddingX));}if(n.y>0){let c=t.config.paddingY;Wo(t,e)&&(c+=4);let s=t.rowHeight.get(n.y-1)??0;t.rowHeight.set(n.y-1,Math.max(s,c));}}function Yo(t,e){if(e.length===0)return;function n(o){t.columnWidth.has(o.x)||t.columnWidth.set(o.x,Math.floor(t.config.paddingX/2)),t.rowHeight.has(o.y)||t.rowHeight.set(o.y,Math.floor(t.config.paddingY/2));}let r=e[0];n(r);for(let o=1;o<e.length;o++){let i=e[o];if(r.x===i.x){let c=i.y>r.y?1:-1;for(let s=r.y;s!==i.y;s+=c)n({x:r.x,y:s}),n({x:r.x,y:s+c});}else if(r.y===i.y){let c=i.x>r.x?1:-1;for(let s=r.x;s!==i.x;s+=c)n({x:s,y:r.y}),n({x:s+c,y:r.y});}else n(i);r=i;}}function Be(t,e){return t.subgraphs.some(n=>n.nodes.includes(e))}function Xe(t,e){for(let n of t.subgraphs)if(n.nodes.includes(e))return n;return null}function Wo(t,e){let n=Xe(t,e);if(!n)return  false;let r=false;for(let o of t.edges)if(o.to===e&&Xe(t,o.from)!==n){r=true;break}if(!r)return  false;for(let o of n.nodes){if(o===e||!o.gridCoord)continue;let i=false;for(let c of t.edges)if(c.to===o&&Xe(t,c.from)!==n){i=true;break}if(i&&o.gridCoord.y<e.gridCoord.y)return  false}return  true}function Nn(t,e){if(e.nodes.length===0)return;let n=1e6,r=1e6,o=-1e6,i=-1e6;for(let l of e.children)Nn(t,l),l.nodes.length>0&&(n=Math.min(n,l.minX),r=Math.min(r,l.minY),o=Math.max(o,l.maxX),i=Math.max(i,l.maxY));for(let l of e.nodes){if(!l.drawingCoord||!l.drawing)continue;let f=l.drawingCoord.x,u=l.drawingCoord.y,h=f+l.drawing.length-1,a=u+l.drawing[0].length-1;n=Math.min(n,f),r=Math.min(r,u),o=Math.max(o,h),i=Math.max(i,a);}let c=2,s=2;e.minX=n-c,e.minY=r-c-s,e.maxX=o+c,e.maxY=i+c;}function Ho(t){let n=t.subgraphs.filter(r=>r.parent===null&&r.nodes.length>0);for(let r=0;r<n.length;r++)for(let o=r+1;o<n.length;o++){let i=n[r],c=n[o];i.minX<c.maxX&&i.maxX>c.minX&&(i.maxY>=c.minY-1&&i.minY<c.minY?c.minY=i.maxY+1+1:c.maxY>=i.minY-1&&c.minY<i.minY&&(i.minY=c.maxY+1+1)),i.minY<c.maxY&&i.maxY>c.minY&&(i.maxX>=c.minX-1&&i.minX<c.minX?c.minX=i.maxX+1+1:c.maxX>=i.minX-1&&c.minX<i.minX&&(i.minX=c.maxX+1+1));}}function jo(t){for(let e of t.subgraphs)Nn(t,e);Ho(t);}function Uo(t){if(t.subgraphs.length===0)return;let e=0,n=0;for(let i of t.subgraphs)e=Math.min(e,i.minX),n=Math.min(n,i.minY);let r=-e,o=-n;if(!(r===0&&o===0)){t.offsetX=r,t.offsetY=o;for(let i of t.subgraphs)i.minX+=r,i.minY+=o,i.maxX+=r,i.maxY+=o;for(let i of t.nodes)i.drawingCoord&&(i.drawingCoord.x+=r,i.drawingCoord.y+=o);}}function Gn(t){let e=[0,1,2,3,4];for(let n of e)if(zo(t),qo(t,n))return}function zo(t){t.grid=new Map,t.columnWidth=new Map,t.rowHeight=new Map,t.canvas=dt(0,0),t.offsetX=0,t.offsetY=0,t.columnStartX=void 0,t.rowStartY=void 0,t.portUsage=t.config.routing==="relaxed"?new Uint16Array(t.nodes.length*9):void 0;for(let e of t.nodes)e.gridCoord=null,e.drawingCoord=null,e.drawing=null,e.drawn=false;for(let e of t.edges)e.path=[],e.labelLine=[],e.startDir={x:0,y:0},e.endDir={x:0,y:0},e.startPortOffsetX=void 0,e.startPortOffsetY=void 0,e.endPortOffsetX=void 0,e.endPortOffsetY=void 0;for(let e of t.subgraphs)e.minX=0,e.minY=0,e.maxX=0,e.maxY=0;}function Vo(t){let e=0;for(let s of t.columnWidth.keys())e=Math.max(e,s);let n=0;for(let s of t.rowHeight.keys())n=Math.max(n,s);let r=new Int32Array(e+2),o=0;for(let s=0;s<r.length;s++)r[s]=o,o+=t.columnWidth.get(s)??0;let i=new Int32Array(n+2),c=0;for(let s=0;s<i.length;s++)i[s]=c,c+=t.rowHeight.get(s)??0;t.columnStartX=r,t.rowStartY=i;}function qo(t,e){let n=t.config.graphDirection,r=new Array(100).fill(0),o=new Set,i=[];for(let M of t.nodes){o.has(M.name)||i.push(M),o.add(M.name);for(let $ of Fe(t,M))o.add($.name);}let c=false,s=false;for(let M of i)Be(t,M)?Fe(t,M).length>0&&(s=true):c=true;let l=n==="LR"&&c&&s,f,u=[];l?(f=i.filter(M=>!Be(t,M)),u=i.filter(M=>Be(t,M))):f=i;for(let M of f){let $=n==="LR"?{x:0+e,y:r[0]+e}:{x:r[0]+e,y:0+e};ae(t,t.nodes[M.index],$),r[0]=r[0]+4;}if(l&&u.length>0)for(let $ of u){let D=n==="LR"?{x:4+e,y:r[4]+e}:{x:r[4]+e,y:4+e};ae(t,t.nodes[$.index],D),r[4]=r[4]+4;}for(let M of t.nodes){let $=M.gridCoord,_=(n==="LR"?$.x-e:$.y-e)+4,R=r[_]??0;for(let B of Fe(t,M)){if(B.gridCoord!==null)continue;let z=n==="LR"?{x:_+e,y:R+e}:{x:R+e,y:_+e};ae(t,t.nodes[B.index],z),r[_]=R+4,R=r[_];}}let h=0,a=0;for(let M of t.nodes)M.gridCoord&&(h=Math.max(h,M.gridCoord.x+2),a=Math.max(a,M.gridCoord.y+2));let d=h+Oe+1,m=a+Oe+1,x=xn(d,m);for(let M of t.nodes)if(M.gridCoord)for(let $=0;$<3;$++)for(let D=0;D<3;D++){let _=M.gridCoord.x+$,R=M.gridCoord.y+D;x.blocked[_+R*d]=1;}let g=En(x.blocked.length),p=new Uint8Array(x.blocked.length);for(let M of t.nodes)Fo(t,M);for(let M of t.edges)Ln(t,M,x,h,a,g,p),Yo(t,M.path);if(t.edges.some(M=>M.path.length<2))return  false;if(!t.config.useAscii&&t.config.routing==="relaxed"){let M=function(_){return _.x===1&&_.y===0?"up":_.x===1&&_.y===2?"down":_.x===0&&_.y===1?"left":_.x===2&&_.y===1?"right":null},$=function(_,R){if(_<=0)return [];if(R<=0)return [];if(_===1)return [Math.floor(R/2)];let B=[];for(let z=0;z<_;z++)B.push(Math.floor(z*(R-1)/(_-1)));return B};let D=t.nodes.map(()=>({up:[],down:[],left:[],right:[]}));for(let _=0;_<t.edges.length;_++){let R=t.edges[_];if(R.path.length<2)continue;let B=M(R.startDir),z=M(R.endDir);if(B){let E=R.to.gridCoord,O=B==="left"||B==="right"?E?.y??0:E?.x??0;D[R.from.index][B].push({edge:R,kind:"start",otherSort:O,edgeOrder:_});}if(z){let E=R.from.gridCoord,O=z==="left"||z==="right"?E?.y??0:E?.x??0;D[R.to.index][z].push({edge:R,kind:"end",otherSort:O,edgeOrder:_});}}for(let _ of t.nodes){if(!_.gridCoord)continue;let R=D[_.index],B=t.config.boxBorderPadding,z=2*B+st(_.displayLabel),E=1+2*B,O=Math.max(z,R.up.length,R.down.length),L=Math.max(E,R.left.length,R.right.length),G=_.gridCoord.x+1,w=_.gridCoord.y+1,j=t.columnWidth.get(G)??0;O>j&&t.columnWidth.set(G,O);let Y=t.rowHeight.get(w)??0;L>Y&&t.rowHeight.set(w,L);}for(let _ of t.nodes){let L=function(G,w){if(G.length===0)return;G.sort((A,y)=>A.otherSort-y.otherSort||A.edgeOrder-y.edgeOrder);let j=w==="left"||w==="right"?O:E,Y=$(G.length,j);for(let A=0;A<G.length;A++){let y=G[A],S=Y[A];w==="left"||w==="right"?y.kind==="start"?y.edge.startPortOffsetY=S:y.edge.endPortOffsetY=S:y.kind==="start"?y.edge.startPortOffsetX=S:y.edge.endPortOffsetX=S;}};if(!_.gridCoord)continue;let R=D[_.index],B=_.gridCoord.x+1,z=_.gridCoord.y+1,E=t.columnWidth.get(B)??0,O=t.rowHeight.get(z)??0;L(R.left,"left"),L(R.right,"right"),L(R.up,"up"),L(R.down,"down");}}for(let M of t.edges)In(t,M);Vo(t);for(let M of t.nodes)M.drawingCoord=Xo(t,M.gridCoord),M.drawing=Pn(M,t);return mn(t.canvas,t.columnWidth,t.rowHeight),jo(t),Uo(t),true}function Ko(t,e){return t.edges.filter(n=>n.from.name===e.name)}function Fe(t,e){return Ko(t,e).map(n=>n.to)}function me(t){let e={actors:[],messages:[],blocks:[],notes:[]},n=new Set,r=[];for(let o=1;o<t.length;o++){let i=t[o],c=i.match(/^(participant|actor)\s+(\S+?)(?:\s+as\s+(.+))?$/);if(c){let a=c[1],d=c[2],m=c[3]?.trim()??d;n.has(d)||(n.add(d),e.actors.push({id:d,label:m,type:a}));continue}let s=i.match(/^Note\s+(left of|right of|over)\s+([^:]+):\s*(.+)$/i);if(s){let a=s[1].toLowerCase(),d=s[2].trim(),m=s[3].trim(),x=d.split(",").map(p=>p.trim());for(let p of x)ce(e,n,p);let g="over";a==="left of"?g="left":a==="right of"&&(g="right"),e.notes.push({actorIds:x,text:m,position:g,afterIndex:e.messages.length-1});continue}let l=i.match(/^(loop|alt|opt|par|critical|break|rect)\s*(.*)$/);if(l){let a=l[1],d=l[2]?.trim()??"";r.push({type:a,label:d,startIndex:e.messages.length,dividers:[]});continue}let f=i.match(/^(else|and)\s*(.*)$/);if(f&&r.length>0){let a=f[2]?.trim()??"";r[r.length-1].dividers.push({index:e.messages.length,label:a});continue}if(i==="end"&&r.length>0){let a=r.pop();e.blocks.push({type:a.type,label:a.label,startIndex:a.startIndex,endIndex:Math.max(e.messages.length-1,a.startIndex),dividers:a.dividers});continue}let u=i.match(/^(\S+?)\s*(--?>?>|--?[)x]|--?>>|--?>)\s*([+-]?)(\S+?)\s*:\s*(.+)$/);if(u){let a=u[1],d=u[2],m=u[3],x=u[4],g=u[5].trim();ce(e,n,a),ce(e,n,x);let p=d.startsWith("--")?"dashed":"solid",b=d.includes(">>")||d.includes("x")?"filled":"open",C={from:a,to:x,label:g,lineStyle:p,arrowHead:b};m==="+"&&(C.activate=true),m==="-"&&(C.deactivate=true),e.messages.push(C);continue}let h=i.match(/^(\S+?)\s*(->>|-->>|-\)|--\)|-x|--x|->|-->)\s*([+-]?)(\S+?)\s*:\s*(.+)$/);if(h){let a=h[1],d=h[2],m=h[3],x=h[4],g=h[5].trim();ce(e,n,a),ce(e,n,x);let p=d.startsWith("--")?"dashed":"solid",b=d.includes(">>")||d.includes("x")?"filled":"open",C={from:a,to:x,label:g,lineStyle:p,arrowHead:b};m==="+"&&(C.activate=true),m==="-"&&(C.deactivate=true),e.messages.push(C);continue}}return e}function ce(t,e,n){e.has(n)||(e.add(n),t.actors.push({id:n,label:n,type:"participant"}));}function Bn(t,e){let n=t.split(`
`).map(A=>A.trim()).filter(A=>A.length>0&&!A.startsWith("%%")),r=me(n);if(r.actors.length===0)return "";let o=e.useAscii,i=o?"-":"\u2500",c=o?"|":"\u2502",s=o?"+":"\u250C",l=o?"+":"\u2510",f=o?"+":"\u2514",u=o?"+":"\u2518",h=o?"+":"\u252C",a=o?"+":"\u2534",d=o?"+":"\u251C",m=o?"+":"\u2524",x=new Map;r.actors.forEach((A,y)=>x.set(A.id,y));let g=1,b=r.actors.map(A=>st(A.label)+2*g+2).map(A=>Math.ceil(A/2)),C=3,T=new Array(Math.max(r.actors.length-1,0)).fill(0);for(let A of r.messages){let y=x.get(A.from),S=x.get(A.to);if(y===S)continue;let P=Math.min(y,S),X=Math.max(y,S),H=st(A.label)+4,W=X-P,U=Math.ceil(H/W);for(let k=P;k<X;k++)T[k]=Math.max(T[k],U);}let N=[b[0]];for(let A=1;A<r.actors.length;A++){let y=Math.max(b[A-1]+b[A]+2,T[A-1]+2,10);N[A]=N[A-1]+y;}let v=[],M=[],$=new Map,D=new Map,_=new Map,R=[],B=C;for(let A=0;A<r.messages.length;A++){for(let P=0;P<r.blocks.length;P++)r.blocks[P].startIndex===A&&(B+=2,$.set(P,B-1));for(let P=0;P<r.blocks.length;P++)for(let X=0;X<r.blocks[P].dividers.length;X++)r.blocks[P].dividers[X].index===A&&(B+=1,_.set(`${P}:${X}`,B),B+=1);B+=1;let y=r.messages[A];y.from===y.to?(M[A]=B+1,v[A]=B,B+=3):(M[A]=B,v[A]=B+1,B+=2);for(let P=0;P<r.notes.length;P++)if(r.notes[P].afterIndex===A){B+=1;let X=r.notes[P],H=X.text.split("\\n"),W=Math.max(...H.map(F=>st(F)))+4,U=H.length+2,k=x.get(X.actorIds[0])??0,I;if(X.position==="left")I=N[k]-W-1;else if(X.position==="right")I=N[k]+2;else if(X.actorIds.length>=2){let F=x.get(X.actorIds[1])??k;I=Math.floor((N[k]+N[F])/2)-Math.floor(W/2);}else I=N[k]-Math.floor(W/2);I=Math.max(0,I),R.push({x:I,y:B,width:W,height:U,lines:H}),B+=U;}for(let P=0;P<r.blocks.length;P++)r.blocks[P].endIndex===A&&(B+=1,D.set(P,B),B+=1);}B+=1;let z=B,E=z+C,O=N[N.length-1]??0,L=b[b.length-1]??0,G=O+L+2;for(let A=0;A<r.messages.length;A++){let y=r.messages[A];if(y.from===y.to){let S=x.get(y.from),P=N[S]+6+2+st(y.label);G=Math.max(G,P+1);}}for(let A of R)G=Math.max(G,A.x+A.width+1);let w=dt(G,E-1);function j(A,y,S){let P=st(S)+2*g+2,X=A-Math.floor(P/2);w[X][y]=s;for(let W=1;W<P-1;W++)w[X+W][y]=i;w[X+P-1][y]=l,w[X][y+1]=c,w[X+P-1][y+1]=c;let H=X+1+g;ft(w,{x:H,y:y+1},S),w[X][y+2]=f;for(let W=1;W<P-1;W++)w[X+W][y+2]=i;w[X+P-1][y+2]=u;}for(let A=0;A<r.actors.length;A++){let y=N[A];for(let S=C;S<=z;S++)w[y][S]=c;}for(let A=0;A<r.actors.length;A++){let y=r.actors[A];j(N[A],0,y.label),j(N[A],z,y.label),o||(w[N[A]][C-1]=h,w[N[A]][z]=a);}for(let A=0;A<r.messages.length;A++){let y=r.messages[A],S=x.get(y.from),P=x.get(y.to),X=N[S],H=N[P],W=S===P,U=y.lineStyle==="dashed",k=y.arrowHead==="filled",I=U?o?".":"\u254C":i;if(W){let F=v[A],V=Math.max(4,4);w[X][F]=d;for(let rt=X+1;rt<X+V;rt++)w[rt][F]=I;w[X+V][F]=o?"+":"\u2510",w[X+V][F+1]=c;let K=X+V+2;ft(w,{x:K,y:F+1},y.label);let Z=k?o?"<":"\u25C0":o?"<":"\u25C1";w[X][F+2]=Z;for(let rt=X+1;rt<X+V;rt++)w[rt][F+2]=I;w[X+V][F+2]=o?"+":"\u2518";}else {let F=M[A],V=v[A],K=X<H,rt=Math.floor((X+H)/2)-Math.floor(st(y.label)/2);if(ft(w,{x:Math.max(0,rt),y:F},y.label),K){for(let kt=X+1;kt<H;kt++)w[kt][V]=I;let ht=k?o?">":"\u25B6":o?">":"\u25B7";w[H][V]=ht;}else {for(let kt=H+1;kt<X;kt++)w[kt][V]=I;let ht=k?o?"<":"\u25C0":o?"<":"\u25C1";w[H][V]=ht;}}}for(let A=0;A<r.blocks.length;A++){let y=r.blocks[A],S=$.get(A),P=D.get(A);if(S===void 0||P===void 0)continue;let X=G,H=0;for(let I=y.startIndex;I<=y.endIndex&&!(I>=r.messages.length);I++){let F=r.messages[I],V=x.get(F.from)??0,K=x.get(F.to)??0;X=Math.min(X,N[Math.min(V,K)]),H=Math.max(H,N[Math.max(V,K)]);}let W=Math.max(0,X-4),U=Math.min(G-1,H+4);w[W][S]=s;for(let I=W+1;I<U;I++)w[I][S]=i;w[U][S]=l;let k=y.label?`${y.type} [${y.label}]`:y.type;ft(w,{x:W+1,y:S},se(k,U-(W+1))),w[W][P]=f;for(let I=W+1;I<U;I++)w[I][P]=i;w[U][P]=u;for(let I=S+1;I<P;I++)w[W][I]=c,w[U][I]=c;for(let I=0;I<y.dividers.length;I++){let F=_.get(`${A}:${I}`);if(F===void 0)continue;let V=Y();w[W][F]=d;for(let Z=W+1;Z<U;Z++)w[Z][F]=V;w[U][F]=m;let K=y.dividers[I].label;if(K){let Z=`[${K}]`;ft(w,{x:W+1,y:F},se(Z,U-(W+1)));}}}for(let A of R){Ut(w,A.x+A.width,A.y+A.height),w[A.x][A.y]=s;for(let S=1;S<A.width-1;S++)w[A.x+S][A.y]=i;w[A.x+A.width-1][A.y]=l;for(let S=0;S<A.lines.length;S++){let P=A.y+1+S;w[A.x][P]=c,w[A.x+A.width-1][P]=c,ft(w,{x:A.x+2,y:P},A.lines[S]);}let y=A.y+A.height-1;w[A.x][y]=f;for(let S=1;S<A.width-1;S++)w[A.x+S][y]=i;w[A.x+A.width-1][y]=u;}return Et(w);function Y(){return o?"-":"\u254C"}}function pe(t){let e={classes:[],relationships:[],namespaces:[]},n=new Map,r=null,o=null,i=0;for(let c=1;c<t.length;c++){let s=t[c];if(o&&i>0){if(s==="}"){i--,i===0&&(o=null);continue}let m=s.match(/^<<(\w+)>>$/);if(m){o.annotation=m[1];continue}let x=Xn(s);x&&(x.isMethod?o.methods.push(x.member):o.attributes.push(x.member));continue}let l=s.match(/^namespace\s+(\S+)\s*\{$/);if(l){r={name:l[1],classIds:[]};continue}if(s==="}"&&r){e.namespaces.push(r),r=null;continue}let f=s.match(/^class\s+(\S+?)(?:\s*~(\w+)~)?\s*\{$/);if(f){let m=f[1],x=f[2],g=Zt(n,m);x&&(g.label=`${m}<${x}>`),o=g,i=1,r&&r.classIds.push(m);continue}let u=s.match(/^class\s+(\S+?)(?:\s*~(\w+)~)?\s*$/);if(u){let m=u[1],x=u[2],g=Zt(n,m);x&&(g.label=`${m}<${x}>`),r&&r.classIds.push(m);continue}let h=s.match(/^class\s+(\S+?)\s*\{\s*<<(\w+)>>\s*\}$/);if(h){let m=Zt(n,h[1]);m.annotation=h[2];continue}let a=s.match(/^(\S+?)\s*:\s*(.+)$/);if(a){let m=a[2];if(!m.match(/<\|--|--|\*--|o--|-->|\.\.>|\.\.\|>/)){let x=Zt(n,a[1]),g=Xn(m);g&&(g.isMethod?x.methods.push(g.member):x.attributes.push(g.member));continue}}let d=Jo(s);if(d){Zt(n,d.from),Zt(n,d.to),e.relationships.push(d);continue}}return e.classes=[...n.values()],e}function Zt(t,e){let n=t.get(e);return n||(n={id:e,label:e,attributes:[],methods:[]},t.set(e,n)),n}function Xn(t){let e=t.trim().replace(/;$/,"");if(!e)return null;let n="",r=e;/^[+\-#~]/.test(r)&&(n=r[0],r=r.slice(1).trim());let o=r.match(/^(.+?)\(([^)]*)\)(?:\s*(.+))?$/);if(o){let u=o[1].trim(),h=o[3]?.trim(),a=u.endsWith("$")||r.includes("$"),d=u.endsWith("*")||r.includes("*");return {member:{visibility:n,name:u.replace(/[$*]$/,""),type:h||void 0,isStatic:a,isAbstract:d},isMethod:true}}let i=r.split(/\s+/),c,s;i.length>=2?(s=i[0],c=i.slice(1).join(" ")):c=i[0]??r;let l=c.endsWith("$"),f=c.endsWith("*");return {member:{visibility:n,name:c.replace(/[$*]$/,""),type:s||void 0,isStatic:l,isAbstract:f},isMethod:false}}function Jo(t){let e=t.match(/^(\S+?)\s+(?:"([^"]*?)"\s+)?(<\|--|<\|\.\.|\*--|o--|-->|--\*|--o|--|>\s*|\.\.>|\.\.\|>|--)\s+(?:"([^"]*?)"\s+)?(\S+?)(?:\s*:\s*(.+))?$/);if(!e)return null;let n=e[1],r=e[2]||void 0,o=e[3].trim(),i=e[4]||void 0,c=e[5],s=e[6]?.trim()||void 0,l=Zo(o);return l?{from:n,to:c,type:l.type,markerAt:l.markerAt,label:s,fromCardinality:r,toCardinality:i}:null}function Zo(t){switch(t){case "<|--":return {type:"inheritance",markerAt:"from"};case "<|..":return {type:"realization",markerAt:"from"};case "*--":return {type:"composition",markerAt:"from"};case "--*":return {type:"composition",markerAt:"to"};case "o--":return {type:"aggregation",markerAt:"from"};case "--o":return {type:"aggregation",markerAt:"to"};case "-->":return {type:"association",markerAt:"to"};case "..>":return {type:"dependency",markerAt:"to"};case "..|>":return {type:"realization",markerAt:"to"};case "--":return {type:"association",markerAt:"to"};default:return null}}function Fn(t){let e=t.visibility||"",n=t.type?`: ${t.type}`:"";return `${e}${t.name}${n}`}function Qo(t){let e=[];t.annotation&&e.push(`<<${t.annotation}>>`),e.push(t.label);let n=t.attributes.map(Fn),r=t.methods.map(Fn);return n.length===0&&r.length===0?[e]:r.length===0?[e,n]:[e,n,r]}function ti(t,e){return {type:t,markerAt:e,dashed:t==="dependency"||t==="realization"}}function Qt(t,e,n){switch(t){case "inheritance":case "realization":return n==="down"?e?"^":"\u25B3":n==="up"?e?"v":"\u25BD":n==="left"?e?">":"\u25C1":e?"<":"\u25B7";case "composition":return e?"*":"\u25C6";case "aggregation":return e?"o":"\u25C7";case "association":case "dependency":return n==="down"?e?"v":"\u25BC":n==="up"?e?"^":"\u25B2":n==="left"?e?"<":"\u25C0":e?">":"\u25B6"}}function Yn(t,e){let n=t.split(`
`).map(L=>L.trim()).filter(L=>L.length>0&&!L.startsWith("%%")),r=pe(n);if(r.classes.length===0)return "";let o=e.useAscii,i=r.relationships.reduce((L,G)=>Math.max(L,G.label?st(` ${G.label} `):0),0),c=Math.max(4,Math.ceil(i/2)+1),s=3,l=new Map,f=new Map,u=new Map;for(let L of r.classes){let G=Qo(L);l.set(L.id,G);let w=0;for(let y of G)for(let S of y)w=Math.max(w,st(S));let j=w+4,Y=0;for(let y of G)Y+=Math.max(y.length,1);let A=Y+(G.length-1)+2;f.set(L.id,j),u.set(L.id,A);}let h=new Map;for(let L of r.classes)h.set(L.id,L);let a=new Map,d=new Map;for(let L of r.relationships){let G=L.type==="inheritance"||L.type==="realization",w=G&&L.markerAt==="to"?L.to:L.from,j=G&&L.markerAt==="to"?L.from:L.to;a.has(j)||a.set(j,new Set),a.get(j).add(w),d.has(w)||d.set(w,new Set),d.get(w).add(j);}let m=new Map,g=r.classes.filter(L=>!a.has(L.id)||a.get(L.id).size===0).map(L=>L.id);for(let L of g)m.set(L,0);let p=r.classes.length-1,b=0;for(;b<g.length;){let L=g[b++],G=d.get(L);if(G)for(let w of G){let j=(m.get(L)??0)+1;j>p||(!m.has(w)||m.get(w)<j)&&(m.set(w,j),g.push(w));}}for(let L of r.classes)m.has(L.id)||m.set(L.id,0);let C=Math.max(...m.values(),0),T=Array.from({length:C+1},()=>[]);for(let L of r.classes)T[m.get(L.id)].push(L.id);let N=new Map,v=0;for(let L=0;L<=C;L++){let G=T[L];if(G.length===0)continue;let w=0,j=0;for(let Y of G){let A=h.get(Y),y=f.get(Y),S=u.get(Y);N.set(Y,{cls:A,sections:l.get(Y),x:w,y:v,width:y,height:S}),w+=y+c,j=Math.max(j,S);}v+=j+s;}let M=0;for(let L of r.relationships){if(!L.label)continue;let G=N.get(L.from),w=N.get(L.to);if(!G||!w)continue;let j=G.x+Math.floor(G.width/2),Y=w.x+Math.floor(w.width/2),A=Math.floor((j+Y)/2),y=` ${L.label} `,S=A-Math.floor(st(y)/2);M=Math.min(M,S);}let $=M<0?-M:0;if($>0)for(let L of N.values())L.x+=$;let D=0,_=0;for(let L of N.values())D=Math.max(D,L.x+L.width),_=Math.max(_,L.y+L.height);D+=4,_+=2;let R=dt(D-1,_-1);for(let L of N.values()){let G=he(L.sections,o);for(let w=0;w<G.length;w++)for(let j=0;j<G[0].length;j++){let Y=G[w][j];if(Y!==" "){let A=L.x+w,y=L.y+j;A<D&&y<_&&(R[A][y]=Y);}}}let B=o?"-":"\u2500",z=o?"|":"\u2502",E=o?".":"\u254C",O=o?":":"\u250A";for(let L of r.relationships){let G=N.get(L.from),w=N.get(L.to);if(!G||!w)continue;let j=ti(L.type,L.markerAt),Y=j.dashed?E:B,A=j.dashed?O:z,y=G.x+Math.floor(G.width/2),S=G.y+G.height-1,P=w.x+Math.floor(w.width/2),X=w.y;if(S<X){let H=S+Math.floor((X-S)/2);for(let W=S+1;W<=H;W++)W<_&&(R[y][W]=A);if(y!==P){let W=Math.min(y,P),U=Math.max(y,P);for(let k=W;k<=U;k++)k<D&&H<_&&(R[k][H]=Y);!o&&H<_&&(y<P?(R[y][H]="\u2514",R[P][H]="\u2510"):(R[y][H]="\u2518",R[P][H]="\u250C"));}for(let W=H+1;W<X;W++)W<_&&(R[P][W]=A);if(j.markerAt==="to"){let W=Qt(j.type,o,"down"),U=X-1;if(U>=0&&U<_)for(let k=0;k<W.length;k++){let I=P-Math.floor(W.length/2)+k;I>=0&&I<D&&(R[I][U]=W[k]);}}if(j.markerAt==="from"){let W=Qt(j.type,o,"down"),U=S+1;if(U<_)for(let k=0;k<W.length;k++){let I=y-Math.floor(W.length/2)+k;I>=0&&I<D&&(R[I][U]=W[k]);}}}else if(w.y+w.height-1<G.y){let H=G.y,W=w.y+w.height-1,U=W+Math.floor((H-W)/2);for(let k=H-1;k>=U;k--)k>=0&&k<_&&(R[y][k]=A);if(y!==P){let k=Math.min(y,P),I=Math.max(y,P);for(let F=k;F<=I;F++)F<D&&U>=0&&U<_&&(R[F][U]=Y);!o&&U>=0&&U<_&&(y<P?(R[y][U]="\u250C",R[P][U]="\u2518"):(R[y][U]="\u2510",R[P][U]="\u2514"));}for(let k=U-1;k>W;k--)k>=0&&k<_&&(R[P][k]=A);if(j.markerAt==="from"){let k=Qt(j.type,o,"up"),I=H-1;if(I>=0&&I<_)for(let F=0;F<k.length;F++){let V=y-Math.floor(k.length/2)+F;V>=0&&V<D&&(R[V][I]=k[F]);}}if(j.markerAt==="to"){let I=j.type==="inheritance"||j.type==="realization"?"down":"up",F=Qt(j.type,o,I),V=W+1;if(V<_)for(let K=0;K<F.length;K++){let Z=P-Math.floor(F.length/2)+K;Z>=0&&Z<D&&(R[Z][V]=F[K]);}}}else {let H=Math.max(S,w.y+w.height-1)+2;Ut(R,D,H+1);for(let k=S+1;k<=H;k++)R[y][k]=A;let W=Math.min(y,P),U=Math.max(y,P);for(let k=W;k<=U;k++)R[k][H]=Y;for(let k=H-1;k>=w.y+w.height;k--)R[P][k]=A;if(j.markerAt==="from"){let k=Qt(j.type,o,"down"),I=S+1;if(I<_)for(let F=0;F<k.length;F++){let V=y-Math.floor(k.length/2)+F;V>=0&&V<D&&(R[V][I]=k[F]);}}if(j.markerAt==="to"){let k=Qt(j.type,o,"up"),I=w.y+w.height;if(I<_)for(let F=0;F<k.length;F++){let V=P-Math.floor(k.length/2)+F;V>=0&&V<D&&(R[V][I]=k[F]);}}}if(L.label){let H=` ${L.label} `,W=Math.floor((y+P)/2),U;if(S<X)U=Math.floor((S+1+X-1)/2);else if(w.y+w.height-1<G.y){let I=w.y+w.height-1;U=Math.floor((I+1+G.y-1)/2);}else U=Math.max(S,w.y+w.height-1)+2;let k=W-Math.floor(st(H)/2);U>=0&&U<_&&ft(R,{x:Math.max(0,k),y:U},H);}}return Et(R)}function ge(t){let e={entities:[],relationships:[]},n=new Map,r=null;for(let o=1;o<t.length;o++){let i=t[o];if(r){if(i==="}"){r=null;continue}let l=ei(i);l&&r.attributes.push(l);continue}let c=i.match(/^(\S+)\s*\{$/);if(c){let l=c[1];r=Ye(n,l);continue}let s=ni(i);if(s){Ye(n,s.entity1),Ye(n,s.entity2),e.relationships.push(s);continue}}return e.entities=[...n.values()],e}function Ye(t,e){let n=t.get(e);return n||(n={id:e,label:e,attributes:[]},t.set(e,n)),n}function ei(t){let e=t.match(/^(\S+)\s+(\S+)(?:\s+(.+))?$/);if(!e)return null;let n=e[1],r=e[2],o=e[3]?.trim()??"",i=[],c,s=o.match(/"([^"]*)"/);s&&(c=s[1]);let l=o.replace(/"[^"]*"/,"").trim();for(let f of l.split(/\s+/)){let u=f.toUpperCase();(u==="PK"||u==="FK"||u==="UK")&&i.push(u);}return {type:n,name:r,keys:i,comment:c}}function ni(t){let e=t.match(/^(\S+)\s+([|o}{]+(?:--|\.\.)[|o}{]+)\s+(\S+)\s*:\s*(.+)$/);if(!e)return null;let n=e[1],r=e[2],o=e[3],i=e[4].trim(),c=r.match(/^([|o}{]+)(--|\.\.?)([|o}{]+)$/);if(!c)return null;let s=c[1],l=c[2],f=c[3],u=Wn(s),h=Wn(f),a=l==="--";return !u||!h?null:{entity1:n,entity2:o,cardinality1:u,cardinality2:h,label:i,identifying:a}}function Wn(t){let e=t.split("").sort().join("");return e==="||"?"one":e==="o|"?"zero-one":e==="|}"||e==="{|"?"many":e==="{o"||e==="o{"?"zero-many":null}function ri(t){return `${t.keys.length>0?t.keys.join(",")+" ":"   "}${t.type} ${t.name}`}function oi(t){let e=[t.label],n=t.attributes.map(ri);return n.length===0?[e]:[e,n]}function xe(t,e){if(e)switch(t){case "one":return "||";case "zero-one":return "o|";case "many":return "}|";case "zero-many":return "o{"}else switch(t){case "one":return "\u2551";case "zero-one":return "o\u2551";case "many":return "\u255F";case "zero-many":return "o\u255F"}}function Hn(t,e){let n=t.split(`
`).map($=>$.trim()).filter($=>$.length>0&&!$.startsWith("%%")),r=ge(n);if(r.entities.length===0)return "";let o=e.useAscii,i=r.relationships.reduce(($,D)=>Math.max($,st(D.label)),0),c=Math.max(6,i),s=4,l=new Map,f=new Map,u=new Map;for(let $ of r.entities){let D=oi($);l.set($.id,D);let _=0;for(let E of D)for(let O of E)_=Math.max(_,st(O));let R=_+4,B=0;for(let E of D)B+=Math.max(E.length,1);let z=B+(D.length-1)+2;f.set($.id,R),u.set($.id,z);}let h=Math.max(2,Math.ceil(Math.sqrt(r.entities.length))),a=new Map,d=0,m=0,x=0,g=0;for(let $ of r.entities){let D=f.get($.id),_=u.get($.id);g>=h&&(m+=x+s,d=0,x=0,g=0),a.set($.id,{entity:$,sections:l.get($.id),x:d,y:m,width:D,height:_}),d+=D+c,x=Math.max(x,_),g++;}let p=0,b=0;for(let $ of a.values())p=Math.max(p,$.x+$.width),b=Math.max(b,$.y+$.height);p+=4,b+=2;let C=dt(p-1,b-1);for(let $ of a.values()){let D=he($.sections,o);for(let _=0;_<D.length;_++)for(let R=0;R<D[0].length;R++){let B=D[_][R];if(B!==" "){let z=$.x+_,E=$.y+R;z<p&&E<b&&(C[z][E]=B);}}}let T=o?"-":"\u2500",N=o?"|":"\u2502",v=o?".":"\u254C",M=o?":":"\u250A";for(let $ of r.relationships){let D=a.get($.entity1),_=a.get($.entity2);if(!D||!_)continue;let R=$.identifying?T:v,B=$.identifying?N:M,z=D.x+Math.floor(D.width/2),E=D.y+Math.floor(D.height/2),O=_.x+Math.floor(_.width/2),L=_.y+Math.floor(_.height/2);if(Math.abs(E-L)<Math.max(D.height,_.height)){let[w,j]=z<O?[D,_]:[_,D],[Y,A]=z<O?[$.cardinality1,$.cardinality2]:[$.cardinality2,$.cardinality1],y=w.x+w.width,S=j.x-1,P=w.y+Math.floor(w.height/2);for(let W=y;W<=S;W++)W<p&&(C[W][P]=R);let X=xe(Y,o);for(let W=0;W<X.length;W++){let U=y+W;U<p&&(C[U][P]=X[W]);}let H=xe(A,o);for(let W=0;W<H.length;W++){let U=S-H.length+1+W;U>=0&&U<p&&(C[U][P]=H[W]);}if($.label){let W=Math.floor((y+S)/2),U=Math.max(y,W-Math.floor(st($.label)/2)),k=P-1;if(k>=0){let I=Math.max(0,S-U+1),F=se($.label,I);ft(C,{x:U,y:k},F);}}}else {let[w,j]=E<L?[D,_]:[_,D],[Y,A]=E<L?[$.cardinality1,$.cardinality2]:[$.cardinality2,$.cardinality1],y=w.y+w.height,S=j.y-1,P=w.x+Math.floor(w.width/2);for(let k=y;k<=S;k++)k<b&&(C[P][k]=B);let X=j.x+Math.floor(j.width/2);if(P!==X){let k=Math.floor((y+S)/2),I=Math.min(P,X),F=Math.max(P,X);for(let V=I;V<=F;V++)V<p&&k<b&&(C[V][k]=R);for(let V=k+1;V<=S;V++)V<b&&(C[X][V]=B);}let H=xe(Y,o);if(y<b)for(let k=0;k<H.length;k++){let I=P-Math.floor(H.length/2)+k;I>=0&&I<p&&(C[I][y]=H[k]);}let W=P!==X?X:P,U=xe(A,o);if(S>=0&&S<b)for(let k=0;k<U.length;k++){let I=W-Math.floor(U.length/2)+k;I>=0&&I<p&&(C[I][S]=U[k]);}if($.label){let k=Math.floor((y+S)/2),I=P+2;k>=0&&ft(C,{x:I,y:k},$.label);}}}return Et(C)}function Vn(t){let e=t.trim().split(/[\n;]/)[0]?.trim().toLowerCase()??"";return /^sequencediagram\s*$/.test(e)?"sequence":/^classdiagram\s*$/.test(e)?"class":/^erdiagram\s*$/.test(e)?"er":"flowchart"}function qn(t){let e=t.useAscii??false,n=t.routing??(e?"strict":"relaxed");return {useAscii:e,paddingX:t.paddingX??5,paddingY:t.paddingY??5,boxBorderPadding:t.boxBorderPadding??1,graphDirection:"TD",routing:n}}function Kn(t,e){let n=ie(t);n.direction==="LR"||n.direction==="RL"?e.graphDirection="LR":e.graphDirection="TD";let r=pn(n,e);Gn(r),On(r);let o=n.direction==="BT";return o&&hn(r.canvas),r.config.useAscii||fn(r.canvas),{graph:r,flippedVertically:o}}function si(t){let e=t.nodes.filter(r=>r.drawingCoord&&r.drawing).map(r=>{let[o,i]=bt(r.drawing);return {id:r.name,label:r.displayLabel,box:{x:r.drawingCoord.x,y:r.drawingCoord.y,width:o+1,height:i+1}}}),n=t.edges.map(r=>({from:r.from.name,to:r.to.name,label:r.text,path:Dn(t,r)}));return {nodes:e,edges:n}}function ai(t,e){return {nodes:t.nodes.map(n=>({...n,box:{...n.box,y:e-(n.box.y+n.box.height-1)}})),edges:t.edges.map(n=>({...n,path:n.path.map(r=>({x:r.x,y:e-r.y}))}))}}function be(t,e={}){let n=qn(e);switch(Vn(t)){case "sequence":return Bn(t,n);case "class":return Yn(t,n);case "er":return Hn(t,n);default:{let{graph:o}=Kn(t,n);return Et(o.canvas)}}}function We(t,e={}){let n=qn(e);switch(Vn(t)){case "sequence":case "class":case "er":return {text:be(t,e),meta:{nodes:[],edges:[]}};default:{let{graph:o,flippedVertically:i}=Kn(t,n),c=Et(o.canvas),s=si(o);if(!i)return {text:c,meta:s};let[,l]=bt(o.canvas);return {text:c,meta:ai(s,l)}}}}var ue=Me(ye());function ct(t,e,n){let r=n>=600?.58:n>=500?.55:.52;return t.length*e*r}function we(t,e){return t.length*e*.6}var J={nodeLabel:13,edgeLabel:11,groupHeader:12},et={nodeLabel:500,edgeLabel:400,groupHeader:600},Zn=8,te={horizontal:16,vertical:10,diamondExtra:24},at={outerBox:1,innerBox:.75,connector:.75},ut="0.35em",ee={width:8,height:4.8};function Lt(t,e,n,r){return {x:t-n/2,y:e-r/2}}function le(t,e,n,r,o){let i=t.x-e,c=t.y-n;if(Math.abs(i)<.5&&Math.abs(c)<.5)return t;let s=1/(Math.abs(i)/r+Math.abs(c)/o);return {x:e+s*i,y:n+s*c}}function de(t,e,n,r){let o=t.x-e,i=t.y-n,c=Math.sqrt(o*o+i*i);if(c<.5)return t;let s=r/c;return {x:e+s*o,y:n+s*i}}function Dt(t,e=true){if(t.length<2)return t;let n=[t[0]];for(let r=1;r<t.length;r++){let o=n[n.length-1],i=t[r],c=Math.abs(i.x-o.x),s=Math.abs(i.y-o.y);if(c<1||s<1){n.push(i);continue}e?n.push({x:o.x,y:i.y}):n.push({x:i.x,y:o.y}),n.push(i);}return li(n)}function li(t){if(t.length<3)return t;let e=[t[0]];for(let n=1;n<t.length-1;n++){let r=e[e.length-1],o=t[n],i=t[n+1],c=Math.abs(r.x-o.x)<1&&Math.abs(o.x-i.x)<1,s=Math.abs(r.y-o.y)<1&&Math.abs(o.y-i.y)<1;c||s||e.push(o);}return e.push(t[t.length-1]),e}function Xt(t,e,n){if(t.length<2)return t;let r=t.map(o=>({...o}));if(n){let o=r.length-1;if(t.length===2){let i=r[0],c=r[o],s=Math.abs(c.x-i.x);if(Math.abs(c.y-i.y)>=s){let u=c.y>i.y?n.cy-n.hh:n.cy+n.hh;r[o]={x:c.x,y:u};}else {let u=c.x>i.x?n.cx-n.hw:n.cx+n.hw;r[o]={x:u,y:c.y};}}else {let i=r[o-1],c=r[o],s=Math.abs(c.x-i.x),l=Math.abs(c.y-i.y),f=l<1&&s>=1,u=s<1&&l>=1,h=!f&&!u&&l<s,a=!f&&!u&&s<l;if(f){let m=c.x>i.x?n.cx-n.hw:n.cx+n.hw;r[o]={x:m,y:n.cy},r[o-1]={...i,y:n.cy};}else if(u){let m=c.y>i.y?n.cy-n.hh:n.cy+n.hh;r[o]={x:n.cx,y:m},r[o-1]={...i,x:n.cx};}else if(h){let m=c.x>i.x?n.cx-n.hw:n.cx+n.hw;i.y>=n.cy-n.hh&&i.y<=n.cy+n.hh?r[o]={x:m,y:i.y}:(r[o]={x:m,y:n.cy},r[o-1]={...i,y:n.cy});}else if(a){let m=c.y>i.y?n.cy-n.hh:n.cy+n.hh;i.x>=n.cx-n.hw&&i.x<=n.cx+n.hw?r[o]={x:i.x,y:m}:(r[o]={x:n.cx,y:m},r[o-1]={...i,x:n.cx});}}}if(e&&t.length>=3){let o=r[0],i=r[1],c=Math.abs(i.x-o.x),s=Math.abs(i.y-o.y),l=s<1&&c>=1,f=c<1&&s>=1,u=!l&&!f&&s<c,h=!l&&!f&&c<s;if(l){let d=i.x>o.x?e.cx+e.hw:e.cx-e.hw;r[0]={x:d,y:e.cy},r[1]={...r[1],y:e.cy};}else if(f){let d=i.y>o.y?e.cy+e.hh:e.cy-e.hh;r[0]={x:e.cx,y:d},r[1]={...r[1],x:e.cx};}else if(u){let d=i.x>o.x?e.cx+e.hw:e.cx-e.hw;i.y>=e.cy-e.hh&&i.y<=e.cy+e.hh?r[0]={x:d,y:i.y}:(r[0]={x:d,y:e.cy},r[1]={...r[1],y:e.cy});}else if(h){let d=i.y>o.y?e.cy+e.hh:e.cy-e.hh;i.x>=e.cx-e.hw&&i.x<=e.cx+e.hw?r[0]={x:i.x,y:d}:(r[0]={x:e.cx,y:d},r[1]={...r[1],x:e.cx});}}return r}function Qn(t){let e=Array.from(t.nodes.keys());if(e.length===0)return [];let n=new Map,r=new Map;for(let u of e)n.set(u,u),r.set(u,0);function o(u){return n.get(u)!==u&&n.set(u,o(n.get(u))),n.get(u)}function i(u,h){let a=o(u),d=o(h);if(a===d)return;let m=r.get(a),x=r.get(d);m<x?n.set(a,d):m>x?n.set(d,a):(n.set(d,a),r.set(a,m+1));}for(let u of t.edges)n.has(u.source)&&n.has(u.target)&&i(u.source,u.target);function c(u){let h=[...u.nodeIds];for(let a of u.children)s(a,h);if(n.has(u.id)&&h.length>0)for(let a of h)n.has(a)&&i(u.id,a);if(h.length>1){let a=h[0];for(let d=1;d<h.length;d++)n.has(a)&&n.has(h[d])&&i(a,h[d]);}for(let a of u.children)c(a);}function s(u,h){h.push(...u.nodeIds);for(let a of u.children)s(a,h);}for(let u of t.subgraphs)c(u);let l=new Map;for(let u of e){let h=o(u);l.has(h)||l.set(h,new Set),l.get(h).add(u);}let f=[];for(let[u,h]of l){let a={nodeIds:h,subgraphIds:new Set,edgeIndices:new Set};for(let d=0;d<t.edges.length;d++){let m=t.edges[d];h.has(m.source)&&h.has(m.target)&&a.edgeIndices.add(d);}f.push(a);}return tr(t.subgraphs,f),f.sort((u,h)=>{let a=Math.min(...Array.from(u.nodeIds).map(m=>m.charCodeAt(0))),d=Math.min(...Array.from(h.nodeIds).map(m=>m.charCodeAt(0)));return a-d}),f}function tr(t,e){for(let n of t){let r=er(n);if(r.size>0){let o=r.values().next().value;for(let i of e)if(i.nodeIds.has(o)){i.subgraphIds.add(n.id),nr(n,i.subgraphIds);break}}tr(n.children,e);}}function er(t){let e=new Set(t.nodeIds);for(let n of t.children)for(let r of er(n))e.add(r);return e}function nr(t,e){for(let n of t.children)e.add(n.id),nr(n,e);}function rr(t,e,n){if(t.length===0)return {width:0,height:0,nodes:[],edges:[],groups:[]};if(t.length===1)return t[0];let r=e==="TD"||e==="TB"||e==="BT",o={width:0,height:0,nodes:[],edges:[],groups:[]},i=0;for(let c=0;c<t.length;c++){let s=t[c];if(r){for(let l of s.nodes)o.nodes.push({...l,x:l.x+i});for(let l of s.edges)o.edges.push({...l,points:l.points.map(f=>({x:f.x+i,y:f.y})),labelPosition:l.labelPosition?{x:l.labelPosition.x+i,y:l.labelPosition.y}:void 0});for(let l of s.groups)o.groups.push(or(l,i));o.width=i+s.width,o.height=Math.max(o.height,s.height),i+=s.width+n;}else {for(let l of s.nodes)o.nodes.push({...l,y:l.y+i});for(let l of s.edges)o.edges.push({...l,points:l.points.map(f=>({x:f.x,y:f.y+i})),labelPosition:l.labelPosition?{x:l.labelPosition.x,y:l.labelPosition.y+i}:void 0});for(let l of s.groups)o.groups.push(ir(l,i));o.width=Math.max(o.width,s.width),o.height=i+s.height,i+=s.height+n;}}return o}function or(t,e){return {...t,x:t.x+e,children:t.children.map(n=>or(n,e))}}function ir(t,e){return {...t,y:t.y+e,children:t.children.map(n=>ir(n,e))}}var Ce=new Set(["circle","doublecircle","state-start","state-end"]),ve=new Set(["diamond","circle","doublecircle","state-start","state-end"]),di={font:"Inter",padding:40,nodeSpacing:24,layerSpacing:40};function ui(t,e,n){let r=new ue.default.graphlib.Graph({directed:true,compound:true});r.setGraph({rankdir:dr(t.direction),acyclicer:"greedy",nodesep:n.nodeSpacing,ranksep:n.layerSpacing,marginx:16,marginy:12}),r.setDefaultEdgeLabel(()=>({}));let o=new Set;o.add(t.id),ze(t,o);for(let a of t.nodeIds){let d=e.nodes.get(a);if(d){let m=je(a,d.label,d.shape);r.setNode(a,{label:d.label,width:m.width,height:m.height});}}for(let a of t.children)Ue(r,a,e);let i=new Set;for(let a=0;a<e.edges.length;a++){let d=e.edges[a];if(o.has(d.source)&&o.has(d.target)){i.add(a);let m={_index:a};d.label&&(m.label=d.label,m.width=ct(d.label,J.edgeLabel,et.edgeLabel)+8,m.height=J.edgeLabel+6,m.labelpos="c"),r.setEdge(d.source,d.target,m);}}ue.default.layout(r);let c=t.direction==="TD"||t.direction==="TB"||t.direction==="BT",s=new Set;for(let a of t.children)qe(a,s);let l=[];for(let a of r.nodes()){if(s.has(a))continue;let d=e.nodes.get(a);if(!d)continue;let m=r.node(a);if(!m)continue;let x=Lt(m.x,m.y,m.width,m.height);l.push({id:a,label:d.label,shape:d.shape,x:x.x,y:x.y,width:m.width,height:m.height,inlineStyle:fr(e,a)});}let f=r.edges().map(a=>{let d=r.edge(a),m=e.edges[d._index],x=d.points??[];if(x.length>0){let M=e.nodes.get(a.v)?.shape;if(M==="diamond"){let D=r.node(a.v);x[0]=le(x[0],D.x,D.y,D.width/2,D.height/2);}else if(M&&Ce.has(M)){let D=r.node(a.v);x[0]=de(x[0],D.x,D.y,Math.min(D.width,D.height)/2);}let $=e.nodes.get(a.w)?.shape;if($==="diamond"){let D=r.node(a.w),_=x.length-1;x[_]=le(x[_],D.x,D.y,D.width/2,D.height/2);}else if($&&Ce.has($)){let D=r.node(a.w),_=x.length-1;x[_]=de(x[_],D.x,D.y,Math.min(D.width,D.height)/2);}}let g=Dt(x,c),p=e.nodes.get(a.v)?.shape,b=e.nodes.get(a.w)?.shape,C=p&&!ve.has(p)||!p?(()=>{let M=r.node(a.v);return M?{cx:M.x,cy:M.y,hw:M.width/2,hh:M.height/2}:null})():null,T=b&&!ve.has(b)||!b?(()=>{let M=r.node(a.w);return M?{cx:M.x,cy:M.y,hw:M.width/2,hh:M.height/2}:null})():null,N=Xt(g,C,T),v;return m.label&&d.x!=null&&d.y!=null&&(v={x:d.x,y:d.y}),{source:m.source,target:m.target,label:m.label,style:m.style,hasArrowStart:m.hasArrowStart,hasArrowEnd:m.hasArrowEnd,points:N,labelPosition:v}}),u=t.children.map(a=>Ve(r,a)),h=r.graph();return {id:t.id,label:t.label,width:h.width??200,height:h.height??100,nodes:l,edges:f,groups:u,nodeIds:o,internalEdgeIndices:i}}async function ar(t,e={}){let n={...di,...e},r=Qn(t);if(r.length>1){let o=[];for(let s of r){let l=fi(t,s),f=await sr(l,n);o.push(f);}let c=(n.componentSpacing??n.nodeSpacing)-2*n.padding;return rr(o,t.direction,c)}return sr(t,n)}function fi(t,e){let n=new Set,r=lr(t.subgraphs,e.subgraphIds);for(let c of r)cr(c,n);let o=new Map(Array.from(t.nodes.entries()).filter(([c])=>e.nodeIds.has(c)&&!n.has(c))),i=t.edges.filter((c,s)=>e.edgeIndices.has(s));return {direction:t.direction,nodes:o,edges:i,subgraphs:r,classDefs:t.classDefs,classAssignments:t.classAssignments,nodeStyles:t.nodeStyles}}function cr(t,e){e.add(t.id);for(let n of t.children)cr(n,e);}function lr(t,e){return t.filter(n=>e.has(n.id)).map(n=>({...n,children:lr(n.children,e)}))}async function sr(t,e){let n=new Map;for(let f of t.subgraphs)f.direction&&f.direction!==t.direction&&n.set(f.id,ui(f,t,e));let r=new ue.default.graphlib.Graph({directed:true,compound:true});r.setGraph({rankdir:dr(t.direction),acyclicer:"greedy",nodesep:e.nodeSpacing,ranksep:e.layerSpacing,marginx:e.padding,marginy:e.padding}),r.setDefaultEdgeLabel(()=>({}));let o=new Set;for(let f of t.subgraphs)o.add(f.id),ze(f,o);for(let[f,u]of t.nodes)if(!o.has(f)){let h=je(f,u.label,u.shape);r.setNode(f,{label:u.label,width:h.width,height:h.height});}for(let f of t.subgraphs)if(n.has(f.id)){let u=n.get(f.id);r.setNode(f.id,{width:u.width,height:u.height});}else Ue(r,f,t);let i=new Map,c=new Map;for(let f of t.subgraphs)n.has(f.id)||ur(f,i,c);for(let[f,u]of n)for(let h of u.nodeIds)i.set(h,f),c.set(h,f);let s=new Set;for(let f of n.values())for(let u of f.internalEdgeIndices)s.add(u);let l=new Set;for(let f=0;f<t.edges.length;f++){if(s.has(f))continue;let u=t.edges[f],h=c.get(u.source)??u.source,a=i.get(u.target)??u.target,d={_index:f};u.label&&(d.label=u.label,d.width=ct(u.label,J.edgeLabel,et.edgeLabel)+8,d.height=J.edgeLabel+6,d.labelpos="c"),l.has(a)||(d.weight=2,l.add(a)),r.setEdge(h,a,d);}try{ue.default.layout(r);}catch(f){let u=f instanceof Error?f.message:String(f);throw new Error(`Dagre layout failed: ${u}`)}return hi(r,t,e.padding,n)}function dr(t){switch(t){case "LR":return "LR";case "RL":return "RL";case "BT":return "BT";default:return "TB"}}function je(t,e,n){let o=ct(e,J.nodeLabel,et.nodeLabel)+te.horizontal*2,i=J.nodeLabel+te.vertical*2;if(n==="diamond"){let c=Math.max(o,i)+te.diamondExtra;o=c,i=c;}if(n==="circle"||n==="doublecircle"){let c=Math.ceil(Math.sqrt(o*o+i*i))+8;o=n==="doublecircle"?c+12:c,i=o;}return n==="hexagon"&&(o+=te.horizontal),(n==="trapezoid"||n==="trapezoid-alt")&&(o+=te.horizontal),n==="asymmetric"&&(o+=12),n==="cylinder"&&(i+=14),(n==="state-start"||n==="state-end")&&(o=28,i=28),o=Math.max(o,60),i=Math.max(i,36),{width:o,height:i}}function Ue(t,e,n,r){t.setNode(e.id,{label:e.label}),r&&t.setParent(e.id,r);for(let o of e.nodeIds){let i=n.nodes.get(o);if(i){let c=je(o,i.label,i.shape);t.setNode(o,{label:i.label,width:c.width,height:c.height}),t.setParent(o,e.id);}}for(let o of e.children)Ue(t,o,n,e.id);}function ur(t,e,n){for(let c of t.children)ur(c,e,n);let r=[...t.nodeIds,...t.children.map(c=>c.id)];if(r.length===0){e.set(t.id,t.id),n.set(t.id,t.id);return}let o=r[0],i=r[r.length-1];e.set(t.id,e.get(o)??o),n.set(t.id,n.get(i)??i);}function fr(t,e){let n=t.classAssignments.get(e),r=n?t.classDefs.get(n):void 0,o=t.nodeStyles.get(e);if(!(!r&&!o))return {...r,...o}}function ze(t,e){for(let n of t.nodeIds)e.add(n);for(let n of t.children)ze(n,e);}function hi(t,e,n,r){let o=[],i=[],c=new Set;for(let p of e.subgraphs)qe(p,c);let s=new Set;if(r)for(let p of r.values())for(let b of p.nodeIds)s.add(b);for(let p of t.nodes()){if(c.has(p))continue;let b=e.nodes.get(p);if(!b)continue;let C=t.node(p);if(!C)continue;let T=Lt(C.x,C.y,C.width,C.height);o.push({id:p,label:b.label,shape:b.shape,x:T.x,y:T.y,width:C.width,height:C.height,inlineStyle:fr(e,p)});}for(let p of e.subgraphs)i.push(Ve(t,p));let l=e.direction==="TD"||e.direction==="TB"||e.direction==="BT",f=t.edges().map(p=>{let b=t.edge(p),C=e.edges[b._index],T=b.points??[];if(T.length>0){let B=e.nodes.get(p.v)?.shape;if(B==="diamond"){let E=t.node(p.v);T[0]=le(T[0],E.x,E.y,E.width/2,E.height/2);}else if(B&&Ce.has(B)){let E=t.node(p.v);T[0]=de(T[0],E.x,E.y,Math.min(E.width,E.height)/2);}let z=e.nodes.get(p.w)?.shape;if(z==="diamond"){let E=t.node(p.w),O=T.length-1;T[O]=le(T[O],E.x,E.y,E.width/2,E.height/2);}else if(z&&Ce.has(z)){let E=t.node(p.w),O=T.length-1;T[O]=de(T[O],E.x,E.y,Math.min(E.width,E.height)/2);}}let N=Dt(T,l),v=e.nodes.get(p.v)?.shape,M=e.nodes.get(p.w)?.shape,$=v&&!ve.has(v)||!v?(()=>{let B=t.node(p.v);return B?{cx:B.x,cy:B.y,hw:B.width/2,hh:B.height/2}:null})():null,D=M&&!ve.has(M)||!M?(()=>{let B=t.node(p.w);return B?{cx:B.x,cy:B.y,hw:B.width/2,hh:B.height/2}:null})():null,_=Xt(N,$,D),R;return C.label&&b.x!=null&&b.y!=null&&(R={x:b.x,y:b.y}),{source:C.source,target:C.target,label:C.label,style:C.style,hasArrowStart:C.hasArrowStart,hasArrowEnd:C.hasArrowEnd,points:_,labelPosition:R}});if(r&&r.size>0){let p=new Map;for(let b of o)p.set(b.id,{cx:b.x+b.width/2,cy:b.y+b.height/2});for(let[b,C]of r){let T=t.node(b);if(!T)continue;let N=Lt(T.x,T.y,T.width,T.height);for(let M of C.nodes){let $={...M,x:M.x+N.x,y:M.y+N.y};o.push($),p.set($.id,{cx:$.x+$.width/2,cy:$.y+$.height/2});}for(let M of C.edges)f.push({...M,points:M.points.map($=>({x:$.x+N.x,y:$.y+N.y})),labelPosition:M.labelPosition?{x:M.labelPosition.x+N.x,y:M.labelPosition.y+N.y}:void 0});let v=pr(i,b);v&&C.groups.length>0&&(v.children=C.groups.map(M=>gr(M,N.x,N.y)));}for(let b of f){if(s.has(b.source)&&s.has(b.target))continue;let C=false;if(s.has(b.source)){let T=p.get(b.source);T&&b.points.length>0&&(b.points[0]={x:T.cx,y:T.cy},C=true);}if(s.has(b.target)){let T=p.get(b.target);T&&b.points.length>0&&(b.points[b.points.length-1]={x:T.cx,y:T.cy},C=true);}C&&(b.points=Dt(b.points,l));}}let u=J.groupHeader+16;mi(i,u);let h=mr(i),a=[...o.map(p=>p.y),...h.map(p=>p.y)],d=a.length>0?Math.min(...a):n,m=t.graph().width??800,x=t.graph().height??600;if(d<n){let p=n-d;for(let b of o)b.y+=p;for(let b of f){for(let C of b.points)C.y+=p;b.labelPosition&&(b.labelPosition.y+=p);}for(let b of h)b.y+=p;x+=p;}let g=Math.max(...o.map(p=>p.y+p.height),...h.map(p=>p.y+p.height),...f.flatMap(p=>p.points.map(b=>b.y)));return g+n>x&&(x=g+n),{width:m,height:x,nodes:o,edges:f,groups:i}}function Ve(t,e){let n=t.node(e.id),r=n?Lt(n.x,n.y,n.width,n.height):{x:0,y:0};return {id:e.id,label:e.label,x:r.x,y:r.y,width:n?.width??0,height:n?.height??0,children:e.children.map(o=>Ve(t,o))}}function mi(t,e){for(let n of t)hr(n,e);}function hr(t,e){for(let n of t.children)hr(n,e);if(t.children.length>0){let n=t.y,r=t.y+t.height;for(let o of t.children)n=Math.min(n,o.y),r=Math.max(r,o.y+o.height);t.height=r-n,t.y=n;}if(t.label){let n=e+Zn;t.y-=n,t.height+=n;}}function mr(t){let e=[];for(let n of t)e.push(n),e.push(...mr(n.children));return e}function pr(t,e){for(let n of t){if(n.id===e)return n;let r=pr(n.children,e);if(r)return r}}function gr(t,e,n){return {...t,x:t.x+e,y:t.y+n,children:t.children.map(r=>gr(r,e,n))}}function qe(t,e){e.add(t.id);for(let n of t.children)qe(n,e);}function br(t,e,n="Inter",r=false){let o=[];o.push(Pt(t.width,t.height,e,r)),o.push(Tt(n,false)),o.push("<defs>"),o.push(pi()),o.push("</defs>");for(let i of t.groups)o.push(yr(i));for(let i of t.edges)o.push(gi(i));for(let i of t.edges)i.label&&o.push(bi(i));for(let i of t.nodes)o.push(wi(i));for(let i of t.nodes)o.push(Ri(i));return o.push("</svg>"),o.join(`
`)}function pi(){let t=ee.width,e=ee.height;return `  <marker id="arrowhead" markerWidth="${t}" markerHeight="${e}" refX="${t}" refY="${e/2}" orient="auto">
    <polygon points="0 0, ${t} ${e/2}, 0 ${e}" fill="var(--_arrow)" />
  </marker>
  <marker id="arrowhead-start" markerWidth="${t}" markerHeight="${e}" refX="0" refY="${e/2}" orient="auto-start-reverse">
    <polygon points="${t} 0, 0 ${e/2}, ${t} ${e}" fill="var(--_arrow)" />
  </marker>`}function yr(t,e){let n=J.groupHeader+16,r=[];r.push(`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" rx="0" ry="0" fill="var(--_group-fill)" stroke="var(--_node-stroke)" stroke-width="${at.outerBox}" />`),r.push(`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${n}" rx="0" ry="0" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="${at.outerBox}" />`),r.push(`<text x="${t.x+12}" y="${t.y+n/2}" dy="${ut}" font-size="${J.groupHeader}" font-weight="${et.groupHeader}" fill="var(--_text-sec)">${Ft(t.label)}</text>`);for(let o of t.children)r.push(yr(o));return r.join(`
`)}function gi(t){if(t.points.length<2)return "";let e=xi(t.points),n=t.style==="dotted"?' stroke-dasharray="4 4"':"",r=t.style==="thick"?at.connector*2:at.connector,o="";return t.hasArrowEnd&&(o+=' marker-end="url(#arrowhead)"'),t.hasArrowStart&&(o+=' marker-start="url(#arrowhead-start)"'),`<polyline points="${e}" fill="none" stroke="var(--_line)" stroke-width="${r}"${n}${o} />`}function xi(t){return t.map(e=>`${e.x},${e.y}`).join(" ")}function bi(t,e){let n=t.labelPosition??yi(t.points),r=t.label,o=ct(r,J.edgeLabel,et.edgeLabel),i=8,c=o+i*2,s=J.edgeLabel+i*2;return `<rect x="${n.x-c/2}" y="${n.y-s/2}" width="${c}" height="${s}" rx="4" ry="4" fill="var(--bg)" stroke="var(--_inner-stroke)" stroke-width="0.5" />
<text x="${n.x}" y="${n.y}" text-anchor="middle" dy="${ut}" font-size="${J.edgeLabel}" font-weight="${et.edgeLabel}" fill="var(--_text-muted)">${Ft(r)}</text>`}function yi(t){if(t.length===0)return {x:0,y:0};if(t.length===1)return t[0];let e=0;for(let r=1;r<t.length;r++)e+=xr(t[r-1],t[r]);let n=e/2;for(let r=1;r<t.length;r++){let o=xr(t[r-1],t[r]);if(n<=o){let i=n/o;return {x:t[r-1].x+i*(t[r].x-t[r-1].x),y:t[r-1].y+i*(t[r].y-t[r-1].y)}}n-=o;}return t[t.length-1]}function xr(t,e){return Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2)}function wi(t){let{x:e,y:n,width:r,height:o,shape:i,inlineStyle:c}=t,s=Ft(c?.fill??"var(--_node-fill)"),l=Ft(c?.stroke??"var(--_node-stroke)"),f=Ft(c?.["stroke-width"]??String(at.innerBox));switch(i){case "diamond":return Mi(e,n,r,o,s,l,f);case "rounded":return vi(e,n,r,o,s,l,f);case "stadium":return Si(e,n,r,o,s,l,f);case "circle":return ki(e,n,r,o,s,l,f);case "subroutine":return $i(e,n,r,o,s,l,f);case "doublecircle":return Ei(e,n,r,o,s,l,f);case "hexagon":return Ai(e,n,r,o,s,l,f);case "cylinder":return _i(e,n,r,o,s,l,f);case "asymmetric":return Li(e,n,r,o,s,l,f);case "trapezoid":return Ii(e,n,r,o,s,l,f);case "trapezoid-alt":return Ti(e,n,r,o,s,l,f);case "state-start":return Pi(e,n,r,o);case "state-end":return Di(e,n,r,o);default:return Ci(e,n,r,o,s,l,f)}}function Ci(t,e,n,r,o,i,c){return `<rect x="${t}" y="${e}" width="${n}" height="${r}" rx="0" ry="0" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function vi(t,e,n,r,o,i,c){return `<rect x="${t}" y="${e}" width="${n}" height="${r}" rx="6" ry="6" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function Si(t,e,n,r,o,i,c){let s=r/2;return `<rect x="${t}" y="${e}" width="${n}" height="${r}" rx="${s}" ry="${s}" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function ki(t,e,n,r,o,i,c){let s=t+n/2,l=e+r/2,f=Math.min(n,r)/2;return `<circle cx="${s}" cy="${l}" r="${f}" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function Mi(t,e,n,r,o,i,c){let s=t+n/2,l=e+r/2,f=n/2,u=r/2;return `<polygon points="${[`${s},${l-u}`,`${s+f},${l}`,`${s},${l+u}`,`${s-f},${l}`].join(" ")}" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function $i(t,e,n,r,o,i,c){return `<rect x="${t}" y="${e}" width="${n}" height="${r}" rx="0" ry="0" fill="${o}" stroke="${i}" stroke-width="${c}" />
<line x1="${t+8}" y1="${e}" x2="${t+8}" y2="${e+r}" stroke="${i}" stroke-width="${c}" />
<line x1="${t+n-8}" y1="${e}" x2="${t+n-8}" y2="${e+r}" stroke="${i}" stroke-width="${c}" />`}function Ei(t,e,n,r,o,i,c){let s=t+n/2,l=e+r/2,f=Math.min(n,r)/2,u=f-5;return `<circle cx="${s}" cy="${l}" r="${f}" fill="${o}" stroke="${i}" stroke-width="${c}" />
<circle cx="${s}" cy="${l}" r="${u}" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function Ai(t,e,n,r,o,i,c){let s=r/4;return `<polygon points="${[`${t+s},${e}`,`${t+n-s},${e}`,`${t+n},${e+r/2}`,`${t+n-s},${e+r}`,`${t+s},${e+r}`,`${t},${e+r/2}`].join(" ")}" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function _i(t,e,n,r,o,i,c){let l=t+n/2,f=e+7,u=r-14;return `<rect x="${t}" y="${f}" width="${n}" height="${u}" fill="${o}" stroke="none" />
<line x1="${t}" y1="${f}" x2="${t}" y2="${f+u}" stroke="${i}" stroke-width="${c}" />
<line x1="${t+n}" y1="${f}" x2="${t+n}" y2="${f+u}" stroke="${i}" stroke-width="${c}" />
<ellipse cx="${l}" cy="${e+r-7}" rx="${n/2}" ry="7" fill="${o}" stroke="${i}" stroke-width="${c}" />
<ellipse cx="${l}" cy="${f}" rx="${n/2}" ry="7" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function Li(t,e,n,r,o,i,c){return `<polygon points="${[`${t+12},${e}`,`${t+n},${e}`,`${t+n},${e+r}`,`${t+12},${e+r}`,`${t},${e+r/2}`].join(" ")}" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function Ii(t,e,n,r,o,i,c){let s=n*.15;return `<polygon points="${[`${t+s},${e}`,`${t+n-s},${e}`,`${t+n},${e+r}`,`${t},${e+r}`].join(" ")}" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function Ti(t,e,n,r,o,i,c){let s=n*.15;return `<polygon points="${[`${t},${e}`,`${t+n},${e}`,`${t+n-s},${e+r}`,`${t+s},${e+r}`].join(" ")}" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function Pi(t,e,n,r){let o=t+n/2,i=e+r/2,c=Math.min(n,r)/2-2;return `<circle cx="${o}" cy="${i}" r="${c}" fill="var(--_text)" stroke="none" />`}function Di(t,e,n,r){let o=t+n/2,i=e+r/2,c=Math.min(n,r)/2-2,s=c-4;return `<circle cx="${o}" cy="${i}" r="${c}" fill="none" stroke="var(--_text)" stroke-width="${at.innerBox*2}" />
<circle cx="${o}" cy="${i}" r="${s}" fill="var(--_text)" stroke="none" />`}function Ri(t,e){if((t.shape==="state-start"||t.shape==="state-end")&&!t.label)return "";let n=t.x+t.width/2,r=t.y+t.height/2,o=Ft(t.inlineStyle?.color??"var(--_text)");return `<text x="${n}" y="${r}" text-anchor="middle" dy="${ut}" font-size="${J.nodeLabel}" font-weight="${et.nodeLabel}" fill="${o}">${Ft(t.label)}</text>`}function Ft(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}var nt={padding:30,actorGap:140,actorHeight:40,actorPadX:16,headerGap:20,messageRowHeight:40,selfMessageHeight:30,activationWidth:10,blockPadX:10,blockPadTop:40,blockPadBottom:8,blockHeaderExtra:28,dividerExtra:24,noteWidth:120,notePadding:8,noteGap:10};function wr(t,e={}){if(t.actors.length===0)return {width:0,height:0,actors:[],lifelines:[],messages:[],activations:[],blocks:[],notes:[]};let n=t.actors.map(v=>{let M=ct(v.label,J.nodeLabel,et.nodeLabel);return Math.max(M+nt.actorPadX*2,80)}),r=[],o=nt.padding+n[0]/2;for(let v=0;v<t.actors.length;v++){if(v>0){let M=Math.max(nt.actorGap,(n[v-1]+n[v])/2+40);o+=M;}r.push(o);}let i=new Map;for(let v=0;v<t.actors.length;v++)i.set(t.actors[v].id,v);let c=nt.padding,s=t.actors.map((v,M)=>({id:v.id,label:v.label,type:v.type,x:r[M],y:c,width:n[M],height:nt.actorHeight})),l=c+nt.actorHeight+nt.headerGap,f=[],u=new Map;for(let v of t.blocks){let M=u.get(v.startIndex)??0;u.set(v.startIndex,Math.max(M,nt.blockHeaderExtra));for(let $ of v.dividers){let D=u.get($.index)??0;u.set($.index,Math.max(D,nt.dividerExtra));}}let h=new Map,a=[];for(let v=0;v<t.messages.length;v++){let M=t.messages[v],$=i.get(M.from)??0,D=i.get(M.to)??0,_=M.from===M.to,R=u.get(v)??0;R>0&&(l+=R);let B=r[$],z=r[D];if(f.push({from:M.from,to:M.to,label:M.label,lineStyle:M.lineStyle,arrowHead:M.arrowHead,x1:B,x2:z,y:l,isSelf:_}),M.activate&&(h.has(M.to)||h.set(M.to,[]),h.get(M.to).push(l)),M.deactivate){let E=h.get(M.from);if(E&&E.length>0){let O=E.pop(),L=i.get(M.from)??0;a.push({actorId:M.from,x:r[L]-nt.activationWidth/2,topY:O,bottomY:l,width:nt.activationWidth});}}l+=_?nt.selfMessageHeight+nt.messageRowHeight:nt.messageRowHeight;}for(let[v,M]of h)for(let $ of M){let D=i.get(v)??0;a.push({actorId:v,x:r[D]-nt.activationWidth/2,topY:$,bottomY:l-nt.messageRowHeight/2,width:nt.activationWidth});}let d=t.blocks.map(v=>{let M=f[v.startIndex],$=f[v.endIndex],D=(M?.y??l)-nt.blockPadTop,_=($?.y??l)+nt.blockPadBottom+12,R=new Set;for(let G=v.startIndex;G<=v.endIndex;G++){let w=t.messages[G];w&&(R.add(i.get(w.from)??0),R.add(i.get(w.to)??0));}if(R.size===0)for(let G=0;G<t.actors.length;G++)R.add(G);let B=Math.min(...R),z=Math.max(...R),E=r[B]-n[B]/2-nt.blockPadX,O=r[z]+n[z]/2+nt.blockPadX,L=v.dividers.map(G=>{let w=f[G.index],j=w?.y??l,Y=28;if(G.label&&w?.label){let A=`[${G.label}]`,y=ct(A,J.edgeLabel,et.edgeLabel),S=E+8,P=S+y,X=ct(w.label,J.edgeLabel,et.edgeLabel),H=w.isSelf?w.x1+36:(w.x1+w.x2)/2-X/2,W=H+X;P>H&&S<W&&(Y=36);}return {y:j-Y,label:G.label}});return {type:v.type,label:v.label,x:E,y:D,width:O-E,height:_-D,dividers:L}}),m=t.notes.map(v=>{let M=Math.max(nt.noteWidth,ct(v.text,J.edgeLabel,et.edgeLabel)+nt.notePadding*2),$=J.edgeLabel+nt.notePadding*2,_=(f[v.afterIndex]?.y??c+nt.actorHeight)+4,R=i.get(v.actorIds[0]??"")??0,B;if(v.position==="left")B=r[R]-n[R]/2-M-nt.noteGap;else if(v.position==="right")B=r[R]+n[R]/2+nt.noteGap;else if(v.actorIds.length>1){let z=i.get(v.actorIds[v.actorIds.length-1]??"")??R;B=(r[R]+r[z])/2-M/2;}else B=r[R]-M/2;return {text:v.text,x:B,y:_,width:M,height:$}}),x=l+nt.padding,g=nt.padding,p=0;for(let v of s)g=Math.min(g,v.x-v.width/2),p=Math.max(p,v.x+v.width/2);for(let v of d)g=Math.min(g,v.x),p=Math.max(p,v.x+v.width);for(let v of m)g=Math.min(g,v.x),p=Math.max(p,v.x+v.width);let b=g<nt.padding?nt.padding-g:0;if(b>0){for(let v of s)v.x+=b;for(let v of f)v.x1+=b,v.x2+=b;for(let v of a)v.x+=b;for(let v of d)v.x+=b;for(let v of m)v.x+=b;for(let v=0;v<r.length;v++)r[v]+=b;}let C=t.actors.map((v,M)=>({actorId:v.id,x:r[M],topY:c+nt.actorHeight,bottomY:x-nt.padding})),T=p+b+nt.padding,N=x;return {width:Math.max(T,200),height:Math.max(N,100),actors:s,lifelines:C,messages:f,activations:a,blocks:d,notes:m}}function Cr(t,e,n="Inter",r=false){let o=[];o.push(Pt(t.width,t.height,e,r)),o.push(Tt(n,false)),o.push("<defs>"),o.push(Oi()),o.push("</defs>");for(let i of t.blocks)o.push(Fi(i));for(let i of t.lifelines)o.push(Gi(i));for(let i of t.activations)o.push(Bi(i));for(let i of t.messages)o.push(Xi(i));for(let i of t.notes)o.push(Yi(i));for(let i of t.actors)o.push(Ni(i));return o.push("</svg>"),o.join(`
`)}function Oi(){let t=ee.width,e=ee.height;return `  <marker id="seq-arrow" markerWidth="${t}" markerHeight="${e}" refX="${t}" refY="${e/2}" orient="auto-start-reverse">
    <polygon points="0 0, ${t} ${e/2}, 0 ${e}" fill="var(--_arrow)" />
  </marker>
  <marker id="seq-arrow-open" markerWidth="${t}" markerHeight="${e}" refX="${t}" refY="${e/2}" orient="auto-start-reverse">
    <polyline points="0 0, ${t} ${e/2}, 0 ${e}" fill="none" stroke="var(--_arrow)" stroke-width="1" />
  </marker>`}function Ni(t){let{x:e,y:n,width:r,height:o,label:i,type:c}=t;if(c==="actor"){let l=o/24*.9,f=e-12*l,u=n+(o-24*l)/2,h=at.outerBox/l,a="var(--_line)";return `<g transform="translate(${f},${u}) scale(${l})">
  <path d="M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" fill="none" stroke="${a}" stroke-width="${h}" />
  <path d="M15 10C15 11.6569 13.6569 13 12 13C10.3431 13 9 11.6569 9 10C9 8.34315 10.3431 7 12 7C13.6569 7 15 8.34315 15 10Z" fill="none" stroke="${a}" stroke-width="${h}" />
  <path d="M5.62842 18.3563C7.08963 17.0398 9.39997 16 12 16C14.6 16 16.9104 17.0398 18.3716 18.3563" fill="none" stroke="${a}" stroke-width="${h}" />
</g>
<text x="${e}" y="${n+o+14}" text-anchor="middle" font-size="${J.nodeLabel}" font-weight="${et.nodeLabel}" fill="var(--_text)">${Yt(i)}</text>`}return `<rect x="${e-r/2}" y="${n}" width="${r}" height="${o}" rx="4" ry="4" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="${at.outerBox}" />
<text x="${e}" y="${n+o/2}" text-anchor="middle" dy="${ut}" font-size="${J.nodeLabel}" font-weight="${et.nodeLabel}" fill="var(--_text)">${Yt(i)}</text>`}function Gi(t){return `<line x1="${t.x}" y1="${t.topY}" x2="${t.x}" y2="${t.bottomY}" stroke="var(--_line)" stroke-width="0.75" stroke-dasharray="6 4" />`}function Bi(t){return `<rect x="${t.x}" y="${t.topY}" width="${t.width}" height="${t.bottomY-t.topY}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="${at.innerBox}" />`}function Xi(t){let e=[],n=t.lineStyle==="dashed"?' stroke-dasharray="6 4"':"",r=t.arrowHead==="filled"?"seq-arrow":"seq-arrow-open";if(t.isSelf)e.push(`<polyline points="${t.x1},${t.y} ${t.x1+30},${t.y} ${t.x1+30},${t.y+20} ${t.x2},${t.y+20}" fill="none" stroke="var(--_line)" stroke-width="${at.connector}"${n} marker-end="url(#${r})" />`),e.push(`<text x="${t.x1+30+6}" y="${t.y+20/2}" dy="${ut}" font-size="${J.edgeLabel}" font-weight="${et.edgeLabel}" fill="var(--_text-muted)">${Yt(t.label)}</text>`);else {e.push(`<line x1="${t.x1}" y1="${t.y}" x2="${t.x2}" y2="${t.y}" stroke="var(--_line)" stroke-width="${at.connector}"${n} marker-end="url(#${r})" />`);let o=(t.x1+t.x2)/2;e.push(`<text x="${o}" y="${t.y-6}" text-anchor="middle" font-size="${J.edgeLabel}" font-weight="${et.edgeLabel}" fill="var(--_text-muted)">${Yt(t.label)}</text>`);}return e.join(`
`)}function Fi(t){let e=[];e.push(`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" rx="0" ry="0" fill="none" stroke="var(--_node-stroke)" stroke-width="${at.outerBox}" />`);let n=`${t.type}${t.label?` [${t.label}]`:""}`,r=ct(n,J.edgeLabel,et.groupHeader)+16,o=18;e.push(`<rect x="${t.x}" y="${t.y}" width="${r}" height="${o}" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="${at.outerBox}" />`),e.push(`<text x="${t.x+6}" y="${t.y+o/2}" dy="${ut}" font-size="${J.edgeLabel}" font-weight="${et.groupHeader}" fill="var(--_text-sec)">${Yt(n)}</text>`);for(let i of t.dividers)e.push(`<line x1="${t.x}" y1="${i.y}" x2="${t.x+t.width}" y2="${i.y}" stroke="var(--_line)" stroke-width="0.75" stroke-dasharray="6 4" />`),i.label&&e.push(`<text x="${t.x+8}" y="${i.y+14}" font-size="${J.edgeLabel}" font-weight="${et.edgeLabel}" fill="var(--_text-muted)">[${Yt(i.label)}]</text>`);return e.join(`
`)}function Yi(t){return `<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="${at.innerBox}" />
<polygon points="${t.x+t.width-6},${t.y} ${t.x+t.width},${t.y+6} ${t.x+t.width-6},${t.y+6}" fill="var(--_inner-stroke)" />
<text x="${t.x+t.width/2}" y="${t.y+t.height/2}" text-anchor="middle" dy="${ut}" font-size="${J.edgeLabel}" font-weight="${et.edgeLabel}" fill="var(--_text-muted)">${Yt(t.text)}</text>`}function Yt(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}var Ke=Me(ye());var lt={padding:40,boxPadX:8,headerBaseHeight:32,annotationHeight:16,memberRowHeight:20,sectionPadY:8,emptySectionHeight:8,minWidth:120,memberFontSize:11,nodeSpacing:40,layerSpacing:60};async function Sr(t,e={}){if(t.classes.length===0)return {width:0,height:0,classes:[],relationships:[]};let n=new Map;for(let s of t.classes){let l=s.annotation?lt.headerBaseHeight+lt.annotationHeight:lt.headerBaseHeight,f=s.attributes.length>0?s.attributes.length*lt.memberRowHeight+lt.sectionPadY:lt.emptySectionHeight,u=s.methods.length>0?s.methods.length*lt.memberRowHeight+lt.sectionPadY:lt.emptySectionHeight,h=ct(s.label,J.nodeLabel,et.nodeLabel),a=vr(s.attributes),d=vr(s.methods),m=Math.max(lt.minWidth,h+lt.boxPadX*2,a+lt.boxPadX*2,d+lt.boxPadX*2),x=l+f+u;n.set(s.id,{width:m,height:x,headerHeight:l,attrHeight:f,methodHeight:u});}let r=new Ke.default.graphlib.Graph({directed:true});r.setGraph({rankdir:"TB",acyclicer:"greedy",nodesep:lt.nodeSpacing,ranksep:lt.layerSpacing,marginx:lt.padding,marginy:lt.padding}),r.setDefaultEdgeLabel(()=>({}));for(let s of t.classes){let l=n.get(s.id);r.setNode(s.id,{width:l.width,height:l.height});}for(let s=0;s<t.relationships.length;s++){let l=t.relationships[s],f={_index:s};l.label&&(f.label=l.label,f.width=ct(l.label,J.edgeLabel,et.edgeLabel)+8,f.height=J.edgeLabel+6,f.labelpos="c"),r.setEdge(l.from,l.to,f);}try{Ke.default.layout(r);}catch(s){let l=s instanceof Error?s.message:String(s);throw new Error(`Dagre layout failed (class diagram): ${l}`)}let o=new Map;for(let s of t.classes)o.set(s.id,s);let i=t.classes.map(s=>{let l=r.node(s.id),f=n.get(s.id),u=Lt(l.x,l.y,l.width,l.height);return {id:s.id,label:s.label,annotation:s.annotation,attributes:s.attributes,methods:s.methods,x:u.x,y:u.y,width:l.width??f.width,height:l.height??f.height,headerHeight:f.headerHeight,attrHeight:f.attrHeight,methodHeight:f.methodHeight}}),c=r.edges().map(s=>{let l=r.edge(s),f=t.relationships[l._index],u=l.points??[],h=Dt(u,true),a=r.node(s.v),d=r.node(s.w),m=Xt(h,a?{cx:a.x,cy:a.y,hw:a.width/2,hh:a.height/2}:null,d?{cx:d.x,cy:d.y,hw:d.width/2,hh:d.height/2}:null),x;return f.label&&l.x!=null&&l.y!=null&&(x={x:l.x,y:l.y}),{from:f.from,to:f.to,type:f.type,markerAt:f.markerAt,label:f.label,fromCardinality:f.fromCardinality,toCardinality:f.toCardinality,points:m,labelPosition:x}});return {width:r.graph().width??600,height:r.graph().height??400,classes:i,relationships:c}}function vr(t){if(t.length===0)return 0;let e=0;for(let n of t){let r=Wi(n),o=we(r,lt.memberFontSize);o>e&&(e=o);}return e}function Wi(t){let e=t.visibility?`${t.visibility} `:"",n=t.type?`: ${t.type}`:"";return `${e}${t.name}${n}`}var Se={memberSize:11,memberWeight:400,annotationSize:10,annotationWeight:500};function $r(t,e,n="Inter",r=false){let o=[];o.push(Pt(t.width,t.height,e,r)),o.push(Tt(n,true)),o.push("<defs>"),o.push(Hi()),o.push("</defs>");for(let i of t.relationships)o.push(Ui(i));for(let i of t.classes)o.push(ji(i));for(let i of t.relationships)o.push(qi(i));return o.push("</svg>"),o.join(`
`)}function Hi(){return `  <marker id="cls-inherit" markerWidth="12" markerHeight="10" refX="12" refY="5" orient="auto-start-reverse">
    <polygon points="0 0, 12 5, 0 10" fill="var(--bg)" stroke="var(--_arrow)" stroke-width="1.5" />
  </marker>
  <marker id="cls-composition" markerWidth="12" markerHeight="10" refX="0" refY="5" orient="auto-start-reverse">
    <polygon points="6 0, 12 5, 6 10, 0 5" fill="var(--_arrow)" stroke="var(--_arrow)" stroke-width="1" />
  </marker>
  <marker id="cls-aggregation" markerWidth="12" markerHeight="10" refX="0" refY="5" orient="auto-start-reverse">
    <polygon points="6 0, 12 5, 6 10, 0 5" fill="var(--bg)" stroke="var(--_arrow)" stroke-width="1.5" />
  </marker>
  <marker id="cls-arrow" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto-start-reverse">
    <polyline points="0 0, 8 3, 0 6" fill="none" stroke="var(--_arrow)" stroke-width="1.5" />
  </marker>`}function ji(t){let{x:e,y:n,width:r,height:o,headerHeight:i,attrHeight:c,methodHeight:s}=t,l=[];l.push(`<rect x="${e}" y="${n}" width="${r}" height="${o}" rx="0" ry="0" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="${at.outerBox}" />`),l.push(`<rect x="${e}" y="${n}" width="${r}" height="${i}" rx="0" ry="0" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="${at.outerBox}" />`);let f=n+i/2;if(t.annotation){let d=n+12;l.push(`<text x="${e+r/2}" y="${d}" text-anchor="middle" dy="${ut}" font-size="${Se.annotationSize}" font-weight="${Se.annotationWeight}" font-style="italic" fill="var(--_text-muted)">&lt;&lt;${Rt(t.annotation)}&gt;&gt;</text>`),f=n+i/2+6;}l.push(`<text x="${e+r/2}" y="${f}" text-anchor="middle" dy="${ut}" font-size="${J.nodeLabel}" font-weight="700" fill="var(--_text)">${Rt(t.label)}</text>`);let u=n+i;l.push(`<line x1="${e}" y1="${u}" x2="${e+r}" y2="${u}" stroke="var(--_node-stroke)" stroke-width="${at.innerBox}" />`);let h=20;for(let d=0;d<t.attributes.length;d++){let m=t.attributes[d],x=u+4+d*h+h/2;l.push(kr(m,e+lt.boxPadX,x));}let a=u+c;l.push(`<line x1="${e}" y1="${a}" x2="${e+r}" y2="${a}" stroke="var(--_node-stroke)" stroke-width="${at.innerBox}" />`);for(let d=0;d<t.methods.length;d++){let m=t.methods[d],x=a+4+d*h+h/2;l.push(kr(m,e+lt.boxPadX,x));}return l.join(`
`)}function kr(t,e,n){let r=t.isAbstract?' font-style="italic"':"",o=t.isStatic?' text-decoration="underline"':"",i=[];return t.visibility&&i.push(`<tspan fill="var(--_text-faint)">${Rt(t.visibility)} </tspan>`),i.push(`<tspan fill="var(--_text-sec)">${Rt(t.name)}</tspan>`),t.type&&(i.push('<tspan fill="var(--_text-faint)">: </tspan>'),i.push(`<tspan fill="var(--_text-muted)">${Rt(t.type)}</tspan>`)),`<text x="${e}" y="${n}" class="mono" dy="${ut}" font-size="${Se.memberSize}" font-weight="${Se.memberWeight}"${r}${o}>${i.join("")}</text>`}function Ui(t){if(t.points.length<2)return "";let e=t.points.map(i=>`${i.x},${i.y}`).join(" "),r=t.type==="dependency"||t.type==="realization"?' stroke-dasharray="6 4"':"",o=zi(t.type,t.markerAt);return `<polyline points="${e}" fill="none" stroke="var(--_line)" stroke-width="${at.connector}"${r}${o} />`}function zi(t,e){let n=Vi(t);return n?e==="from"?` marker-start="url(#${n})"`:` marker-end="url(#${n})"`:""}function Vi(t){switch(t){case "inheritance":case "realization":return "cls-inherit";case "composition":return "cls-composition";case "aggregation":return "cls-aggregation";case "association":case "dependency":return "cls-arrow";default:return null}}function qi(t){if(!t.label&&!t.fromCardinality&&!t.toCardinality||t.points.length<2)return "";let e=[];if(t.label){let n=t.labelPosition??Ki(t.points);e.push(`<text x="${n.x}" y="${n.y-8}" text-anchor="middle" font-size="${J.edgeLabel}" font-weight="${et.edgeLabel}" fill="var(--_text-muted)">${Rt(t.label)}</text>`);}if(t.fromCardinality){let n=t.points[0],r=t.points[1],o=Mr(n,r);e.push(`<text x="${n.x+o.x}" y="${n.y+o.y}" text-anchor="middle" font-size="${J.edgeLabel}" font-weight="${et.edgeLabel}" fill="var(--_text-muted)">${Rt(t.fromCardinality)}</text>`);}if(t.toCardinality){let n=t.points[t.points.length-1],r=t.points[t.points.length-2],o=Mr(n,r);e.push(`<text x="${n.x+o.x}" y="${n.y+o.y}" text-anchor="middle" font-size="${J.edgeLabel}" font-weight="${et.edgeLabel}" fill="var(--_text-muted)">${Rt(t.toCardinality)}</text>`);}return e.join(`
`)}function Ki(t){if(t.length===0)return {x:0,y:0};let e=Math.floor(t.length/2);return t[e]}function Mr(t,e){let n=e.x-t.x,r=e.y-t.y;return Math.abs(n)>Math.abs(r)?{x:n>0?14:-14,y:-10}:{x:-14,y:r>0?14:-14}}function Rt(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}var Je=Me(ye());var vt={padding:40,boxPadX:12,headerHeight:32,rowHeight:22,minWidth:140,attrFontSize:11,nodeSpacing:50,layerSpacing:70};async function Er(t,e={}){if(t.entities.length===0)return {width:0,height:0,entities:[],relationships:[]};let n=new Map;for(let s of t.entities){let l=ct(s.label,J.nodeLabel,et.nodeLabel),f=0;for(let a of s.attributes){let d=`${a.type}  ${a.name}${a.keys.length>0?"  "+a.keys.join(","):""}`,m=we(d,vt.attrFontSize);m>f&&(f=m);}let u=Math.max(vt.minWidth,l+vt.boxPadX*2,f+vt.boxPadX*2),h=vt.headerHeight+Math.max(s.attributes.length,1)*vt.rowHeight;n.set(s.id,{width:u,height:h});}let r=new Je.default.graphlib.Graph({directed:true});r.setGraph({rankdir:"LR",acyclicer:"greedy",nodesep:vt.nodeSpacing,ranksep:vt.layerSpacing,marginx:vt.padding,marginy:vt.padding}),r.setDefaultEdgeLabel(()=>({}));for(let s of t.entities){let l=n.get(s.id);r.setNode(s.id,{width:l.width,height:l.height});}for(let s=0;s<t.relationships.length;s++){let l=t.relationships[s];r.setEdge(l.entity1,l.entity2,{_index:s,label:l.label,width:ct(l.label,J.edgeLabel,et.edgeLabel)+8,height:J.edgeLabel+6,labelpos:"c"});}try{Je.default.layout(r);}catch(s){let l=s instanceof Error?s.message:String(s);throw new Error(`Dagre layout failed (ER diagram): ${l}`)}let o=new Map;for(let s of t.entities)o.set(s.id,s);let i=t.entities.map(s=>{let l=r.node(s.id),f=Lt(l.x,l.y,l.width,l.height);return {id:s.id,label:s.label,attributes:s.attributes,x:f.x,y:f.y,width:l.width??n.get(s.id).width,height:l.height??n.get(s.id).height,headerHeight:vt.headerHeight,rowHeight:vt.rowHeight}}),c=r.edges().map(s=>{let l=r.edge(s),f=t.relationships[l._index],u=l.points??[],h=Dt(u,false),a=r.node(s.v),d=r.node(s.w),m=Xt(h,a?{cx:a.x,cy:a.y,hw:a.width/2,hh:a.height/2}:null,d?{cx:d.x,cy:d.y,hw:d.width/2,hh:d.height/2}:null);return {entity1:f.entity1,entity2:f.entity2,cardinality1:f.cardinality1,cardinality2:f.cardinality2,label:f.label,identifying:f.identifying,points:m}});return {width:r.graph().width??600,height:r.graph().height??400,entities:i,relationships:c}}var It={attrSize:11,attrWeight:400,keySize:9,keyWeight:600};function _r(t,e,n="Inter",r=false){let o=[];o.push(Pt(t.width,t.height,e,r)),o.push(Tt(n,true)),o.push("<defs>"),o.push("</defs>");for(let i of t.relationships)o.push(Qi(i));for(let i of t.entities)o.push(Ji(i));for(let i of t.relationships)o.push(es(i));for(let i of t.relationships)o.push(ts(i));return o.push("</svg>"),o.join(`
`)}function Ji(t){let{x:e,y:n,width:r,height:o,headerHeight:i,rowHeight:c,label:s,attributes:l}=t,f=[];f.push(`<rect x="${e}" y="${n}" width="${r}" height="${o}" rx="0" ry="0" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="${at.outerBox}" />`),f.push(`<rect x="${e}" y="${n}" width="${r}" height="${i}" rx="0" ry="0" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="${at.outerBox}" />`),f.push(`<text x="${e+r/2}" y="${n+i/2}" text-anchor="middle" dy="${ut}" font-size="${J.nodeLabel}" font-weight="700" fill="var(--_text)">${ke(s)}</text>`);let u=n+i;f.push(`<line x1="${e}" y1="${u}" x2="${e+r}" y2="${u}" stroke="var(--_node-stroke)" stroke-width="${at.innerBox}" />`);for(let h=0;h<l.length;h++){let a=l[h],d=u+h*c+c/2;f.push(Zi(a,e,d,r));}return l.length===0&&f.push(`<text x="${e+r/2}" y="${u+c/2}" text-anchor="middle" dy="${ut}" font-size="${It.attrSize}" fill="var(--_text-faint)" font-style="italic">(no attributes)</text>`),f.join(`
`)}function Zi(t,e,n,r){let o=[],i=0;if(t.keys.length>0){let l=t.keys.join(",");i=ct(l,It.keySize,It.keyWeight)+8,o.push(`<rect x="${e+6}" y="${n-7}" width="${i}" height="14" rx="2" ry="2" fill="var(--_key-badge)" />`),o.push(`<text x="${e+6+i/2}" y="${n}" text-anchor="middle" dy="${ut}" font-size="${It.keySize}" font-weight="${It.keyWeight}" fill="var(--_text-sec)">${t.keys.join(",")}</text>`);}let c=e+8+(i>0?i+6:0);o.push(`<text x="${c}" y="${n}" class="mono" dy="${ut}" font-size="${It.attrSize}" font-weight="${It.attrWeight}"><tspan fill="var(--_text-muted)">${ke(t.type)}</tspan></text>`);let s=e+r-8;return o.push(`<text x="${s}" y="${n}" class="mono" text-anchor="end" dy="${ut}" font-size="${It.attrSize}" font-weight="${It.attrWeight}"><tspan fill="var(--_text-sec)">${ke(t.name)}</tspan></text>`),o.join(`
`)}function Qi(t){if(t.points.length<2)return "";let e=t.points.map(r=>`${r.x},${r.y}`).join(" "),n=t.identifying?"":' stroke-dasharray="6 4"';return `<polyline points="${e}" fill="none" stroke="var(--_line)" stroke-width="${at.connector}"${n} />`}function ts(t){if(!t.label||t.points.length<2)return "";let e=ns(t.points),r=ct(t.label,J.edgeLabel,et.edgeLabel)+8,o=J.edgeLabel+6;return `<rect x="${e.x-r/2}" y="${e.y-o/2}" width="${r}" height="${o}" rx="2" ry="2" fill="var(--bg)" stroke="var(--_inner-stroke)" stroke-width="0.5" />
<text x="${e.x}" y="${e.y}" text-anchor="middle" dy="${ut}" font-size="${J.edgeLabel}" font-weight="${et.edgeLabel}" fill="var(--_text-muted)">${ke(t.label)}</text>`}function es(t){if(t.points.length<2)return "";let e=[],n=t.points[0],r=t.points[1];e.push(Ar(n,r,t.cardinality1));let o=t.points[t.points.length-1],i=t.points[t.points.length-2];return e.push(Ar(o,i,t.cardinality2)),e.join(`
`)}function Ar(t,e,n){let r=[],o=at.connector+.25,i=t.x-e.x,c=t.y-e.y,s=Math.sqrt(i*i+c*c);if(s===0)return "";let l=i/s,f=c/s,u=-f,h=l,a=t.x-l*4,d=t.y-f*4,m=t.x-l*16,x=t.y-f*16,g=n==="one"||n==="zero-one",p=n==="many"||n==="zero-many",b=n==="zero-one"||n==="zero-many";if(g){r.push(`<line x1="${a+u*6}" y1="${d+h*6}" x2="${a-u*6}" y2="${d-h*6}" stroke="var(--_line)" stroke-width="${o}" />`);let T=a-l*4,N=d-f*4;r.push(`<line x1="${T+u*6}" y1="${N+h*6}" x2="${T-u*6}" y2="${N-h*6}" stroke="var(--_line)" stroke-width="${o}" />`);}if(p){let T=a,N=d;r.push(`<line x1="${T+u*7}" y1="${N+h*7}" x2="${m}" y2="${x}" stroke="var(--_line)" stroke-width="${o}" />`),r.push(`<line x1="${T}" y1="${N}" x2="${m}" y2="${x}" stroke="var(--_line)" stroke-width="${o}" />`),r.push(`<line x1="${T-u*7}" y1="${N-h*7}" x2="${m}" y2="${x}" stroke="var(--_line)" stroke-width="${o}" />`);}if(b){let C=p?20:12,T=t.x-l*C,N=t.y-f*C;r.push(`<circle cx="${T}" cy="${N}" r="4" fill="var(--bg)" stroke="var(--_line)" stroke-width="${o}" />`);}return r.join(`
`)}function ns(t){if(t.length===0)return {x:0,y:0};if(t.length===1)return t[0];let e=0;for(let o=1;o<t.length;o++){let i=t[o].x-t[o-1].x,c=t[o].y-t[o-1].y;e+=Math.sqrt(i*i+c*c);}if(e===0)return t[0];let n=e/2,r=0;for(let o=1;o<t.length;o++){let i=t[o].x-t[o-1].x,c=t[o].y-t[o-1].y,s=Math.sqrt(i*i+c*c);if(r+s>=n){let l=s>0?(n-r)/s:0;return {x:t[o-1].x+i*l,y:t[o-1].y+c*l}}r+=s;}return t[t.length-1]}function ke(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function rs(t){let e=t.trim().split(/[\n;]/)[0]?.trim().toLowerCase()??"";return /^sequencediagram\s*$/.test(e)?"sequence":/^classdiagram\s*$/.test(e)?"class":/^erdiagram\s*$/.test(e)?"er":"flowchart"}function os(t){return {bg:t.bg??Wt.bg,fg:t.fg??Wt.fg,line:t.line,accent:t.accent,muted:t.muted,surface:t.surface,border:t.border}}async function Lr(t,e={}){let n=os(e),r=e.font??"Inter",o=e.transparent??false,i=rs(t),c=t.split(/[\n;]/).map(s=>s.trim()).filter(s=>s.length>0&&!s.startsWith("%%"));switch(i){case "sequence":{let s=me(c),l=wr(s,e);return Cr(l,n,r,o)}case "class":{let s=pe(c),l=await Sr(s,e);return $r(l,n,r,o)}case "er":{let s=ge(c),l=await Er(s,e);return _r(l,n,r,o)}default:{let s=ie(t),l=await ar(s,e);return br(l,n,r,o)}}}typeof window<"u"&&(window.__mermaid={renderMermaid:Lr,renderMermaidAscii:be,renderMermaidAsciiWithMeta:We,THEMES:$e,DEFAULTS:Wt,fromShikiTheme:Ee});exports.DEFAULTS=Wt;exports.THEMES=$e;exports.fromShikiTheme=Ee;exports.renderMermaid=Lr;exports.renderMermaidAscii=be;exports.renderMermaidAsciiWithMeta=We;return exports;})({});//# sourceMappingURL=beautiful-mermaid.browser.global.js.map
//# sourceMappingURL=beautiful-mermaid.browser.global.js.map