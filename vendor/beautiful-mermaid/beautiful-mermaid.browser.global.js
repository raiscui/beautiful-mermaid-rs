var beautifulMermaid=(function(exports){'use strict';var _r=Object.create;var en=Object.defineProperty;var Lr=Object.getOwnPropertyDescriptor;var Tr=Object.getOwnPropertyNames;var Ir=Object.getPrototypeOf,Dr=Object.prototype.hasOwnProperty;var Je=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var Pr=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Rr=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Tr(t))!Dr.call(e,o)&&o!==r&&en(e,o,{get:()=>t[o],enumerable:!(n=Lr(t,o))||n.enumerable});return e};var vt=(e,t,r)=>(r=e!=null?_r(Ir(e)):{},Rr(en(r,"default",{value:e,enumerable:true}),e));var mt=Pr((qn,Ht)=>{(function(e){if(typeof qn=="object"&&typeof Ht<"u")Ht.exports=e();else if(typeof define=="function"&&define.amd)define([],e);else {var t;typeof window<"u"?t=window:typeof global<"u"?t=global:typeof self<"u"?t=self:t=this,t.dagre=e();}})(function(){return (function(){function n(o,i,c){function s(u,h){if(!i[u]){if(!o[u]){var a=typeof Je=="function"&&Je;if(!h&&a)return a(u,true);if(l)return l(u,true);var d=new Error("Cannot find module '"+u+"'");throw d.code="MODULE_NOT_FOUND",d}var p=i[u]={exports:{}};o[u][0].call(p.exports,function(x){var g=o[u][1][x];return s(g||x)},p,p.exports,n,o,i,c);}return i[u].exports}for(var l=typeof Je=="function"&&Je,f=0;f<c.length;f++)s(c[f]);return s}return n})()({1:[function(n,o,i){o.exports={graphlib:n("@dagrejs/graphlib"),layout:n("./lib/layout"),debug:n("./lib/debug"),util:{time:n("./lib/util").time,notime:n("./lib/util").notime},version:n("./lib/version")};},{"./lib/debug":6,"./lib/layout":8,"./lib/util":27,"./lib/version":28,"@dagrejs/graphlib":29}],2:[function(n,o,i){let c=n("./greedy-fas"),s=n("./util").uniqueId;o.exports={run:l,undo:u};function l(h){(h.graph().acyclicer==="greedy"?c(h,d(h)):f(h)).forEach(p=>{let x=h.edge(p);h.removeEdge(p),x.forwardName=p.name,x.reversed=true,h.setEdge(p.w,p.v,x,s("rev"));});function d(p){return x=>p.edge(x).weight}}function f(h){let a=[],d={},p={};function x(g){Object.hasOwn(p,g)||(p[g]=true,d[g]=true,h.outEdges(g).forEach(m=>{Object.hasOwn(d,m.w)?a.push(m):x(m.w);}),delete d[g]);}return h.nodes().forEach(x),a}function u(h){h.edges().forEach(a=>{let d=h.edge(a);if(d.reversed){h.removeEdge(a);let p=d.forwardName;delete d.reversed,delete d.forwardName,h.setEdge(a.w,a.v,d,p);}});}},{"./greedy-fas":7,"./util":27}],3:[function(n,o,i){let c=n("./util");o.exports=s;function s(f){function u(h){let a=f.children(h),d=f.node(h);if(a.length&&a.forEach(u),Object.hasOwn(d,"minRank")){d.borderLeft=[],d.borderRight=[];for(let p=d.minRank,x=d.maxRank+1;p<x;++p)l(f,"borderLeft","_bl",h,d,p),l(f,"borderRight","_br",h,d,p);}}f.children().forEach(u);}function l(f,u,h,a,d,p){let x={width:0,height:0,rank:p,borderType:u},g=d[u][p-1],m=c.addDummyNode(f,"border",x,h);d[u][p]=m,f.setParent(m,a),g&&f.setEdge(g,m,{weight:1});}},{"./util":27}],4:[function(n,o,i){o.exports={adjust:c,undo:s};function c(p){let x=p.graph().rankdir.toLowerCase();(x==="lr"||x==="rl")&&l(p);}function s(p){let x=p.graph().rankdir.toLowerCase();(x==="bt"||x==="rl")&&u(p),(x==="lr"||x==="rl")&&(a(p),l(p));}function l(p){p.nodes().forEach(x=>f(p.node(x))),p.edges().forEach(x=>f(p.edge(x)));}function f(p){let x=p.width;p.width=p.height,p.height=x;}function u(p){p.nodes().forEach(x=>h(p.node(x))),p.edges().forEach(x=>{let g=p.edge(x);g.points.forEach(h),Object.hasOwn(g,"y")&&h(g);});}function h(p){p.y=-p.y;}function a(p){p.nodes().forEach(x=>d(p.node(x))),p.edges().forEach(x=>{let g=p.edge(x);g.points.forEach(d),Object.hasOwn(g,"x")&&d(g);});}function d(p){let x=p.x;p.x=p.y,p.y=x;}},{}],5:[function(n,o,i){class c{constructor(){let u={};u._next=u._prev=u,this._sentinel=u;}dequeue(){let u=this._sentinel,h=u._prev;if(h!==u)return s(h),h}enqueue(u){let h=this._sentinel;u._prev&&u._next&&s(u),u._next=h._next,h._next._prev=u,h._next=u,u._prev=h;}toString(){let u=[],h=this._sentinel,a=h._prev;for(;a!==h;)u.push(JSON.stringify(a,l)),a=a._prev;return "["+u.join(", ")+"]"}}function s(f){f._prev._next=f._next,f._next._prev=f._prev,delete f._next,delete f._prev;}function l(f,u){if(f!=="_next"&&f!=="_prev")return u}o.exports=c;},{}],6:[function(n,o,i){let c=n("./util"),s=n("@dagrejs/graphlib").Graph;o.exports={debugOrdering:l};function l(f){let u=c.buildLayerMatrix(f),h=new s({compound:true,multigraph:true}).setGraph({});return f.nodes().forEach(a=>{h.setNode(a,{label:a}),h.setParent(a,"layer"+f.node(a).rank);}),f.edges().forEach(a=>h.setEdge(a.v,a.w,{},a.name)),u.forEach((a,d)=>{let p="layer"+d;h.setNode(p,{rank:"same"}),a.reduce((x,g)=>(h.setEdge(x,g,{style:"invis"}),g));}),h}},{"./util":27,"@dagrejs/graphlib":29}],7:[function(n,o,i){let c=n("@dagrejs/graphlib").Graph,s=n("./data/list");o.exports=f;let l=()=>1;function f(x,g){if(x.nodeCount()<=1)return [];let m=a(x,g||l);return u(m.graph,m.buckets,m.zeroIdx).flatMap(b=>x.outEdges(b.v,b.w))}function u(x,g,m){let y=[],b=g[g.length-1],_=g[0],P;for(;x.nodeCount();){for(;P=_.dequeue();)h(x,g,m,P);for(;P=b.dequeue();)h(x,g,m,P);if(x.nodeCount()){for(let w=g.length-2;w>0;--w)if(P=g[w].dequeue(),P){y=y.concat(h(x,g,m,P,true));break}}}return y}function h(x,g,m,y,b){let _=b?[]:void 0;return x.inEdges(y.v).forEach(P=>{let w=x.edge(P),E=x.node(P.v);b&&_.push({v:P.v,w:P.w}),E.out-=w,d(g,m,E);}),x.outEdges(y.v).forEach(P=>{let w=x.edge(P),E=P.w,k=x.node(E);k.in-=w,d(g,m,k);}),x.removeNode(y.v),_}function a(x,g){let m=new c,y=0,b=0;x.nodes().forEach(w=>{m.setNode(w,{v:w,in:0,out:0});}),x.edges().forEach(w=>{let E=m.edge(w.v,w.w)||0,k=g(w),T=E+k;m.setEdge(w.v,w.w,T),b=Math.max(b,m.node(w.v).out+=k),y=Math.max(y,m.node(w.w).in+=k);});let _=p(b+y+3).map(()=>new s),P=y+1;return m.nodes().forEach(w=>{d(_,P,m.node(w));}),{graph:m,buckets:_,zeroIdx:P}}function d(x,g,m){m.out?m.in?x[m.out-m.in+g].enqueue(m):x[x.length-1].enqueue(m):x[0].enqueue(m);}function p(x){let g=[];for(let m=0;m<x;m++)g.push(m);return g}},{"./data/list":5,"@dagrejs/graphlib":29}],8:[function(n,o,i){let c=n("./acyclic"),s=n("./normalize"),l=n("./rank"),f=n("./util").normalizeRanks,u=n("./parent-dummy-chains"),h=n("./util").removeEmptyRanks,a=n("./nesting-graph"),d=n("./add-border-segments"),p=n("./coordinate-system"),x=n("./order"),g=n("./position"),m=n("./util"),y=n("@dagrejs/graphlib").Graph;o.exports=b;function b($,D){let G=D&&D.debugTiming?m.time:m.notime;G("layout",()=>{let Y=G("  buildLayoutGraph",()=>M($));G("  runLayout",()=>_(Y,G,D)),G("  updateInputGraph",()=>P($,Y));});}function _($,D,G){D("    makeSpaceForEdgeLabels",()=>C($)),D("    removeSelfEdges",()=>W($)),D("    acyclic",()=>c.run($)),D("    nestingGraph.run",()=>a.run($)),D("    rank",()=>l(m.asNonCompoundGraph($))),D("    injectEdgeLabelProxies",()=>S($)),D("    removeEmptyRanks",()=>h($)),D("    nestingGraph.cleanup",()=>a.cleanup($)),D("    normalizeRanks",()=>f($)),D("    assignRankMinMax",()=>L($)),D("    removeEdgeLabelProxies",()=>v($)),D("    normalize.run",()=>s.run($)),D("    parentDummyChains",()=>u($)),D("    addBorderSegments",()=>d($)),D("    order",()=>x($,G)),D("    insertSelfEdges",()=>H($)),D("    adjustCoordinateSystem",()=>p.adjust($)),D("    position",()=>g($)),D("    positionSelfEdges",()=>V($)),D("    removeBorderNodes",()=>X($)),D("    normalize.undo",()=>s.undo($)),D("    fixupEdgeLabelCoords",()=>A($)),D("    undoCoordinateSystem",()=>p.undo($)),D("    translateGraph",()=>B($)),D("    assignNodeIntersects",()=>F($)),D("    reversePoints",()=>I($)),D("    acyclic.undo",()=>c.undo($));}function P($,D){$.nodes().forEach(G=>{let Y=$.node(G),K=D.node(G);Y&&(Y.x=K.x,Y.y=K.y,Y.rank=K.rank,D.children(G).length&&(Y.width=K.width,Y.height=K.height));}),$.edges().forEach(G=>{let Y=$.edge(G),K=D.edge(G);Y.points=K.points,Object.hasOwn(K,"x")&&(Y.x=K.x,Y.y=K.y);}),$.graph().width=D.graph().width,$.graph().height=D.graph().height;}let w=["nodesep","edgesep","ranksep","marginx","marginy"],E={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},k=["acyclicer","ranker","rankdir","align"],T=["width","height","rank"],R={width:0,height:0},N=["minlen","weight","width","height","labeloffset"],O={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},j=["labelpos"];function M($){let D=new y({multigraph:true,compound:true}),G=q($.graph());return D.setGraph(Object.assign({},E,z(G,w),m.pick(G,k))),$.nodes().forEach(Y=>{let K=q($.node(Y)),Z=z(K,T);Object.keys(R).forEach(re=>{Z[re]===void 0&&(Z[re]=R[re]);}),D.setNode(Y,Z),D.setParent(Y,$.parent(Y));}),$.edges().forEach(Y=>{let K=q($.edge(Y));D.setEdge(Y,Object.assign({},O,z(K,N),m.pick(K,j)));}),D}function C($){let D=$.graph();D.ranksep/=2,$.edges().forEach(G=>{let Y=$.edge(G);Y.minlen*=2,Y.labelpos.toLowerCase()!=="c"&&(D.rankdir==="TB"||D.rankdir==="BT"?Y.width+=Y.labeloffset:Y.height+=Y.labeloffset);});}function S($){$.edges().forEach(D=>{let G=$.edge(D);if(G.width&&G.height){let Y=$.node(D.v),Z={rank:($.node(D.w).rank-Y.rank)/2+Y.rank,e:D};m.addDummyNode($,"edge-proxy",Z,"_ep");}});}function L($){let D=0;$.nodes().forEach(G=>{let Y=$.node(G);Y.borderTop&&(Y.minRank=$.node(Y.borderTop).rank,Y.maxRank=$.node(Y.borderBottom).rank,D=Math.max(D,Y.maxRank));}),$.graph().maxRank=D;}function v($){$.nodes().forEach(D=>{let G=$.node(D);G.dummy==="edge-proxy"&&($.edge(G.e).labelRank=G.rank,$.removeNode(D));});}function B($){let D=Number.POSITIVE_INFINITY,G=0,Y=Number.POSITIVE_INFINITY,K=0,Z=$.graph(),re=Z.marginx||0,he=Z.marginy||0;function Se(xe){let pe=xe.x,Ke=xe.y,Zt=xe.width,Qt=xe.height;D=Math.min(D,pe-Zt/2),G=Math.max(G,pe+Zt/2),Y=Math.min(Y,Ke-Qt/2),K=Math.max(K,Ke+Qt/2);}$.nodes().forEach(xe=>Se($.node(xe))),$.edges().forEach(xe=>{let pe=$.edge(xe);Object.hasOwn(pe,"x")&&Se(pe);}),D-=re,Y-=he,$.nodes().forEach(xe=>{let pe=$.node(xe);pe.x-=D,pe.y-=Y;}),$.edges().forEach(xe=>{let pe=$.edge(xe);pe.points.forEach(Ke=>{Ke.x-=D,Ke.y-=Y;}),Object.hasOwn(pe,"x")&&(pe.x-=D),Object.hasOwn(pe,"y")&&(pe.y-=Y);}),Z.width=G-D+re,Z.height=K-Y+he;}function F($){$.edges().forEach(D=>{let G=$.edge(D),Y=$.node(D.v),K=$.node(D.w),Z,re;G.points?(Z=G.points[0],re=G.points[G.points.length-1]):(G.points=[],Z=K,re=Y),G.points.unshift(m.intersectRect(Y,Z)),G.points.push(m.intersectRect(K,re));});}function A($){$.edges().forEach(D=>{let G=$.edge(D);if(Object.hasOwn(G,"x"))switch((G.labelpos==="l"||G.labelpos==="r")&&(G.width-=G.labeloffset),G.labelpos){case "l":G.x-=G.width/2+G.labeloffset;break;case "r":G.x+=G.width/2+G.labeloffset;break}});}function I($){$.edges().forEach(D=>{let G=$.edge(D);G.reversed&&G.points.reverse();});}function X($){$.nodes().forEach(D=>{if($.children(D).length){let G=$.node(D),Y=$.node(G.borderTop),K=$.node(G.borderBottom),Z=$.node(G.borderLeft[G.borderLeft.length-1]),re=$.node(G.borderRight[G.borderRight.length-1]);G.width=Math.abs(re.x-Z.x),G.height=Math.abs(K.y-Y.y),G.x=Z.x+G.width/2,G.y=Y.y+G.height/2;}}),$.nodes().forEach(D=>{$.node(D).dummy==="border"&&$.removeNode(D);});}function W($){$.edges().forEach(D=>{if(D.v===D.w){var G=$.node(D.v);G.selfEdges||(G.selfEdges=[]),G.selfEdges.push({e:D,label:$.edge(D)}),$.removeEdge(D);}});}function H($){var D=m.buildLayerMatrix($);D.forEach(G=>{var Y=0;G.forEach((K,Z)=>{var re=$.node(K);re.order=Z+Y,(re.selfEdges||[]).forEach(he=>{m.addDummyNode($,"selfedge",{width:he.label.width,height:he.label.height,rank:re.rank,order:Z+ ++Y,e:he.e,label:he.label},"_se");}),delete re.selfEdges;});});}function V($){$.nodes().forEach(D=>{var G=$.node(D);if(G.dummy==="selfedge"){var Y=$.node(G.e.v),K=Y.x+Y.width/2,Z=Y.y,re=G.x-K,he=Y.height/2;$.setEdge(G.e,G.label),$.removeNode(D),G.label.points=[{x:K+2*re/3,y:Z-he},{x:K+5*re/6,y:Z-he},{x:K+re,y:Z},{x:K+5*re/6,y:Z+he},{x:K+2*re/3,y:Z+he}],G.label.x=G.x,G.label.y=G.y;}});}function z($,D){return m.mapValues(m.pick($,D),Number)}function q($){var D={};return $&&Object.entries($).forEach(([G,Y])=>{typeof G=="string"&&(G=G.toLowerCase()),D[G]=Y;}),D}},{"./acyclic":2,"./add-border-segments":3,"./coordinate-system":4,"./nesting-graph":9,"./normalize":10,"./order":15,"./parent-dummy-chains":20,"./position":22,"./rank":24,"./util":27,"@dagrejs/graphlib":29}],9:[function(n,o,i){let c=n("./util");o.exports={run:s,cleanup:h};function s(a){let d=c.addDummyNode(a,"root",{},"_root"),p=f(a),x=Object.values(p),g=c.applyWithChunking(Math.max,x)-1,m=2*g+1;a.graph().nestingRoot=d,a.edges().forEach(b=>a.edge(b).minlen*=m);let y=u(a)+1;a.children().forEach(b=>l(a,d,m,y,g,p,b)),a.graph().nodeRankFactor=m;}function l(a,d,p,x,g,m,y){let b=a.children(y);if(!b.length){y!==d&&a.setEdge(d,y,{weight:0,minlen:p});return}let _=c.addBorderNode(a,"_bt"),P=c.addBorderNode(a,"_bb"),w=a.node(y);a.setParent(_,y),w.borderTop=_,a.setParent(P,y),w.borderBottom=P,b.forEach(E=>{l(a,d,p,x,g,m,E);let k=a.node(E),T=k.borderTop?k.borderTop:E,R=k.borderBottom?k.borderBottom:E,N=k.borderTop?x:2*x,O=T!==R?1:g-m[y]+1;a.setEdge(_,T,{weight:N,minlen:O,nestingEdge:true}),a.setEdge(R,P,{weight:N,minlen:O,nestingEdge:true});}),a.parent(y)||a.setEdge(d,_,{weight:0,minlen:g+m[y]});}function f(a){var d={};function p(x,g){var m=a.children(x);m&&m.length&&m.forEach(y=>p(y,g+1)),d[x]=g;}return a.children().forEach(x=>p(x,1)),d}function u(a){return a.edges().reduce((d,p)=>d+a.edge(p).weight,0)}function h(a){var d=a.graph();a.removeNode(d.nestingRoot),delete d.nestingRoot,a.edges().forEach(p=>{var x=a.edge(p);x.nestingEdge&&a.removeEdge(p);});}},{"./util":27}],10:[function(n,o,i){let c=n("./util");o.exports={run:s,undo:f};function s(u){u.graph().dummyChains=[],u.edges().forEach(h=>l(u,h));}function l(u,h){let a=h.v,d=u.node(a).rank,p=h.w,x=u.node(p).rank,g=h.name,m=u.edge(h),y=m.labelRank;if(x===d+1)return;u.removeEdge(h);let b,_,P;for(P=0,++d;d<x;++P,++d)m.points=[],_={width:0,height:0,edgeLabel:m,edgeObj:h,rank:d},b=c.addDummyNode(u,"edge",_,"_d"),d===y&&(_.width=m.width,_.height=m.height,_.dummy="edge-label",_.labelpos=m.labelpos),u.setEdge(a,b,{weight:m.weight},g),P===0&&u.graph().dummyChains.push(b),a=b;u.setEdge(a,p,{weight:m.weight},g);}function f(u){u.graph().dummyChains.forEach(h=>{let a=u.node(h),d=a.edgeLabel,p;for(u.setEdge(a.edgeObj,d);a.dummy;)p=u.successors(h)[0],u.removeNode(h),d.points.push({x:a.x,y:a.y}),a.dummy==="edge-label"&&(d.x=a.x,d.y=a.y,d.width=a.width,d.height=a.height),h=p,a=u.node(h);});}},{"./util":27}],11:[function(n,o,i){o.exports=c;function c(s,l,f){let u={},h;f.forEach(a=>{let d=s.parent(a),p,x;for(;d;){if(p=s.parent(d),p?(x=u[p],u[p]=d):(x=h,h=d),x&&x!==d){l.setEdge(x,d);return}d=p;}});}},{}],12:[function(n,o,i){o.exports=c;function c(s,l=[]){return l.map(f=>{let u=s.inEdges(f);if(u.length){let h=u.reduce((a,d)=>{let p=s.edge(d),x=s.node(d.v);return {sum:a.sum+p.weight*x.order,weight:a.weight+p.weight}},{sum:0,weight:0});return {v:f,barycenter:h.sum/h.weight,weight:h.weight}}else return {v:f}})}},{}],13:[function(n,o,i){let c=n("@dagrejs/graphlib").Graph,s=n("../util");o.exports=l;function l(u,h,a,d){d||(d=u.nodes());let p=f(u),x=new c({compound:true}).setGraph({root:p}).setDefaultNodeLabel(g=>u.node(g));return d.forEach(g=>{let m=u.node(g),y=u.parent(g);(m.rank===h||m.minRank<=h&&h<=m.maxRank)&&(x.setNode(g),x.setParent(g,y||p),u[a](g).forEach(b=>{let _=b.v===g?b.w:b.v,P=x.edge(_,g),w=P!==void 0?P.weight:0;x.setEdge(_,g,{weight:u.edge(b).weight+w});}),Object.hasOwn(m,"minRank")&&x.setNode(g,{borderLeft:m.borderLeft[h],borderRight:m.borderRight[h]}));}),x}function f(u){for(var h;u.hasNode(h=s.uniqueId("_root")););return h}},{"../util":27,"@dagrejs/graphlib":29}],14:[function(n,o,i){let c=n("../util").zipObject;o.exports=s;function s(f,u){let h=0;for(let a=1;a<u.length;++a)h+=l(f,u[a-1],u[a]);return h}function l(f,u,h){let a=c(h,h.map((y,b)=>b)),d=u.flatMap(y=>f.outEdges(y).map(b=>({pos:a[b.w],weight:f.edge(b).weight})).sort((b,_)=>b.pos-_.pos)),p=1;for(;p<h.length;)p<<=1;let x=2*p-1;p-=1;let g=new Array(x).fill(0),m=0;return d.forEach(y=>{let b=y.pos+p;g[b]+=y.weight;let _=0;for(;b>0;)b%2&&(_+=g[b+1]),b=b-1>>1,g[b]+=y.weight;m+=y.weight*_;}),m}},{"../util":27}],15:[function(n,o,i){let c=n("./init-order"),s=n("./cross-count"),l=n("./sort-subgraph"),f=n("./build-layer-graph"),u=n("./add-subgraph-constraints"),h=n("@dagrejs/graphlib").Graph,a=n("../util");o.exports=d;function d(m,y){if(y&&typeof y.customOrder=="function"){y.customOrder(m,d);return}let b=a.maxRank(m),_=p(m,a.range(1,b+1),"inEdges"),P=p(m,a.range(b-1,-1,-1),"outEdges"),w=c(m);if(g(m,w),y&&y.disableOptimalOrderHeuristic)return;let E=Number.POSITIVE_INFINITY,k;for(let T=0,R=0;R<4;++T,++R){x(T%2?_:P,T%4>=2),w=a.buildLayerMatrix(m);let N=s(m,w);N<E&&(R=0,k=Object.assign({},w),E=N);}g(m,k);}function p(m,y,b){let _=new Map,P=(w,E)=>{_.has(w)||_.set(w,[]),_.get(w).push(E);};for(let w of m.nodes()){let E=m.node(w);if(typeof E.rank=="number"&&P(E.rank,w),typeof E.minRank=="number"&&typeof E.maxRank=="number")for(let k=E.minRank;k<=E.maxRank;k++)k!==E.rank&&P(k,w);}return y.map(function(w){return f(m,w,b,_.get(w)||[])})}function x(m,y){let b=new h;m.forEach(function(_){let P=_.graph().root,w=l(_,P,b,y);w.vs.forEach((E,k)=>_.node(E).order=k),u(_,b,w.vs);});}function g(m,y){Object.values(y).forEach(b=>b.forEach((_,P)=>m.node(_).order=P));}},{"../util":27,"./add-subgraph-constraints":11,"./build-layer-graph":13,"./cross-count":14,"./init-order":16,"./sort-subgraph":18,"@dagrejs/graphlib":29}],16:[function(n,o,i){let c=n("../util");o.exports=s;function s(l){let f={},u=l.nodes().filter(g=>!l.children(g).length),h=u.map(g=>l.node(g).rank),a=c.applyWithChunking(Math.max,h),d=c.range(a+1).map(()=>[]);function p(g){if(f[g])return;f[g]=true;let m=l.node(g);d[m.rank].push(g),l.successors(g).forEach(p);}return u.sort((g,m)=>l.node(g).rank-l.node(m).rank).forEach(p),d}},{"../util":27}],17:[function(n,o,i){let c=n("../util");o.exports=s;function s(u,h){let a={};u.forEach((p,x)=>{let g=a[p.v]={indegree:0,in:[],out:[],vs:[p.v],i:x};p.barycenter!==void 0&&(g.barycenter=p.barycenter,g.weight=p.weight);}),h.edges().forEach(p=>{let x=a[p.v],g=a[p.w];x!==void 0&&g!==void 0&&(g.indegree++,x.out.push(a[p.w]));});let d=Object.values(a).filter(p=>!p.indegree);return l(d)}function l(u){let h=[];function a(p){return x=>{x.merged||(x.barycenter===void 0||p.barycenter===void 0||x.barycenter>=p.barycenter)&&f(p,x);}}function d(p){return x=>{x.in.push(p),--x.indegree===0&&u.push(x);}}for(;u.length;){let p=u.pop();h.push(p),p.in.reverse().forEach(a(p)),p.out.forEach(d(p));}return h.filter(p=>!p.merged).map(p=>c.pick(p,["vs","i","barycenter","weight"]))}function f(u,h){let a=0,d=0;u.weight&&(a+=u.barycenter*u.weight,d+=u.weight),h.weight&&(a+=h.barycenter*h.weight,d+=h.weight),u.vs=h.vs.concat(u.vs),u.barycenter=a/d,u.weight=d,u.i=Math.min(h.i,u.i),h.merged=true;}},{"../util":27}],18:[function(n,o,i){let c=n("./barycenter"),s=n("./resolve-conflicts"),l=n("./sort");o.exports=f;function f(a,d,p,x){let g=a.children(d),m=a.node(d),y=m?m.borderLeft:void 0,b=m?m.borderRight:void 0,_={};y&&(g=g.filter(k=>k!==y&&k!==b));let P=c(a,g);P.forEach(k=>{if(a.children(k.v).length){let T=f(a,k.v,p,x);_[k.v]=T,Object.hasOwn(T,"barycenter")&&h(k,T);}});let w=s(P,p);u(w,_);let E=l(w,x);if(y&&(E.vs=[y,E.vs,b].flat(true),a.predecessors(y).length)){let k=a.node(a.predecessors(y)[0]),T=a.node(a.predecessors(b)[0]);Object.hasOwn(E,"barycenter")||(E.barycenter=0,E.weight=0),E.barycenter=(E.barycenter*E.weight+k.order+T.order)/(E.weight+2),E.weight+=2;}return E}function u(a,d){a.forEach(p=>{p.vs=p.vs.flatMap(x=>d[x]?d[x].vs:x);});}function h(a,d){a.barycenter!==void 0?(a.barycenter=(a.barycenter*a.weight+d.barycenter*d.weight)/(a.weight+d.weight),a.weight+=d.weight):(a.barycenter=d.barycenter,a.weight=d.weight);}},{"./barycenter":12,"./resolve-conflicts":17,"./sort":19}],19:[function(n,o,i){let c=n("../util");o.exports=s;function s(u,h){let a=c.partition(u,_=>Object.hasOwn(_,"barycenter")),d=a.lhs,p=a.rhs.sort((_,P)=>P.i-_.i),x=[],g=0,m=0,y=0;d.sort(f(!!h)),y=l(x,p,y),d.forEach(_=>{y+=_.vs.length,x.push(_.vs),g+=_.barycenter*_.weight,m+=_.weight,y=l(x,p,y);});let b={vs:x.flat(true)};return m&&(b.barycenter=g/m,b.weight=m),b}function l(u,h,a){let d;for(;h.length&&(d=h[h.length-1]).i<=a;)h.pop(),u.push(d.vs),a++;return a}function f(u){return (h,a)=>h.barycenter<a.barycenter?-1:h.barycenter>a.barycenter?1:u?a.i-h.i:h.i-a.i}},{"../util":27}],20:[function(n,o,i){o.exports=c;function c(f){let u=l(f);f.graph().dummyChains.forEach(h=>{let a=f.node(h),d=a.edgeObj,p=s(f,u,d.v,d.w),x=p.path,g=p.lca,m=0,y=x[m],b=true;for(;h!==d.w;){if(a=f.node(h),b){for(;(y=x[m])!==g&&f.node(y).maxRank<a.rank;)m++;y===g&&(b=false);}if(!b){for(;m<x.length-1&&f.node(y=x[m+1]).minRank<=a.rank;)m++;y=x[m];}f.setParent(h,y),h=f.successors(h)[0];}});}function s(f,u,h,a){let d=[],p=[],x=Math.min(u[h].low,u[a].low),g=Math.max(u[h].lim,u[a].lim),m,y;m=h;do m=f.parent(m),d.push(m);while(m&&(u[m].low>x||g>u[m].lim));for(y=m,m=a;(m=f.parent(m))!==y;)p.push(m);return {path:d.concat(p.reverse()),lca:y}}function l(f){let u={},h=0;function a(d){let p=h;f.children(d).forEach(a),u[d]={low:p,lim:h++};}return f.children().forEach(a),u}},{}],21:[function(n,o,i){let c=n("@dagrejs/graphlib").Graph,s=n("../util");o.exports={positionX:b,findType1Conflicts:l,findType2Conflicts:f,addConflict:h,hasConflict:a,verticalAlignment:d,horizontalCompaction:p,alignCoordinates:m,findSmallestWidthAlignment:g,balance:y};function l(w,E){let k={};function T(R,N){let O=0,j=0,M=R.length,C=N[N.length-1];return N.forEach((S,L)=>{let v=u(w,S),B=v?w.node(v).order:M;(v||S===C)&&(N.slice(j,L+1).forEach(F=>{w.predecessors(F).forEach(A=>{let I=w.node(A),X=I.order;(X<O||B<X)&&!(I.dummy&&w.node(F).dummy)&&h(k,A,F);});}),j=L+1,O=B);}),N}return E.length&&E.reduce(T),k}function f(w,E){let k={};function T(N,O,j,M,C){let S;s.range(O,j).forEach(L=>{S=N[L],w.node(S).dummy&&w.predecessors(S).forEach(v=>{let B=w.node(v);B.dummy&&(B.order<M||B.order>C)&&h(k,v,S);});});}function R(N,O){let j=-1,M,C=0;return O.forEach((S,L)=>{if(w.node(S).dummy==="border"){let v=w.predecessors(S);v.length&&(M=w.node(v[0]).order,T(O,C,L,j,M),C=L,j=M);}T(O,C,O.length,M,N.length);}),O}return E.length&&E.reduce(R),k}function u(w,E){if(w.node(E).dummy)return w.predecessors(E).find(k=>w.node(k).dummy)}function h(w,E,k){if(E>k){let R=E;E=k,k=R;}let T=w[E];T||(w[E]=T={}),T[k]=true;}function a(w,E,k){if(E>k){let T=E;E=k,k=T;}return !!w[E]&&Object.hasOwn(w[E],k)}function d(w,E,k,T){let R={},N={},O={};return E.forEach(j=>{j.forEach((M,C)=>{R[M]=M,N[M]=M,O[M]=C;});}),E.forEach(j=>{let M=-1;j.forEach(C=>{let S=T(C);if(S.length){S=S.sort((v,B)=>O[v]-O[B]);let L=(S.length-1)/2;for(let v=Math.floor(L),B=Math.ceil(L);v<=B;++v){let F=S[v];N[C]===C&&M<O[F]&&!a(k,C,F)&&(N[F]=C,N[C]=R[C]=R[F],M=O[F]);}}});}),{root:R,align:N}}function p(w,E,k,T,R){let N={},O=x(w,E,k,R),j=R?"borderLeft":"borderRight";function M(L,v){let B=O.nodes(),F=B.pop(),A={};for(;F;)A[F]?L(F):(A[F]=true,B.push(F),B=B.concat(v(F))),F=B.pop();}function C(L){N[L]=O.inEdges(L).reduce((v,B)=>Math.max(v,N[B.v]+O.edge(B)),0);}function S(L){let v=O.outEdges(L).reduce((F,A)=>Math.min(F,N[A.w]-O.edge(A)),Number.POSITIVE_INFINITY),B=w.node(L);v!==Number.POSITIVE_INFINITY&&B.borderType!==j&&(N[L]=Math.max(N[L],v));}return M(C,O.predecessors.bind(O)),M(S,O.successors.bind(O)),Object.keys(T).forEach(L=>N[L]=N[k[L]]),N}function x(w,E,k,T){let R=new c,N=w.graph(),O=_(N.nodesep,N.edgesep,T);return E.forEach(j=>{let M;j.forEach(C=>{let S=k[C];if(R.setNode(S),M){var L=k[M],v=R.edge(L,S);R.setEdge(L,S,Math.max(O(w,C,M),v||0));}M=C;});}),R}function g(w,E){return Object.values(E).reduce((k,T)=>{let R=Number.NEGATIVE_INFINITY,N=Number.POSITIVE_INFINITY;Object.entries(T).forEach(([j,M])=>{let C=P(w,j)/2;R=Math.max(M+C,R),N=Math.min(M-C,N);});let O=R-N;return O<k[0]&&(k=[O,T]),k},[Number.POSITIVE_INFINITY,null])[1]}function m(w,E){let k=Object.values(E),T=s.applyWithChunking(Math.min,k),R=s.applyWithChunking(Math.max,k);["u","d"].forEach(N=>{["l","r"].forEach(O=>{let j=N+O,M=w[j];if(M===E)return;let C=Object.values(M),S=T-s.applyWithChunking(Math.min,C);O!=="l"&&(S=R-s.applyWithChunking(Math.max,C)),S&&(w[j]=s.mapValues(M,L=>L+S));});});}function y(w,E){return s.mapValues(w.ul,(k,T)=>{if(E)return w[E.toLowerCase()][T];{let R=Object.values(w).map(N=>N[T]).sort((N,O)=>N-O);return (R[1]+R[2])/2}})}function b(w){let E=s.buildLayerMatrix(w),k=Object.assign(l(w,E),f(w,E)),T={},R;["u","d"].forEach(O=>{R=O==="u"?E:Object.values(E).reverse(),["l","r"].forEach(j=>{j==="r"&&(R=R.map(L=>Object.values(L).reverse()));let M=(O==="u"?w.predecessors:w.successors).bind(w),C=d(w,R,k,M),S=p(w,R,C.root,C.align,j==="r");j==="r"&&(S=s.mapValues(S,L=>-L)),T[O+j]=S;});});let N=g(w,T);return m(T,N),y(T,w.graph().align)}function _(w,E,k){return (T,R,N)=>{let O=T.node(R),j=T.node(N),M=0,C;if(M+=O.width/2,Object.hasOwn(O,"labelpos"))switch(O.labelpos.toLowerCase()){case "l":C=-O.width/2;break;case "r":C=O.width/2;break}if(C&&(M+=k?C:-C),C=0,M+=(O.dummy?E:w)/2,M+=(j.dummy?E:w)/2,M+=j.width/2,Object.hasOwn(j,"labelpos"))switch(j.labelpos.toLowerCase()){case "l":C=j.width/2;break;case "r":C=-j.width/2;break}return C&&(M+=k?C:-C),C=0,M}}function P(w,E){return w.node(E).width}},{"../util":27,"@dagrejs/graphlib":29}],22:[function(n,o,i){let c=n("../util"),s=n("./bk").positionX;o.exports=l;function l(u){u=c.asNonCompoundGraph(u),f(u),Object.entries(s(u)).forEach(([h,a])=>u.node(h).x=a);}function f(u){let h=c.buildLayerMatrix(u),a=u.graph().ranksep,d=0;h.forEach(p=>{let x=p.reduce((g,m)=>{let y=u.node(m).height;return g>y?g:y},0);p.forEach(g=>u.node(g).y=d+x/2),d+=x+a;});}},{"../util":27,"./bk":21}],23:[function(n,o,i){var c=n("@dagrejs/graphlib").Graph,s=n("./util").slack;o.exports=l;function l(a){var d=new c({directed:false}),p=a.nodes()[0],x=a.nodeCount();d.setNode(p,{});for(var g,m;f(d,a)<x;)g=u(d,a),m=d.hasNode(g.v)?s(a,g):-s(a,g),h(d,a,m);return d}function f(a,d){function p(x){d.nodeEdges(x).forEach(g=>{var m=g.v,y=x===m?g.w:m;!a.hasNode(y)&&!s(d,g)&&(a.setNode(y,{}),a.setEdge(x,y,{}),p(y));});}return a.nodes().forEach(p),a.nodeCount()}function u(a,d){return d.edges().reduce((x,g)=>{let m=Number.POSITIVE_INFINITY;return a.hasNode(g.v)!==a.hasNode(g.w)&&(m=s(d,g)),m<x[0]?[m,g]:x},[Number.POSITIVE_INFINITY,null])[1]}function h(a,d,p){a.nodes().forEach(x=>d.node(x).rank+=p);}},{"./util":26,"@dagrejs/graphlib":29}],24:[function(n,o,i){var c=n("./util"),s=c.longestPath,l=n("./feasible-tree"),f=n("./network-simplex");o.exports=u;function u(p){var x=p.graph().ranker;if(x instanceof Function)return x(p);switch(p.graph().ranker){case "network-simplex":d(p);break;case "tight-tree":a(p);break;case "longest-path":h(p);break;case "none":break;default:d(p);}}var h=s;function a(p){s(p),l(p);}function d(p){f(p);}},{"./feasible-tree":23,"./network-simplex":25,"./util":26}],25:[function(n,o,i){var c=n("./feasible-tree"),s=n("./util").slack,l=n("./util").longestPath,f=n("@dagrejs/graphlib").alg.preorder,u=n("@dagrejs/graphlib").alg.postorder,h=n("../util").simplify;o.exports=a,a.initLowLimValues=g,a.initCutValues=d,a.calcCutValue=x,a.leaveEdge=y,a.enterEdge=b,a.exchangeEdges=_;function a(k){k=h(k),l(k);var T=c(k);g(T),d(T,k);for(var R,N;R=y(T);)N=b(T,k,R),_(T,k,R,N);}function d(k,T){var R=u(k,k.nodes());R=R.slice(0,R.length-1),R.forEach(N=>p(k,T,N));}function p(k,T,R){var N=k.node(R),O=N.parent;k.edge(R,O).cutvalue=x(k,T,R);}function x(k,T,R){var N=k.node(R),O=N.parent,j=true,M=T.edge(R,O),C=0;return M||(j=false,M=T.edge(O,R)),C=M.weight,T.nodeEdges(R).forEach(S=>{var L=S.v===R,v=L?S.w:S.v;if(v!==O){var B=L===j,F=T.edge(S).weight;if(C+=B?F:-F,w(k,R,v)){var A=k.edge(R,v).cutvalue;C+=B?-A:A;}}}),C}function g(k,T){arguments.length<2&&(T=k.nodes()[0]),m(k,{},1,T);}function m(k,T,R,N,O){var j=R,M=k.node(N);return T[N]=true,k.neighbors(N).forEach(C=>{Object.hasOwn(T,C)||(R=m(k,T,R,C,N));}),M.low=j,M.lim=R++,O?M.parent=O:delete M.parent,R}function y(k){return k.edges().find(T=>k.edge(T).cutvalue<0)}function b(k,T,R){var N=R.v,O=R.w;T.hasEdge(N,O)||(N=R.w,O=R.v);var j=k.node(N),M=k.node(O),C=j,S=false;j.lim>M.lim&&(C=M,S=true);var L=T.edges().filter(v=>S===E(k,k.node(v.v),C)&&S!==E(k,k.node(v.w),C));return L.reduce((v,B)=>s(T,B)<s(T,v)?B:v)}function _(k,T,R,N){var O=R.v,j=R.w;k.removeEdge(O,j),k.setEdge(N.v,N.w,{}),g(k),d(k,T),P(k,T);}function P(k,T){var R=k.nodes().find(O=>!T.node(O).parent),N=f(k,R);N=N.slice(1),N.forEach(O=>{var j=k.node(O).parent,M=T.edge(O,j),C=false;M||(M=T.edge(j,O),C=true),T.node(O).rank=T.node(j).rank+(C?M.minlen:-M.minlen);});}function w(k,T,R){return k.hasEdge(T,R)}function E(k,T,R){return R.low<=T.lim&&T.lim<=R.lim}},{"../util":27,"./feasible-tree":23,"./util":26,"@dagrejs/graphlib":29}],26:[function(n,o,i){let{applyWithChunking:c}=n("../util");o.exports={longestPath:s,slack:l};function s(f){var u={};function h(a){var d=f.node(a);if(Object.hasOwn(u,a))return d.rank;u[a]=true;let p=f.outEdges(a).map(g=>g==null?Number.POSITIVE_INFINITY:h(g.w)-f.edge(g).minlen);var x=c(Math.min,p);return x===Number.POSITIVE_INFINITY&&(x=0),d.rank=x}f.sources().forEach(h);}function l(f,u){return f.node(u.w).rank-f.node(u.v).rank-f.edge(u).minlen}},{"../util":27}],27:[function(n,o,i){let c=n("@dagrejs/graphlib").Graph;o.exports={addBorderNode:g,addDummyNode:s,applyWithChunking:b,asNonCompoundGraph:f,buildLayerMatrix:d,intersectRect:a,mapValues:O,maxRank:_,normalizeRanks:p,notime:E,partition:P,pick:N,predecessorWeights:h,range:R,removeEmptyRanks:x,simplify:l,successorWeights:u,time:w,uniqueId:T,zipObject:j};function s(M,C,S,L){for(var v=L;M.hasNode(v);)v=T(L);return S.dummy=C,M.setNode(v,S),v}function l(M){let C=new c().setGraph(M.graph());return M.nodes().forEach(S=>C.setNode(S,M.node(S))),M.edges().forEach(S=>{let L=C.edge(S.v,S.w)||{weight:0,minlen:1},v=M.edge(S);C.setEdge(S.v,S.w,{weight:L.weight+v.weight,minlen:Math.max(L.minlen,v.minlen)});}),C}function f(M){let C=new c({multigraph:M.isMultigraph()}).setGraph(M.graph());return M.nodes().forEach(S=>{M.children(S).length||C.setNode(S,M.node(S));}),M.edges().forEach(S=>{C.setEdge(S,M.edge(S));}),C}function u(M){let C=M.nodes().map(S=>{let L={};return M.outEdges(S).forEach(v=>{L[v.w]=(L[v.w]||0)+M.edge(v).weight;}),L});return j(M.nodes(),C)}function h(M){let C=M.nodes().map(S=>{let L={};return M.inEdges(S).forEach(v=>{L[v.v]=(L[v.v]||0)+M.edge(v).weight;}),L});return j(M.nodes(),C)}function a(M,C){let S=M.x,L=M.y,v=C.x-S,B=C.y-L,F=M.width/2,A=M.height/2;if(!v&&!B)throw new Error("Not possible to find intersection inside of the rectangle");let I,X;return Math.abs(B)*F>Math.abs(v)*A?(B<0&&(A=-A),I=A*v/B,X=A):(v<0&&(F=-F),I=F,X=F*B/v),{x:S+I,y:L+X}}function d(M){let C=R(_(M)+1).map(()=>[]);return M.nodes().forEach(S=>{let L=M.node(S),v=L.rank;v!==void 0&&(C[v][L.order]=S);}),C}function p(M){let C=M.nodes().map(L=>{let v=M.node(L).rank;return v===void 0?Number.MAX_VALUE:v}),S=b(Math.min,C);M.nodes().forEach(L=>{let v=M.node(L);Object.hasOwn(v,"rank")&&(v.rank-=S);});}function x(M){let C=M.nodes().map(F=>M.node(F).rank),S=b(Math.min,C),L=[];M.nodes().forEach(F=>{let A=M.node(F).rank-S;L[A]||(L[A]=[]),L[A].push(F);});let v=0,B=M.graph().nodeRankFactor;Array.from(L).forEach((F,A)=>{F===void 0&&A%B!==0?--v:F!==void 0&&v&&F.forEach(I=>M.node(I).rank+=v);});}function g(M,C,S,L){let v={width:0,height:0};return arguments.length>=4&&(v.rank=S,v.order=L),s(M,"border",v,C)}function m(M,C=y){let S=[];for(let L=0;L<M.length;L+=C){let v=M.slice(L,L+C);S.push(v);}return S}let y=65535;function b(M,C){if(C.length>y){let S=m(C);return M.apply(null,S.map(L=>M.apply(null,L)))}else return M.apply(null,C)}function _(M){let S=M.nodes().map(L=>{let v=M.node(L).rank;return v===void 0?Number.MIN_VALUE:v});return b(Math.max,S)}function P(M,C){let S={lhs:[],rhs:[]};return M.forEach(L=>{C(L)?S.lhs.push(L):S.rhs.push(L);}),S}function w(M,C){let S=Date.now();try{return C()}finally{console.log(M+" time: "+(Date.now()-S)+"ms");}}function E(M,C){return C()}let k=0;function T(M){var C=++k;return M+(""+C)}function R(M,C,S=1){C==null&&(C=M,M=0);let L=B=>B<C;S<0&&(L=B=>C<B);let v=[];for(let B=M;L(B);B+=S)v.push(B);return v}function N(M,C){let S={};for(let L of C)M[L]!==void 0&&(S[L]=M[L]);return S}function O(M,C){let S=C;return typeof C=="string"&&(S=L=>L[C]),Object.entries(M).reduce((L,[v,B])=>(L[v]=S(B,v),L),{})}function j(M,C){return M.reduce((S,L,v)=>(S[L]=C[v],S),{})}},{"@dagrejs/graphlib":29}],28:[function(n,o,i){o.exports="1.1.8";},{}],29:[function(n,o,i){var c=n("./lib");o.exports={Graph:c.Graph,json:n("./lib/json"),alg:n("./lib/alg"),version:c.version};},{"./lib":45,"./lib/alg":36,"./lib/json":46}],30:[function(n,o,i){o.exports=c;function c(s){var l={},f=[],u;function h(a){Object.hasOwn(l,a)||(l[a]=true,u.push(a),s.successors(a).forEach(h),s.predecessors(a).forEach(h));}return s.nodes().forEach(function(a){u=[],h(a),u.length&&f.push(u);}),f}},{}],31:[function(n,o,i){o.exports=c;function c(u,h,a){Array.isArray(h)||(h=[h]);var d=u.isDirected()?m=>u.successors(m):m=>u.neighbors(m),p=a==="post"?s:l,x=[],g={};return h.forEach(m=>{if(!u.hasNode(m))throw new Error("Graph does not have node: "+m);p(m,d,g,x);}),x}function s(u,h,a,d){for(var p=[[u,false]];p.length>0;){var x=p.pop();x[1]?d.push(x[0]):Object.hasOwn(a,x[0])||(a[x[0]]=true,p.push([x[0],true]),f(h(x[0]),g=>p.push([g,false])));}}function l(u,h,a,d){for(var p=[u];p.length>0;){var x=p.pop();Object.hasOwn(a,x)||(a[x]=true,d.push(x),f(h(x),g=>p.push(g)));}}function f(u,h){for(var a=u.length;a--;)h(u[a],a,u);return u}},{}],32:[function(n,o,i){var c=n("./dijkstra");o.exports=s;function s(l,f,u){return l.nodes().reduce(function(h,a){return h[a]=c(l,a,f,u),h},{})}},{"./dijkstra":33}],33:[function(n,o,i){var c=n("../data/priority-queue");o.exports=l;var s=()=>1;function l(u,h,a,d){return f(u,String(h),a||s,d||function(p){return u.outEdges(p)})}function f(u,h,a,d){var p={},x=new c,g,m,y=function(b){var _=b.v!==g?b.v:b.w,P=p[_],w=a(b),E=m.distance+w;if(w<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+b+" Weight: "+w);E<P.distance&&(P.distance=E,P.predecessor=g,x.decrease(_,E));};for(u.nodes().forEach(function(b){var _=b===h?0:Number.POSITIVE_INFINITY;p[b]={distance:_},x.add(b,_);});x.size()>0&&(g=x.removeMin(),m=p[g],m.distance!==Number.POSITIVE_INFINITY);)d(g).forEach(y);return p}},{"../data/priority-queue":43}],34:[function(n,o,i){var c=n("./tarjan");o.exports=s;function s(l){return c(l).filter(function(f){return f.length>1||f.length===1&&l.hasEdge(f[0],f[0])})}},{"./tarjan":41}],35:[function(n,o,i){o.exports=s;var c=()=>1;function s(f,u,h){return l(f,u||c,h||function(a){return f.outEdges(a)})}function l(f,u,h){var a={},d=f.nodes();return d.forEach(function(p){a[p]={},a[p][p]={distance:0},d.forEach(function(x){p!==x&&(a[p][x]={distance:Number.POSITIVE_INFINITY});}),h(p).forEach(function(x){var g=x.v===p?x.w:x.v,m=u(x);a[p][g]={distance:m,predecessor:p};});}),d.forEach(function(p){var x=a[p];d.forEach(function(g){var m=a[g];d.forEach(function(y){var b=m[p],_=x[y],P=m[y],w=b.distance+_.distance;w<P.distance&&(P.distance=w,P.predecessor=_.predecessor);});});}),a}},{}],36:[function(n,o,i){o.exports={components:n("./components"),dijkstra:n("./dijkstra"),dijkstraAll:n("./dijkstra-all"),findCycles:n("./find-cycles"),floydWarshall:n("./floyd-warshall"),isAcyclic:n("./is-acyclic"),postorder:n("./postorder"),preorder:n("./preorder"),prim:n("./prim"),tarjan:n("./tarjan"),topsort:n("./topsort")};},{"./components":30,"./dijkstra":33,"./dijkstra-all":32,"./find-cycles":34,"./floyd-warshall":35,"./is-acyclic":37,"./postorder":38,"./preorder":39,"./prim":40,"./tarjan":41,"./topsort":42}],37:[function(n,o,i){var c=n("./topsort");o.exports=s;function s(l){try{c(l);}catch(f){if(f instanceof c.CycleException)return  false;throw f}return  true}},{"./topsort":42}],38:[function(n,o,i){var c=n("./dfs");o.exports=s;function s(l,f){return c(l,f,"post")}},{"./dfs":31}],39:[function(n,o,i){var c=n("./dfs");o.exports=s;function s(l,f){return c(l,f,"pre")}},{"./dfs":31}],40:[function(n,o,i){var c=n("../graph"),s=n("../data/priority-queue");o.exports=l;function l(f,u){var h=new c,a={},d=new s,p;function x(m){var y=m.v===p?m.w:m.v,b=d.priority(y);if(b!==void 0){var _=u(m);_<b&&(a[y]=p,d.decrease(y,_));}}if(f.nodeCount()===0)return h;f.nodes().forEach(function(m){d.add(m,Number.POSITIVE_INFINITY),h.setNode(m);}),d.decrease(f.nodes()[0],0);for(var g=false;d.size()>0;){if(p=d.removeMin(),Object.hasOwn(a,p))h.setEdge(p,a[p]);else {if(g)throw new Error("Input graph is not connected: "+f);g=true;}f.nodeEdges(p).forEach(x);}return h}},{"../data/priority-queue":43,"../graph":44}],41:[function(n,o,i){o.exports=c;function c(s){var l=0,f=[],u={},h=[];function a(d){var p=u[d]={onStack:true,lowlink:l,index:l++};if(f.push(d),s.successors(d).forEach(function(m){Object.hasOwn(u,m)?u[m].onStack&&(p.lowlink=Math.min(p.lowlink,u[m].index)):(a(m),p.lowlink=Math.min(p.lowlink,u[m].lowlink));}),p.lowlink===p.index){var x=[],g;do g=f.pop(),u[g].onStack=false,x.push(g);while(d!==g);h.push(x);}}return s.nodes().forEach(function(d){Object.hasOwn(u,d)||a(d);}),h}},{}],42:[function(n,o,i){function c(l){var f={},u={},h=[];function a(d){if(Object.hasOwn(u,d))throw new s;Object.hasOwn(f,d)||(u[d]=true,f[d]=true,l.predecessors(d).forEach(a),delete u[d],h.push(d));}if(l.sinks().forEach(a),Object.keys(f).length!==l.nodeCount())throw new s;return h}class s extends Error{constructor(){super(...arguments);}}o.exports=c,c.CycleException=s;},{}],43:[function(n,o,i){class c{_arr=[];_keyIndices={};size(){return this._arr.length}keys(){return this._arr.map(function(l){return l.key})}has(l){return Object.hasOwn(this._keyIndices,l)}priority(l){var f=this._keyIndices[l];if(f!==void 0)return this._arr[f].priority}min(){if(this.size()===0)throw new Error("Queue underflow");return this._arr[0].key}add(l,f){var u=this._keyIndices;if(l=String(l),!Object.hasOwn(u,l)){var h=this._arr,a=h.length;return u[l]=a,h.push({key:l,priority:f}),this._decrease(a),true}return  false}removeMin(){this._swap(0,this._arr.length-1);var l=this._arr.pop();return delete this._keyIndices[l.key],this._heapify(0),l.key}decrease(l,f){var u=this._keyIndices[l];if(f>this._arr[u].priority)throw new Error("New priority is greater than current priority. Key: "+l+" Old: "+this._arr[u].priority+" New: "+f);this._arr[u].priority=f,this._decrease(u);}_heapify(l){var f=this._arr,u=2*l,h=u+1,a=l;u<f.length&&(a=f[u].priority<f[a].priority?u:a,h<f.length&&(a=f[h].priority<f[a].priority?h:a),a!==l&&(this._swap(l,a),this._heapify(a)));}_decrease(l){for(var f=this._arr,u=f[l].priority,h;l!==0&&(h=l>>1,!(f[h].priority<u));)this._swap(l,h),l=h;}_swap(l,f){var u=this._arr,h=this._keyIndices,a=u[l],d=u[f];u[l]=d,u[f]=a,h[d.key]=l,h[a.key]=f;}}o.exports=c;},{}],44:[function(n,o,i){var c="\0",s="\0",l="";class f{_isDirected=true;_isMultigraph=false;_isCompound=false;_label;_defaultNodeLabelFn=()=>{};_defaultEdgeLabelFn=()=>{};_nodes={};_in={};_preds={};_out={};_sucs={};_edgeObjs={};_edgeLabels={};_nodeCount=0;_edgeCount=0;_parent;_children;constructor(g){g&&(this._isDirected=Object.hasOwn(g,"directed")?g.directed:true,this._isMultigraph=Object.hasOwn(g,"multigraph")?g.multigraph:false,this._isCompound=Object.hasOwn(g,"compound")?g.compound:false),this._isCompound&&(this._parent={},this._children={},this._children[s]={});}isDirected(){return this._isDirected}isMultigraph(){return this._isMultigraph}isCompound(){return this._isCompound}setGraph(g){return this._label=g,this}graph(){return this._label}setDefaultNodeLabel(g){return this._defaultNodeLabelFn=g,typeof g!="function"&&(this._defaultNodeLabelFn=()=>g),this}nodeCount(){return this._nodeCount}nodes(){return Object.keys(this._nodes)}sources(){var g=this;return this.nodes().filter(m=>Object.keys(g._in[m]).length===0)}sinks(){var g=this;return this.nodes().filter(m=>Object.keys(g._out[m]).length===0)}setNodes(g,m){var y=arguments,b=this;return g.forEach(function(_){y.length>1?b.setNode(_,m):b.setNode(_);}),this}setNode(g,m){return Object.hasOwn(this._nodes,g)?(arguments.length>1&&(this._nodes[g]=m),this):(this._nodes[g]=arguments.length>1?m:this._defaultNodeLabelFn(g),this._isCompound&&(this._parent[g]=s,this._children[g]={},this._children[s][g]=true),this._in[g]={},this._preds[g]={},this._out[g]={},this._sucs[g]={},++this._nodeCount,this)}node(g){return this._nodes[g]}hasNode(g){return Object.hasOwn(this._nodes,g)}removeNode(g){var m=this;if(Object.hasOwn(this._nodes,g)){var y=b=>m.removeEdge(m._edgeObjs[b]);delete this._nodes[g],this._isCompound&&(this._removeFromParentsChildList(g),delete this._parent[g],this.children(g).forEach(function(b){m.setParent(b);}),delete this._children[g]),Object.keys(this._in[g]).forEach(y),delete this._in[g],delete this._preds[g],Object.keys(this._out[g]).forEach(y),delete this._out[g],delete this._sucs[g],--this._nodeCount;}return this}setParent(g,m){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(m===void 0)m=s;else {m+="";for(var y=m;y!==void 0;y=this.parent(y))if(y===g)throw new Error("Setting "+m+" as parent of "+g+" would create a cycle");this.setNode(m);}return this.setNode(g),this._removeFromParentsChildList(g),this._parent[g]=m,this._children[m][g]=true,this}_removeFromParentsChildList(g){delete this._children[this._parent[g]][g];}parent(g){if(this._isCompound){var m=this._parent[g];if(m!==s)return m}}children(g=s){if(this._isCompound){var m=this._children[g];if(m)return Object.keys(m)}else {if(g===s)return this.nodes();if(this.hasNode(g))return []}}predecessors(g){var m=this._preds[g];if(m)return Object.keys(m)}successors(g){var m=this._sucs[g];if(m)return Object.keys(m)}neighbors(g){var m=this.predecessors(g);if(m){let b=new Set(m);for(var y of this.successors(g))b.add(y);return Array.from(b.values())}}isLeaf(g){var m;return this.isDirected()?m=this.successors(g):m=this.neighbors(g),m.length===0}filterNodes(g){var m=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});m.setGraph(this.graph());var y=this;Object.entries(this._nodes).forEach(function([P,w]){g(P)&&m.setNode(P,w);}),Object.values(this._edgeObjs).forEach(function(P){m.hasNode(P.v)&&m.hasNode(P.w)&&m.setEdge(P,y.edge(P));});var b={};function _(P){var w=y.parent(P);return w===void 0||m.hasNode(w)?(b[P]=w,w):w in b?b[w]:_(w)}return this._isCompound&&m.nodes().forEach(P=>m.setParent(P,_(P))),m}setDefaultEdgeLabel(g){return this._defaultEdgeLabelFn=g,typeof g!="function"&&(this._defaultEdgeLabelFn=()=>g),this}edgeCount(){return this._edgeCount}edges(){return Object.values(this._edgeObjs)}setPath(g,m){var y=this,b=arguments;return g.reduce(function(_,P){return b.length>1?y.setEdge(_,P,m):y.setEdge(_,P),P}),this}setEdge(){var g,m,y,b,_=false,P=arguments[0];typeof P=="object"&&P!==null&&"v"in P?(g=P.v,m=P.w,y=P.name,arguments.length===2&&(b=arguments[1],_=true)):(g=P,m=arguments[1],y=arguments[3],arguments.length>2&&(b=arguments[2],_=true)),g=""+g,m=""+m,y!==void 0&&(y=""+y);var w=a(this._isDirected,g,m,y);if(Object.hasOwn(this._edgeLabels,w))return _&&(this._edgeLabels[w]=b),this;if(y!==void 0&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(g),this.setNode(m),this._edgeLabels[w]=_?b:this._defaultEdgeLabelFn(g,m,y);var E=d(this._isDirected,g,m,y);return g=E.v,m=E.w,Object.freeze(E),this._edgeObjs[w]=E,u(this._preds[m],g),u(this._sucs[g],m),this._in[m][w]=E,this._out[g][w]=E,this._edgeCount++,this}edge(g,m,y){var b=arguments.length===1?p(this._isDirected,arguments[0]):a(this._isDirected,g,m,y);return this._edgeLabels[b]}edgeAsObj(){let g=this.edge(...arguments);return typeof g!="object"?{label:g}:g}hasEdge(g,m,y){var b=arguments.length===1?p(this._isDirected,arguments[0]):a(this._isDirected,g,m,y);return Object.hasOwn(this._edgeLabels,b)}removeEdge(g,m,y){var b=arguments.length===1?p(this._isDirected,arguments[0]):a(this._isDirected,g,m,y),_=this._edgeObjs[b];return _&&(g=_.v,m=_.w,delete this._edgeLabels[b],delete this._edgeObjs[b],h(this._preds[m],g),h(this._sucs[g],m),delete this._in[m][b],delete this._out[g][b],this._edgeCount--),this}inEdges(g,m){var y=this._in[g];if(y){var b=Object.values(y);return m?b.filter(_=>_.v===m):b}}outEdges(g,m){var y=this._out[g];if(y){var b=Object.values(y);return m?b.filter(_=>_.w===m):b}}nodeEdges(g,m){var y=this.inEdges(g,m);if(y)return y.concat(this.outEdges(g,m))}}function u(x,g){x[g]?x[g]++:x[g]=1;}function h(x,g){--x[g]||delete x[g];}function a(x,g,m,y){var b=""+g,_=""+m;if(!x&&b>_){var P=b;b=_,_=P;}return b+l+_+l+(y===void 0?c:y)}function d(x,g,m,y){var b=""+g,_=""+m;if(!x&&b>_){var P=b;b=_,_=P;}var w={v:b,w:_};return y&&(w.name=y),w}function p(x,g){return a(x,g.v,g.w,g.name)}o.exports=f;},{}],45:[function(n,o,i){o.exports={Graph:n("./graph"),version:n("./version")};},{"./graph":44,"./version":47}],46:[function(n,o,i){var c=n("./graph");o.exports={write:s,read:u};function s(h){var a={options:{directed:h.isDirected(),multigraph:h.isMultigraph(),compound:h.isCompound()},nodes:l(h),edges:f(h)};return h.graph()!==void 0&&(a.value=structuredClone(h.graph())),a}function l(h){return h.nodes().map(function(a){var d=h.node(a),p=h.parent(a),x={v:a};return d!==void 0&&(x.value=d),p!==void 0&&(x.parent=p),x})}function f(h){return h.edges().map(function(a){var d=h.edge(a),p={v:a.v,w:a.w};return a.name!==void 0&&(p.name=a.name),d!==void 0&&(p.value=d),p})}function u(h){var a=new c(h.options).setGraph(h.value);return h.nodes.forEach(function(d){a.setNode(d.v,d.value),d.parent&&a.setParent(d.v,d.parent);}),h.edges.forEach(function(d){a.setEdge({v:d.v,w:d.w,name:d.name},d.value);}),a}},{"./graph":44}],47:[function(n,o,i){o.exports="2.2.4";},{}]},{},[1])(1)});});var Xe={bg:"#FFFFFF",fg:"#27272A"},$e={textSec:60,textMuted:40,textFaint:25,line:30,arrow:50,nodeFill:3,nodeStroke:20,groupHeader:5,innerStroke:12,keyBadge:10},Ct={"zinc-light":{bg:"#FFFFFF",fg:"#27272A"},"zinc-dark":{bg:"#18181B",fg:"#FAFAFA"},"tokyo-night":{bg:"#1a1b26",fg:"#a9b1d6",line:"#3d59a1",accent:"#7aa2f7",muted:"#565f89"},"tokyo-night-storm":{bg:"#24283b",fg:"#a9b1d6",line:"#3d59a1",accent:"#7aa2f7",muted:"#565f89"},"tokyo-night-light":{bg:"#d5d6db",fg:"#343b58",line:"#34548a",accent:"#34548a",muted:"#9699a3"},"catppuccin-mocha":{bg:"#1e1e2e",fg:"#cdd6f4",line:"#585b70",accent:"#cba6f7",muted:"#6c7086"},"catppuccin-latte":{bg:"#eff1f5",fg:"#4c4f69",line:"#9ca0b0",accent:"#8839ef",muted:"#9ca0b0"},nord:{bg:"#2e3440",fg:"#d8dee9",line:"#4c566a",accent:"#88c0d0",muted:"#616e88"},"nord-light":{bg:"#eceff4",fg:"#2e3440",line:"#aab1c0",accent:"#5e81ac",muted:"#7b88a1"},dracula:{bg:"#282a36",fg:"#f8f8f2",line:"#6272a4",accent:"#bd93f9",muted:"#6272a4"},"github-light":{bg:"#ffffff",fg:"#1f2328",line:"#d1d9e0",accent:"#0969da",muted:"#59636e"},"github-dark":{bg:"#0d1117",fg:"#e6edf3",line:"#3d444d",accent:"#4493f8",muted:"#9198a1"},"solarized-light":{bg:"#fdf6e3",fg:"#657b83",line:"#93a1a1",accent:"#268bd2",muted:"#93a1a1"},"solarized-dark":{bg:"#002b36",fg:"#839496",line:"#586e75",accent:"#268bd2",muted:"#586e75"},"one-dark":{bg:"#282c34",fg:"#abb2bf",line:"#4b5263",accent:"#c678dd",muted:"#5c6370"}};function St(e){let t=e.colors??{},r=e.type==="dark",n=o=>e.tokenColors?.find(i=>Array.isArray(i.scope)?i.scope.includes(o):i.scope===o)?.settings?.foreground;return {bg:t["editor.background"]??(r?"#1e1e1e":"#ffffff"),fg:t["editor.foreground"]??(r?"#d4d4d4":"#333333"),line:t["editorLineNumber.foreground"]??void 0,accent:t.focusBorder??n("keyword")??void 0,muted:n("comment")??t["editorLineNumber.foreground"]??void 0,surface:t["editor.selectionBackground"]??void 0,border:t["editorWidget.border"]??void 0}}function Te(e,t){let r=[`@import url('https://fonts.googleapis.com/css2?family=${encodeURIComponent(e)}:wght@400;500;600;700&amp;display=swap');`,...t?["@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&amp;display=swap');"]:[]],n=`
    /* Derived from --bg and --fg (overridable via --line, --accent, etc.) */
    --_text:          var(--fg);
    --_text-sec:      var(--muted, color-mix(in srgb, var(--fg) ${$e.textSec}%, var(--bg)));
    --_text-muted:    var(--muted, color-mix(in srgb, var(--fg) ${$e.textMuted}%, var(--bg)));
    --_text-faint:    color-mix(in srgb, var(--fg) ${$e.textFaint}%, var(--bg));
    --_line:          var(--line, color-mix(in srgb, var(--fg) ${$e.line}%, var(--bg)));
    --_arrow:         var(--accent, color-mix(in srgb, var(--fg) ${$e.arrow}%, var(--bg)));
    --_node-fill:     var(--surface, color-mix(in srgb, var(--fg) ${$e.nodeFill}%, var(--bg)));
    --_node-stroke:   var(--border, color-mix(in srgb, var(--fg) ${$e.nodeStroke}%, var(--bg)));
    --_group-fill:    var(--bg);
    --_group-hdr:     color-mix(in srgb, var(--fg) ${$e.groupHeader}%, var(--bg));
    --_inner-stroke:  color-mix(in srgb, var(--fg) ${$e.innerStroke}%, var(--bg));
    --_key-badge:     color-mix(in srgb, var(--fg) ${$e.keyBadge}%, var(--bg));`;return ["<style>",`  ${r.join(`
  `)}`,`  text { font-family: '${e}', system-ui, sans-serif; }`,...t?["  .mono { font-family: 'JetBrains Mono', 'SF Mono', 'Fira Code', ui-monospace, monospace; }"]:[],`  svg {${n}`,"  }","</style>"].join(`
`)}function Ie(e,t,r,n){let o=[`--bg:${r.bg}`,`--fg:${r.fg}`,r.line?`--line:${r.line}`:"",r.accent?`--accent:${r.accent}`:"",r.muted?`--muted:${r.muted}`:"",r.surface?`--surface:${r.surface}`:"",r.border?`--border:${r.border}`:""].filter(Boolean).join(";");return `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${e} ${t}" width="${e}" height="${t}" style="${o}${n?"":";background:var(--bg)"}">`}function Qe(e){let t=e.split(/[\n;]/).map(n=>n.trim()).filter(n=>n.length>0&&!n.startsWith("%%"));if(t.length===0)throw new Error("Empty mermaid diagram");let r=t[0];return /^stateDiagram(-v2)?\s*$/i.test(r)?Or(t):Nr(t)}function Nr(e){let t=e[0].match(/^(?:graph|flowchart)\s+(TD|TB|LR|BT|RL)\s*$/i);if(!t)throw new Error(`Invalid mermaid header: "${e[0]}". Expected "graph TD", "flowchart LR", "stateDiagram-v2", etc.`);let n={direction:t[1].toUpperCase(),nodes:new Map,edges:[],subgraphs:[],classDefs:new Map,classAssignments:new Map,nodeStyles:new Map},o=[];for(let i=1;i<e.length;i++){let c=e[i],s=c.match(/^classDef\s+(\w+)\s+(.+)$/);if(s){let a=s[1],d=s[2],p=nn(d);n.classDefs.set(a,p);continue}let l=c.match(/^class\s+([^\s]+)\s+(\w+)$/);if(l){let a=l[1].split(",").map(p=>p.trim()),d=l[2];for(let p of a)n.classAssignments.set(p,d);continue}let f=c.match(/^style\s+([^\s]+)\s+(.+)$/);if(f){let a=f[1].split(",").map(p=>p.trim()),d=nn(f[2]);for(let p of a)n.nodeStyles.set(p,{...n.nodeStyles.get(p),...d});continue}let u=c.match(/^direction\s+(TD|TB|LR|BT|RL)\s*$/i);if(u&&o.length>0){o[o.length-1].direction=u[1].toUpperCase();continue}let h=c.match(/^subgraph\s+(.+)$/);if(h){let a=h[1].trim(),d=a.match(/^([\p{L}\p{N}_-]+)\s*\[(.+)\]$/u),p,x;d?(p=d[1],x=d[2]):(x=a,p=a.replace(/\s+/g,"_").replace(/[^\p{L}\p{N}_]/gu,""));let g={id:p,label:x,nodeIds:[],children:[]};o.push(g);continue}if(c==="end"){let a=o.pop();a&&(o.length>0?o[o.length-1].children.push(a):n.subgraphs.push(a));continue}Yr(c,n,o);}return n}function Or(e){let t={direction:"TD",nodes:new Map,edges:[],subgraphs:[],classDefs:new Map,classAssignments:new Map,nodeStyles:new Map},r=[],n=0,o=0;for(let i=1;i<e.length;i++){let c=e[i],s=c.match(/^direction\s+(TD|TB|LR|BT|RL)\s*$/i);if(s){r.length>0?r[r.length-1].direction=s[1].toUpperCase():t.direction=s[1].toUpperCase();continue}let l=c.match(/^state\s+(?:"([^"]+)"\s+as\s+)?([\p{L}\p{N}_-]+)\s*\{$/u);if(l){let a=l[1]??l[2],p={id:l[2],label:a,nodeIds:[],children:[]};r.push(p);continue}if(c==="}"){let a=r.pop();a&&(r.length>0?r[r.length-1].children.push(a):t.subgraphs.push(a));continue}let f=c.match(/^state\s+"([^"]+)"\s+as\s+([\p{L}\p{N}_-]+)\s*$/u);if(f){let a=f[1],d=f[2];Ze(t,r,{id:d,label:a,shape:"rounded"});continue}let u=c.match(/^(\[\*\]|[\p{L}\p{N}_-]+)\s*(-->)\s*(\[\*\]|[\p{L}\p{N}_-]+)(?:\s*:\s*(.+))?$/u);if(u){let a=u[1],d=u[3],p=u[4]?.trim()||void 0;a==="[*]"?(n++,a=`_start${n>1?n:""}`,Ze(t,r,{id:a,label:"",shape:"state-start"})):tn(t,r,a),d==="[*]"?(o++,d=`_end${o>1?o:""}`,Ze(t,r,{id:d,label:"",shape:"state-end"})):tn(t,r,d),t.edges.push({source:a,target:d,label:p,style:"solid",hasArrowStart:false,hasArrowEnd:true});continue}let h=c.match(/^([\p{L}\p{N}_-]+)\s*:\s*(.+)$/u);if(h){let a=h[1],d=h[2].trim();Ze(t,r,{id:a,label:d,shape:"rounded"});continue}}return t}function Ze(e,t,r){if(!e.nodes.has(r.id)&&e.nodes.set(r.id,r),t.length>0){let o=t[t.length-1];o.nodeIds.includes(r.id)||o.nodeIds.push(r.id);}}function tn(e,t,r){if(!e.nodes.has(r))Ze(e,t,{id:r,label:r,shape:"rounded"});else if(t.length>0){let n=t[t.length-1];n.nodeIds.includes(r)||n.nodeIds.push(r);}}function nn(e){let t={};for(let r of e.split(",")){let n=r.indexOf(":");if(n>0){let o=r.slice(0,n).trim(),i=r.slice(n+1).trim();o&&i&&(t[o]=i);}}return t}var Br=/^(<)?(-->|-.->|==>|---|-\.-|===)(?:\|([^|]*)\|)?/,Gr=[{regex:/^([\p{L}\p{N}_-]+)\(\(\((.+?)\)\)\)/u,shape:"doublecircle"},{regex:/^([\p{L}\p{N}_-]+)\(\[(.+?)\]\)/u,shape:"stadium"},{regex:/^([\p{L}\p{N}_-]+)\(\((.+?)\)\)/u,shape:"circle"},{regex:/^([\p{L}\p{N}_-]+)\[\[(.+?)\]\]/u,shape:"subroutine"},{regex:/^([\p{L}\p{N}_-]+)\[\((.+?)\)\]/u,shape:"cylinder"},{regex:/^([\p{L}\p{N}_-]+)\[\/(.+?)\\\]/u,shape:"trapezoid"},{regex:/^([\p{L}\p{N}_-]+)\[\\(.+?)\/\]/u,shape:"trapezoid-alt"},{regex:/^([\p{L}\p{N}_-]+)>(.+?)\]/u,shape:"asymmetric"},{regex:/^([\p{L}\p{N}_-]+)\{\{(.+?)\}\}/u,shape:"hexagon"},{regex:/^([\p{L}\p{N}_-]+)\[(.+?)\]/u,shape:"rectangle"},{regex:/^([\p{L}\p{N}_-]+)\((.+?)\)/u,shape:"rounded"},{regex:/^([\p{L}\p{N}_-]+)\{(.+?)\}/u,shape:"diamond"}],Fr=/^([\p{L}\p{N}_-]+)/u,Xr=/^:::([\w][\w-]*)/;function Wr(e){let t=e.trim();return t.length>=2&&t.startsWith('"')&&t.endsWith('"')?t.slice(1,-1).replaceAll('\\"','"'):e}function Yr(e,t,r){let n=e.trim(),o=rn(n,t,r);if(!o||o.ids.length===0)return;n=o.remaining.trim();let i=o.ids;for(;n.length>0;){let c=n.match(Br);if(!c)break;let s=!!c[1],l=c[2],f=c[3]?.trim()||void 0;n=n.slice(c[0].length).trim();let u=Hr(l),h=l.endsWith(">"),a=rn(n,t,r);if(!a||a.ids.length===0)break;n=a.remaining.trim();for(let d of i)for(let p of a.ids)t.edges.push({source:d,target:p,label:f,style:u,hasArrowStart:s,hasArrowEnd:h});i=a.ids;}}function rn(e,t,r){let n=on(e,t,r);if(!n)return null;let o=[n.id],i=n.remaining.trim();for(;i.startsWith("&");){i=i.slice(1).trim();let c=on(i,t,r);if(!c)break;o.push(c.id),i=c.remaining.trim();}return {ids:o,remaining:i}}function on(e,t,r){let n=null,o=e;for(let{regex:c,shape:s}of Gr){let l=e.match(c);if(l){n=l[1];let f=Wr(l[2]);sn(t,r,{id:n,label:f,shape:s}),o=e.slice(l[0].length);break}}if(n===null){let c=e.match(Fr);c&&(n=c[1],t.nodes.has(n)?an(r,n):sn(t,r,{id:n,label:n,shape:"rectangle"}),o=e.slice(c[0].length));}if(n===null)return null;let i=o.match(Xr);return i&&(t.classAssignments.set(n,i[1]),o=o.slice(i[0].length)),{id:n,remaining:o}}function sn(e,t,r){!e.nodes.has(r.id)&&e.nodes.set(r.id,r),an(t,r.id);}function an(e,t){if(e.length>0){let r=e[e.length-1];r.nodeIds.includes(t)||r.nodeIds.push(t);}}function Hr(e){return e==="-.->"||e==="-.-"?"dotted":e==="==>"||e==="==="?"thick":"solid"}var oe={x:1,y:0},Q={x:1,y:2},ie={x:0,y:1},ee={x:2,y:1},ve={x:2,y:0},be={x:0,y:0},ke={x:2,y:2},Ce={x:0,y:2},We={x:1,y:1};function Re(e,t){return e.x===t.x&&e.y===t.y}function $t(e,t){return e.x===t.x&&e.y===t.y}function Ne(e,t){return {x:e.x+t.x,y:e.y+t.y}}function kt(e){return `${e.x},${e.y}`}var cn={name:"",styles:{}};function jr(e){return e>=768&&e<=879||e>=6832&&e<=6911||e>=7616&&e<=7679||e>=8400&&e<=8447||e>=65056&&e<=65071}function zr(e){return e>=4352&&e<=4447||e>=11904&&e<=42191||e>=44032&&e<=55203||e>=63744&&e<=64255||e>=65040&&e<=65049||e>=65072&&e<=65135||e>=65280&&e<=65376||e>=65504&&e<=65510||e>=127744&&e<=129791||e>=129280&&e<=129535}function Ye(e){let t=e.codePointAt(0);return t==null||t===0||t<32||t>=127&&t<160||jr(t)?0:zr(t)?2:1}function ae(e){let t=0;for(let r of e)t+=Ye(r);return t}function et(e,t){if(t<=0)return "";let r=0,n="";for(let o of e){let i=Ye(o);if(r+i>t)break;n+=o,r+=i;}return n}function de(e,t){let r=[];for(let n=0;n<=e;n++){let o=[];for(let i=0;i<=t;i++)o.push(" ");r.push(o);}return r}function Oe(e){let[t,r]=me(e);return de(t,r)}function me(e){return [e.length-1,(e[0]?.length??1)-1]}function He(e,t,r){let[n,o]=me(e),i=Math.max(t,n),c=Math.max(r,o),s=de(i,c);for(let l=0;l<s.length;l++)for(let f=0;f<s[0].length;f++)l<e.length&&f<e[0].length&&(s[l][f]=e[l][f]);return e.length=0,e.push(...s),e}var Ur=new Set(["\u2500","\u2502","\u250C","\u2510","\u2514","\u2518","\u251C","\u2524","\u252C","\u2534","\u253C","\u2574","\u2575","\u2576","\u2577"]);function ln(e){return Ur.has(e)}var Vr={"\u2500":{"\u2502":"\u253C","\u250C":"\u252C","\u2510":"\u252C","\u2514":"\u2534","\u2518":"\u2534","\u251C":"\u253C","\u2524":"\u253C","\u252C":"\u252C","\u2534":"\u2534"},"\u2502":{"\u2500":"\u253C","\u250C":"\u251C","\u2510":"\u2524","\u2514":"\u251C","\u2518":"\u2524","\u251C":"\u251C","\u2524":"\u2524","\u252C":"\u253C","\u2534":"\u253C"},"\u250C":{"\u2500":"\u252C","\u2502":"\u251C","\u2510":"\u252C","\u2514":"\u251C","\u2518":"\u253C","\u251C":"\u251C","\u2524":"\u253C","\u252C":"\u252C","\u2534":"\u253C"},"\u2510":{"\u2500":"\u252C","\u2502":"\u2524","\u250C":"\u252C","\u2514":"\u253C","\u2518":"\u2524","\u251C":"\u253C","\u2524":"\u2524","\u252C":"\u252C","\u2534":"\u253C"},"\u2514":{"\u2500":"\u2534","\u2502":"\u251C","\u250C":"\u251C","\u2510":"\u253C","\u2518":"\u2534","\u251C":"\u251C","\u2524":"\u253C","\u252C":"\u253C","\u2534":"\u2534"},"\u2518":{"\u2500":"\u2534","\u2502":"\u2524","\u250C":"\u253C","\u2510":"\u2524","\u2514":"\u2534","\u251C":"\u253C","\u2524":"\u2524","\u252C":"\u253C","\u2534":"\u2534"},"\u251C":{"\u2500":"\u253C","\u2502":"\u251C","\u250C":"\u251C","\u2510":"\u253C","\u2514":"\u251C","\u2518":"\u253C","\u2524":"\u253C","\u252C":"\u253C","\u2534":"\u253C"},"\u2524":{"\u2500":"\u253C","\u2502":"\u2524","\u250C":"\u253C","\u2510":"\u2524","\u2514":"\u253C","\u2518":"\u2524","\u251C":"\u253C","\u252C":"\u253C","\u2534":"\u253C"},"\u252C":{"\u2500":"\u252C","\u2502":"\u253C","\u250C":"\u252C","\u2510":"\u252C","\u2514":"\u253C","\u2518":"\u253C","\u251C":"\u253C","\u2524":"\u253C","\u2534":"\u253C"},"\u2534":{"\u2500":"\u2534","\u2502":"\u253C","\u250C":"\u253C","\u2510":"\u253C","\u2514":"\u2534","\u2518":"\u2534","\u251C":"\u253C","\u2524":"\u253C","\u252C":"\u253C"}};function qr(e,t){return Vr[e]?.[t]??e}function Me(e,t,r,...n){let[o,i]=me(e);for(let s of n){let[l,f]=me(s);o=Math.max(o,l+t.x),i=Math.max(i,f+t.y);}let c=de(o,i);for(let s=0;s<=o;s++)for(let l=0;l<=i;l++)s<e.length&&l<e[0].length&&(c[s][l]=e[s][l]);for(let s of n)for(let l=0;l<s.length;l++)for(let f=0;f<s[0].length;f++){let u=s[l][f];if(u!==" "){let h=l+t.x,a=f+t.y,d=c[h][a];!r&&ln(u)&&ln(d)?c[h][a]=qr(d,u):c[h][a]=u;}}return c}function Kr(e){return e==="\u2500"||e==="\u253C"||e==="\u252C"||e==="\u2534"||e==="\u2524"||e==="\u2510"||e==="\u2518"}function Jr(e){return e==="\u2500"||e==="\u253C"||e==="\u252C"||e==="\u2534"||e==="\u251C"||e==="\u250C"||e==="\u2514"}function Zr(e){return e==="\u2502"||e==="\u253C"||e==="\u251C"||e==="\u2524"||e==="\u2534"||e==="\u2514"||e==="\u2518"}function Qr(e){return e==="\u2502"||e==="\u253C"||e==="\u251C"||e==="\u2524"||e==="\u252C"||e==="\u250C"||e==="\u2510"}function dn(e){let[t,r]=me(e);for(let n=0;n<=t;n++)for(let o=0;o<=r;o++){if(e[n][o]!=="\u253C")continue;let i=n>0?e[n-1][o]:" ",c=n<t?e[n+1][o]:" ",s=o>0?e[n][o-1]:" ",l=o<r?e[n][o+1]:" ",f=(Jr(i)?1:0)+(Kr(c)?1:0),u=(Qr(s)?1:0)+(Zr(l)?1:0);e[n][o]=u>f?"\u2502":"\u2500";}}function Ee(e){let[t,r]=me(e),n=[];for(let o=0;o<=r;o++){let i="";for(let c=0;c<=t;c++){let s=e[c][o];i+=s,Ye(s)===2&&(c+=1);}n.push(i);}return n.join(`
`)}var eo={"\u25B2":"\u25BC","\u25BC":"\u25B2","\u25E4":"\u25E3","\u25E3":"\u25E4","\u25E5":"\u25E2","\u25E2":"\u25E5","^":"v",v:"^","\u250C":"\u2514","\u2514":"\u250C","\u2510":"\u2518","\u2518":"\u2510","\u252C":"\u2534","\u2534":"\u252C","\u2575":"\u2577","\u2577":"\u2575"};function un(e){for(let t of e)t.reverse();for(let t of e)for(let r=0;r<t.length;r++){let n=eo[t[r]];n&&(t[r]=n);}return e}function fe(e,t,r){He(e,t.x+ae(r),t.y);let n=t.x;for(let o of r)e[n][t.y]=o,n+=Ye(o);}function fn(e,t,r){let n=0,o=0;for(let i of t.values())n+=i;for(let i of r.values())o+=i;He(e,n-1,o-1);}function hn(e,t){let r=new Map,n=0;for(let[s,l]of e.nodes){let f={name:s,displayLabel:l.label,index:n,gridCoord:null,drawingCoord:null,drawing:null,drawn:false,styleClassName:"",styleClass:cn};r.set(s,f),n++;}let o=[...r.values()],i=[];for(let s of e.edges){let l=r.get(s.source),f=r.get(s.target);!l||!f||i.push({from:l,to:f,text:s.label??"",path:[],labelLine:[],startDir:{x:0,y:0},endDir:{x:0,y:0}});}let c=[];for(let s of e.subgraphs)pn(s,null,r,c);to(e.subgraphs,c,r);for(let[s,l]of e.classAssignments){let f=r.get(s),u=e.classDefs.get(l);f&&u&&(f.styleClassName=l,f.styleClass={name:l,styles:u});}return {nodes:o,edges:i,canvas:de(0,0),grid:new Map,columnWidth:new Map,rowHeight:new Map,subgraphs:c,config:t,offsetX:0,offsetY:0}}function pn(e,t,r,n){let o={name:e.label,nodes:[],parent:t,children:[],minX:0,minY:0,maxX:0,maxY:0};for(let i of e.nodeIds){let c=r.get(i);c&&o.nodes.push(c);}n.push(o);for(let i of e.children){let c=pn(i,o,r,n);o.children.push(c);for(let s of c.nodes)o.nodes.includes(s)||o.nodes.push(s);}return o}function to(e,t,r,n){let o=new Map;ro(e,t,o);let i=new Map;function c(s){let l=o.get(s);if(l){for(let f of s.children)c(f);for(let f of s.nodeIds)i.has(f)||i.set(f,l);}}for(let s of e)c(s);for(let s of t)s.nodes=s.nodes.filter(l=>{let f;for(let[h,a]of r)if(a===l){f=h;break}if(!f)return  false;let u=i.get(f);return u?no(s,u):true});}function no(e,t){let r=t;for(;r!==null;){if(r===e)return  true;r=r.parent;}return  false}function ro(e,t,r){let n=[];function o(i){for(let c of i)n.push(c),o(c.children);}o(e);for(let i=0;i<n.length&&i<t.length;i++)r.set(n[i],t[i]);}var Lt=class{idxs=[];priorities=[];costs=[];poppedIdx=-1;poppedPriority=0;poppedCost=0;get length(){return this.idxs.length}clear(){this.idxs.length=0,this.priorities.length=0,this.costs.length=0,this.poppedIdx=-1,this.poppedPriority=0,this.poppedCost=0;}push(t,r,n){this.idxs.push(t),this.priorities.push(r),this.costs.push(n),this.bubbleUp(this.idxs.length-1);}pop(){if(this.idxs.length===0)return  false;this.poppedIdx=this.idxs[0],this.poppedPriority=this.priorities[0],this.poppedCost=this.costs[0];let t=this.idxs.pop(),r=this.priorities.pop(),n=this.costs.pop();return this.idxs.length>0&&(this.idxs[0]=t,this.priorities[0]=r,this.costs[0]=n,this.sinkDown(0)),true}bubbleUp(t){for(;t>0;){let r=t-1>>1;if(this.priorities[t]<this.priorities[r])[this.idxs[t],this.idxs[r]]=[this.idxs[r],this.idxs[t]],[this.priorities[t],this.priorities[r]]=[this.priorities[r],this.priorities[t]],[this.costs[t],this.costs[r]]=[this.costs[r],this.costs[t]],t=r;else break}}sinkDown(t){let r=this.idxs.length;for(;;){let n=t,o=2*t+1,i=2*t+2;if(o<r&&this.priorities[o]<this.priorities[n]&&(n=o),i<r&&this.priorities[i]<this.priorities[n]&&(n=i),n!==t)[this.idxs[t],this.idxs[n]]=[this.idxs[n],this.idxs[t]],[this.priorities[t],this.priorities[n]]=[this.priorities[n],this.priorities[t]],[this.costs[t],this.costs[n]]=[this.costs[n],this.costs[t]],t=n;else break}}};function mn(e,t){let r=e*t;return {stride:e,height:t,blocked:new Uint8Array(r),stamp:0,costStamp:new Uint32Array(r),costSoFar:new Float64Array(r),cameFrom:new Int32Array(r),heap:new Lt}}function Ae(e,t){return t.x+t.y*e}function gn(e,t){let r=t/e|0;return {x:t-r*e,y:r}}function st(e,t){if(e.length<=2)return e.length;let r=0,n=e[1]-e[0];for(let o=2;o<e.length;o++){let i=e[o]-e[o-1];i!==n&&(r++,n=i);}return 2+r}function xn(e,t){if(e.length<=2)return e;let r=[e[0]],n=e[1]-e[0];for(let o=2;o<e.length;o++){let i=e[o]-e[o-1];i!==n&&(r.push(e[o-1]),n=i);}return r.push(e[e.length-1]),r}function bn(e,t,r,n){let o=globalThis.__bm_getPath;if(typeof o=="function")return o(e.stride,t,r,n.maxX,n.maxY,e.blocked);let{stride:i}=e,c=n.maxX,s=n.maxY;if(c<0||s<0)return null;let l=r/i|0,f=r-l*i;e.stamp=e.stamp+1>>>0,e.stamp===0&&(e.stamp=1);let u=e.stamp;for(e.heap.clear(),e.costStamp[t]=u,e.costSoFar[t]=0,e.cameFrom[t]=-1,e.heap.push(t,0,0);e.heap.pop();){let h=e.heap.poppedIdx,a=e.heap.poppedCost;if(e.costStamp[h]!==u||a!==e.costSoFar[h])continue;if(h===r){let g=[],m=h;for(;m!==-1;)g.push(m),m=e.cameFrom[m];return g.reverse(),g}let d=e.costSoFar[h],p=h/i|0,x=h-p*i;if(x<c){let g=h+1;if(!e.blocked[g]||g===r){let m=d+1;if(e.costStamp[g]!==u||m<e.costSoFar[g]){e.costStamp[g]=u,e.costSoFar[g]=m,e.cameFrom[g]=h;let y=x+1>=f?x+1-f:f-(x+1),b=p>=l?p-l:l-p,_=y===0||b===0?y+b:y+b+1;e.heap.push(g,m+_,m);}}}if(x>0){let g=h-1;if(!e.blocked[g]||g===r){let m=d+1;if(e.costStamp[g]!==u||m<e.costSoFar[g]){e.costStamp[g]=u,e.costSoFar[g]=m,e.cameFrom[g]=h;let y=x-1>=f?x-1-f:f-(x-1),b=p>=l?p-l:l-p,_=y===0||b===0?y+b:y+b+1;e.heap.push(g,m+_,m);}}}if(p<s){let g=h+i;if(!e.blocked[g]||g===r){let m=d+1;if(e.costStamp[g]!==u||m<e.costSoFar[g]){e.costStamp[g]=u,e.costSoFar[g]=m,e.cameFrom[g]=h;let y=x>=f?x-f:f-x,b=p+1>=l?p+1-l:l-(p+1),_=y===0||b===0?y+b:y+b+1;e.heap.push(g,m+_,m);}}}if(p>0){let g=h-i;if(!e.blocked[g]||g===r){let m=d+1;if(e.costStamp[g]!==u||m<e.costSoFar[g]){e.costStamp[g]=u,e.costSoFar[g]=m,e.cameFrom[g]=h;let y=x>=f?x-f:f-x,b=p-1>=l?p-1-l:l-(p-1),_=y===0||b===0?y+b:y+b+1;e.heap.push(g,m+_,m);}}}}return null}var Mt=1,Et=2,At=4,_t=8;function yn(e,t,r,n,o){let i=globalThis.__bm_getPathStrict;if(typeof i=="function")return i(e.stride,t,r,n.maxX,n.maxY,e.blocked,o);let c=e.stride,s=n.maxX,l=n.maxY;if(s<0||l<0)return null;let f=r/c|0,u=r-f*c;e.stamp=e.stamp+1>>>0,e.stamp===0&&(e.stamp=1);let h=e.stamp,a=e.heap,d=e.blocked,p=e.costStamp,x=e.costSoFar,g=e.cameFrom;a.clear(),p[t]=h,x[t]=0,g[t]=-1,a.push(t,0,0);let m=o.usedPoints,y=o.segmentUsage,b=y.segmentUsed,_=y.usedAsMiddle,P=y.startSource,w=y.startSourceMulti,E=y.endTarget,k=y.endTargetMulti,T=o.routeFromIdx,R=o.routeToIdx,N=o.edgeFromId,O=o.edgeToId,j=Mt|Et,M=At|_t;for(;a.pop();){let C=a.poppedIdx,S=a.poppedCost;if(p[C]!==h||S!==x[C])continue;if(C===r){let F=[],A=C;for(;A!==-1;)F.push(A),A=g[A];return F.reverse(),F}let L=x[C],v=C/c|0,B=C-v*c;if(B<s){let F=C+1;if(!d[F]||F===r){let A=true;if(m){let I=m[C];if(I!==0){let X=I|Et;(X&j)===j&&(X&M)===M&&(A=false);}if(A){let X=m[F];if(X!==0){let W=X|Mt;(W&j)===j&&(W&M)===M&&(A=false);}}}if(A){let I=C*2;if(b[I]&&(A=false,!_[I])){let X=C===T,W=F===R,H=P[I],V=E[I],z=w[I]!==0,q=k[I]!==0;X&&W?A=!z&&(H===0||H===N)&&(!q&&(V===0||V===O)):X?A=!q&&V===0&&!z&&H===N:W&&(A=!z&&H===0&&!q&&V===O);}}if(A){let I=L+1;if(p[F]!==h||I<x[F]){p[F]=h,x[F]=I,g[F]=C;let X=B+1,W=X>=u?X-u:u-X,H=v>=f?v-f:f-v,V=W===0||H===0?W+H:W+H+1;a.push(F,I+V,I);}}}}if(B>0){let F=C-1;if(!d[F]||F===r){let A=true;if(m){let I=m[C];if(I!==0){let X=I|Mt;(X&j)===j&&(X&M)===M&&(A=false);}if(A){let X=m[F];if(X!==0){let W=X|Et;(W&j)===j&&(W&M)===M&&(A=false);}}}if(A){let I=F*2;if(b[I]&&(A=false,!_[I])){let X=C===T,W=F===R,H=P[I],V=E[I],z=w[I]!==0,q=k[I]!==0;X&&W?A=!z&&(H===0||H===N)&&(!q&&(V===0||V===O)):X?A=!q&&V===0&&!z&&H===N:W&&(A=!z&&H===0&&!q&&V===O);}}if(A){let I=L+1;if(p[F]!==h||I<x[F]){p[F]=h,x[F]=I,g[F]=C;let X=B-1,W=X>=u?X-u:u-X,H=v>=f?v-f:f-v,V=W===0||H===0?W+H:W+H+1;a.push(F,I+V,I);}}}}if(v<l){let F=C+c;if(!d[F]||F===r){let A=true;if(m){let I=m[C];if(I!==0){let X=I|_t;(X&j)===j&&(X&M)===M&&(A=false);}if(A){let X=m[F];if(X!==0){let W=X|At;(W&j)===j&&(W&M)===M&&(A=false);}}}if(A){let I=C*2+1;if(b[I]&&(A=false,!_[I])){let X=C===T,W=F===R,H=P[I],V=E[I],z=w[I]!==0,q=k[I]!==0;X&&W?A=!z&&(H===0||H===N)&&(!q&&(V===0||V===O)):X?A=!q&&V===0&&!z&&H===N:W&&(A=!z&&H===0&&!q&&V===O);}}if(A){let I=L+1;if(p[F]!==h||I<x[F]){p[F]=h,x[F]=I,g[F]=C;let X=v+1,W=B>=u?B-u:u-B,H=X>=f?X-f:f-X,V=W===0||H===0?W+H:W+H+1;a.push(F,I+V,I);}}}}if(v>0){let F=C-c;if(!d[F]||F===r){let A=true;if(m){let I=m[C];if(I!==0){let X=I|At;(X&j)===j&&(X&M)===M&&(A=false);}if(A){let X=m[F];if(X!==0){let W=X|_t;(W&j)===j&&(W&M)===M&&(A=false);}}}if(A){let I=F*2+1;if(b[I]&&(A=false,!_[I])){let X=C===T,W=F===R,H=P[I],V=E[I],z=w[I]!==0,q=k[I]!==0;X&&W?A=!z&&(H===0||H===N)&&(!q&&(V===0||V===O)):X?A=!q&&V===0&&!z&&H===N:W&&(A=!z&&H===0&&!q&&V===O);}}if(A){let I=L+1;if(p[F]!==h||I<x[F]){p[F]=h,x[F]=I,g[F]=C;let X=v-1,W=B>=u?B-u:u-B,H=X>=f?X-f:f-X,V=W===0||H===0?W+H:W+H+1;a.push(F,I+V,I);}}}}}return null}function Tt(e){if(e.length<=2)return e;let t=new Set,r=e[0],n=e[1];for(let o=2;o<e.length;o++){let i=e[o],c=n.x-r.x,s=n.y-r.y,l=i.x-n.x,f=i.y-n.y;c===l&&s===f&&t.add(o-1),r=n,n=i;}return e.filter((o,i)=>!t.has(i))}var at=[12,24,48],je=[12,24,48,96,192,384],Nt=je[je.length-1];function ct(e){return e===oe?Q:e===Q?oe:e===ie?ee:e===ee?ie:e===ve?Ce:e===be?ke:e===ke?be:e===Ce?ve:We}function U(e,t){return e.x===t.x&&e.y===t.y}function ye(e,t){return e.x===t.x?e.y<t.y?Q:oe:e.y===t.y?e.x<t.x?ee:ie:e.x<t.x?e.y<t.y?ke:ve:e.y<t.y?Ce:be}function oo(e){return e==="LR"?[ee,Q,Q,ee]:[Q,ee,ee,Q]}function io(e,t){if(e.from===e.to)return oo(t);let r=ye(e.from.gridCoord,e.to.gridCoord),n,o,i,c,s=t==="LR"?U(r,ie)||U(r,be)||U(r,Ce):U(r,oe)||U(r,be)||U(r,ve);return U(r,ke)?t==="LR"?(n=Q,o=ie,i=ee,c=oe):(n=ee,o=oe,i=Q,c=ie):U(r,ve)?t==="LR"?(n=oe,o=ie,i=ee,c=Q):(n=ee,o=Q,i=oe,c=ie):U(r,Ce)?t==="LR"?(n=Q,o=Q,i=ie,c=oe):(n=ie,o=oe,i=Q,c=ee):U(r,be)?t==="LR"?(n=Q,o=Q,i=ie,c=Q):(n=ee,o=ee,i=oe,c=ee):s?t==="LR"&&U(r,ie)?(n=Q,o=Q,i=ie,c=ee):t==="TD"&&U(r,oe)?(n=ee,o=ee,i=oe,c=Q):(n=r,o=ct(r),i=r,c=ct(r)):(n=r,o=ct(r),i=r,c=ct(r)),[n,o,i,c]}function $n(e){let t=e*2;return {segmentUsed:new Uint8Array(t),usedAsMiddle:new Uint8Array(t),startSource:new Uint32Array(t),startSourceMulti:new Uint8Array(t),endTarget:new Uint32Array(t),endTargetMulti:new Uint8Array(t),usedCount:0}}var It=1,Dt=2,Pt=4,Rt=8;function kn(e,t){let r=t-e,n=r===1||r===-1;return (e<t?e:t)*2+(n?0:1)}function wn(e,t,r){if(r.length<2)return;let n=t.from.index+1,o=t.to.index+1;for(let i=1;i<r.length;i++){let c=r[i-1],s=r[i],l=kn(c,s),f=i===1,u=i===r.length-1;if(e.segmentUsed[l]||(e.segmentUsed[l]=1,e.usedCount++),f){let h=e.startSource[l];h===0?e.startSource[l]=n:h!==n&&(e.startSourceMulti[l]=1);}if(u){let h=e.endTarget[l];h===0?e.endTarget[l]=o:h!==o&&(e.endTargetMulti[l]=1);}!f&&!u&&(e.usedAsMiddle[l]=1);}}function Mn(e,t,r){let n=t-e;return n===1?{fromBit:Dt,toBit:It}:n===-1?{fromBit:It,toBit:Dt}:n===r?{fromBit:Rt,toBit:Pt}:n===-r?{fromBit:Pt,toBit:Rt}:null}function vn(e,t,r){if(r.length<2)return;let n=t.stride;for(let o=1;o<r.length;o++){let i=r[o-1],c=r[o],s=Mn(i,c,n);s&&(t.blocked[i]||(e[i]=e[i]|s.fromBit),t.blocked[c]||(e[c]=e[c]|s.toBit));}}function Cn(e,t){let r=e|t,n=(r&It)!==0&&(r&Dt)!==0,o=(r&Pt)!==0&&(r&Rt)!==0;return n&&o}function so(e,t,r,n){if(!t)return  true;let o=Mn(r,n,e.stride);if(!o)return  true;if(!e.blocked[r]){let i=t[r];if(i!==0&&Cn(i,o.fromBit))return  false}if(!e.blocked[n]){let i=t[n];if(i!==0&&Cn(i,o.toBit))return  false}return  true}function ao(e,t,r,n,o,i,c,s){if(e.usedAsMiddle[s])return  false;let l=i===n,f=c===o,u=e.startSource[s],h=e.endTarget[s],a=e.startSourceMulti[s]!==0,d=e.endTargetMulti[s]!==0;return l&&f?!a&&(u===0||u===t)&&(!d&&(h===0||h===r)):l?!d&&h===0&&!a&&u===t:f?!a&&u===0&&!d&&h===r:false}function En(e,t,r,n,o,i,c){let s=t.from===t.to,[l,f,u,h]=io(t,e.config.graphDirection);function a(C){let S=[];for(let L of C)S.some(v=>U(v,L))||S.push(L);return S}function d(C,S){let L=[];for(let v of C)for(let B of S){let F=Ne(t.from.gridCoord,v),A=Ne(t.to.gridCoord,B);Re(F,A)||L.push({startDir:v,endDir:B,routeFrom:F,routeTo:A,routeFromIdx:Ae(r.stride,F),routeToIdx:Ae(r.stride,A)});}return L}function p(C){return U(C,oe)||U(C,Q)||U(C,ie)||U(C,ee)?0:100}function x(C){return C.x===0||C.y===0?200:0}function g(C,S){return st(S,r.stride)+p(C.startDir)+p(C.endDir)+x(C.routeFrom)+x(C.routeTo)}let m=[];{let C=Ne(t.from.gridCoord,l),S=Ne(t.to.gridCoord,f);Re(C,S)||m.push({startDir:l,endDir:f,routeFrom:C,routeTo:S,routeFromIdx:Ae(r.stride,C),routeToIdx:Ae(r.stride,S)});}if(!U(l,u)||!U(f,h)){let C=Ne(t.from.gridCoord,u),S=Ne(t.to.gridCoord,h);Re(C,S)||m.push({startDir:u,endDir:h,routeFrom:C,routeTo:S,routeFromIdx:Ae(r.stride,C),routeToIdx:Ae(r.stride,S)});}function y(C){return U(C,oe)?{x:0,y:-1}:U(C,Q)?{x:0,y:1}:U(C,ie)?{x:-1,y:0}:U(C,ee)?{x:1,y:0}:null}function b(C,S){let L=C[C.length-1];if(L.x===S.x){let v=S.y>L.y?1:-1;for(let B=L.y+v;B!==S.y+v;B+=v)C.push({x:L.x,y:B});return}if(L.y===S.y){let v=S.x>L.x?1:-1;for(let B=L.x+v;B!==S.x+v;B+=v)C.push({x:B,y:L.y});return}throw new Error(`appendStraightLine expects straight line, got from=(${L.x},${L.y}) to=(${S.x},${S.y})`)}function _(C,S){if(S.length<4)return  false;let L=[];for(let v=0;v<S.length;v++){let B=S[v];if(B.x<0||B.y<0||B.x>=r.stride||B.y>=r.height||(L.push(Ae(r.stride,B)),!(Re(B,C.routeFrom)||Re(B,C.routeTo))&&r.blocked[L[L.length-1]]))return  false}for(let v=1;v<L.length;v++){let B=L[v-1],F=L[v];if(!so(r,c,B,F))return  false;if(i){let A=kn(B,F);if(i.segmentUsed[A]&&!ao(i,t.from.index+1,t.to.index+1,C.routeFromIdx,C.routeToIdx,B,F,A))return  false}}return  true}function P(C,S){let L=y(C.startDir),v=y(C.endDir);if(!L||!v||S<1)return null;let B={x:C.routeFrom.x+L.x*S,y:C.routeFrom.y+L.y*S},F={x:C.routeTo.x+v.x*S,y:C.routeTo.y+v.y*S},A=[{x:B.x,y:F.y},{x:F.x,y:B.y}];for(let I of A){let X=[C.routeFrom];b(X,B),b(X,I),b(X,F),b(X,C.routeTo);let W=X.filter((H,V)=>V===0||!Re(H,X[V-1]));if(_(C,W)&&Tt(W).length>=4)return W}return null}if(s){let C=m.length>0?m:T;for(let S of C)for(let L=1;L<=12;L++){let v=P(S,L);if(!v)continue;t.startDir=S.startDir,t.endDir=S.endDir,t.path=Tt(v);let B=v.map(F=>Ae(r.stride,F));i&&wn(i,t,B),c&&vn(c,r,B);return}}let w=a([f,h]),E=a([l,u,ee,ie,Q,oe]),k=a([f,h,ee,ie,Q,oe]),T=d(E,w),R=d(E,k);function N(C){return {maxX:Math.min(r.stride-1,n+C),maxY:Math.min(r.height-1,o+C)}}function O(C,S=je){for(let L of S){let v=N(L),B=null;for(let F of C){let A=bn(r,F.routeFromIdx,F.routeToIdx,v);if(!A||s&&st(A,r.stride)<4)continue;let I=g(F,A);(!B||I<B.cost)&&(B={candidate:F,pathIdx:A,cost:I});}if(B)return B}return null}function j(C,S){if(!i||i.usedCount===0)return null;let L={segmentUsage:i,usedPoints:c,routeFromIdx:0,routeToIdx:0,edgeFromId:t.from.index+1,edgeToId:t.to.index+1};for(let v of S){let B=N(v),F=null;for(let A of C){L.routeFromIdx=A.routeFromIdx,L.routeToIdx=A.routeToIdx;let I=yn(r,A.routeFromIdx,A.routeToIdx,B,L);if(!I||s&&st(I,r.stride)<4)continue;let X=g(A,I);(!F||X<F.cost)&&(F={candidate:A,pathIdx:I,cost:X});}if(F)return F}return null}let M=null;if(!i||i.usedCount===0?M=O(m,at):(M=j(m,at)??j(T,at)??j(R,at),M=M??j(m,je)??j(T,je),M=M??j(R,je)),!M){t.startDir=l,t.endDir=f,t.path=[];return}t.startDir=M.candidate.startDir,t.endDir=M.candidate.endDir,t.path=xn(M.pathIdx,r.stride).map(C=>gn(r.stride,C)),i&&wn(i,t,M.pathIdx),c&&vn(c,r,M.pathIdx);}function An(e,t){if(t.text.length===0||t.path.length<2)return;let r=ae(t.text),n=mo(e),o=ho(e),i=t.path[0],c=null,s=[i,t.path[1]],l=0,f=false,u=null,h=-1;for(let g=1;g<t.path.length;g++){let m=t.path[g],y=[i,m],b=co(e,y);f||(b>=r?(s=y,f=true):b>l&&(l=b,s=y));let _=_n(e,y,t.text),P=_?n.some(E=>po(E,_)):false,w=_?o.some(E=>fo(_,E)):false;if(!P&&!w&&(b>h&&(h=b,u=y),b>=r)){c=y;break}i=m;}c===null&&(c=u??s);let a=Math.min(c[0].x,c[1].x),d=Math.max(c[0].x,c[1].x),p=a+Math.floor((d-a)/2),x=e.columnWidth.get(p)??0;e.columnWidth.set(p,Math.max(x,r+2)),t.labelLine=[c[0],c[1]];}function co(e,t){let r=0,n=Math.min(t[0].x,t[1].x),o=Math.max(t[0].x,t[1].x);for(let i=n;i<=o;i++)r+=e.columnWidth.get(i)??0;return r}function Sn(e,t){let r=e.offsetX;for(let c=0;c<t.x;c++)r+=e.columnWidth.get(c)??0;let n=e.offsetY;for(let c=0;c<t.y;c++)n+=e.rowHeight.get(c)??0;let o=e.columnWidth.get(t.x)??0,i=e.rowHeight.get(t.y)??0;return {x:r+Math.floor(o/2),y:n+Math.floor(i/2)}}function lo(e,t){let r=e.offsetX;for(let o=0;o<t.x;o++)r+=e.columnWidth.get(o)??0;let n=e.offsetY;for(let o=0;o<t.y;o++)n+=e.rowHeight.get(o)??0;return {x:r,y:n}}function uo(e,t){if(!t.gridCoord)return null;let r=t.gridCoord,n=0;for(let c=0;c<2;c++)n+=e.columnWidth.get(r.x+c)??0;let o=0;for(let c=0;c<2;c++)o+=e.rowHeight.get(r.y+c)??0;let i=lo(e,r);return {minX:i.x,minY:i.y,maxX:i.x+n,maxY:i.y+o}}function fo(e,t){return e.y<t.minY||e.y>t.maxY?false:!(e.endX<t.minX||t.maxX<e.startX)}function ho(e){let t=[];for(let r of e.nodes){let n=uo(e,r);n&&t.push(n);}return t}function _n(e,t,r){let n=ae(r);if(n<=0)return null;let o=Sn(e,t[0]),i=Sn(e,t[1]),c=Math.min(o.x,i.x),s=Math.max(o.x,i.x),l=Math.min(o.y,i.y),f=Math.max(o.y,i.y),u=c+Math.floor((s-c)/2),h=l+Math.floor((f-l)/2),a=u-Math.floor(n/2);return {y:h,startX:a,endX:a+n-1}}function po(e,t){return e.y!==t.y?false:!(e.endX<t.startX||t.endX<e.startX)}function mo(e){let t=[];for(let r of e.edges){if(r.text.length===0||r.labelLine.length<2)continue;let n=_n(e,[r.labelLine[0],r.labelLine[1]],r.text);n&&t.push(n);}return t}function Ln(e,t){let r=e.gridCoord,n=t.config.useAscii,o=0;for(let d=0;d<2;d++)o+=t.columnWidth.get(r.x+d)??0;let i=0;for(let d=0;d<2;d++)i+=t.rowHeight.get(r.y+d)??0;let c={x:0,y:0},s={x:o,y:i},l=de(Math.max(c.x,s.x),Math.max(c.y,s.y));if(n){for(let d=c.x+1;d<s.x;d++)l[d][c.y]="-";for(let d=c.x+1;d<s.x;d++)l[d][s.y]="-";for(let d=c.y+1;d<s.y;d++)l[c.x][d]="|";for(let d=c.y+1;d<s.y;d++)l[s.x][d]="|";l[c.x][c.y]="+",l[s.x][c.y]="+",l[c.x][s.y]="+",l[s.x][s.y]="+";}else {for(let d=c.x+1;d<s.x;d++)l[d][c.y]="\u2500";for(let d=c.x+1;d<s.x;d++)l[d][s.y]="\u2500";for(let d=c.y+1;d<s.y;d++)l[c.x][d]="\u2502";for(let d=c.y+1;d<s.y;d++)l[s.x][d]="\u2502";l[c.x][c.y]="\u250C",l[s.x][c.y]="\u2510",l[c.x][s.y]="\u2514",l[s.x][s.y]="\u2518";}let f=e.displayLabel,u=c.y+Math.floor(i/2),h=ae(f),a=c.x+Math.floor(o/2)-Math.ceil(h/2)+1;return fe(l,{x:a,y:u},f),l}function lt(e,t,r=1){let n=0;for(let b of e)for(let _ of b)n=Math.max(n,ae(_));let i=n+2*r+2,c=0;for(let b of e)c+=Math.max(b.length,1);let s=e.length-1,l=c+s+2,f=t?"-":"\u2500",u=t?"|":"\u2502",h=t?"+":"\u250C",a=t?"+":"\u2510",d=t?"+":"\u2514",p=t?"+":"\u2518",x=t?"+":"\u251C",g=t?"+":"\u2524",m=de(i-1,l-1);m[0][0]=h;for(let b=1;b<i-1;b++)m[b][0]=f;m[i-1][0]=a,m[0][l-1]=d;for(let b=1;b<i-1;b++)m[b][l-1]=f;m[i-1][l-1]=p;for(let b=1;b<l-1;b++)m[0][b]=u,m[i-1][b]=u;let y=1;for(let b=0;b<e.length;b++){let _=e[b],P=_.length>0?_:[""];for(let w of P){let E=1+r;fe(m,{x:E,y},w),y++;}if(b<e.length-1){m[0][y]=x;for(let w=1;w<i-1;w++)m[w][y]=f;m[i-1][y]=g,y++;}}return m}function go(e,t,r,n,o,i){let c=ye(t,r),s=[],l=i?"-":"\u2500",f=i?"|":"\u2502",u=i?"\\":"\u2572",h=i?"/":"\u2571";if(U(c,oe))for(let a=t.y-n;a>=r.y-o;a--)s.push({x:t.x,y:a}),e[t.x][a]=f;else if(U(c,Q))for(let a=t.y+n;a<=r.y+o;a++)s.push({x:t.x,y:a}),e[t.x][a]=f;else if(U(c,ie))for(let a=t.x-n;a>=r.x-o;a--)s.push({x:a,y:t.y}),e[a][t.y]=l;else if(U(c,ee))for(let a=t.x+n;a<=r.x+o;a++)s.push({x:a,y:t.y}),e[a][t.y]=l;else if(U(c,be))for(let a=t.x,d=t.y-n;a>=r.x-o&&d>=r.y-o;a--,d--)s.push({x:a,y:d}),e[a][d]=u;else if(U(c,ve))for(let a=t.x,d=t.y-n;a<=r.x+o&&d>=r.y-o;a++,d--)s.push({x:a,y:d}),e[a][d]=h;else if(U(c,Ce))for(let a=t.x,d=t.y+n;a>=r.x-o&&d<=r.y+o;a--,d++)s.push({x:a,y:d}),e[a][d]=h;else if(U(c,ke))for(let a=t.x,d=t.y+n;a<=r.x+o&&d<=r.y+o;a++,d++)s.push({x:a,y:d}),e[a][d]=u;return s}function xo(e,t){if(t.path.length<2){let f=Oe(e.canvas);return [f,f,f,f,f]}let r=In(e,t),[n,o,i]=bo(e,t.path),c=yo(e,t.path,o[0]),s=wo(e,o[o.length-1],i[i.length-1]),l=vo(e,t.path);return [n,c,s,l,r]}function Tn(e,t){let r=[],n=new Set;function o(s){let l=`${s.x},${s.y}`;n.has(l)||(n.add(l),r.push(s));}if(t.path.length<2)return r;e.config.useAscii||o(ge(e,t.path[0]));let i=1,c=-1;for(let s=1;s<t.path.length;s++){let l=t.path[s-1],f=t.path[s],u=ge(e,l),h=ge(e,f);if($t(u,h))continue;let a=ye(l,f);if(U(a,oe))for(let d=u.y-i;d>=h.y-c;d--)o({x:u.x,y:d});else if(U(a,Q))for(let d=u.y+i;d<=h.y+c;d++)o({x:u.x,y:d});else if(U(a,ie))for(let d=u.x-i;d>=h.x-c;d--)o({x:d,y:u.y});else if(U(a,ee))for(let d=u.x+i;d<=h.x+c;d++)o({x:d,y:u.y});else if(U(a,be))for(let d=u.x,p=u.y-i;d>=h.x-c&&p>=h.y-c;d--,p--)o({x:d,y:p});else if(U(a,ve))for(let d=u.x,p=u.y-i;d<=h.x+c&&p>=h.y-c;d++,p--)o({x:d,y:p});else if(U(a,Ce))for(let d=u.x,p=u.y+i;d>=h.x-c&&p<=h.y+c;d--,p++)o({x:d,y:p});else if(U(a,ke))for(let d=u.x,p=u.y+i;d<=h.x+c&&p<=h.y+c;d++,p++)o({x:d,y:p});if(s<t.path.length-1){let d=ye(f,t.path[s+1]);!U(a,d)&&!U(a,We)&&!U(d,We)&&o(ge(e,f));}}{let s=t.path[t.path.length-1],l=t.path[t.path.length-2],f=ye(l,s),u=ge(e,s);U(f,oe)?o({x:u.x,y:u.y+1}):U(f,Q)?o({x:u.x,y:u.y-1}):U(f,ie)?o({x:u.x+1,y:u.y}):U(f,ee)&&o({x:u.x-1,y:u.y});}return r}function bo(e,t){let r=Oe(e.canvas),n=t[0],o=[],i=[];for(let c=1;c<t.length;c++){let s=t[c],l=ge(e,n),f=ge(e,s);if($t(l,f)){n=s;continue}let u=ye(n,s),h=go(r,l,f,1,-1,e.config.useAscii);h.length===0&&h.push(l),o.push(h),i.push(u),n=s;}return [r,o,i]}function yo(e,t,r){let n=Oe(e.canvas);if(e.config.useAscii)return n;let o=r[0],i=ye(t[0],t[1]);return U(i,oe)?n[o.x][o.y+1]="\u2534":U(i,Q)?n[o.x][o.y-1]="\u252C":U(i,ie)?n[o.x+1][o.y]="\u2524":U(i,ee)&&(n[o.x-1][o.y]="\u251C"),n}function wo(e,t,r){let n=Oe(e.canvas);if(t.length===0)return n;let o=t[0],i=t[t.length-1],c=ye(o,i);(t.length===1||U(c,We))&&(c=r);let s;return e.config.useAscii?U(c,oe)?s="^":U(c,Q)?s="v":U(c,ie)?s="<":U(c,ee)?s=">":U(r,oe)?s="^":U(r,Q)?s="v":U(r,ie)?s="<":U(r,ee)?s=">":s="*":U(c,oe)?s="\u25B2":U(c,Q)?s="\u25BC":U(c,ie)?s="\u25C4":U(c,ee)?s="\u25BA":U(c,ve)?s="\u25E5":U(c,be)?s="\u25E4":U(c,ke)?s="\u25E2":U(c,Ce)?s="\u25E3":U(r,oe)?s="\u25B2":U(r,Q)?s="\u25BC":U(r,ie)?s="\u25C4":U(r,ee)?s="\u25BA":U(r,ve)?s="\u25E5":U(r,be)?s="\u25E4":U(r,ke)?s="\u25E2":U(r,Ce)?s="\u25E3":s="\u25CF",n[i.x][i.y]=s,n}function vo(e,t){let r=Oe(e.canvas);for(let n=1;n<t.length-1;n++){let o=t[n],i=ge(e,o),c=ye(t[n-1],o),s=ye(o,t[n+1]),l;e.config.useAscii?l="+":U(c,ee)&&U(s,Q)||U(c,oe)&&U(s,ie)?l="\u2510":U(c,ee)&&U(s,oe)||U(c,Q)&&U(s,ie)?l="\u2518":U(c,ie)&&U(s,Q)||U(c,oe)&&U(s,ee)?l="\u250C":U(c,ie)&&U(s,oe)||U(c,Q)&&U(s,ee)?l="\u2514":l="+",r[i.x][i.y]=l;}return r}function In(e,t,r){let n=Oe(e.canvas);if(t.text.length===0)return n;let o=Pn(e,t.labelLine),i=[],c=Io(e,t);c&&i.push(c);let s=Do(e,t);return s&&i.push(s),To(n,o,t.text,i,r,e.config.useAscii),n}function Co(e){return e==="\u25B2"||e==="\u25BC"||e==="\u25C4"||e==="\u25BA"||e==="\u25E5"||e==="\u25E4"||e==="\u25E2"||e==="\u25E3"||e==="\u25CF"}function So(e){return e==="^"||e==="v"||e==="<"||e===">"||e==="*"}function $o(e){return e==="\u253C"||e==="\u252C"||e==="\u2534"||e==="\u251C"||e==="\u2524"||e==="\u250C"||e==="\u2510"||e==="\u2514"||e==="\u2518"||e==="\u2574"||e==="\u2575"||e==="\u2576"||e==="\u2577"}function ko(e){return e==="+"}function Ot(e,t){return t?e==="|"||e==="+":e==="\u2502"||e==="\u253C"||e==="\u252C"||e==="\u2534"||e==="\u251C"||e==="\u2524"||e==="\u250C"||e==="\u2510"||e==="\u2514"||e==="\u2518"||e==="\u2577"||e==="\u2575"}function Bt(e,t){return t?e==="-"||e==="+":e==="\u2500"||e==="\u253C"||e==="\u252C"||e==="\u2534"||e==="\u251C"||e==="\u2524"||e==="\u250C"||e==="\u2510"||e==="\u2514"||e==="\u2518"||e==="\u2574"||e==="\u2576"}function Mo(e,t,r,n){let[o,i]=me(e);if(t<0||r<0||t>o||r>i)return  false;let c=e[t][r],s=t>0?e[t-1][r]:" ",l=t<o?e[t+1][r]:" ",f=r>0?e[t][r-1]:" ",u=r<i?e[t][r+1]:" ",h=Ot(f,n)&&Ot(u,n),a=Bt(s,n)&&Bt(l,n);return !!((c===" "||Bt(c,n))&&h||(c===" "||Ot(c,n))&&a)}function Eo(e,t,r,n){let[o,i]=me(e);if(t<0||r<0||t>o||r>i)return  false;let c=e[t][r];if(n){if(So(c)||ko(c))return  true}else if(Co(c)||$o(c))return  true;return !!Mo(e,t,r,n)}function Ao(e,t,r,n){for(let o of n)if(o.y===e&&o.x>=t&&o.x<=r)return  true;return  false}function _o(e,t,r,n,o){for(let i=r;i<=n;i++)if(Eo(e,i,t,o))return  true;return  false}function Lo(e){let{desiredStartX:t,minStartX:r,maxStartX:n,isValid:o}=e;if(o(t))return t;let i=Math.max(0,n-r);for(let c=1;c<=i;c++){let s=t-c;if(s>=r&&o(s))return s;let l=t+c;if(l<=n&&o(l))return l}return t}function To(e,t,r,n=[],o,i=false){if(t.length<2)return;let c=Math.min(t[0].x,t[1].x),s=Math.max(t[0].x,t[1].x),l=Math.min(t[0].y,t[1].y),f=Math.max(t[0].y,t[1].y),u=c+Math.floor((s-c)/2),h=l+Math.floor((f-l)/2),a=ae(r),d=u-Math.floor(a/2);if(o){let[x]=me(o),g=0,m=Math.max(g,x-a+1),y=t[0].y===t[1].y,b=c,_=s-a+1,P=y&&_>=b?Math.max(g,b):g,w=y&&_>=b?Math.min(m,_):m;w>=P&&(d<P&&(d=P),d>w&&(d=w),d=Lo({desiredStartX:d,minStartX:P,maxStartX:w,isValid:E=>{let k=E+a-1;return !(Ao(h,E,k,n)||_o(o,h,E,k,i))}})),fe(e,{x:d,y:h},r);return}if(t[0].y===t[1].y){let x=c,g=s-a+1;if(g>=x){d<x&&(d=x),d>g&&(d=g);for(let m of n){if(m.y!==h)continue;let y=d+a-1;if(!(m.x>=d&&m.x<=y))continue;let _=m.x-a,P=m.x+1,w=[];_>=x&&_<=g&&w.push(_),P>=x&&P<=g&&w.push(P),w.length!==0&&(w.sort((E,k)=>Math.abs(E-d)-Math.abs(k-d)),d=w[0]);}}}fe(e,{x:d,y:h},r);}function Io(e,t){if(t.path.length<2)return null;let r=t.path[t.path.length-1],n=t.path[t.path.length-2],o=ye(n,r),i=ge(e,r);return U(o,oe)?{x:i.x,y:i.y+1}:U(o,Q)?{x:i.x,y:i.y-1}:U(o,ie)?{x:i.x+1,y:i.y}:U(o,ee)?{x:i.x-1,y:i.y}:null}function Do(e,t){return t.path.length<2?null:ge(e,t.path[0])}function Po(e,t){let r=e.maxX-e.minX,n=e.maxY-e.minY;if(r<=0||n<=0)return de(0,0);let o={x:0,y:0},i={x:r,y:n},c=de(r,n);if(t.config.useAscii){for(let s=o.x+1;s<i.x;s++)c[s][o.y]="-";for(let s=o.x+1;s<i.x;s++)c[s][i.y]="-";for(let s=o.y+1;s<i.y;s++)c[o.x][s]="|";for(let s=o.y+1;s<i.y;s++)c[i.x][s]="|";c[o.x][o.y]="+",c[i.x][o.y]="+",c[o.x][i.y]="+",c[i.x][i.y]="+";}else {for(let s=o.x+1;s<i.x;s++)c[s][o.y]="\u2500";for(let s=o.x+1;s<i.x;s++)c[s][i.y]="\u2500";for(let s=o.y+1;s<i.y;s++)c[o.x][s]="\u2502";for(let s=o.y+1;s<i.y;s++)c[i.x][s]="\u2502";c[o.x][o.y]="\u250C",c[i.x][o.y]="\u2510",c[o.x][i.y]="\u2514",c[i.x][i.y]="\u2518";}return c}function Ro(e,t){let r=e.maxX-e.minX,n=e.maxY-e.minY;if(r<=0||n<=0)return [de(0,0),{x:0,y:0}];let o=de(r,n),i=1,c=Math.floor(r/2)-Math.floor(ae(e.name)/2);return c<1&&(c=1),fe(o,{x:c,y:i},e.name),[o,{x:e.minX,y:e.minY}]}function No(e){function t(n){return n.parent===null?0:1+t(n.parent)}let r=[...e];return r.sort((n,o)=>t(n)-t(o)),r}function Dn(e){let t=e.config.useAscii,r=No(e.subgraphs);for(let u of r){let h=Po(u,e),a={x:u.minX,y:u.minY};e.canvas=Me(e.canvas,a,t,h);}for(let u of e.nodes)!u.drawn&&u.drawingCoord&&u.drawing&&(e.canvas=Me(e.canvas,u.drawingCoord,t,u.drawing),u.drawn=true);let n=[],o=[],i=[],c=[];for(let u of e.edges){let[h,a,d,p,x]=xo(e,u);n.push(h),o.push(p),i.push(d),c.push(a);}let s={x:0,y:0};e.canvas=Me(e.canvas,s,t,...n),e.canvas=Me(e.canvas,s,t,...o),e.canvas=Me(e.canvas,s,t,...i),e.canvas=Me(e.canvas,s,t,...c);let l=[],f=e.canvas;for(let u of e.edges)l.push(In(e,u,f));e.canvas=Me(e.canvas,s,t,...l);for(let u of e.subgraphs){if(u.nodes.length===0)continue;let[h,a]=Ro(u);e.canvas=Me(e.canvas,a,t,h);}return e.canvas}function ge(e,t,r){let n=t,o=0;for(let l=0;l<n.x;l++)o+=e.columnWidth.get(l)??0;let i=0;for(let l=0;l<n.y;l++)i+=e.rowHeight.get(l)??0;let c=e.columnWidth.get(n.x)??0,s=e.rowHeight.get(n.y)??0;return {x:o+Math.floor(c/2)+e.offsetX,y:i+Math.floor(s/2)+e.offsetY}}function Pn(e,t){return t.map(r=>ge(e,r))}function tt(e,t,r){if(e.grid.has(kt(r)))return e.config.graphDirection==="LR"?tt(e,t,{x:r.x,y:r.y+4}):tt(e,t,{x:r.x+4,y:r.y});for(let n=0;n<3;n++)for(let o=0;o<3;o++){let i={x:r.x+n,y:r.y+o};e.grid.set(kt(i),t);}return t.gridCoord=r,r}function Oo(e,t){let r=t.gridCoord,n=e.config.boxBorderPadding,o=[1,2*n+ae(t.displayLabel),1],i=[1,1+2*n,1];for(let c=0;c<o.length;c++){let s=r.x+c,l=e.columnWidth.get(s)??0;e.columnWidth.set(s,Math.max(l,o[c]));}for(let c=0;c<i.length;c++){let s=r.y+c,l=e.rowHeight.get(s)??0;e.rowHeight.set(s,Math.max(l,i[c]));}if(r.x>0){let c=e.columnWidth.get(r.x-1)??0;e.columnWidth.set(r.x-1,Math.max(c,e.config.paddingX));}if(r.y>0){let c=e.config.paddingY;Go(e,t)&&(c+=4);let s=e.rowHeight.get(r.y-1)??0;e.rowHeight.set(r.y-1,Math.max(s,c));}}function Bo(e,t){if(t.length===0)return;function r(o){e.columnWidth.has(o.x)||e.columnWidth.set(o.x,Math.floor(e.config.paddingX/2)),e.rowHeight.has(o.y)||e.rowHeight.set(o.y,Math.floor(e.config.paddingY/2));}let n=t[0];r(n);for(let o=1;o<t.length;o++){let i=t[o];if(n.x===i.x){let c=i.y>n.y?1:-1;for(let s=n.y;s!==i.y;s+=c)r({x:n.x,y:s}),r({x:n.x,y:s+c});}else if(n.y===i.y){let c=i.x>n.x?1:-1;for(let s=n.x;s!==i.x;s+=c)r({x:s,y:n.y}),r({x:s+c,y:n.y});}else r(i);n=i;}}function Gt(e,t){return e.subgraphs.some(r=>r.nodes.includes(t))}function Ft(e,t){for(let r of e.subgraphs)if(r.nodes.includes(t))return r;return null}function Go(e,t){let r=Ft(e,t);if(!r)return  false;let n=false;for(let o of e.edges)if(o.to===t&&Ft(e,o.from)!==r){n=true;break}if(!n)return  false;for(let o of r.nodes){if(o===t||!o.gridCoord)continue;let i=false;for(let c of e.edges)if(c.to===o&&Ft(e,c.from)!==r){i=true;break}if(i&&o.gridCoord.y<t.gridCoord.y)return  false}return  true}function Rn(e,t){if(t.nodes.length===0)return;let r=1e6,n=1e6,o=-1e6,i=-1e6;for(let l of t.children)Rn(e,l),l.nodes.length>0&&(r=Math.min(r,l.minX),n=Math.min(n,l.minY),o=Math.max(o,l.maxX),i=Math.max(i,l.maxY));for(let l of t.nodes){if(!l.drawingCoord||!l.drawing)continue;let f=l.drawingCoord.x,u=l.drawingCoord.y,h=f+l.drawing.length-1,a=u+l.drawing[0].length-1;r=Math.min(r,f),n=Math.min(n,u),o=Math.max(o,h),i=Math.max(i,a);}let c=2,s=2;t.minX=r-c,t.minY=n-c-s,t.maxX=o+c,t.maxY=i+c;}function Fo(e){let r=e.subgraphs.filter(n=>n.parent===null&&n.nodes.length>0);for(let n=0;n<r.length;n++)for(let o=n+1;o<r.length;o++){let i=r[n],c=r[o];i.minX<c.maxX&&i.maxX>c.minX&&(i.maxY>=c.minY-1&&i.minY<c.minY?c.minY=i.maxY+1+1:c.maxY>=i.minY-1&&c.minY<i.minY&&(i.minY=c.maxY+1+1)),i.minY<c.maxY&&i.maxY>c.minY&&(i.maxX>=c.minX-1&&i.minX<c.minX?c.minX=i.maxX+1+1:c.maxX>=i.minX-1&&c.minX<i.minX&&(i.minX=c.maxX+1+1));}}function Xo(e){for(let t of e.subgraphs)Rn(e,t);Fo(e);}function Wo(e){if(e.subgraphs.length===0)return;let t=0,r=0;for(let i of e.subgraphs)t=Math.min(t,i.minX),r=Math.min(r,i.minY);let n=-t,o=-r;if(!(n===0&&o===0)){e.offsetX=n,e.offsetY=o;for(let i of e.subgraphs)i.minX+=n,i.minY+=o,i.maxX+=n,i.maxY+=o;for(let i of e.nodes)i.drawingCoord&&(i.drawingCoord.x+=n,i.drawingCoord.y+=o);}}function Nn(e){let t=[0,1,2,3,4];for(let r of t)if(Yo(e),Ho(e,r))return}function Yo(e){e.grid=new Map,e.columnWidth=new Map,e.rowHeight=new Map,e.canvas=de(0,0),e.offsetX=0,e.offsetY=0;for(let t of e.nodes)t.gridCoord=null,t.drawingCoord=null,t.drawing=null,t.drawn=false;for(let t of e.edges)t.path=[],t.labelLine=[],t.startDir={x:0,y:0},t.endDir={x:0,y:0};for(let t of e.subgraphs)t.minX=0,t.minY=0,t.maxX=0,t.maxY=0;}function Ho(e,t){let r=e.config.graphDirection,n=new Array(100).fill(0),o=new Set,i=[];for(let b of e.nodes){o.has(b.name)||i.push(b),o.add(b.name);for(let _ of Xt(e,b))o.add(_.name);}let c=false,s=false;for(let b of i)Gt(e,b)?Xt(e,b).length>0&&(s=true):c=true;let l=r==="LR"&&c&&s,f,u=[];l?(f=i.filter(b=>!Gt(e,b)),u=i.filter(b=>Gt(e,b))):f=i;for(let b of f){let _=r==="LR"?{x:0+t,y:n[0]+t}:{x:n[0]+t,y:0+t};tt(e,e.nodes[b.index],_),n[0]=n[0]+4;}if(l&&u.length>0)for(let _ of u){let P=r==="LR"?{x:4+t,y:n[4]+t}:{x:n[4]+t,y:4+t};tt(e,e.nodes[_.index],P),n[4]=n[4]+4;}for(let b of e.nodes){let _=b.gridCoord,w=(r==="LR"?_.x-t:_.y-t)+4,E=n[w]??0;for(let k of Xt(e,b)){if(k.gridCoord!==null)continue;let T=r==="LR"?{x:w+t,y:E+t}:{x:E+t,y:w+t};tt(e,e.nodes[k.index],T),n[w]=E+4,E=n[w];}}let h=0,a=0;for(let b of e.nodes)b.gridCoord&&(h=Math.max(h,b.gridCoord.x+2),a=Math.max(a,b.gridCoord.y+2));let d=h+Nt+1,p=a+Nt+1,x=mn(d,p);for(let b of e.nodes)if(b.gridCoord)for(let _=0;_<3;_++)for(let P=0;P<3;P++){let w=b.gridCoord.x+_,E=b.gridCoord.y+P;x.blocked[w+E*d]=1;}let g=$n(x.blocked.length),m=new Uint8Array(x.blocked.length);for(let b of e.nodes)Oo(e,b);for(let b of e.edges)En(e,b,x,h,a,g,m),Bo(e,b.path),An(e,b);if(e.edges.some(b=>b.path.length<2))return  false;for(let b of e.nodes)b.drawingCoord=ge(e,b.gridCoord),b.drawing=Ln(b,e);return fn(e.canvas,e.columnWidth,e.rowHeight),Xo(e),Wo(e),true}function jo(e,t){return e.edges.filter(r=>r.from.name===t.name)}function Xt(e,t){return jo(e,t).map(r=>r.to)}function dt(e){let t={actors:[],messages:[],blocks:[],notes:[]},r=new Set,n=[];for(let o=1;o<e.length;o++){let i=e[o],c=i.match(/^(participant|actor)\s+(\S+?)(?:\s+as\s+(.+))?$/);if(c){let a=c[1],d=c[2],p=c[3]?.trim()??d;r.has(d)||(r.add(d),t.actors.push({id:d,label:p,type:a}));continue}let s=i.match(/^Note\s+(left of|right of|over)\s+([^:]+):\s*(.+)$/i);if(s){let a=s[1].toLowerCase(),d=s[2].trim(),p=s[3].trim(),x=d.split(",").map(m=>m.trim());for(let m of x)nt(t,r,m);let g="over";a==="left of"?g="left":a==="right of"&&(g="right"),t.notes.push({actorIds:x,text:p,position:g,afterIndex:t.messages.length-1});continue}let l=i.match(/^(loop|alt|opt|par|critical|break|rect)\s*(.*)$/);if(l){let a=l[1],d=l[2]?.trim()??"";n.push({type:a,label:d,startIndex:t.messages.length,dividers:[]});continue}let f=i.match(/^(else|and)\s*(.*)$/);if(f&&n.length>0){let a=f[2]?.trim()??"";n[n.length-1].dividers.push({index:t.messages.length,label:a});continue}if(i==="end"&&n.length>0){let a=n.pop();t.blocks.push({type:a.type,label:a.label,startIndex:a.startIndex,endIndex:Math.max(t.messages.length-1,a.startIndex),dividers:a.dividers});continue}let u=i.match(/^(\S+?)\s*(--?>?>|--?[)x]|--?>>|--?>)\s*([+-]?)(\S+?)\s*:\s*(.+)$/);if(u){let a=u[1],d=u[2],p=u[3],x=u[4],g=u[5].trim();nt(t,r,a),nt(t,r,x);let m=d.startsWith("--")?"dashed":"solid",y=d.includes(">>")||d.includes("x")?"filled":"open",b={from:a,to:x,label:g,lineStyle:m,arrowHead:y};p==="+"&&(b.activate=true),p==="-"&&(b.deactivate=true),t.messages.push(b);continue}let h=i.match(/^(\S+?)\s*(->>|-->>|-\)|--\)|-x|--x|->|-->)\s*([+-]?)(\S+?)\s*:\s*(.+)$/);if(h){let a=h[1],d=h[2],p=h[3],x=h[4],g=h[5].trim();nt(t,r,a),nt(t,r,x);let m=d.startsWith("--")?"dashed":"solid",y=d.includes(">>")||d.includes("x")?"filled":"open",b={from:a,to:x,label:g,lineStyle:m,arrowHead:y};p==="+"&&(b.activate=true),p==="-"&&(b.deactivate=true),t.messages.push(b);continue}}return t}function nt(e,t,r){t.has(r)||(t.add(r),e.actors.push({id:r,label:r,type:"participant"}));}function On(e,t){let r=e.split(`
`).map(A=>A.trim()).filter(A=>A.length>0&&!A.startsWith("%%")),n=dt(r);if(n.actors.length===0)return "";let o=t.useAscii,i=o?"-":"\u2500",c=o?"|":"\u2502",s=o?"+":"\u250C",l=o?"+":"\u2510",f=o?"+":"\u2514",u=o?"+":"\u2518",h=o?"+":"\u252C",a=o?"+":"\u2534",d=o?"+":"\u251C",p=o?"+":"\u2524",x=new Map;n.actors.forEach((A,I)=>x.set(A.id,I));let g=1,y=n.actors.map(A=>ae(A.label)+2*g+2).map(A=>Math.ceil(A/2)),b=3,_=new Array(Math.max(n.actors.length-1,0)).fill(0);for(let A of n.messages){let I=x.get(A.from),X=x.get(A.to);if(I===X)continue;let W=Math.min(I,X),H=Math.max(I,X),V=ae(A.label)+4,z=H-W,q=Math.ceil(V/z);for(let $=W;$<H;$++)_[$]=Math.max(_[$],q);}let P=[y[0]];for(let A=1;A<n.actors.length;A++){let I=Math.max(y[A-1]+y[A]+2,_[A-1]+2,10);P[A]=P[A-1]+I;}let w=[],E=[],k=new Map,T=new Map,R=new Map,N=[],O=b;for(let A=0;A<n.messages.length;A++){for(let W=0;W<n.blocks.length;W++)n.blocks[W].startIndex===A&&(O+=2,k.set(W,O-1));for(let W=0;W<n.blocks.length;W++)for(let H=0;H<n.blocks[W].dividers.length;H++)n.blocks[W].dividers[H].index===A&&(O+=1,R.set(`${W}:${H}`,O),O+=1);O+=1;let I=n.messages[A];I.from===I.to?(E[A]=O+1,w[A]=O,O+=3):(E[A]=O,w[A]=O+1,O+=2);for(let W=0;W<n.notes.length;W++)if(n.notes[W].afterIndex===A){O+=1;let H=n.notes[W],V=H.text.split("\\n"),z=Math.max(...V.map(G=>ae(G)))+4,q=V.length+2,$=x.get(H.actorIds[0])??0,D;if(H.position==="left")D=P[$]-z-1;else if(H.position==="right")D=P[$]+2;else if(H.actorIds.length>=2){let G=x.get(H.actorIds[1])??$;D=Math.floor((P[$]+P[G])/2)-Math.floor(z/2);}else D=P[$]-Math.floor(z/2);D=Math.max(0,D),N.push({x:D,y:O,width:z,height:q,lines:V}),O+=q;}for(let W=0;W<n.blocks.length;W++)n.blocks[W].endIndex===A&&(O+=1,T.set(W,O),O+=1);}O+=1;let j=O,M=j+b,C=P[P.length-1]??0,S=y[y.length-1]??0,L=C+S+2;for(let A=0;A<n.messages.length;A++){let I=n.messages[A];if(I.from===I.to){let X=x.get(I.from),W=P[X]+6+2+ae(I.label);L=Math.max(L,W+1);}}for(let A of N)L=Math.max(L,A.x+A.width+1);let v=de(L,M-1);function B(A,I,X){let W=ae(X)+2*g+2,H=A-Math.floor(W/2);v[H][I]=s;for(let z=1;z<W-1;z++)v[H+z][I]=i;v[H+W-1][I]=l,v[H][I+1]=c,v[H+W-1][I+1]=c;let V=H+1+g;fe(v,{x:V,y:I+1},X),v[H][I+2]=f;for(let z=1;z<W-1;z++)v[H+z][I+2]=i;v[H+W-1][I+2]=u;}for(let A=0;A<n.actors.length;A++){let I=P[A];for(let X=b;X<=j;X++)v[I][X]=c;}for(let A=0;A<n.actors.length;A++){let I=n.actors[A];B(P[A],0,I.label),B(P[A],j,I.label),o||(v[P[A]][b-1]=h,v[P[A]][j]=a);}for(let A=0;A<n.messages.length;A++){let I=n.messages[A],X=x.get(I.from),W=x.get(I.to),H=P[X],V=P[W],z=X===W,q=I.lineStyle==="dashed",$=I.arrowHead==="filled",D=q?o?".":"\u254C":i;if(z){let G=w[A],Y=Math.max(4,4);v[H][G]=d;for(let re=H+1;re<H+Y;re++)v[re][G]=D;v[H+Y][G]=o?"+":"\u2510",v[H+Y][G+1]=c;let K=H+Y+2;fe(v,{x:K,y:G+1},I.label);let Z=$?o?"<":"\u25C0":o?"<":"\u25C1";v[H][G+2]=Z;for(let re=H+1;re<H+Y;re++)v[re][G+2]=D;v[H+Y][G+2]=o?"+":"\u2518";}else {let G=E[A],Y=w[A],K=H<V,re=Math.floor((H+V)/2)-Math.floor(ae(I.label)/2);if(fe(v,{x:Math.max(0,re),y:G},I.label),K){for(let Se=H+1;Se<V;Se++)v[Se][Y]=D;let he=$?o?">":"\u25B6":o?">":"\u25B7";v[V][Y]=he;}else {for(let Se=V+1;Se<H;Se++)v[Se][Y]=D;let he=$?o?"<":"\u25C0":o?"<":"\u25C1";v[V][Y]=he;}}}for(let A=0;A<n.blocks.length;A++){let I=n.blocks[A],X=k.get(A),W=T.get(A);if(X===void 0||W===void 0)continue;let H=L,V=0;for(let D=I.startIndex;D<=I.endIndex&&!(D>=n.messages.length);D++){let G=n.messages[D],Y=x.get(G.from)??0,K=x.get(G.to)??0;H=Math.min(H,P[Math.min(Y,K)]),V=Math.max(V,P[Math.max(Y,K)]);}let z=Math.max(0,H-4),q=Math.min(L-1,V+4);v[z][X]=s;for(let D=z+1;D<q;D++)v[D][X]=i;v[q][X]=l;let $=I.label?`${I.type} [${I.label}]`:I.type;fe(v,{x:z+1,y:X},et($,q-(z+1))),v[z][W]=f;for(let D=z+1;D<q;D++)v[D][W]=i;v[q][W]=u;for(let D=X+1;D<W;D++)v[z][D]=c,v[q][D]=c;for(let D=0;D<I.dividers.length;D++){let G=R.get(`${A}:${D}`);if(G===void 0)continue;let Y=F();v[z][G]=d;for(let Z=z+1;Z<q;Z++)v[Z][G]=Y;v[q][G]=p;let K=I.dividers[D].label;if(K){let Z=`[${K}]`;fe(v,{x:z+1,y:G},et(Z,q-(z+1)));}}}for(let A of N){He(v,A.x+A.width,A.y+A.height),v[A.x][A.y]=s;for(let X=1;X<A.width-1;X++)v[A.x+X][A.y]=i;v[A.x+A.width-1][A.y]=l;for(let X=0;X<A.lines.length;X++){let W=A.y+1+X;v[A.x][W]=c,v[A.x+A.width-1][W]=c,fe(v,{x:A.x+2,y:W},A.lines[X]);}let I=A.y+A.height-1;v[A.x][I]=f;for(let X=1;X<A.width-1;X++)v[A.x+X][I]=i;v[A.x+A.width-1][I]=u;}return Ee(v);function F(){return o?"-":"\u254C"}}function ut(e){let t={classes:[],relationships:[],namespaces:[]},r=new Map,n=null,o=null,i=0;for(let c=1;c<e.length;c++){let s=e[c];if(o&&i>0){if(s==="}"){i--,i===0&&(o=null);continue}let p=s.match(/^<<(\w+)>>$/);if(p){o.annotation=p[1];continue}let x=Bn(s);x&&(x.isMethod?o.methods.push(x.member):o.attributes.push(x.member));continue}let l=s.match(/^namespace\s+(\S+)\s*\{$/);if(l){n={name:l[1],classIds:[]};continue}if(s==="}"&&n){t.namespaces.push(n),n=null;continue}let f=s.match(/^class\s+(\S+?)(?:\s*~(\w+)~)?\s*\{$/);if(f){let p=f[1],x=f[2],g=ze(r,p);x&&(g.label=`${p}<${x}>`),o=g,i=1,n&&n.classIds.push(p);continue}let u=s.match(/^class\s+(\S+?)(?:\s*~(\w+)~)?\s*$/);if(u){let p=u[1],x=u[2],g=ze(r,p);x&&(g.label=`${p}<${x}>`),n&&n.classIds.push(p);continue}let h=s.match(/^class\s+(\S+?)\s*\{\s*<<(\w+)>>\s*\}$/);if(h){let p=ze(r,h[1]);p.annotation=h[2];continue}let a=s.match(/^(\S+?)\s*:\s*(.+)$/);if(a){let p=a[2];if(!p.match(/<\|--|--|\*--|o--|-->|\.\.>|\.\.\|>/)){let x=ze(r,a[1]),g=Bn(p);g&&(g.isMethod?x.methods.push(g.member):x.attributes.push(g.member));continue}}let d=zo(s);if(d){ze(r,d.from),ze(r,d.to),t.relationships.push(d);continue}}return t.classes=[...r.values()],t}function ze(e,t){let r=e.get(t);return r||(r={id:t,label:t,attributes:[],methods:[]},e.set(t,r)),r}function Bn(e){let t=e.trim().replace(/;$/,"");if(!t)return null;let r="",n=t;/^[+\-#~]/.test(n)&&(r=n[0],n=n.slice(1).trim());let o=n.match(/^(.+?)\(([^)]*)\)(?:\s*(.+))?$/);if(o){let u=o[1].trim(),h=o[3]?.trim(),a=u.endsWith("$")||n.includes("$"),d=u.endsWith("*")||n.includes("*");return {member:{visibility:r,name:u.replace(/[$*]$/,""),type:h||void 0,isStatic:a,isAbstract:d},isMethod:true}}let i=n.split(/\s+/),c,s;i.length>=2?(s=i[0],c=i.slice(1).join(" ")):c=i[0]??n;let l=c.endsWith("$"),f=c.endsWith("*");return {member:{visibility:r,name:c.replace(/[$*]$/,""),type:s||void 0,isStatic:l,isAbstract:f},isMethod:false}}function zo(e){let t=e.match(/^(\S+?)\s+(?:"([^"]*?)"\s+)?(<\|--|<\|\.\.|\*--|o--|-->|--\*|--o|--|>\s*|\.\.>|\.\.\|>|--)\s+(?:"([^"]*?)"\s+)?(\S+?)(?:\s*:\s*(.+))?$/);if(!t)return null;let r=t[1],n=t[2]||void 0,o=t[3].trim(),i=t[4]||void 0,c=t[5],s=t[6]?.trim()||void 0,l=Uo(o);return l?{from:r,to:c,type:l.type,markerAt:l.markerAt,label:s,fromCardinality:n,toCardinality:i}:null}function Uo(e){switch(e){case "<|--":return {type:"inheritance",markerAt:"from"};case "<|..":return {type:"realization",markerAt:"from"};case "*--":return {type:"composition",markerAt:"from"};case "--*":return {type:"composition",markerAt:"to"};case "o--":return {type:"aggregation",markerAt:"from"};case "--o":return {type:"aggregation",markerAt:"to"};case "-->":return {type:"association",markerAt:"to"};case "..>":return {type:"dependency",markerAt:"to"};case "..|>":return {type:"realization",markerAt:"to"};case "--":return {type:"association",markerAt:"to"};default:return null}}function Gn(e){let t=e.visibility||"",r=e.type?`: ${e.type}`:"";return `${t}${e.name}${r}`}function Vo(e){let t=[];e.annotation&&t.push(`<<${e.annotation}>>`),t.push(e.label);let r=e.attributes.map(Gn),n=e.methods.map(Gn);return r.length===0&&n.length===0?[t]:n.length===0?[t,r]:[t,r,n]}function qo(e,t){return {type:e,markerAt:t,dashed:e==="dependency"||e==="realization"}}function Ue(e,t,r){switch(e){case "inheritance":case "realization":return r==="down"?t?"^":"\u25B3":r==="up"?t?"v":"\u25BD":r==="left"?t?">":"\u25C1":t?"<":"\u25B7";case "composition":return t?"*":"\u25C6";case "aggregation":return t?"o":"\u25C7";case "association":case "dependency":return r==="down"?t?"v":"\u25BC":r==="up"?t?"^":"\u25B2":r==="left"?t?"<":"\u25C0":t?">":"\u25B6"}}function Fn(e,t){let r=e.split(`
`).map(S=>S.trim()).filter(S=>S.length>0&&!S.startsWith("%%")),n=ut(r);if(n.classes.length===0)return "";let o=t.useAscii,i=n.relationships.reduce((S,L)=>Math.max(S,L.label?ae(` ${L.label} `):0),0),c=Math.max(4,Math.ceil(i/2)+1),s=3,l=new Map,f=new Map,u=new Map;for(let S of n.classes){let L=Vo(S);l.set(S.id,L);let v=0;for(let I of L)for(let X of I)v=Math.max(v,ae(X));let B=v+4,F=0;for(let I of L)F+=Math.max(I.length,1);let A=F+(L.length-1)+2;f.set(S.id,B),u.set(S.id,A);}let h=new Map;for(let S of n.classes)h.set(S.id,S);let a=new Map,d=new Map;for(let S of n.relationships){let L=S.type==="inheritance"||S.type==="realization",v=L&&S.markerAt==="to"?S.to:S.from,B=L&&S.markerAt==="to"?S.from:S.to;a.has(B)||a.set(B,new Set),a.get(B).add(v),d.has(v)||d.set(v,new Set),d.get(v).add(B);}let p=new Map,g=n.classes.filter(S=>!a.has(S.id)||a.get(S.id).size===0).map(S=>S.id);for(let S of g)p.set(S,0);let m=n.classes.length-1,y=0;for(;y<g.length;){let S=g[y++],L=d.get(S);if(L)for(let v of L){let B=(p.get(S)??0)+1;B>m||(!p.has(v)||p.get(v)<B)&&(p.set(v,B),g.push(v));}}for(let S of n.classes)p.has(S.id)||p.set(S.id,0);let b=Math.max(...p.values(),0),_=Array.from({length:b+1},()=>[]);for(let S of n.classes)_[p.get(S.id)].push(S.id);let P=new Map,w=0;for(let S=0;S<=b;S++){let L=_[S];if(L.length===0)continue;let v=0,B=0;for(let F of L){let A=h.get(F),I=f.get(F),X=u.get(F);P.set(F,{cls:A,sections:l.get(F),x:v,y:w,width:I,height:X}),v+=I+c,B=Math.max(B,X);}w+=B+s;}let E=0;for(let S of n.relationships){if(!S.label)continue;let L=P.get(S.from),v=P.get(S.to);if(!L||!v)continue;let B=L.x+Math.floor(L.width/2),F=v.x+Math.floor(v.width/2),A=Math.floor((B+F)/2),I=` ${S.label} `,X=A-Math.floor(ae(I)/2);E=Math.min(E,X);}let k=E<0?-E:0;if(k>0)for(let S of P.values())S.x+=k;let T=0,R=0;for(let S of P.values())T=Math.max(T,S.x+S.width),R=Math.max(R,S.y+S.height);T+=4,R+=2;let N=de(T-1,R-1);for(let S of P.values()){let L=lt(S.sections,o);for(let v=0;v<L.length;v++)for(let B=0;B<L[0].length;B++){let F=L[v][B];if(F!==" "){let A=S.x+v,I=S.y+B;A<T&&I<R&&(N[A][I]=F);}}}let O=o?"-":"\u2500",j=o?"|":"\u2502",M=o?".":"\u254C",C=o?":":"\u250A";for(let S of n.relationships){let L=P.get(S.from),v=P.get(S.to);if(!L||!v)continue;let B=qo(S.type,S.markerAt),F=B.dashed?M:O,A=B.dashed?C:j,I=L.x+Math.floor(L.width/2),X=L.y+L.height-1,W=v.x+Math.floor(v.width/2),H=v.y;if(X<H){let V=X+Math.floor((H-X)/2);for(let z=X+1;z<=V;z++)z<R&&(N[I][z]=A);if(I!==W){let z=Math.min(I,W),q=Math.max(I,W);for(let $=z;$<=q;$++)$<T&&V<R&&(N[$][V]=F);!o&&V<R&&(I<W?(N[I][V]="\u2514",N[W][V]="\u2510"):(N[I][V]="\u2518",N[W][V]="\u250C"));}for(let z=V+1;z<H;z++)z<R&&(N[W][z]=A);if(B.markerAt==="to"){let z=Ue(B.type,o,"down"),q=H-1;if(q>=0&&q<R)for(let $=0;$<z.length;$++){let D=W-Math.floor(z.length/2)+$;D>=0&&D<T&&(N[D][q]=z[$]);}}if(B.markerAt==="from"){let z=Ue(B.type,o,"down"),q=X+1;if(q<R)for(let $=0;$<z.length;$++){let D=I-Math.floor(z.length/2)+$;D>=0&&D<T&&(N[D][q]=z[$]);}}}else if(v.y+v.height-1<L.y){let V=L.y,z=v.y+v.height-1,q=z+Math.floor((V-z)/2);for(let $=V-1;$>=q;$--)$>=0&&$<R&&(N[I][$]=A);if(I!==W){let $=Math.min(I,W),D=Math.max(I,W);for(let G=$;G<=D;G++)G<T&&q>=0&&q<R&&(N[G][q]=F);!o&&q>=0&&q<R&&(I<W?(N[I][q]="\u250C",N[W][q]="\u2518"):(N[I][q]="\u2510",N[W][q]="\u2514"));}for(let $=q-1;$>z;$--)$>=0&&$<R&&(N[W][$]=A);if(B.markerAt==="from"){let $=Ue(B.type,o,"up"),D=V-1;if(D>=0&&D<R)for(let G=0;G<$.length;G++){let Y=I-Math.floor($.length/2)+G;Y>=0&&Y<T&&(N[Y][D]=$[G]);}}if(B.markerAt==="to"){let D=B.type==="inheritance"||B.type==="realization"?"down":"up",G=Ue(B.type,o,D),Y=z+1;if(Y<R)for(let K=0;K<G.length;K++){let Z=W-Math.floor(G.length/2)+K;Z>=0&&Z<T&&(N[Z][Y]=G[K]);}}}else {let V=Math.max(X,v.y+v.height-1)+2;He(N,T,V+1);for(let $=X+1;$<=V;$++)N[I][$]=A;let z=Math.min(I,W),q=Math.max(I,W);for(let $=z;$<=q;$++)N[$][V]=F;for(let $=V-1;$>=v.y+v.height;$--)N[W][$]=A;if(B.markerAt==="from"){let $=Ue(B.type,o,"down"),D=X+1;if(D<R)for(let G=0;G<$.length;G++){let Y=I-Math.floor($.length/2)+G;Y>=0&&Y<T&&(N[Y][D]=$[G]);}}if(B.markerAt==="to"){let $=Ue(B.type,o,"up"),D=v.y+v.height;if(D<R)for(let G=0;G<$.length;G++){let Y=W-Math.floor($.length/2)+G;Y>=0&&Y<T&&(N[Y][D]=$[G]);}}}if(S.label){let V=` ${S.label} `,z=Math.floor((I+W)/2),q;if(X<H)q=Math.floor((X+1+H-1)/2);else if(v.y+v.height-1<L.y){let D=v.y+v.height-1;q=Math.floor((D+1+L.y-1)/2);}else q=Math.max(X,v.y+v.height-1)+2;let $=z-Math.floor(ae(V)/2);q>=0&&q<R&&fe(N,{x:Math.max(0,$),y:q},V);}}return Ee(N)}function ft(e){let t={entities:[],relationships:[]},r=new Map,n=null;for(let o=1;o<e.length;o++){let i=e[o];if(n){if(i==="}"){n=null;continue}let l=Ko(i);l&&n.attributes.push(l);continue}let c=i.match(/^(\S+)\s*\{$/);if(c){let l=c[1];n=Wt(r,l);continue}let s=Jo(i);if(s){Wt(r,s.entity1),Wt(r,s.entity2),t.relationships.push(s);continue}}return t.entities=[...r.values()],t}function Wt(e,t){let r=e.get(t);return r||(r={id:t,label:t,attributes:[]},e.set(t,r)),r}function Ko(e){let t=e.match(/^(\S+)\s+(\S+)(?:\s+(.+))?$/);if(!t)return null;let r=t[1],n=t[2],o=t[3]?.trim()??"",i=[],c,s=o.match(/"([^"]*)"/);s&&(c=s[1]);let l=o.replace(/"[^"]*"/,"").trim();for(let f of l.split(/\s+/)){let u=f.toUpperCase();(u==="PK"||u==="FK"||u==="UK")&&i.push(u);}return {type:r,name:n,keys:i,comment:c}}function Jo(e){let t=e.match(/^(\S+)\s+([|o}{]+(?:--|\.\.)[|o}{]+)\s+(\S+)\s*:\s*(.+)$/);if(!t)return null;let r=t[1],n=t[2],o=t[3],i=t[4].trim(),c=n.match(/^([|o}{]+)(--|\.\.?)([|o}{]+)$/);if(!c)return null;let s=c[1],l=c[2],f=c[3],u=Xn(s),h=Xn(f),a=l==="--";return !u||!h?null:{entity1:r,entity2:o,cardinality1:u,cardinality2:h,label:i,identifying:a}}function Xn(e){let t=e.split("").sort().join("");return t==="||"?"one":t==="o|"?"zero-one":t==="|}"||t==="{|"?"many":t==="{o"||t==="o{"?"zero-many":null}function Zo(e){return `${e.keys.length>0?e.keys.join(",")+" ":"   "}${e.type} ${e.name}`}function Qo(e){let t=[e.label],r=e.attributes.map(Zo);return r.length===0?[t]:[t,r]}function ht(e,t){if(t)switch(e){case "one":return "||";case "zero-one":return "o|";case "many":return "}|";case "zero-many":return "o{"}else switch(e){case "one":return "\u2551";case "zero-one":return "o\u2551";case "many":return "\u255F";case "zero-many":return "o\u255F"}}function Wn(e,t){let r=e.split(`
`).map(k=>k.trim()).filter(k=>k.length>0&&!k.startsWith("%%")),n=ft(r);if(n.entities.length===0)return "";let o=t.useAscii,i=n.relationships.reduce((k,T)=>Math.max(k,ae(T.label)),0),c=Math.max(6,i),s=4,l=new Map,f=new Map,u=new Map;for(let k of n.entities){let T=Qo(k);l.set(k.id,T);let R=0;for(let M of T)for(let C of M)R=Math.max(R,ae(C));let N=R+4,O=0;for(let M of T)O+=Math.max(M.length,1);let j=O+(T.length-1)+2;f.set(k.id,N),u.set(k.id,j);}let h=Math.max(2,Math.ceil(Math.sqrt(n.entities.length))),a=new Map,d=0,p=0,x=0,g=0;for(let k of n.entities){let T=f.get(k.id),R=u.get(k.id);g>=h&&(p+=x+s,d=0,x=0,g=0),a.set(k.id,{entity:k,sections:l.get(k.id),x:d,y:p,width:T,height:R}),d+=T+c,x=Math.max(x,R),g++;}let m=0,y=0;for(let k of a.values())m=Math.max(m,k.x+k.width),y=Math.max(y,k.y+k.height);m+=4,y+=2;let b=de(m-1,y-1);for(let k of a.values()){let T=lt(k.sections,o);for(let R=0;R<T.length;R++)for(let N=0;N<T[0].length;N++){let O=T[R][N];if(O!==" "){let j=k.x+R,M=k.y+N;j<m&&M<y&&(b[j][M]=O);}}}let _=o?"-":"\u2500",P=o?"|":"\u2502",w=o?".":"\u254C",E=o?":":"\u250A";for(let k of n.relationships){let T=a.get(k.entity1),R=a.get(k.entity2);if(!T||!R)continue;let N=k.identifying?_:w,O=k.identifying?P:E,j=T.x+Math.floor(T.width/2),M=T.y+Math.floor(T.height/2),C=R.x+Math.floor(R.width/2),S=R.y+Math.floor(R.height/2);if(Math.abs(M-S)<Math.max(T.height,R.height)){let[v,B]=j<C?[T,R]:[R,T],[F,A]=j<C?[k.cardinality1,k.cardinality2]:[k.cardinality2,k.cardinality1],I=v.x+v.width,X=B.x-1,W=v.y+Math.floor(v.height/2);for(let z=I;z<=X;z++)z<m&&(b[z][W]=N);let H=ht(F,o);for(let z=0;z<H.length;z++){let q=I+z;q<m&&(b[q][W]=H[z]);}let V=ht(A,o);for(let z=0;z<V.length;z++){let q=X-V.length+1+z;q>=0&&q<m&&(b[q][W]=V[z]);}if(k.label){let z=Math.floor((I+X)/2),q=Math.max(I,z-Math.floor(ae(k.label)/2)),$=W-1;if($>=0){let D=Math.max(0,X-q+1),G=et(k.label,D);fe(b,{x:q,y:$},G);}}}else {let[v,B]=M<S?[T,R]:[R,T],[F,A]=M<S?[k.cardinality1,k.cardinality2]:[k.cardinality2,k.cardinality1],I=v.y+v.height,X=B.y-1,W=v.x+Math.floor(v.width/2);for(let $=I;$<=X;$++)$<y&&(b[W][$]=O);let H=B.x+Math.floor(B.width/2);if(W!==H){let $=Math.floor((I+X)/2),D=Math.min(W,H),G=Math.max(W,H);for(let Y=D;Y<=G;Y++)Y<m&&$<y&&(b[Y][$]=N);for(let Y=$+1;Y<=X;Y++)Y<y&&(b[H][Y]=O);}let V=ht(F,o);if(I<y)for(let $=0;$<V.length;$++){let D=W-Math.floor(V.length/2)+$;D>=0&&D<m&&(b[D][I]=V[$]);}let z=W!==H?H:W,q=ht(A,o);if(X>=0&&X<y)for(let $=0;$<q.length;$++){let D=z-Math.floor(q.length/2)+$;D>=0&&D<m&&(b[D][X]=q[$]);}if(k.label){let $=Math.floor((I+X)/2),D=W+2;$>=0&&fe(b,{x:D,y:$},k.label);}}}return Ee(b)}function zn(e){let t=e.trim().split(/[\n;]/)[0]?.trim().toLowerCase()??"";return /^sequencediagram\s*$/.test(t)?"sequence":/^classdiagram\s*$/.test(t)?"class":/^erdiagram\s*$/.test(t)?"er":"flowchart"}function Un(e){return {useAscii:e.useAscii??false,paddingX:e.paddingX??5,paddingY:e.paddingY??5,boxBorderPadding:e.boxBorderPadding??1,graphDirection:"TD"}}function Vn(e,t){let r=Qe(e);r.direction==="LR"||r.direction==="RL"?t.graphDirection="LR":t.graphDirection="TD";let n=hn(r,t);Nn(n),Dn(n);let o=r.direction==="BT";return o&&un(n.canvas),n.config.useAscii||dn(n.canvas),{graph:n,flippedVertically:o}}function ti(e){let t=e.nodes.filter(n=>n.drawingCoord&&n.drawing).map(n=>{let[o,i]=me(n.drawing);return {id:n.name,label:n.displayLabel,box:{x:n.drawingCoord.x,y:n.drawingCoord.y,width:o+1,height:i+1}}}),r=e.edges.map(n=>({from:n.from.name,to:n.to.name,label:n.text,path:Tn(e,n)}));return {nodes:t,edges:r}}function ni(e,t){return {nodes:e.nodes.map(r=>({...r,box:{...r.box,y:t-(r.box.y+r.box.height-1)}})),edges:e.edges.map(r=>({...r,path:r.path.map(n=>({x:n.x,y:t-n.y}))}))}}function pt(e,t={}){let r=Un(t);switch(zn(e)){case "sequence":return On(e,r);case "class":return Fn(e,r);case "er":return Wn(e,r);default:{let{graph:o}=Vn(e,r);return Ee(o.canvas)}}}function Yt(e,t={}){let r=Un(t);switch(zn(e)){case "sequence":case "class":case "er":return {text:pt(e,t),meta:{nodes:[],edges:[]}};default:{let{graph:o,flippedVertically:i}=Vn(e,r),c=Ee(o.canvas),s=ti(o);if(!i)return {text:c,meta:s};let[,l]=me(o.canvas);return {text:c,meta:ni(s,l)}}}}var it=vt(mt());function ce(e,t,r){let n=r>=600?.58:r>=500?.55:.52;return e.length*t*n}function gt(e,t){return e.length*t*.6}var J={nodeLabel:13,edgeLabel:11,groupHeader:12},te={nodeLabel:500,edgeLabel:400,groupHeader:600},Kn=8,Ve={horizontal:16,vertical:10,diamondExtra:24},se={outerBox:1,innerBox:.75,connector:.75},ue="0.35em",qe={width:8,height:4.8};function _e(e,t,r,n){return {x:e-r/2,y:t-n/2}}function rt(e,t,r,n,o){let i=e.x-t,c=e.y-r;if(Math.abs(i)<.5&&Math.abs(c)<.5)return e;let s=1/(Math.abs(i)/n+Math.abs(c)/o);return {x:t+s*i,y:r+s*c}}function ot(e,t,r,n){let o=e.x-t,i=e.y-r,c=Math.sqrt(o*o+i*i);if(c<.5)return e;let s=n/c;return {x:t+s*o,y:r+s*i}}function De(e,t=true){if(e.length<2)return e;let r=[e[0]];for(let n=1;n<e.length;n++){let o=r[r.length-1],i=e[n],c=Math.abs(i.x-o.x),s=Math.abs(i.y-o.y);if(c<1||s<1){r.push(i);continue}t?r.push({x:o.x,y:i.y}):r.push({x:i.x,y:o.y}),r.push(i);}return oi(r)}function oi(e){if(e.length<3)return e;let t=[e[0]];for(let r=1;r<e.length-1;r++){let n=t[t.length-1],o=e[r],i=e[r+1],c=Math.abs(n.x-o.x)<1&&Math.abs(o.x-i.x)<1,s=Math.abs(n.y-o.y)<1&&Math.abs(o.y-i.y)<1;c||s||t.push(o);}return t.push(e[e.length-1]),t}function Be(e,t,r){if(e.length<2)return e;let n=e.map(o=>({...o}));if(r){let o=n.length-1;if(e.length===2){let i=n[0],c=n[o],s=Math.abs(c.x-i.x);if(Math.abs(c.y-i.y)>=s){let u=c.y>i.y?r.cy-r.hh:r.cy+r.hh;n[o]={x:c.x,y:u};}else {let u=c.x>i.x?r.cx-r.hw:r.cx+r.hw;n[o]={x:u,y:c.y};}}else {let i=n[o-1],c=n[o],s=Math.abs(c.x-i.x),l=Math.abs(c.y-i.y),f=l<1&&s>=1,u=s<1&&l>=1,h=!f&&!u&&l<s,a=!f&&!u&&s<l;if(f){let p=c.x>i.x?r.cx-r.hw:r.cx+r.hw;n[o]={x:p,y:r.cy},n[o-1]={...i,y:r.cy};}else if(u){let p=c.y>i.y?r.cy-r.hh:r.cy+r.hh;n[o]={x:r.cx,y:p},n[o-1]={...i,x:r.cx};}else if(h){let p=c.x>i.x?r.cx-r.hw:r.cx+r.hw;i.y>=r.cy-r.hh&&i.y<=r.cy+r.hh?n[o]={x:p,y:i.y}:(n[o]={x:p,y:r.cy},n[o-1]={...i,y:r.cy});}else if(a){let p=c.y>i.y?r.cy-r.hh:r.cy+r.hh;i.x>=r.cx-r.hw&&i.x<=r.cx+r.hw?n[o]={x:i.x,y:p}:(n[o]={x:r.cx,y:p},n[o-1]={...i,x:r.cx});}}}if(t&&e.length>=3){let o=n[0],i=n[1],c=Math.abs(i.x-o.x),s=Math.abs(i.y-o.y),l=s<1&&c>=1,f=c<1&&s>=1,u=!l&&!f&&s<c,h=!l&&!f&&c<s;if(l){let d=i.x>o.x?t.cx+t.hw:t.cx-t.hw;n[0]={x:d,y:t.cy},n[1]={...n[1],y:t.cy};}else if(f){let d=i.y>o.y?t.cy+t.hh:t.cy-t.hh;n[0]={x:t.cx,y:d},n[1]={...n[1],x:t.cx};}else if(u){let d=i.x>o.x?t.cx+t.hw:t.cx-t.hw;i.y>=t.cy-t.hh&&i.y<=t.cy+t.hh?n[0]={x:d,y:i.y}:(n[0]={x:d,y:t.cy},n[1]={...n[1],y:t.cy});}else if(h){let d=i.y>o.y?t.cy+t.hh:t.cy-t.hh;i.x>=t.cx-t.hw&&i.x<=t.cx+t.hw?n[0]={x:i.x,y:d}:(n[0]={x:t.cx,y:d},n[1]={...n[1],x:t.cx});}}return n}function Jn(e){let t=Array.from(e.nodes.keys());if(t.length===0)return [];let r=new Map,n=new Map;for(let u of t)r.set(u,u),n.set(u,0);function o(u){return r.get(u)!==u&&r.set(u,o(r.get(u))),r.get(u)}function i(u,h){let a=o(u),d=o(h);if(a===d)return;let p=n.get(a),x=n.get(d);p<x?r.set(a,d):p>x?r.set(d,a):(r.set(d,a),n.set(a,p+1));}for(let u of e.edges)r.has(u.source)&&r.has(u.target)&&i(u.source,u.target);function c(u){let h=[...u.nodeIds];for(let a of u.children)s(a,h);if(r.has(u.id)&&h.length>0)for(let a of h)r.has(a)&&i(u.id,a);if(h.length>1){let a=h[0];for(let d=1;d<h.length;d++)r.has(a)&&r.has(h[d])&&i(a,h[d]);}for(let a of u.children)c(a);}function s(u,h){h.push(...u.nodeIds);for(let a of u.children)s(a,h);}for(let u of e.subgraphs)c(u);let l=new Map;for(let u of t){let h=o(u);l.has(h)||l.set(h,new Set),l.get(h).add(u);}let f=[];for(let[u,h]of l){let a={nodeIds:h,subgraphIds:new Set,edgeIndices:new Set};for(let d=0;d<e.edges.length;d++){let p=e.edges[d];h.has(p.source)&&h.has(p.target)&&a.edgeIndices.add(d);}f.push(a);}return Zn(e.subgraphs,f),f.sort((u,h)=>{let a=Math.min(...Array.from(u.nodeIds).map(p=>p.charCodeAt(0))),d=Math.min(...Array.from(h.nodeIds).map(p=>p.charCodeAt(0)));return a-d}),f}function Zn(e,t){for(let r of e){let n=Qn(r);if(n.size>0){let o=n.values().next().value;for(let i of t)if(i.nodeIds.has(o)){i.subgraphIds.add(r.id),er(r,i.subgraphIds);break}}Zn(r.children,t);}}function Qn(e){let t=new Set(e.nodeIds);for(let r of e.children)for(let n of Qn(r))t.add(n);return t}function er(e,t){for(let r of e.children)t.add(r.id),er(r,t);}function tr(e,t,r){if(e.length===0)return {width:0,height:0,nodes:[],edges:[],groups:[]};if(e.length===1)return e[0];let n=t==="TD"||t==="TB"||t==="BT",o={width:0,height:0,nodes:[],edges:[],groups:[]},i=0;for(let c=0;c<e.length;c++){let s=e[c];if(n){for(let l of s.nodes)o.nodes.push({...l,x:l.x+i});for(let l of s.edges)o.edges.push({...l,points:l.points.map(f=>({x:f.x+i,y:f.y})),labelPosition:l.labelPosition?{x:l.labelPosition.x+i,y:l.labelPosition.y}:void 0});for(let l of s.groups)o.groups.push(nr(l,i));o.width=i+s.width,o.height=Math.max(o.height,s.height),i+=s.width+r;}else {for(let l of s.nodes)o.nodes.push({...l,y:l.y+i});for(let l of s.edges)o.edges.push({...l,points:l.points.map(f=>({x:f.x,y:f.y+i})),labelPosition:l.labelPosition?{x:l.labelPosition.x,y:l.labelPosition.y+i}:void 0});for(let l of s.groups)o.groups.push(rr(l,i));o.width=Math.max(o.width,s.width),o.height=i+s.height,i+=s.height+r;}}return o}function nr(e,t){return {...e,x:e.x+t,children:e.children.map(r=>nr(r,t))}}function rr(e,t){return {...e,y:e.y+t,children:e.children.map(r=>rr(r,t))}}var xt=new Set(["circle","doublecircle","state-start","state-end"]),bt=new Set(["diamond","circle","doublecircle","state-start","state-end"]),ii={font:"Inter",padding:40,nodeSpacing:24,layerSpacing:40};function si(e,t,r){let n=new it.default.graphlib.Graph({directed:true,compound:true});n.setGraph({rankdir:cr(e.direction),acyclicer:"greedy",nodesep:r.nodeSpacing,ranksep:r.layerSpacing,marginx:16,marginy:12}),n.setDefaultEdgeLabel(()=>({}));let o=new Set;o.add(e.id),Ut(e,o);for(let a of e.nodeIds){let d=t.nodes.get(a);if(d){let p=jt(a,d.label,d.shape);n.setNode(a,{label:d.label,width:p.width,height:p.height});}}for(let a of e.children)zt(n,a,t);let i=new Set;for(let a=0;a<t.edges.length;a++){let d=t.edges[a];if(o.has(d.source)&&o.has(d.target)){i.add(a);let p={_index:a};d.label&&(p.label=d.label,p.width=ce(d.label,J.edgeLabel,te.edgeLabel)+8,p.height=J.edgeLabel+6,p.labelpos="c"),n.setEdge(d.source,d.target,p);}}it.default.layout(n);let c=e.direction==="TD"||e.direction==="TB"||e.direction==="BT",s=new Set;for(let a of e.children)qt(a,s);let l=[];for(let a of n.nodes()){if(s.has(a))continue;let d=t.nodes.get(a);if(!d)continue;let p=n.node(a);if(!p)continue;let x=_e(p.x,p.y,p.width,p.height);l.push({id:a,label:d.label,shape:d.shape,x:x.x,y:x.y,width:p.width,height:p.height,inlineStyle:dr(t,a)});}let f=n.edges().map(a=>{let d=n.edge(a),p=t.edges[d._index],x=d.points??[];if(x.length>0){let E=t.nodes.get(a.v)?.shape;if(E==="diamond"){let T=n.node(a.v);x[0]=rt(x[0],T.x,T.y,T.width/2,T.height/2);}else if(E&&xt.has(E)){let T=n.node(a.v);x[0]=ot(x[0],T.x,T.y,Math.min(T.width,T.height)/2);}let k=t.nodes.get(a.w)?.shape;if(k==="diamond"){let T=n.node(a.w),R=x.length-1;x[R]=rt(x[R],T.x,T.y,T.width/2,T.height/2);}else if(k&&xt.has(k)){let T=n.node(a.w),R=x.length-1;x[R]=ot(x[R],T.x,T.y,Math.min(T.width,T.height)/2);}}let g=De(x,c),m=t.nodes.get(a.v)?.shape,y=t.nodes.get(a.w)?.shape,b=m&&!bt.has(m)||!m?(()=>{let E=n.node(a.v);return E?{cx:E.x,cy:E.y,hw:E.width/2,hh:E.height/2}:null})():null,_=y&&!bt.has(y)||!y?(()=>{let E=n.node(a.w);return E?{cx:E.x,cy:E.y,hw:E.width/2,hh:E.height/2}:null})():null,P=Be(g,b,_),w;return p.label&&d.x!=null&&d.y!=null&&(w={x:d.x,y:d.y}),{source:p.source,target:p.target,label:p.label,style:p.style,hasArrowStart:p.hasArrowStart,hasArrowEnd:p.hasArrowEnd,points:P,labelPosition:w}}),u=e.children.map(a=>Vt(n,a)),h=n.graph();return {id:e.id,label:e.label,width:h.width??200,height:h.height??100,nodes:l,edges:f,groups:u,nodeIds:o,internalEdgeIndices:i}}async function ir(e,t={}){let r={...ii,...t},n=Jn(e);if(n.length>1){let o=[];for(let s of n){let l=ai(e,s),f=await or(l,r);o.push(f);}let c=(r.componentSpacing??r.nodeSpacing)-2*r.padding;return tr(o,e.direction,c)}return or(e,r)}function ai(e,t){let r=new Set,n=ar(e.subgraphs,t.subgraphIds);for(let c of n)sr(c,r);let o=new Map(Array.from(e.nodes.entries()).filter(([c])=>t.nodeIds.has(c)&&!r.has(c))),i=e.edges.filter((c,s)=>t.edgeIndices.has(s));return {direction:e.direction,nodes:o,edges:i,subgraphs:n,classDefs:e.classDefs,classAssignments:e.classAssignments,nodeStyles:e.nodeStyles}}function sr(e,t){t.add(e.id);for(let r of e.children)sr(r,t);}function ar(e,t){return e.filter(r=>t.has(r.id)).map(r=>({...r,children:ar(r.children,t)}))}async function or(e,t){let r=new Map;for(let f of e.subgraphs)f.direction&&f.direction!==e.direction&&r.set(f.id,si(f,e,t));let n=new it.default.graphlib.Graph({directed:true,compound:true});n.setGraph({rankdir:cr(e.direction),acyclicer:"greedy",nodesep:t.nodeSpacing,ranksep:t.layerSpacing,marginx:t.padding,marginy:t.padding}),n.setDefaultEdgeLabel(()=>({}));let o=new Set;for(let f of e.subgraphs)o.add(f.id),Ut(f,o);for(let[f,u]of e.nodes)if(!o.has(f)){let h=jt(f,u.label,u.shape);n.setNode(f,{label:u.label,width:h.width,height:h.height});}for(let f of e.subgraphs)if(r.has(f.id)){let u=r.get(f.id);n.setNode(f.id,{width:u.width,height:u.height});}else zt(n,f,e);let i=new Map,c=new Map;for(let f of e.subgraphs)r.has(f.id)||lr(f,i,c);for(let[f,u]of r)for(let h of u.nodeIds)i.set(h,f),c.set(h,f);let s=new Set;for(let f of r.values())for(let u of f.internalEdgeIndices)s.add(u);let l=new Set;for(let f=0;f<e.edges.length;f++){if(s.has(f))continue;let u=e.edges[f],h=c.get(u.source)??u.source,a=i.get(u.target)??u.target,d={_index:f};u.label&&(d.label=u.label,d.width=ce(u.label,J.edgeLabel,te.edgeLabel)+8,d.height=J.edgeLabel+6,d.labelpos="c"),l.has(a)||(d.weight=2,l.add(a)),n.setEdge(h,a,d);}try{it.default.layout(n);}catch(f){let u=f instanceof Error?f.message:String(f);throw new Error(`Dagre layout failed: ${u}`)}return ci(n,e,t.padding,r)}function cr(e){switch(e){case "LR":return "LR";case "RL":return "RL";case "BT":return "BT";default:return "TB"}}function jt(e,t,r){let o=ce(t,J.nodeLabel,te.nodeLabel)+Ve.horizontal*2,i=J.nodeLabel+Ve.vertical*2;if(r==="diamond"){let c=Math.max(o,i)+Ve.diamondExtra;o=c,i=c;}if(r==="circle"||r==="doublecircle"){let c=Math.ceil(Math.sqrt(o*o+i*i))+8;o=r==="doublecircle"?c+12:c,i=o;}return r==="hexagon"&&(o+=Ve.horizontal),(r==="trapezoid"||r==="trapezoid-alt")&&(o+=Ve.horizontal),r==="asymmetric"&&(o+=12),r==="cylinder"&&(i+=14),(r==="state-start"||r==="state-end")&&(o=28,i=28),o=Math.max(o,60),i=Math.max(i,36),{width:o,height:i}}function zt(e,t,r,n){e.setNode(t.id,{label:t.label}),n&&e.setParent(t.id,n);for(let o of t.nodeIds){let i=r.nodes.get(o);if(i){let c=jt(o,i.label,i.shape);e.setNode(o,{label:i.label,width:c.width,height:c.height}),e.setParent(o,t.id);}}for(let o of t.children)zt(e,o,r,t.id);}function lr(e,t,r){for(let c of e.children)lr(c,t,r);let n=[...e.nodeIds,...e.children.map(c=>c.id)];if(n.length===0){t.set(e.id,e.id),r.set(e.id,e.id);return}let o=n[0],i=n[n.length-1];t.set(e.id,t.get(o)??o),r.set(e.id,r.get(i)??i);}function dr(e,t){let r=e.classAssignments.get(t),n=r?e.classDefs.get(r):void 0,o=e.nodeStyles.get(t);if(!(!n&&!o))return {...n,...o}}function Ut(e,t){for(let r of e.nodeIds)t.add(r);for(let r of e.children)Ut(r,t);}function ci(e,t,r,n){let o=[],i=[],c=new Set;for(let m of t.subgraphs)qt(m,c);let s=new Set;if(n)for(let m of n.values())for(let y of m.nodeIds)s.add(y);for(let m of e.nodes()){if(c.has(m))continue;let y=t.nodes.get(m);if(!y)continue;let b=e.node(m);if(!b)continue;let _=_e(b.x,b.y,b.width,b.height);o.push({id:m,label:y.label,shape:y.shape,x:_.x,y:_.y,width:b.width,height:b.height,inlineStyle:dr(t,m)});}for(let m of t.subgraphs)i.push(Vt(e,m));let l=t.direction==="TD"||t.direction==="TB"||t.direction==="BT",f=e.edges().map(m=>{let y=e.edge(m),b=t.edges[y._index],_=y.points??[];if(_.length>0){let O=t.nodes.get(m.v)?.shape;if(O==="diamond"){let M=e.node(m.v);_[0]=rt(_[0],M.x,M.y,M.width/2,M.height/2);}else if(O&&xt.has(O)){let M=e.node(m.v);_[0]=ot(_[0],M.x,M.y,Math.min(M.width,M.height)/2);}let j=t.nodes.get(m.w)?.shape;if(j==="diamond"){let M=e.node(m.w),C=_.length-1;_[C]=rt(_[C],M.x,M.y,M.width/2,M.height/2);}else if(j&&xt.has(j)){let M=e.node(m.w),C=_.length-1;_[C]=ot(_[C],M.x,M.y,Math.min(M.width,M.height)/2);}}let P=De(_,l),w=t.nodes.get(m.v)?.shape,E=t.nodes.get(m.w)?.shape,k=w&&!bt.has(w)||!w?(()=>{let O=e.node(m.v);return O?{cx:O.x,cy:O.y,hw:O.width/2,hh:O.height/2}:null})():null,T=E&&!bt.has(E)||!E?(()=>{let O=e.node(m.w);return O?{cx:O.x,cy:O.y,hw:O.width/2,hh:O.height/2}:null})():null,R=Be(P,k,T),N;return b.label&&y.x!=null&&y.y!=null&&(N={x:y.x,y:y.y}),{source:b.source,target:b.target,label:b.label,style:b.style,hasArrowStart:b.hasArrowStart,hasArrowEnd:b.hasArrowEnd,points:R,labelPosition:N}});if(n&&n.size>0){let m=new Map;for(let y of o)m.set(y.id,{cx:y.x+y.width/2,cy:y.y+y.height/2});for(let[y,b]of n){let _=e.node(y);if(!_)continue;let P=_e(_.x,_.y,_.width,_.height);for(let E of b.nodes){let k={...E,x:E.x+P.x,y:E.y+P.y};o.push(k),m.set(k.id,{cx:k.x+k.width/2,cy:k.y+k.height/2});}for(let E of b.edges)f.push({...E,points:E.points.map(k=>({x:k.x+P.x,y:k.y+P.y})),labelPosition:E.labelPosition?{x:E.labelPosition.x+P.x,y:E.labelPosition.y+P.y}:void 0});let w=hr(i,y);w&&b.groups.length>0&&(w.children=b.groups.map(E=>pr(E,P.x,P.y)));}for(let y of f){if(s.has(y.source)&&s.has(y.target))continue;let b=false;if(s.has(y.source)){let _=m.get(y.source);_&&y.points.length>0&&(y.points[0]={x:_.cx,y:_.cy},b=true);}if(s.has(y.target)){let _=m.get(y.target);_&&y.points.length>0&&(y.points[y.points.length-1]={x:_.cx,y:_.cy},b=true);}b&&(y.points=De(y.points,l));}}let u=J.groupHeader+16;li(i,u);let h=fr(i),a=[...o.map(m=>m.y),...h.map(m=>m.y)],d=a.length>0?Math.min(...a):r,p=e.graph().width??800,x=e.graph().height??600;if(d<r){let m=r-d;for(let y of o)y.y+=m;for(let y of f){for(let b of y.points)b.y+=m;y.labelPosition&&(y.labelPosition.y+=m);}for(let y of h)y.y+=m;x+=m;}let g=Math.max(...o.map(m=>m.y+m.height),...h.map(m=>m.y+m.height),...f.flatMap(m=>m.points.map(y=>y.y)));return g+r>x&&(x=g+r),{width:p,height:x,nodes:o,edges:f,groups:i}}function Vt(e,t){let r=e.node(t.id),n=r?_e(r.x,r.y,r.width,r.height):{x:0,y:0};return {id:t.id,label:t.label,x:n.x,y:n.y,width:r?.width??0,height:r?.height??0,children:t.children.map(o=>Vt(e,o))}}function li(e,t){for(let r of e)ur(r,t);}function ur(e,t){for(let r of e.children)ur(r,t);if(e.children.length>0){let r=e.y,n=e.y+e.height;for(let o of e.children)r=Math.min(r,o.y),n=Math.max(n,o.y+o.height);e.height=n-r,e.y=r;}if(e.label){let r=t+Kn;e.y-=r,e.height+=r;}}function fr(e){let t=[];for(let r of e)t.push(r),t.push(...fr(r.children));return t}function hr(e,t){for(let r of e){if(r.id===t)return r;let n=hr(r.children,t);if(n)return n}}function pr(e,t,r){return {...e,x:e.x+t,y:e.y+r,children:e.children.map(n=>pr(n,t,r))}}function qt(e,t){t.add(e.id);for(let r of e.children)qt(r,t);}function gr(e,t,r="Inter",n=false){let o=[];o.push(Ie(e.width,e.height,t,n)),o.push(Te(r,false)),o.push("<defs>"),o.push(di()),o.push("</defs>");for(let i of e.groups)o.push(xr(i));for(let i of e.edges)o.push(ui(i));for(let i of e.edges)i.label&&o.push(hi(i));for(let i of e.nodes)o.push(mi(i));for(let i of e.nodes)o.push(Li(i));return o.push("</svg>"),o.join(`
`)}function di(){let e=qe.width,t=qe.height;return `  <marker id="arrowhead" markerWidth="${e}" markerHeight="${t}" refX="${e}" refY="${t/2}" orient="auto">
    <polygon points="0 0, ${e} ${t/2}, 0 ${t}" fill="var(--_arrow)" />
  </marker>
  <marker id="arrowhead-start" markerWidth="${e}" markerHeight="${t}" refX="0" refY="${t/2}" orient="auto-start-reverse">
    <polygon points="${e} 0, 0 ${t/2}, ${e} ${t}" fill="var(--_arrow)" />
  </marker>`}function xr(e,t){let r=J.groupHeader+16,n=[];n.push(`<rect x="${e.x}" y="${e.y}" width="${e.width}" height="${e.height}" rx="0" ry="0" fill="var(--_group-fill)" stroke="var(--_node-stroke)" stroke-width="${se.outerBox}" />`),n.push(`<rect x="${e.x}" y="${e.y}" width="${e.width}" height="${r}" rx="0" ry="0" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="${se.outerBox}" />`),n.push(`<text x="${e.x+12}" y="${e.y+r/2}" dy="${ue}" font-size="${J.groupHeader}" font-weight="${te.groupHeader}" fill="var(--_text-sec)">${Ge(e.label)}</text>`);for(let o of e.children)n.push(xr(o));return n.join(`
`)}function ui(e){if(e.points.length<2)return "";let t=fi(e.points),r=e.style==="dotted"?' stroke-dasharray="4 4"':"",n=e.style==="thick"?se.connector*2:se.connector,o="";return e.hasArrowEnd&&(o+=' marker-end="url(#arrowhead)"'),e.hasArrowStart&&(o+=' marker-start="url(#arrowhead-start)"'),`<polyline points="${t}" fill="none" stroke="var(--_line)" stroke-width="${n}"${r}${o} />`}function fi(e){return e.map(t=>`${t.x},${t.y}`).join(" ")}function hi(e,t){let r=e.labelPosition??pi(e.points),n=e.label,o=ce(n,J.edgeLabel,te.edgeLabel),i=8,c=o+i*2,s=J.edgeLabel+i*2;return `<rect x="${r.x-c/2}" y="${r.y-s/2}" width="${c}" height="${s}" rx="4" ry="4" fill="var(--bg)" stroke="var(--_inner-stroke)" stroke-width="0.5" />
<text x="${r.x}" y="${r.y}" text-anchor="middle" dy="${ue}" font-size="${J.edgeLabel}" font-weight="${te.edgeLabel}" fill="var(--_text-muted)">${Ge(n)}</text>`}function pi(e){if(e.length===0)return {x:0,y:0};if(e.length===1)return e[0];let t=0;for(let n=1;n<e.length;n++)t+=mr(e[n-1],e[n]);let r=t/2;for(let n=1;n<e.length;n++){let o=mr(e[n-1],e[n]);if(r<=o){let i=r/o;return {x:e[n-1].x+i*(e[n].x-e[n-1].x),y:e[n-1].y+i*(e[n].y-e[n-1].y)}}r-=o;}return e[e.length-1]}function mr(e,t){return Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2)}function mi(e){let{x:t,y:r,width:n,height:o,shape:i,inlineStyle:c}=e,s=Ge(c?.fill??"var(--_node-fill)"),l=Ge(c?.stroke??"var(--_node-stroke)"),f=Ge(c?.["stroke-width"]??String(se.innerBox));switch(i){case "diamond":return wi(t,r,n,o,s,l,f);case "rounded":return xi(t,r,n,o,s,l,f);case "stadium":return bi(t,r,n,o,s,l,f);case "circle":return yi(t,r,n,o,s,l,f);case "subroutine":return vi(t,r,n,o,s,l,f);case "doublecircle":return Ci(t,r,n,o,s,l,f);case "hexagon":return Si(t,r,n,o,s,l,f);case "cylinder":return $i(t,r,n,o,s,l,f);case "asymmetric":return ki(t,r,n,o,s,l,f);case "trapezoid":return Mi(t,r,n,o,s,l,f);case "trapezoid-alt":return Ei(t,r,n,o,s,l,f);case "state-start":return Ai(t,r,n,o);case "state-end":return _i(t,r,n,o);default:return gi(t,r,n,o,s,l,f)}}function gi(e,t,r,n,o,i,c){return `<rect x="${e}" y="${t}" width="${r}" height="${n}" rx="0" ry="0" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function xi(e,t,r,n,o,i,c){return `<rect x="${e}" y="${t}" width="${r}" height="${n}" rx="6" ry="6" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function bi(e,t,r,n,o,i,c){let s=n/2;return `<rect x="${e}" y="${t}" width="${r}" height="${n}" rx="${s}" ry="${s}" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function yi(e,t,r,n,o,i,c){let s=e+r/2,l=t+n/2,f=Math.min(r,n)/2;return `<circle cx="${s}" cy="${l}" r="${f}" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function wi(e,t,r,n,o,i,c){let s=e+r/2,l=t+n/2,f=r/2,u=n/2;return `<polygon points="${[`${s},${l-u}`,`${s+f},${l}`,`${s},${l+u}`,`${s-f},${l}`].join(" ")}" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function vi(e,t,r,n,o,i,c){return `<rect x="${e}" y="${t}" width="${r}" height="${n}" rx="0" ry="0" fill="${o}" stroke="${i}" stroke-width="${c}" />
<line x1="${e+8}" y1="${t}" x2="${e+8}" y2="${t+n}" stroke="${i}" stroke-width="${c}" />
<line x1="${e+r-8}" y1="${t}" x2="${e+r-8}" y2="${t+n}" stroke="${i}" stroke-width="${c}" />`}function Ci(e,t,r,n,o,i,c){let s=e+r/2,l=t+n/2,f=Math.min(r,n)/2,u=f-5;return `<circle cx="${s}" cy="${l}" r="${f}" fill="${o}" stroke="${i}" stroke-width="${c}" />
<circle cx="${s}" cy="${l}" r="${u}" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function Si(e,t,r,n,o,i,c){let s=n/4;return `<polygon points="${[`${e+s},${t}`,`${e+r-s},${t}`,`${e+r},${t+n/2}`,`${e+r-s},${t+n}`,`${e+s},${t+n}`,`${e},${t+n/2}`].join(" ")}" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function $i(e,t,r,n,o,i,c){let l=e+r/2,f=t+7,u=n-14;return `<rect x="${e}" y="${f}" width="${r}" height="${u}" fill="${o}" stroke="none" />
<line x1="${e}" y1="${f}" x2="${e}" y2="${f+u}" stroke="${i}" stroke-width="${c}" />
<line x1="${e+r}" y1="${f}" x2="${e+r}" y2="${f+u}" stroke="${i}" stroke-width="${c}" />
<ellipse cx="${l}" cy="${t+n-7}" rx="${r/2}" ry="7" fill="${o}" stroke="${i}" stroke-width="${c}" />
<ellipse cx="${l}" cy="${f}" rx="${r/2}" ry="7" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function ki(e,t,r,n,o,i,c){return `<polygon points="${[`${e+12},${t}`,`${e+r},${t}`,`${e+r},${t+n}`,`${e+12},${t+n}`,`${e},${t+n/2}`].join(" ")}" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function Mi(e,t,r,n,o,i,c){let s=r*.15;return `<polygon points="${[`${e+s},${t}`,`${e+r-s},${t}`,`${e+r},${t+n}`,`${e},${t+n}`].join(" ")}" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function Ei(e,t,r,n,o,i,c){let s=r*.15;return `<polygon points="${[`${e},${t}`,`${e+r},${t}`,`${e+r-s},${t+n}`,`${e+s},${t+n}`].join(" ")}" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function Ai(e,t,r,n){let o=e+r/2,i=t+n/2,c=Math.min(r,n)/2-2;return `<circle cx="${o}" cy="${i}" r="${c}" fill="var(--_text)" stroke="none" />`}function _i(e,t,r,n){let o=e+r/2,i=t+n/2,c=Math.min(r,n)/2-2,s=c-4;return `<circle cx="${o}" cy="${i}" r="${c}" fill="none" stroke="var(--_text)" stroke-width="${se.innerBox*2}" />
<circle cx="${o}" cy="${i}" r="${s}" fill="var(--_text)" stroke="none" />`}function Li(e,t){if((e.shape==="state-start"||e.shape==="state-end")&&!e.label)return "";let r=e.x+e.width/2,n=e.y+e.height/2,o=Ge(e.inlineStyle?.color??"var(--_text)");return `<text x="${r}" y="${n}" text-anchor="middle" dy="${ue}" font-size="${J.nodeLabel}" font-weight="${te.nodeLabel}" fill="${o}">${Ge(e.label)}</text>`}function Ge(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}var ne={padding:30,actorGap:140,actorHeight:40,actorPadX:16,headerGap:20,messageRowHeight:40,selfMessageHeight:30,activationWidth:10,blockPadX:10,blockPadTop:40,blockPadBottom:8,blockHeaderExtra:28,dividerExtra:24,noteWidth:120,notePadding:8,noteGap:10};function br(e,t={}){if(e.actors.length===0)return {width:0,height:0,actors:[],lifelines:[],messages:[],activations:[],blocks:[],notes:[]};let r=e.actors.map(w=>{let E=ce(w.label,J.nodeLabel,te.nodeLabel);return Math.max(E+ne.actorPadX*2,80)}),n=[],o=ne.padding+r[0]/2;for(let w=0;w<e.actors.length;w++){if(w>0){let E=Math.max(ne.actorGap,(r[w-1]+r[w])/2+40);o+=E;}n.push(o);}let i=new Map;for(let w=0;w<e.actors.length;w++)i.set(e.actors[w].id,w);let c=ne.padding,s=e.actors.map((w,E)=>({id:w.id,label:w.label,type:w.type,x:n[E],y:c,width:r[E],height:ne.actorHeight})),l=c+ne.actorHeight+ne.headerGap,f=[],u=new Map;for(let w of e.blocks){let E=u.get(w.startIndex)??0;u.set(w.startIndex,Math.max(E,ne.blockHeaderExtra));for(let k of w.dividers){let T=u.get(k.index)??0;u.set(k.index,Math.max(T,ne.dividerExtra));}}let h=new Map,a=[];for(let w=0;w<e.messages.length;w++){let E=e.messages[w],k=i.get(E.from)??0,T=i.get(E.to)??0,R=E.from===E.to,N=u.get(w)??0;N>0&&(l+=N);let O=n[k],j=n[T];if(f.push({from:E.from,to:E.to,label:E.label,lineStyle:E.lineStyle,arrowHead:E.arrowHead,x1:O,x2:j,y:l,isSelf:R}),E.activate&&(h.has(E.to)||h.set(E.to,[]),h.get(E.to).push(l)),E.deactivate){let M=h.get(E.from);if(M&&M.length>0){let C=M.pop(),S=i.get(E.from)??0;a.push({actorId:E.from,x:n[S]-ne.activationWidth/2,topY:C,bottomY:l,width:ne.activationWidth});}}l+=R?ne.selfMessageHeight+ne.messageRowHeight:ne.messageRowHeight;}for(let[w,E]of h)for(let k of E){let T=i.get(w)??0;a.push({actorId:w,x:n[T]-ne.activationWidth/2,topY:k,bottomY:l-ne.messageRowHeight/2,width:ne.activationWidth});}let d=e.blocks.map(w=>{let E=f[w.startIndex],k=f[w.endIndex],T=(E?.y??l)-ne.blockPadTop,R=(k?.y??l)+ne.blockPadBottom+12,N=new Set;for(let L=w.startIndex;L<=w.endIndex;L++){let v=e.messages[L];v&&(N.add(i.get(v.from)??0),N.add(i.get(v.to)??0));}if(N.size===0)for(let L=0;L<e.actors.length;L++)N.add(L);let O=Math.min(...N),j=Math.max(...N),M=n[O]-r[O]/2-ne.blockPadX,C=n[j]+r[j]/2+ne.blockPadX,S=w.dividers.map(L=>{let v=f[L.index],B=v?.y??l,F=28;if(L.label&&v?.label){let A=`[${L.label}]`,I=ce(A,J.edgeLabel,te.edgeLabel),X=M+8,W=X+I,H=ce(v.label,J.edgeLabel,te.edgeLabel),V=v.isSelf?v.x1+36:(v.x1+v.x2)/2-H/2,z=V+H;W>V&&X<z&&(F=36);}return {y:B-F,label:L.label}});return {type:w.type,label:w.label,x:M,y:T,width:C-M,height:R-T,dividers:S}}),p=e.notes.map(w=>{let E=Math.max(ne.noteWidth,ce(w.text,J.edgeLabel,te.edgeLabel)+ne.notePadding*2),k=J.edgeLabel+ne.notePadding*2,R=(f[w.afterIndex]?.y??c+ne.actorHeight)+4,N=i.get(w.actorIds[0]??"")??0,O;if(w.position==="left")O=n[N]-r[N]/2-E-ne.noteGap;else if(w.position==="right")O=n[N]+r[N]/2+ne.noteGap;else if(w.actorIds.length>1){let j=i.get(w.actorIds[w.actorIds.length-1]??"")??N;O=(n[N]+n[j])/2-E/2;}else O=n[N]-E/2;return {text:w.text,x:O,y:R,width:E,height:k}}),x=l+ne.padding,g=ne.padding,m=0;for(let w of s)g=Math.min(g,w.x-w.width/2),m=Math.max(m,w.x+w.width/2);for(let w of d)g=Math.min(g,w.x),m=Math.max(m,w.x+w.width);for(let w of p)g=Math.min(g,w.x),m=Math.max(m,w.x+w.width);let y=g<ne.padding?ne.padding-g:0;if(y>0){for(let w of s)w.x+=y;for(let w of f)w.x1+=y,w.x2+=y;for(let w of a)w.x+=y;for(let w of d)w.x+=y;for(let w of p)w.x+=y;for(let w=0;w<n.length;w++)n[w]+=y;}let b=e.actors.map((w,E)=>({actorId:w.id,x:n[E],topY:c+ne.actorHeight,bottomY:x-ne.padding})),_=m+y+ne.padding,P=x;return {width:Math.max(_,200),height:Math.max(P,100),actors:s,lifelines:b,messages:f,activations:a,blocks:d,notes:p}}function yr(e,t,r="Inter",n=false){let o=[];o.push(Ie(e.width,e.height,t,n)),o.push(Te(r,false)),o.push("<defs>"),o.push(Ti()),o.push("</defs>");for(let i of e.blocks)o.push(Ni(i));for(let i of e.lifelines)o.push(Di(i));for(let i of e.activations)o.push(Pi(i));for(let i of e.messages)o.push(Ri(i));for(let i of e.notes)o.push(Oi(i));for(let i of e.actors)o.push(Ii(i));return o.push("</svg>"),o.join(`
`)}function Ti(){let e=qe.width,t=qe.height;return `  <marker id="seq-arrow" markerWidth="${e}" markerHeight="${t}" refX="${e}" refY="${t/2}" orient="auto-start-reverse">
    <polygon points="0 0, ${e} ${t/2}, 0 ${t}" fill="var(--_arrow)" />
  </marker>
  <marker id="seq-arrow-open" markerWidth="${e}" markerHeight="${t}" refX="${e}" refY="${t/2}" orient="auto-start-reverse">
    <polyline points="0 0, ${e} ${t/2}, 0 ${t}" fill="none" stroke="var(--_arrow)" stroke-width="1" />
  </marker>`}function Ii(e){let{x:t,y:r,width:n,height:o,label:i,type:c}=e;if(c==="actor"){let l=o/24*.9,f=t-12*l,u=r+(o-24*l)/2,h=se.outerBox/l,a="var(--_line)";return `<g transform="translate(${f},${u}) scale(${l})">
  <path d="M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" fill="none" stroke="${a}" stroke-width="${h}" />
  <path d="M15 10C15 11.6569 13.6569 13 12 13C10.3431 13 9 11.6569 9 10C9 8.34315 10.3431 7 12 7C13.6569 7 15 8.34315 15 10Z" fill="none" stroke="${a}" stroke-width="${h}" />
  <path d="M5.62842 18.3563C7.08963 17.0398 9.39997 16 12 16C14.6 16 16.9104 17.0398 18.3716 18.3563" fill="none" stroke="${a}" stroke-width="${h}" />
</g>
<text x="${t}" y="${r+o+14}" text-anchor="middle" font-size="${J.nodeLabel}" font-weight="${te.nodeLabel}" fill="var(--_text)">${Fe(i)}</text>`}return `<rect x="${t-n/2}" y="${r}" width="${n}" height="${o}" rx="4" ry="4" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="${se.outerBox}" />
<text x="${t}" y="${r+o/2}" text-anchor="middle" dy="${ue}" font-size="${J.nodeLabel}" font-weight="${te.nodeLabel}" fill="var(--_text)">${Fe(i)}</text>`}function Di(e){return `<line x1="${e.x}" y1="${e.topY}" x2="${e.x}" y2="${e.bottomY}" stroke="var(--_line)" stroke-width="0.75" stroke-dasharray="6 4" />`}function Pi(e){return `<rect x="${e.x}" y="${e.topY}" width="${e.width}" height="${e.bottomY-e.topY}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="${se.innerBox}" />`}function Ri(e){let t=[],r=e.lineStyle==="dashed"?' stroke-dasharray="6 4"':"",n=e.arrowHead==="filled"?"seq-arrow":"seq-arrow-open";if(e.isSelf)t.push(`<polyline points="${e.x1},${e.y} ${e.x1+30},${e.y} ${e.x1+30},${e.y+20} ${e.x2},${e.y+20}" fill="none" stroke="var(--_line)" stroke-width="${se.connector}"${r} marker-end="url(#${n})" />`),t.push(`<text x="${e.x1+30+6}" y="${e.y+20/2}" dy="${ue}" font-size="${J.edgeLabel}" font-weight="${te.edgeLabel}" fill="var(--_text-muted)">${Fe(e.label)}</text>`);else {t.push(`<line x1="${e.x1}" y1="${e.y}" x2="${e.x2}" y2="${e.y}" stroke="var(--_line)" stroke-width="${se.connector}"${r} marker-end="url(#${n})" />`);let o=(e.x1+e.x2)/2;t.push(`<text x="${o}" y="${e.y-6}" text-anchor="middle" font-size="${J.edgeLabel}" font-weight="${te.edgeLabel}" fill="var(--_text-muted)">${Fe(e.label)}</text>`);}return t.join(`
`)}function Ni(e){let t=[];t.push(`<rect x="${e.x}" y="${e.y}" width="${e.width}" height="${e.height}" rx="0" ry="0" fill="none" stroke="var(--_node-stroke)" stroke-width="${se.outerBox}" />`);let r=`${e.type}${e.label?` [${e.label}]`:""}`,n=ce(r,J.edgeLabel,te.groupHeader)+16,o=18;t.push(`<rect x="${e.x}" y="${e.y}" width="${n}" height="${o}" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="${se.outerBox}" />`),t.push(`<text x="${e.x+6}" y="${e.y+o/2}" dy="${ue}" font-size="${J.edgeLabel}" font-weight="${te.groupHeader}" fill="var(--_text-sec)">${Fe(r)}</text>`);for(let i of e.dividers)t.push(`<line x1="${e.x}" y1="${i.y}" x2="${e.x+e.width}" y2="${i.y}" stroke="var(--_line)" stroke-width="0.75" stroke-dasharray="6 4" />`),i.label&&t.push(`<text x="${e.x+8}" y="${i.y+14}" font-size="${J.edgeLabel}" font-weight="${te.edgeLabel}" fill="var(--_text-muted)">[${Fe(i.label)}]</text>`);return t.join(`
`)}function Oi(e){return `<rect x="${e.x}" y="${e.y}" width="${e.width}" height="${e.height}" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="${se.innerBox}" />
<polygon points="${e.x+e.width-6},${e.y} ${e.x+e.width},${e.y+6} ${e.x+e.width-6},${e.y+6}" fill="var(--_inner-stroke)" />
<text x="${e.x+e.width/2}" y="${e.y+e.height/2}" text-anchor="middle" dy="${ue}" font-size="${J.edgeLabel}" font-weight="${te.edgeLabel}" fill="var(--_text-muted)">${Fe(e.text)}</text>`}function Fe(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}var Kt=vt(mt());var le={padding:40,boxPadX:8,headerBaseHeight:32,annotationHeight:16,memberRowHeight:20,sectionPadY:8,emptySectionHeight:8,minWidth:120,memberFontSize:11,nodeSpacing:40,layerSpacing:60};async function vr(e,t={}){if(e.classes.length===0)return {width:0,height:0,classes:[],relationships:[]};let r=new Map;for(let s of e.classes){let l=s.annotation?le.headerBaseHeight+le.annotationHeight:le.headerBaseHeight,f=s.attributes.length>0?s.attributes.length*le.memberRowHeight+le.sectionPadY:le.emptySectionHeight,u=s.methods.length>0?s.methods.length*le.memberRowHeight+le.sectionPadY:le.emptySectionHeight,h=ce(s.label,J.nodeLabel,te.nodeLabel),a=wr(s.attributes),d=wr(s.methods),p=Math.max(le.minWidth,h+le.boxPadX*2,a+le.boxPadX*2,d+le.boxPadX*2),x=l+f+u;r.set(s.id,{width:p,height:x,headerHeight:l,attrHeight:f,methodHeight:u});}let n=new Kt.default.graphlib.Graph({directed:true});n.setGraph({rankdir:"TB",acyclicer:"greedy",nodesep:le.nodeSpacing,ranksep:le.layerSpacing,marginx:le.padding,marginy:le.padding}),n.setDefaultEdgeLabel(()=>({}));for(let s of e.classes){let l=r.get(s.id);n.setNode(s.id,{width:l.width,height:l.height});}for(let s=0;s<e.relationships.length;s++){let l=e.relationships[s],f={_index:s};l.label&&(f.label=l.label,f.width=ce(l.label,J.edgeLabel,te.edgeLabel)+8,f.height=J.edgeLabel+6,f.labelpos="c"),n.setEdge(l.from,l.to,f);}try{Kt.default.layout(n);}catch(s){let l=s instanceof Error?s.message:String(s);throw new Error(`Dagre layout failed (class diagram): ${l}`)}let o=new Map;for(let s of e.classes)o.set(s.id,s);let i=e.classes.map(s=>{let l=n.node(s.id),f=r.get(s.id),u=_e(l.x,l.y,l.width,l.height);return {id:s.id,label:s.label,annotation:s.annotation,attributes:s.attributes,methods:s.methods,x:u.x,y:u.y,width:l.width??f.width,height:l.height??f.height,headerHeight:f.headerHeight,attrHeight:f.attrHeight,methodHeight:f.methodHeight}}),c=n.edges().map(s=>{let l=n.edge(s),f=e.relationships[l._index],u=l.points??[],h=De(u,true),a=n.node(s.v),d=n.node(s.w),p=Be(h,a?{cx:a.x,cy:a.y,hw:a.width/2,hh:a.height/2}:null,d?{cx:d.x,cy:d.y,hw:d.width/2,hh:d.height/2}:null),x;return f.label&&l.x!=null&&l.y!=null&&(x={x:l.x,y:l.y}),{from:f.from,to:f.to,type:f.type,markerAt:f.markerAt,label:f.label,fromCardinality:f.fromCardinality,toCardinality:f.toCardinality,points:p,labelPosition:x}});return {width:n.graph().width??600,height:n.graph().height??400,classes:i,relationships:c}}function wr(e){if(e.length===0)return 0;let t=0;for(let r of e){let n=Bi(r),o=gt(n,le.memberFontSize);o>t&&(t=o);}return t}function Bi(e){let t=e.visibility?`${e.visibility} `:"",r=e.type?`: ${e.type}`:"";return `${t}${e.name}${r}`}var yt={memberSize:11,memberWeight:400,annotationSize:10,annotationWeight:500};function $r(e,t,r="Inter",n=false){let o=[];o.push(Ie(e.width,e.height,t,n)),o.push(Te(r,true)),o.push("<defs>"),o.push(Gi()),o.push("</defs>");for(let i of e.relationships)o.push(Xi(i));for(let i of e.classes)o.push(Fi(i));for(let i of e.relationships)o.push(Hi(i));return o.push("</svg>"),o.join(`
`)}function Gi(){return `  <marker id="cls-inherit" markerWidth="12" markerHeight="10" refX="12" refY="5" orient="auto-start-reverse">
    <polygon points="0 0, 12 5, 0 10" fill="var(--bg)" stroke="var(--_arrow)" stroke-width="1.5" />
  </marker>
  <marker id="cls-composition" markerWidth="12" markerHeight="10" refX="0" refY="5" orient="auto-start-reverse">
    <polygon points="6 0, 12 5, 6 10, 0 5" fill="var(--_arrow)" stroke="var(--_arrow)" stroke-width="1" />
  </marker>
  <marker id="cls-aggregation" markerWidth="12" markerHeight="10" refX="0" refY="5" orient="auto-start-reverse">
    <polygon points="6 0, 12 5, 6 10, 0 5" fill="var(--bg)" stroke="var(--_arrow)" stroke-width="1.5" />
  </marker>
  <marker id="cls-arrow" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto-start-reverse">
    <polyline points="0 0, 8 3, 0 6" fill="none" stroke="var(--_arrow)" stroke-width="1.5" />
  </marker>`}function Fi(e){let{x:t,y:r,width:n,height:o,headerHeight:i,attrHeight:c,methodHeight:s}=e,l=[];l.push(`<rect x="${t}" y="${r}" width="${n}" height="${o}" rx="0" ry="0" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="${se.outerBox}" />`),l.push(`<rect x="${t}" y="${r}" width="${n}" height="${i}" rx="0" ry="0" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="${se.outerBox}" />`);let f=r+i/2;if(e.annotation){let d=r+12;l.push(`<text x="${t+n/2}" y="${d}" text-anchor="middle" dy="${ue}" font-size="${yt.annotationSize}" font-weight="${yt.annotationWeight}" font-style="italic" fill="var(--_text-muted)">&lt;&lt;${Pe(e.annotation)}&gt;&gt;</text>`),f=r+i/2+6;}l.push(`<text x="${t+n/2}" y="${f}" text-anchor="middle" dy="${ue}" font-size="${J.nodeLabel}" font-weight="700" fill="var(--_text)">${Pe(e.label)}</text>`);let u=r+i;l.push(`<line x1="${t}" y1="${u}" x2="${t+n}" y2="${u}" stroke="var(--_node-stroke)" stroke-width="${se.innerBox}" />`);let h=20;for(let d=0;d<e.attributes.length;d++){let p=e.attributes[d],x=u+4+d*h+h/2;l.push(Cr(p,t+le.boxPadX,x));}let a=u+c;l.push(`<line x1="${t}" y1="${a}" x2="${t+n}" y2="${a}" stroke="var(--_node-stroke)" stroke-width="${se.innerBox}" />`);for(let d=0;d<e.methods.length;d++){let p=e.methods[d],x=a+4+d*h+h/2;l.push(Cr(p,t+le.boxPadX,x));}return l.join(`
`)}function Cr(e,t,r){let n=e.isAbstract?' font-style="italic"':"",o=e.isStatic?' text-decoration="underline"':"",i=[];return e.visibility&&i.push(`<tspan fill="var(--_text-faint)">${Pe(e.visibility)} </tspan>`),i.push(`<tspan fill="var(--_text-sec)">${Pe(e.name)}</tspan>`),e.type&&(i.push('<tspan fill="var(--_text-faint)">: </tspan>'),i.push(`<tspan fill="var(--_text-muted)">${Pe(e.type)}</tspan>`)),`<text x="${t}" y="${r}" class="mono" dy="${ue}" font-size="${yt.memberSize}" font-weight="${yt.memberWeight}"${n}${o}>${i.join("")}</text>`}function Xi(e){if(e.points.length<2)return "";let t=e.points.map(i=>`${i.x},${i.y}`).join(" "),n=e.type==="dependency"||e.type==="realization"?' stroke-dasharray="6 4"':"",o=Wi(e.type,e.markerAt);return `<polyline points="${t}" fill="none" stroke="var(--_line)" stroke-width="${se.connector}"${n}${o} />`}function Wi(e,t){let r=Yi(e);return r?t==="from"?` marker-start="url(#${r})"`:` marker-end="url(#${r})"`:""}function Yi(e){switch(e){case "inheritance":case "realization":return "cls-inherit";case "composition":return "cls-composition";case "aggregation":return "cls-aggregation";case "association":case "dependency":return "cls-arrow";default:return null}}function Hi(e){if(!e.label&&!e.fromCardinality&&!e.toCardinality||e.points.length<2)return "";let t=[];if(e.label){let r=e.labelPosition??ji(e.points);t.push(`<text x="${r.x}" y="${r.y-8}" text-anchor="middle" font-size="${J.edgeLabel}" font-weight="${te.edgeLabel}" fill="var(--_text-muted)">${Pe(e.label)}</text>`);}if(e.fromCardinality){let r=e.points[0],n=e.points[1],o=Sr(r,n);t.push(`<text x="${r.x+o.x}" y="${r.y+o.y}" text-anchor="middle" font-size="${J.edgeLabel}" font-weight="${te.edgeLabel}" fill="var(--_text-muted)">${Pe(e.fromCardinality)}</text>`);}if(e.toCardinality){let r=e.points[e.points.length-1],n=e.points[e.points.length-2],o=Sr(r,n);t.push(`<text x="${r.x+o.x}" y="${r.y+o.y}" text-anchor="middle" font-size="${J.edgeLabel}" font-weight="${te.edgeLabel}" fill="var(--_text-muted)">${Pe(e.toCardinality)}</text>`);}return t.join(`
`)}function ji(e){if(e.length===0)return {x:0,y:0};let t=Math.floor(e.length/2);return e[t]}function Sr(e,t){let r=t.x-e.x,n=t.y-e.y;return Math.abs(r)>Math.abs(n)?{x:r>0?14:-14,y:-10}:{x:-14,y:n>0?14:-14}}function Pe(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}var Jt=vt(mt());var we={padding:40,boxPadX:12,headerHeight:32,rowHeight:22,minWidth:140,attrFontSize:11,nodeSpacing:50,layerSpacing:70};async function kr(e,t={}){if(e.entities.length===0)return {width:0,height:0,entities:[],relationships:[]};let r=new Map;for(let s of e.entities){let l=ce(s.label,J.nodeLabel,te.nodeLabel),f=0;for(let a of s.attributes){let d=`${a.type}  ${a.name}${a.keys.length>0?"  "+a.keys.join(","):""}`,p=gt(d,we.attrFontSize);p>f&&(f=p);}let u=Math.max(we.minWidth,l+we.boxPadX*2,f+we.boxPadX*2),h=we.headerHeight+Math.max(s.attributes.length,1)*we.rowHeight;r.set(s.id,{width:u,height:h});}let n=new Jt.default.graphlib.Graph({directed:true});n.setGraph({rankdir:"LR",acyclicer:"greedy",nodesep:we.nodeSpacing,ranksep:we.layerSpacing,marginx:we.padding,marginy:we.padding}),n.setDefaultEdgeLabel(()=>({}));for(let s of e.entities){let l=r.get(s.id);n.setNode(s.id,{width:l.width,height:l.height});}for(let s=0;s<e.relationships.length;s++){let l=e.relationships[s];n.setEdge(l.entity1,l.entity2,{_index:s,label:l.label,width:ce(l.label,J.edgeLabel,te.edgeLabel)+8,height:J.edgeLabel+6,labelpos:"c"});}try{Jt.default.layout(n);}catch(s){let l=s instanceof Error?s.message:String(s);throw new Error(`Dagre layout failed (ER diagram): ${l}`)}let o=new Map;for(let s of e.entities)o.set(s.id,s);let i=e.entities.map(s=>{let l=n.node(s.id),f=_e(l.x,l.y,l.width,l.height);return {id:s.id,label:s.label,attributes:s.attributes,x:f.x,y:f.y,width:l.width??r.get(s.id).width,height:l.height??r.get(s.id).height,headerHeight:we.headerHeight,rowHeight:we.rowHeight}}),c=n.edges().map(s=>{let l=n.edge(s),f=e.relationships[l._index],u=l.points??[],h=De(u,false),a=n.node(s.v),d=n.node(s.w),p=Be(h,a?{cx:a.x,cy:a.y,hw:a.width/2,hh:a.height/2}:null,d?{cx:d.x,cy:d.y,hw:d.width/2,hh:d.height/2}:null);return {entity1:f.entity1,entity2:f.entity2,cardinality1:f.cardinality1,cardinality2:f.cardinality2,label:f.label,identifying:f.identifying,points:p}});return {width:n.graph().width??600,height:n.graph().height??400,entities:i,relationships:c}}var Le={attrSize:11,attrWeight:400,keySize:9,keyWeight:600};function Er(e,t,r="Inter",n=false){let o=[];o.push(Ie(e.width,e.height,t,n)),o.push(Te(r,true)),o.push("<defs>"),o.push("</defs>");for(let i of e.relationships)o.push(Vi(i));for(let i of e.entities)o.push(zi(i));for(let i of e.relationships)o.push(Ki(i));for(let i of e.relationships)o.push(qi(i));return o.push("</svg>"),o.join(`
`)}function zi(e){let{x:t,y:r,width:n,height:o,headerHeight:i,rowHeight:c,label:s,attributes:l}=e,f=[];f.push(`<rect x="${t}" y="${r}" width="${n}" height="${o}" rx="0" ry="0" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="${se.outerBox}" />`),f.push(`<rect x="${t}" y="${r}" width="${n}" height="${i}" rx="0" ry="0" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="${se.outerBox}" />`),f.push(`<text x="${t+n/2}" y="${r+i/2}" text-anchor="middle" dy="${ue}" font-size="${J.nodeLabel}" font-weight="700" fill="var(--_text)">${wt(s)}</text>`);let u=r+i;f.push(`<line x1="${t}" y1="${u}" x2="${t+n}" y2="${u}" stroke="var(--_node-stroke)" stroke-width="${se.innerBox}" />`);for(let h=0;h<l.length;h++){let a=l[h],d=u+h*c+c/2;f.push(Ui(a,t,d,n));}return l.length===0&&f.push(`<text x="${t+n/2}" y="${u+c/2}" text-anchor="middle" dy="${ue}" font-size="${Le.attrSize}" fill="var(--_text-faint)" font-style="italic">(no attributes)</text>`),f.join(`
`)}function Ui(e,t,r,n){let o=[],i=0;if(e.keys.length>0){let l=e.keys.join(",");i=ce(l,Le.keySize,Le.keyWeight)+8,o.push(`<rect x="${t+6}" y="${r-7}" width="${i}" height="14" rx="2" ry="2" fill="var(--_key-badge)" />`),o.push(`<text x="${t+6+i/2}" y="${r}" text-anchor="middle" dy="${ue}" font-size="${Le.keySize}" font-weight="${Le.keyWeight}" fill="var(--_text-sec)">${e.keys.join(",")}</text>`);}let c=t+8+(i>0?i+6:0);o.push(`<text x="${c}" y="${r}" class="mono" dy="${ue}" font-size="${Le.attrSize}" font-weight="${Le.attrWeight}"><tspan fill="var(--_text-muted)">${wt(e.type)}</tspan></text>`);let s=t+n-8;return o.push(`<text x="${s}" y="${r}" class="mono" text-anchor="end" dy="${ue}" font-size="${Le.attrSize}" font-weight="${Le.attrWeight}"><tspan fill="var(--_text-sec)">${wt(e.name)}</tspan></text>`),o.join(`
`)}function Vi(e){if(e.points.length<2)return "";let t=e.points.map(n=>`${n.x},${n.y}`).join(" "),r=e.identifying?"":' stroke-dasharray="6 4"';return `<polyline points="${t}" fill="none" stroke="var(--_line)" stroke-width="${se.connector}"${r} />`}function qi(e){if(!e.label||e.points.length<2)return "";let t=Ji(e.points),n=ce(e.label,J.edgeLabel,te.edgeLabel)+8,o=J.edgeLabel+6;return `<rect x="${t.x-n/2}" y="${t.y-o/2}" width="${n}" height="${o}" rx="2" ry="2" fill="var(--bg)" stroke="var(--_inner-stroke)" stroke-width="0.5" />
<text x="${t.x}" y="${t.y}" text-anchor="middle" dy="${ue}" font-size="${J.edgeLabel}" font-weight="${te.edgeLabel}" fill="var(--_text-muted)">${wt(e.label)}</text>`}function Ki(e){if(e.points.length<2)return "";let t=[],r=e.points[0],n=e.points[1];t.push(Mr(r,n,e.cardinality1));let o=e.points[e.points.length-1],i=e.points[e.points.length-2];return t.push(Mr(o,i,e.cardinality2)),t.join(`
`)}function Mr(e,t,r){let n=[],o=se.connector+.25,i=e.x-t.x,c=e.y-t.y,s=Math.sqrt(i*i+c*c);if(s===0)return "";let l=i/s,f=c/s,u=-f,h=l,a=e.x-l*4,d=e.y-f*4,p=e.x-l*16,x=e.y-f*16,g=r==="one"||r==="zero-one",m=r==="many"||r==="zero-many",y=r==="zero-one"||r==="zero-many";if(g){n.push(`<line x1="${a+u*6}" y1="${d+h*6}" x2="${a-u*6}" y2="${d-h*6}" stroke="var(--_line)" stroke-width="${o}" />`);let _=a-l*4,P=d-f*4;n.push(`<line x1="${_+u*6}" y1="${P+h*6}" x2="${_-u*6}" y2="${P-h*6}" stroke="var(--_line)" stroke-width="${o}" />`);}if(m){let _=a,P=d;n.push(`<line x1="${_+u*7}" y1="${P+h*7}" x2="${p}" y2="${x}" stroke="var(--_line)" stroke-width="${o}" />`),n.push(`<line x1="${_}" y1="${P}" x2="${p}" y2="${x}" stroke="var(--_line)" stroke-width="${o}" />`),n.push(`<line x1="${_-u*7}" y1="${P-h*7}" x2="${p}" y2="${x}" stroke="var(--_line)" stroke-width="${o}" />`);}if(y){let b=m?20:12,_=e.x-l*b,P=e.y-f*b;n.push(`<circle cx="${_}" cy="${P}" r="4" fill="var(--bg)" stroke="var(--_line)" stroke-width="${o}" />`);}return n.join(`
`)}function Ji(e){if(e.length===0)return {x:0,y:0};if(e.length===1)return e[0];let t=0;for(let o=1;o<e.length;o++){let i=e[o].x-e[o-1].x,c=e[o].y-e[o-1].y;t+=Math.sqrt(i*i+c*c);}if(t===0)return e[0];let r=t/2,n=0;for(let o=1;o<e.length;o++){let i=e[o].x-e[o-1].x,c=e[o].y-e[o-1].y,s=Math.sqrt(i*i+c*c);if(n+s>=r){let l=s>0?(r-n)/s:0;return {x:e[o-1].x+i*l,y:e[o-1].y+c*l}}n+=s;}return e[e.length-1]}function wt(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function Zi(e){let t=e.trim().split(/[\n;]/)[0]?.trim().toLowerCase()??"";return /^sequencediagram\s*$/.test(t)?"sequence":/^classdiagram\s*$/.test(t)?"class":/^erdiagram\s*$/.test(t)?"er":"flowchart"}function Qi(e){return {bg:e.bg??Xe.bg,fg:e.fg??Xe.fg,line:e.line,accent:e.accent,muted:e.muted,surface:e.surface,border:e.border}}async function Ar(e,t={}){let r=Qi(t),n=t.font??"Inter",o=t.transparent??false,i=Zi(e),c=e.split(/[\n;]/).map(s=>s.trim()).filter(s=>s.length>0&&!s.startsWith("%%"));switch(i){case "sequence":{let s=dt(c),l=br(s,t);return yr(l,r,n,o)}case "class":{let s=ut(c),l=await vr(s,t);return $r(l,r,n,o)}case "er":{let s=ft(c),l=await kr(s,t);return Er(l,r,n,o)}default:{let s=Qe(e),l=await ir(s,t);return gr(l,r,n,o)}}}typeof window<"u"&&(window.__mermaid={renderMermaid:Ar,renderMermaidAscii:pt,renderMermaidAsciiWithMeta:Yt,THEMES:Ct,DEFAULTS:Xe,fromShikiTheme:St});exports.DEFAULTS=Xe;exports.THEMES=Ct;exports.fromShikiTheme=St;exports.renderMermaid=Ar;exports.renderMermaidAscii=pt;exports.renderMermaidAsciiWithMeta=Yt;return exports;})({});//# sourceMappingURL=beautiful-mermaid.browser.global.js.map
//# sourceMappingURL=beautiful-mermaid.browser.global.js.map