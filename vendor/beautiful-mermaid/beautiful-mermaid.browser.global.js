var beautifulMermaid=(function(exports){'use strict';var fo=Object.create;var Mn=Object.defineProperty;var uo=Object.getOwnPropertyDescriptor;var ho=Object.getOwnPropertyNames;var mo=Object.getPrototypeOf,po=Object.prototype.hasOwnProperty;var me=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,r)=>(typeof require<"u"?require:e)[r]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var go=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var xo=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of ho(e))!po.call(t,o)&&o!==r&&Mn(t,o,{get:()=>e[o],enumerable:!(n=uo(e,o))||n.enumerable});return t};var Fe=(t,e,r)=>(r=t!=null?fo(mo(t)):{},xo(Mn(r,"default",{value:t,enumerable:true}),t));var Oe=go((Ar,dn)=>{(function(t){if(typeof Ar=="object"&&typeof dn<"u")dn.exports=t();else if(typeof define=="function"&&define.amd)define([],t);else {var e;typeof window<"u"?e=window:typeof global<"u"?e=global:typeof self<"u"?e=self:e=this,e.dagre=t();}})(function(){return (function(){function n(o,i,a){function s(u,p){if(!i[u]){if(!o[u]){var c=typeof me=="function"&&me;if(!p&&c)return c(u,true);if(l)return l(u,true);var f=new Error("Cannot find module '"+u+"'");throw f.code="MODULE_NOT_FOUND",f}var g=i[u]={exports:{}};o[u][0].call(g.exports,function(x){var m=o[u][1][x];return s(m||x)},g,g.exports,n,o,i,a);}return i[u].exports}for(var l=typeof me=="function"&&me,d=0;d<a.length;d++)s(a[d]);return s}return n})()({1:[function(n,o,i){o.exports={graphlib:n("@dagrejs/graphlib"),layout:n("./lib/layout"),debug:n("./lib/debug"),util:{time:n("./lib/util").time,notime:n("./lib/util").notime},version:n("./lib/version")};},{"./lib/debug":6,"./lib/layout":8,"./lib/util":27,"./lib/version":28,"@dagrejs/graphlib":29}],2:[function(n,o,i){let a=n("./greedy-fas"),s=n("./util").uniqueId;o.exports={run:l,undo:u};function l(p){(p.graph().acyclicer==="greedy"?a(p,f(p)):d(p)).forEach(g=>{let x=p.edge(g);p.removeEdge(g),x.forwardName=g.name,x.reversed=true,p.setEdge(g.w,g.v,x,s("rev"));});function f(g){return x=>g.edge(x).weight}}function d(p){let c=[],f={},g={};function x(m){Object.hasOwn(g,m)||(g[m]=true,f[m]=true,p.outEdges(m).forEach(h=>{Object.hasOwn(f,h.w)?c.push(h):x(h.w);}),delete f[m]);}return p.nodes().forEach(x),c}function u(p){p.edges().forEach(c=>{let f=p.edge(c);if(f.reversed){p.removeEdge(c);let g=f.forwardName;delete f.reversed,delete f.forwardName,p.setEdge(c.w,c.v,f,g);}});}},{"./greedy-fas":7,"./util":27}],3:[function(n,o,i){let a=n("./util");o.exports=s;function s(d){function u(p){let c=d.children(p),f=d.node(p);if(c.length&&c.forEach(u),Object.hasOwn(f,"minRank")){f.borderLeft=[],f.borderRight=[];for(let g=f.minRank,x=f.maxRank+1;g<x;++g)l(d,"borderLeft","_bl",p,f,g),l(d,"borderRight","_br",p,f,g);}}d.children().forEach(u);}function l(d,u,p,c,f,g){let x={width:0,height:0,rank:g,borderType:u},m=f[u][g-1],h=a.addDummyNode(d,"border",x,p);f[u][g]=h,d.setParent(h,c),m&&d.setEdge(m,h,{weight:1});}},{"./util":27}],4:[function(n,o,i){o.exports={adjust:a,undo:s};function a(g){let x=g.graph().rankdir.toLowerCase();(x==="lr"||x==="rl")&&l(g);}function s(g){let x=g.graph().rankdir.toLowerCase();(x==="bt"||x==="rl")&&u(g),(x==="lr"||x==="rl")&&(c(g),l(g));}function l(g){g.nodes().forEach(x=>d(g.node(x))),g.edges().forEach(x=>d(g.edge(x)));}function d(g){let x=g.width;g.width=g.height,g.height=x;}function u(g){g.nodes().forEach(x=>p(g.node(x))),g.edges().forEach(x=>{let m=g.edge(x);m.points.forEach(p),Object.hasOwn(m,"y")&&p(m);});}function p(g){g.y=-g.y;}function c(g){g.nodes().forEach(x=>f(g.node(x))),g.edges().forEach(x=>{let m=g.edge(x);m.points.forEach(f),Object.hasOwn(m,"x")&&f(m);});}function f(g){let x=g.x;g.x=g.y,g.y=x;}},{}],5:[function(n,o,i){class a{constructor(){let u={};u._next=u._prev=u,this._sentinel=u;}dequeue(){let u=this._sentinel,p=u._prev;if(p!==u)return s(p),p}enqueue(u){let p=this._sentinel;u._prev&&u._next&&s(u),u._next=p._next,p._next._prev=u,p._next=u,u._prev=p;}toString(){let u=[],p=this._sentinel,c=p._prev;for(;c!==p;)u.push(JSON.stringify(c,l)),c=c._prev;return "["+u.join(", ")+"]"}}function s(d){d._prev._next=d._next,d._next._prev=d._prev,delete d._next,delete d._prev;}function l(d,u){if(d!=="_next"&&d!=="_prev")return u}o.exports=a;},{}],6:[function(n,o,i){let a=n("./util"),s=n("@dagrejs/graphlib").Graph;o.exports={debugOrdering:l};function l(d){let u=a.buildLayerMatrix(d),p=new s({compound:true,multigraph:true}).setGraph({});return d.nodes().forEach(c=>{p.setNode(c,{label:c}),p.setParent(c,"layer"+d.node(c).rank);}),d.edges().forEach(c=>p.setEdge(c.v,c.w,{},c.name)),u.forEach((c,f)=>{let g="layer"+f;p.setNode(g,{rank:"same"}),c.reduce((x,m)=>(p.setEdge(x,m,{style:"invis"}),m));}),p}},{"./util":27,"@dagrejs/graphlib":29}],7:[function(n,o,i){let a=n("@dagrejs/graphlib").Graph,s=n("./data/list");o.exports=d;let l=()=>1;function d(x,m){if(x.nodeCount()<=1)return [];let h=c(x,m||l);return u(h.graph,h.buckets,h.zeroIdx).flatMap(y=>x.outEdges(y.v,y.w))}function u(x,m,h){let b=[],y=m[m.length-1],M=m[0],A;for(;x.nodeCount();){for(;A=M.dequeue();)p(x,m,h,A);for(;A=y.dequeue();)p(x,m,h,A);if(x.nodeCount()){for(let w=m.length-2;w>0;--w)if(A=m[w].dequeue(),A){b=b.concat(p(x,m,h,A,true));break}}}return b}function p(x,m,h,b,y){let M=y?[]:void 0;return x.inEdges(b.v).forEach(A=>{let w=x.edge(A),$=x.node(A.v);y&&M.push({v:A.v,w:A.w}),$.out-=w,f(m,h,$);}),x.outEdges(b.v).forEach(A=>{let w=x.edge(A),$=A.w,k=x.node($);k.in-=w,f(m,h,k);}),x.removeNode(b.v),M}function c(x,m){let h=new a,b=0,y=0;x.nodes().forEach(w=>{h.setNode(w,{v:w,in:0,out:0});}),x.edges().forEach(w=>{let $=h.edge(w.v,w.w)||0,k=m(w),P=$+k;h.setEdge(w.v,w.w,P),y=Math.max(y,h.node(w.v).out+=k),b=Math.max(b,h.node(w.w).in+=k);});let M=g(y+b+3).map(()=>new s),A=b+1;return h.nodes().forEach(w=>{f(M,A,h.node(w));}),{graph:h,buckets:M,zeroIdx:A}}function f(x,m,h){h.out?h.in?x[h.out-h.in+m].enqueue(h):x[x.length-1].enqueue(h):x[0].enqueue(h);}function g(x){let m=[];for(let h=0;h<x;h++)m.push(h);return m}},{"./data/list":5,"@dagrejs/graphlib":29}],8:[function(n,o,i){let a=n("./acyclic"),s=n("./normalize"),l=n("./rank"),d=n("./util").normalizeRanks,u=n("./parent-dummy-chains"),p=n("./util").removeEmptyRanks,c=n("./nesting-graph"),f=n("./add-border-segments"),g=n("./coordinate-system"),x=n("./order"),m=n("./position"),h=n("./util"),b=n("@dagrejs/graphlib").Graph;o.exports=y;function y(C,E){let R=E&&E.debugTiming?h.time:h.notime;R("layout",()=>{let U=R("  buildLayoutGraph",()=>_(C));R("  runLayout",()=>M(U,R,E)),R("  updateInputGraph",()=>A(C,U));});}function M(C,E,R){E("    makeSpaceForEdgeLabels",()=>H(C)),E("    removeSelfEdges",()=>G(C)),E("    acyclic",()=>a.run(C)),E("    nestingGraph.run",()=>c.run(C)),E("    rank",()=>l(h.asNonCompoundGraph(C))),E("    injectEdgeLabelProxies",()=>I(C)),E("    removeEmptyRanks",()=>p(C)),E("    nestingGraph.cleanup",()=>c.cleanup(C)),E("    normalizeRanks",()=>d(C)),E("    assignRankMinMax",()=>S(C)),E("    removeEdgeLabelProxies",()=>v(C)),E("    normalize.run",()=>s.run(C)),E("    parentDummyChains",()=>u(C)),E("    addBorderSegments",()=>f(C)),E("    order",()=>x(C,R)),E("    insertSelfEdges",()=>W(C)),E("    adjustCoordinateSystem",()=>g.adjust(C)),E("    position",()=>m(C)),E("    positionSelfEdges",()=>K(C)),E("    removeBorderNodes",()=>T(C)),E("    normalize.undo",()=>s.undo(C)),E("    fixupEdgeLabelCoords",()=>L(C)),E("    undoCoordinateSystem",()=>g.undo(C)),E("    translateGraph",()=>V(C)),E("    assignNodeIntersects",()=>z(C)),E("    reversePoints",()=>D(C)),E("    acyclic.undo",()=>a.undo(C));}function A(C,E){C.nodes().forEach(R=>{let U=C.node(R),J=E.node(R);U&&(U.x=J.x,U.y=J.y,U.rank=J.rank,E.children(R).length&&(U.width=J.width,U.height=J.height));}),C.edges().forEach(R=>{let U=C.edge(R),J=E.edge(R);U.points=J.points,Object.hasOwn(J,"x")&&(U.x=J.x,U.y=J.y);}),C.graph().width=E.graph().width,C.graph().height=E.graph().height;}let w=["nodesep","edgesep","ranksep","marginx","marginy"],$={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},k=["acyclicer","ranker","rankdir","align"],P=["width","height","rank"],X={width:0,height:0},N=["minlen","weight","width","height","labeloffset"],F={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},Z=["labelpos"];function _(C){let E=new b({multigraph:true,compound:true}),R=O(C.graph());return E.setGraph(Object.assign({},$,B(R,w),h.pick(R,k))),C.nodes().forEach(U=>{let J=O(C.node(U)),et=B(J,P);Object.keys(X).forEach(Y=>{et[Y]===void 0&&(et[Y]=X[Y]);}),E.setNode(U,et),E.setParent(U,C.parent(U));}),C.edges().forEach(U=>{let J=O(C.edge(U));E.setEdge(U,Object.assign({},F,B(J,N),h.pick(J,Z)));}),E}function H(C){let E=C.graph();E.ranksep/=2,C.edges().forEach(R=>{let U=C.edge(R);U.minlen*=2,U.labelpos.toLowerCase()!=="c"&&(E.rankdir==="TB"||E.rankdir==="BT"?U.width+=U.labeloffset:U.height+=U.labeloffset);});}function I(C){C.edges().forEach(E=>{let R=C.edge(E);if(R.width&&R.height){let U=C.node(E.v),et={rank:(C.node(E.w).rank-U.rank)/2+U.rank,e:E};h.addDummyNode(C,"edge-proxy",et,"_ep");}});}function S(C){let E=0;C.nodes().forEach(R=>{let U=C.node(R);U.borderTop&&(U.minRank=C.node(U.borderTop).rank,U.maxRank=C.node(U.borderBottom).rank,E=Math.max(E,U.maxRank));}),C.graph().maxRank=E;}function v(C){C.nodes().forEach(E=>{let R=C.node(E);R.dummy==="edge-proxy"&&(C.edge(R.e).labelRank=R.rank,C.removeNode(E));});}function V(C){let E=Number.POSITIVE_INFINITY,R=0,U=Number.POSITIVE_INFINITY,J=0,et=C.graph(),Y=et.marginx||0,q=et.marginy||0;function nt(Q){let tt=Q.x,rt=Q.y,st=Q.width,ut=Q.height;E=Math.min(E,tt-st/2),R=Math.max(R,tt+st/2),U=Math.min(U,rt-ut/2),J=Math.max(J,rt+ut/2);}C.nodes().forEach(Q=>nt(C.node(Q))),C.edges().forEach(Q=>{let tt=C.edge(Q);Object.hasOwn(tt,"x")&&nt(tt);}),E-=Y,U-=q,C.nodes().forEach(Q=>{let tt=C.node(Q);tt.x-=E,tt.y-=U;}),C.edges().forEach(Q=>{let tt=C.edge(Q);tt.points.forEach(rt=>{rt.x-=E,rt.y-=U;}),Object.hasOwn(tt,"x")&&(tt.x-=E),Object.hasOwn(tt,"y")&&(tt.y-=U);}),et.width=R-E+Y,et.height=J-U+q;}function z(C){C.edges().forEach(E=>{let R=C.edge(E),U=C.node(E.v),J=C.node(E.w),et,Y;R.points?(et=R.points[0],Y=R.points[R.points.length-1]):(R.points=[],et=J,Y=U),R.points.unshift(h.intersectRect(U,et)),R.points.push(h.intersectRect(J,Y));});}function L(C){C.edges().forEach(E=>{let R=C.edge(E);if(Object.hasOwn(R,"x"))switch((R.labelpos==="l"||R.labelpos==="r")&&(R.width-=R.labeloffset),R.labelpos){case "l":R.x-=R.width/2+R.labeloffset;break;case "r":R.x+=R.width/2+R.labeloffset;break}});}function D(C){C.edges().forEach(E=>{let R=C.edge(E);R.reversed&&R.points.reverse();});}function T(C){C.nodes().forEach(E=>{if(C.children(E).length){let R=C.node(E),U=C.node(R.borderTop),J=C.node(R.borderBottom),et=C.node(R.borderLeft[R.borderLeft.length-1]),Y=C.node(R.borderRight[R.borderRight.length-1]);R.width=Math.abs(Y.x-et.x),R.height=Math.abs(J.y-U.y),R.x=et.x+R.width/2,R.y=U.y+R.height/2;}}),C.nodes().forEach(E=>{C.node(E).dummy==="border"&&C.removeNode(E);});}function G(C){C.edges().forEach(E=>{if(E.v===E.w){var R=C.node(E.v);R.selfEdges||(R.selfEdges=[]),R.selfEdges.push({e:E,label:C.edge(E)}),C.removeEdge(E);}});}function W(C){var E=h.buildLayerMatrix(C);E.forEach(R=>{var U=0;R.forEach((J,et)=>{var Y=C.node(J);Y.order=et+U,(Y.selfEdges||[]).forEach(q=>{h.addDummyNode(C,"selfedge",{width:q.label.width,height:q.label.height,rank:Y.rank,order:et+ ++U,e:q.e,label:q.label},"_se");}),delete Y.selfEdges;});});}function K(C){C.nodes().forEach(E=>{var R=C.node(E);if(R.dummy==="selfedge"){var U=C.node(R.e.v),J=U.x+U.width/2,et=U.y,Y=R.x-J,q=U.height/2;C.setEdge(R.e,R.label),C.removeNode(E),R.label.points=[{x:J+2*Y/3,y:et-q},{x:J+5*Y/6,y:et-q},{x:J+Y,y:et},{x:J+5*Y/6,y:et+q},{x:J+2*Y/3,y:et+q}],R.label.x=R.x,R.label.y=R.y;}});}function B(C,E){return h.mapValues(h.pick(C,E),Number)}function O(C){var E={};return C&&Object.entries(C).forEach(([R,U])=>{typeof R=="string"&&(R=R.toLowerCase()),E[R]=U;}),E}},{"./acyclic":2,"./add-border-segments":3,"./coordinate-system":4,"./nesting-graph":9,"./normalize":10,"./order":15,"./parent-dummy-chains":20,"./position":22,"./rank":24,"./util":27,"@dagrejs/graphlib":29}],9:[function(n,o,i){let a=n("./util");o.exports={run:s,cleanup:p};function s(c){let f=a.addDummyNode(c,"root",{},"_root"),g=d(c),x=Object.values(g),m=a.applyWithChunking(Math.max,x)-1,h=2*m+1;c.graph().nestingRoot=f,c.edges().forEach(y=>c.edge(y).minlen*=h);let b=u(c)+1;c.children().forEach(y=>l(c,f,h,b,m,g,y)),c.graph().nodeRankFactor=h;}function l(c,f,g,x,m,h,b){let y=c.children(b);if(!y.length){b!==f&&c.setEdge(f,b,{weight:0,minlen:g});return}let M=a.addBorderNode(c,"_bt"),A=a.addBorderNode(c,"_bb"),w=c.node(b);c.setParent(M,b),w.borderTop=M,c.setParent(A,b),w.borderBottom=A,y.forEach($=>{l(c,f,g,x,m,h,$);let k=c.node($),P=k.borderTop?k.borderTop:$,X=k.borderBottom?k.borderBottom:$,N=k.borderTop?x:2*x,F=P!==X?1:m-h[b]+1;c.setEdge(M,P,{weight:N,minlen:F,nestingEdge:true}),c.setEdge(X,A,{weight:N,minlen:F,nestingEdge:true});}),c.parent(b)||c.setEdge(f,M,{weight:0,minlen:m+h[b]});}function d(c){var f={};function g(x,m){var h=c.children(x);h&&h.length&&h.forEach(b=>g(b,m+1)),f[x]=m;}return c.children().forEach(x=>g(x,1)),f}function u(c){return c.edges().reduce((f,g)=>f+c.edge(g).weight,0)}function p(c){var f=c.graph();c.removeNode(f.nestingRoot),delete f.nestingRoot,c.edges().forEach(g=>{var x=c.edge(g);x.nestingEdge&&c.removeEdge(g);});}},{"./util":27}],10:[function(n,o,i){let a=n("./util");o.exports={run:s,undo:d};function s(u){u.graph().dummyChains=[],u.edges().forEach(p=>l(u,p));}function l(u,p){let c=p.v,f=u.node(c).rank,g=p.w,x=u.node(g).rank,m=p.name,h=u.edge(p),b=h.labelRank;if(x===f+1)return;u.removeEdge(p);let y,M,A;for(A=0,++f;f<x;++A,++f)h.points=[],M={width:0,height:0,edgeLabel:h,edgeObj:p,rank:f},y=a.addDummyNode(u,"edge",M,"_d"),f===b&&(M.width=h.width,M.height=h.height,M.dummy="edge-label",M.labelpos=h.labelpos),u.setEdge(c,y,{weight:h.weight},m),A===0&&u.graph().dummyChains.push(y),c=y;u.setEdge(c,g,{weight:h.weight},m);}function d(u){u.graph().dummyChains.forEach(p=>{let c=u.node(p),f=c.edgeLabel,g;for(u.setEdge(c.edgeObj,f);c.dummy;)g=u.successors(p)[0],u.removeNode(p),f.points.push({x:c.x,y:c.y}),c.dummy==="edge-label"&&(f.x=c.x,f.y=c.y,f.width=c.width,f.height=c.height),p=g,c=u.node(p);});}},{"./util":27}],11:[function(n,o,i){o.exports=a;function a(s,l,d){let u={},p;d.forEach(c=>{let f=s.parent(c),g,x;for(;f;){if(g=s.parent(f),g?(x=u[g],u[g]=f):(x=p,p=f),x&&x!==f){l.setEdge(x,f);return}f=g;}});}},{}],12:[function(n,o,i){o.exports=a;function a(s,l=[]){return l.map(d=>{let u=s.inEdges(d);if(u.length){let p=u.reduce((c,f)=>{let g=s.edge(f),x=s.node(f.v);return {sum:c.sum+g.weight*x.order,weight:c.weight+g.weight}},{sum:0,weight:0});return {v:d,barycenter:p.sum/p.weight,weight:p.weight}}else return {v:d}})}},{}],13:[function(n,o,i){let a=n("@dagrejs/graphlib").Graph,s=n("../util");o.exports=l;function l(u,p,c,f){f||(f=u.nodes());let g=d(u),x=new a({compound:true}).setGraph({root:g}).setDefaultNodeLabel(m=>u.node(m));return f.forEach(m=>{let h=u.node(m),b=u.parent(m);(h.rank===p||h.minRank<=p&&p<=h.maxRank)&&(x.setNode(m),x.setParent(m,b||g),u[c](m).forEach(y=>{let M=y.v===m?y.w:y.v,A=x.edge(M,m),w=A!==void 0?A.weight:0;x.setEdge(M,m,{weight:u.edge(y).weight+w});}),Object.hasOwn(h,"minRank")&&x.setNode(m,{borderLeft:h.borderLeft[p],borderRight:h.borderRight[p]}));}),x}function d(u){for(var p;u.hasNode(p=s.uniqueId("_root")););return p}},{"../util":27,"@dagrejs/graphlib":29}],14:[function(n,o,i){let a=n("../util").zipObject;o.exports=s;function s(d,u){let p=0;for(let c=1;c<u.length;++c)p+=l(d,u[c-1],u[c]);return p}function l(d,u,p){let c=a(p,p.map((b,y)=>y)),f=u.flatMap(b=>d.outEdges(b).map(y=>({pos:c[y.w],weight:d.edge(y).weight})).sort((y,M)=>y.pos-M.pos)),g=1;for(;g<p.length;)g<<=1;let x=2*g-1;g-=1;let m=new Array(x).fill(0),h=0;return f.forEach(b=>{let y=b.pos+g;m[y]+=b.weight;let M=0;for(;y>0;)y%2&&(M+=m[y+1]),y=y-1>>1,m[y]+=b.weight;h+=b.weight*M;}),h}},{"../util":27}],15:[function(n,o,i){let a=n("./init-order"),s=n("./cross-count"),l=n("./sort-subgraph"),d=n("./build-layer-graph"),u=n("./add-subgraph-constraints"),p=n("@dagrejs/graphlib").Graph,c=n("../util");o.exports=f;function f(h,b){if(b&&typeof b.customOrder=="function"){b.customOrder(h,f);return}let y=c.maxRank(h),M=g(h,c.range(1,y+1),"inEdges"),A=g(h,c.range(y-1,-1,-1),"outEdges"),w=a(h);if(m(h,w),b&&b.disableOptimalOrderHeuristic)return;let $=Number.POSITIVE_INFINITY,k;for(let P=0,X=0;X<4;++P,++X){x(P%2?M:A,P%4>=2),w=c.buildLayerMatrix(h);let N=s(h,w);N<$&&(X=0,k=Object.assign({},w),$=N);}m(h,k);}function g(h,b,y){let M=new Map,A=(w,$)=>{M.has(w)||M.set(w,[]),M.get(w).push($);};for(let w of h.nodes()){let $=h.node(w);if(typeof $.rank=="number"&&A($.rank,w),typeof $.minRank=="number"&&typeof $.maxRank=="number")for(let k=$.minRank;k<=$.maxRank;k++)k!==$.rank&&A(k,w);}return b.map(function(w){return d(h,w,y,M.get(w)||[])})}function x(h,b){let y=new p;h.forEach(function(M){let A=M.graph().root,w=l(M,A,y,b);w.vs.forEach(($,k)=>M.node($).order=k),u(M,y,w.vs);});}function m(h,b){Object.values(b).forEach(y=>y.forEach((M,A)=>h.node(M).order=A));}},{"../util":27,"./add-subgraph-constraints":11,"./build-layer-graph":13,"./cross-count":14,"./init-order":16,"./sort-subgraph":18,"@dagrejs/graphlib":29}],16:[function(n,o,i){let a=n("../util");o.exports=s;function s(l){let d={},u=l.nodes().filter(m=>!l.children(m).length),p=u.map(m=>l.node(m).rank),c=a.applyWithChunking(Math.max,p),f=a.range(c+1).map(()=>[]);function g(m){if(d[m])return;d[m]=true;let h=l.node(m);f[h.rank].push(m),l.successors(m).forEach(g);}return u.sort((m,h)=>l.node(m).rank-l.node(h).rank).forEach(g),f}},{"../util":27}],17:[function(n,o,i){let a=n("../util");o.exports=s;function s(u,p){let c={};u.forEach((g,x)=>{let m=c[g.v]={indegree:0,in:[],out:[],vs:[g.v],i:x};g.barycenter!==void 0&&(m.barycenter=g.barycenter,m.weight=g.weight);}),p.edges().forEach(g=>{let x=c[g.v],m=c[g.w];x!==void 0&&m!==void 0&&(m.indegree++,x.out.push(c[g.w]));});let f=Object.values(c).filter(g=>!g.indegree);return l(f)}function l(u){let p=[];function c(g){return x=>{x.merged||(x.barycenter===void 0||g.barycenter===void 0||x.barycenter>=g.barycenter)&&d(g,x);}}function f(g){return x=>{x.in.push(g),--x.indegree===0&&u.push(x);}}for(;u.length;){let g=u.pop();p.push(g),g.in.reverse().forEach(c(g)),g.out.forEach(f(g));}return p.filter(g=>!g.merged).map(g=>a.pick(g,["vs","i","barycenter","weight"]))}function d(u,p){let c=0,f=0;u.weight&&(c+=u.barycenter*u.weight,f+=u.weight),p.weight&&(c+=p.barycenter*p.weight,f+=p.weight),u.vs=p.vs.concat(u.vs),u.barycenter=c/f,u.weight=f,u.i=Math.min(p.i,u.i),p.merged=true;}},{"../util":27}],18:[function(n,o,i){let a=n("./barycenter"),s=n("./resolve-conflicts"),l=n("./sort");o.exports=d;function d(c,f,g,x){let m=c.children(f),h=c.node(f),b=h?h.borderLeft:void 0,y=h?h.borderRight:void 0,M={};b&&(m=m.filter(k=>k!==b&&k!==y));let A=a(c,m);A.forEach(k=>{if(c.children(k.v).length){let P=d(c,k.v,g,x);M[k.v]=P,Object.hasOwn(P,"barycenter")&&p(k,P);}});let w=s(A,g);u(w,M);let $=l(w,x);if(b&&($.vs=[b,$.vs,y].flat(true),c.predecessors(b).length)){let k=c.node(c.predecessors(b)[0]),P=c.node(c.predecessors(y)[0]);Object.hasOwn($,"barycenter")||($.barycenter=0,$.weight=0),$.barycenter=($.barycenter*$.weight+k.order+P.order)/($.weight+2),$.weight+=2;}return $}function u(c,f){c.forEach(g=>{g.vs=g.vs.flatMap(x=>f[x]?f[x].vs:x);});}function p(c,f){c.barycenter!==void 0?(c.barycenter=(c.barycenter*c.weight+f.barycenter*f.weight)/(c.weight+f.weight),c.weight+=f.weight):(c.barycenter=f.barycenter,c.weight=f.weight);}},{"./barycenter":12,"./resolve-conflicts":17,"./sort":19}],19:[function(n,o,i){let a=n("../util");o.exports=s;function s(u,p){let c=a.partition(u,M=>Object.hasOwn(M,"barycenter")),f=c.lhs,g=c.rhs.sort((M,A)=>A.i-M.i),x=[],m=0,h=0,b=0;f.sort(d(!!p)),b=l(x,g,b),f.forEach(M=>{b+=M.vs.length,x.push(M.vs),m+=M.barycenter*M.weight,h+=M.weight,b=l(x,g,b);});let y={vs:x.flat(true)};return h&&(y.barycenter=m/h,y.weight=h),y}function l(u,p,c){let f;for(;p.length&&(f=p[p.length-1]).i<=c;)p.pop(),u.push(f.vs),c++;return c}function d(u){return (p,c)=>p.barycenter<c.barycenter?-1:p.barycenter>c.barycenter?1:u?c.i-p.i:p.i-c.i}},{"../util":27}],20:[function(n,o,i){o.exports=a;function a(d){let u=l(d);d.graph().dummyChains.forEach(p=>{let c=d.node(p),f=c.edgeObj,g=s(d,u,f.v,f.w),x=g.path,m=g.lca,h=0,b=x[h],y=true;for(;p!==f.w;){if(c=d.node(p),y){for(;(b=x[h])!==m&&d.node(b).maxRank<c.rank;)h++;b===m&&(y=false);}if(!y){for(;h<x.length-1&&d.node(b=x[h+1]).minRank<=c.rank;)h++;b=x[h];}d.setParent(p,b),p=d.successors(p)[0];}});}function s(d,u,p,c){let f=[],g=[],x=Math.min(u[p].low,u[c].low),m=Math.max(u[p].lim,u[c].lim),h,b;h=p;do h=d.parent(h),f.push(h);while(h&&(u[h].low>x||m>u[h].lim));for(b=h,h=c;(h=d.parent(h))!==b;)g.push(h);return {path:f.concat(g.reverse()),lca:b}}function l(d){let u={},p=0;function c(f){let g=p;d.children(f).forEach(c),u[f]={low:g,lim:p++};}return d.children().forEach(c),u}},{}],21:[function(n,o,i){let a=n("@dagrejs/graphlib").Graph,s=n("../util");o.exports={positionX:y,findType1Conflicts:l,findType2Conflicts:d,addConflict:p,hasConflict:c,verticalAlignment:f,horizontalCompaction:g,alignCoordinates:h,findSmallestWidthAlignment:m,balance:b};function l(w,$){let k={};function P(X,N){let F=0,Z=0,_=X.length,H=N[N.length-1];return N.forEach((I,S)=>{let v=u(w,I),V=v?w.node(v).order:_;(v||I===H)&&(N.slice(Z,S+1).forEach(z=>{w.predecessors(z).forEach(L=>{let D=w.node(L),T=D.order;(T<F||V<T)&&!(D.dummy&&w.node(z).dummy)&&p(k,L,z);});}),Z=S+1,F=V);}),N}return $.length&&$.reduce(P),k}function d(w,$){let k={};function P(N,F,Z,_,H){let I;s.range(F,Z).forEach(S=>{I=N[S],w.node(I).dummy&&w.predecessors(I).forEach(v=>{let V=w.node(v);V.dummy&&(V.order<_||V.order>H)&&p(k,v,I);});});}function X(N,F){let Z=-1,_,H=0;return F.forEach((I,S)=>{if(w.node(I).dummy==="border"){let v=w.predecessors(I);v.length&&(_=w.node(v[0]).order,P(F,H,S,Z,_),H=S,Z=_);}P(F,H,F.length,_,N.length);}),F}return $.length&&$.reduce(X),k}function u(w,$){if(w.node($).dummy)return w.predecessors($).find(k=>w.node(k).dummy)}function p(w,$,k){if($>k){let X=$;$=k,k=X;}let P=w[$];P||(w[$]=P={}),P[k]=true;}function c(w,$,k){if($>k){let P=$;$=k,k=P;}return !!w[$]&&Object.hasOwn(w[$],k)}function f(w,$,k,P){let X={},N={},F={};return $.forEach(Z=>{Z.forEach((_,H)=>{X[_]=_,N[_]=_,F[_]=H;});}),$.forEach(Z=>{let _=-1;Z.forEach(H=>{let I=P(H);if(I.length){I=I.sort((v,V)=>F[v]-F[V]);let S=(I.length-1)/2;for(let v=Math.floor(S),V=Math.ceil(S);v<=V;++v){let z=I[v];N[H]===H&&_<F[z]&&!c(k,H,z)&&(N[z]=H,N[H]=X[H]=X[z],_=F[z]);}}});}),{root:X,align:N}}function g(w,$,k,P,X){let N={},F=x(w,$,k,X),Z=X?"borderLeft":"borderRight";function _(S,v){let V=F.nodes(),z=V.pop(),L={};for(;z;)L[z]?S(z):(L[z]=true,V.push(z),V=V.concat(v(z))),z=V.pop();}function H(S){N[S]=F.inEdges(S).reduce((v,V)=>Math.max(v,N[V.v]+F.edge(V)),0);}function I(S){let v=F.outEdges(S).reduce((z,L)=>Math.min(z,N[L.w]-F.edge(L)),Number.POSITIVE_INFINITY),V=w.node(S);v!==Number.POSITIVE_INFINITY&&V.borderType!==Z&&(N[S]=Math.max(N[S],v));}return _(H,F.predecessors.bind(F)),_(I,F.successors.bind(F)),Object.keys(P).forEach(S=>N[S]=N[k[S]]),N}function x(w,$,k,P){let X=new a,N=w.graph(),F=M(N.nodesep,N.edgesep,P);return $.forEach(Z=>{let _;Z.forEach(H=>{let I=k[H];if(X.setNode(I),_){var S=k[_],v=X.edge(S,I);X.setEdge(S,I,Math.max(F(w,H,_),v||0));}_=H;});}),X}function m(w,$){return Object.values($).reduce((k,P)=>{let X=Number.NEGATIVE_INFINITY,N=Number.POSITIVE_INFINITY;Object.entries(P).forEach(([Z,_])=>{let H=A(w,Z)/2;X=Math.max(_+H,X),N=Math.min(_-H,N);});let F=X-N;return F<k[0]&&(k=[F,P]),k},[Number.POSITIVE_INFINITY,null])[1]}function h(w,$){let k=Object.values($),P=s.applyWithChunking(Math.min,k),X=s.applyWithChunking(Math.max,k);["u","d"].forEach(N=>{["l","r"].forEach(F=>{let Z=N+F,_=w[Z];if(_===$)return;let H=Object.values(_),I=P-s.applyWithChunking(Math.min,H);F!=="l"&&(I=X-s.applyWithChunking(Math.max,H)),I&&(w[Z]=s.mapValues(_,S=>S+I));});});}function b(w,$){return s.mapValues(w.ul,(k,P)=>{if($)return w[$.toLowerCase()][P];{let X=Object.values(w).map(N=>N[P]).sort((N,F)=>N-F);return (X[1]+X[2])/2}})}function y(w){let $=s.buildLayerMatrix(w),k=Object.assign(l(w,$),d(w,$)),P={},X;["u","d"].forEach(F=>{X=F==="u"?$:Object.values($).reverse(),["l","r"].forEach(Z=>{Z==="r"&&(X=X.map(S=>Object.values(S).reverse()));let _=(F==="u"?w.predecessors:w.successors).bind(w),H=f(w,X,k,_),I=g(w,X,H.root,H.align,Z==="r");Z==="r"&&(I=s.mapValues(I,S=>-S)),P[F+Z]=I;});});let N=m(w,P);return h(P,N),b(P,w.graph().align)}function M(w,$,k){return (P,X,N)=>{let F=P.node(X),Z=P.node(N),_=0,H;if(_+=F.width/2,Object.hasOwn(F,"labelpos"))switch(F.labelpos.toLowerCase()){case "l":H=-F.width/2;break;case "r":H=F.width/2;break}if(H&&(_+=k?H:-H),H=0,_+=(F.dummy?$:w)/2,_+=(Z.dummy?$:w)/2,_+=Z.width/2,Object.hasOwn(Z,"labelpos"))switch(Z.labelpos.toLowerCase()){case "l":H=Z.width/2;break;case "r":H=-Z.width/2;break}return H&&(_+=k?H:-H),H=0,_}}function A(w,$){return w.node($).width}},{"../util":27,"@dagrejs/graphlib":29}],22:[function(n,o,i){let a=n("../util"),s=n("./bk").positionX;o.exports=l;function l(u){u=a.asNonCompoundGraph(u),d(u),Object.entries(s(u)).forEach(([p,c])=>u.node(p).x=c);}function d(u){let p=a.buildLayerMatrix(u),c=u.graph().ranksep,f=0;p.forEach(g=>{let x=g.reduce((m,h)=>{let b=u.node(h).height;return m>b?m:b},0);g.forEach(m=>u.node(m).y=f+x/2),f+=x+c;});}},{"../util":27,"./bk":21}],23:[function(n,o,i){var a=n("@dagrejs/graphlib").Graph,s=n("./util").slack;o.exports=l;function l(c){var f=new a({directed:false}),g=c.nodes()[0],x=c.nodeCount();f.setNode(g,{});for(var m,h;d(f,c)<x;)m=u(f,c),h=f.hasNode(m.v)?s(c,m):-s(c,m),p(f,c,h);return f}function d(c,f){function g(x){f.nodeEdges(x).forEach(m=>{var h=m.v,b=x===h?m.w:h;!c.hasNode(b)&&!s(f,m)&&(c.setNode(b,{}),c.setEdge(x,b,{}),g(b));});}return c.nodes().forEach(g),c.nodeCount()}function u(c,f){return f.edges().reduce((x,m)=>{let h=Number.POSITIVE_INFINITY;return c.hasNode(m.v)!==c.hasNode(m.w)&&(h=s(f,m)),h<x[0]?[h,m]:x},[Number.POSITIVE_INFINITY,null])[1]}function p(c,f,g){c.nodes().forEach(x=>f.node(x).rank+=g);}},{"./util":26,"@dagrejs/graphlib":29}],24:[function(n,o,i){var a=n("./util"),s=a.longestPath,l=n("./feasible-tree"),d=n("./network-simplex");o.exports=u;function u(g){var x=g.graph().ranker;if(x instanceof Function)return x(g);switch(g.graph().ranker){case "network-simplex":f(g);break;case "tight-tree":c(g);break;case "longest-path":p(g);break;case "none":break;default:f(g);}}var p=s;function c(g){s(g),l(g);}function f(g){d(g);}},{"./feasible-tree":23,"./network-simplex":25,"./util":26}],25:[function(n,o,i){var a=n("./feasible-tree"),s=n("./util").slack,l=n("./util").longestPath,d=n("@dagrejs/graphlib").alg.preorder,u=n("@dagrejs/graphlib").alg.postorder,p=n("../util").simplify;o.exports=c,c.initLowLimValues=m,c.initCutValues=f,c.calcCutValue=x,c.leaveEdge=b,c.enterEdge=y,c.exchangeEdges=M;function c(k){k=p(k),l(k);var P=a(k);m(P),f(P,k);for(var X,N;X=b(P);)N=y(P,k,X),M(P,k,X,N);}function f(k,P){var X=u(k,k.nodes());X=X.slice(0,X.length-1),X.forEach(N=>g(k,P,N));}function g(k,P,X){var N=k.node(X),F=N.parent;k.edge(X,F).cutvalue=x(k,P,X);}function x(k,P,X){var N=k.node(X),F=N.parent,Z=true,_=P.edge(X,F),H=0;return _||(Z=false,_=P.edge(F,X)),H=_.weight,P.nodeEdges(X).forEach(I=>{var S=I.v===X,v=S?I.w:I.v;if(v!==F){var V=S===Z,z=P.edge(I).weight;if(H+=V?z:-z,w(k,X,v)){var L=k.edge(X,v).cutvalue;H+=V?-L:L;}}}),H}function m(k,P){arguments.length<2&&(P=k.nodes()[0]),h(k,{},1,P);}function h(k,P,X,N,F){var Z=X,_=k.node(N);return P[N]=true,k.neighbors(N).forEach(H=>{Object.hasOwn(P,H)||(X=h(k,P,X,H,N));}),_.low=Z,_.lim=X++,F?_.parent=F:delete _.parent,X}function b(k){return k.edges().find(P=>k.edge(P).cutvalue<0)}function y(k,P,X){var N=X.v,F=X.w;P.hasEdge(N,F)||(N=X.w,F=X.v);var Z=k.node(N),_=k.node(F),H=Z,I=false;Z.lim>_.lim&&(H=_,I=true);var S=P.edges().filter(v=>I===$(k,k.node(v.v),H)&&I!==$(k,k.node(v.w),H));return S.reduce((v,V)=>s(P,V)<s(P,v)?V:v)}function M(k,P,X,N){var F=X.v,Z=X.w;k.removeEdge(F,Z),k.setEdge(N.v,N.w,{}),m(k),f(k,P),A(k,P);}function A(k,P){var X=k.nodes().find(F=>!P.node(F).parent),N=d(k,X);N=N.slice(1),N.forEach(F=>{var Z=k.node(F).parent,_=P.edge(F,Z),H=false;_||(_=P.edge(Z,F),H=true),P.node(F).rank=P.node(Z).rank+(H?_.minlen:-_.minlen);});}function w(k,P,X){return k.hasEdge(P,X)}function $(k,P,X){return X.low<=P.lim&&P.lim<=X.lim}},{"../util":27,"./feasible-tree":23,"./util":26,"@dagrejs/graphlib":29}],26:[function(n,o,i){let{applyWithChunking:a}=n("../util");o.exports={longestPath:s,slack:l};function s(d){var u={};function p(c){var f=d.node(c);if(Object.hasOwn(u,c))return f.rank;u[c]=true;let g=d.outEdges(c).map(m=>m==null?Number.POSITIVE_INFINITY:p(m.w)-d.edge(m).minlen);var x=a(Math.min,g);return x===Number.POSITIVE_INFINITY&&(x=0),f.rank=x}d.sources().forEach(p);}function l(d,u){return d.node(u.w).rank-d.node(u.v).rank-d.edge(u).minlen}},{"../util":27}],27:[function(n,o,i){let a=n("@dagrejs/graphlib").Graph;o.exports={addBorderNode:m,addDummyNode:s,applyWithChunking:y,asNonCompoundGraph:d,buildLayerMatrix:f,intersectRect:c,mapValues:F,maxRank:M,normalizeRanks:g,notime:$,partition:A,pick:N,predecessorWeights:p,range:X,removeEmptyRanks:x,simplify:l,successorWeights:u,time:w,uniqueId:P,zipObject:Z};function s(_,H,I,S){for(var v=S;_.hasNode(v);)v=P(S);return I.dummy=H,_.setNode(v,I),v}function l(_){let H=new a().setGraph(_.graph());return _.nodes().forEach(I=>H.setNode(I,_.node(I))),_.edges().forEach(I=>{let S=H.edge(I.v,I.w)||{weight:0,minlen:1},v=_.edge(I);H.setEdge(I.v,I.w,{weight:S.weight+v.weight,minlen:Math.max(S.minlen,v.minlen)});}),H}function d(_){let H=new a({multigraph:_.isMultigraph()}).setGraph(_.graph());return _.nodes().forEach(I=>{_.children(I).length||H.setNode(I,_.node(I));}),_.edges().forEach(I=>{H.setEdge(I,_.edge(I));}),H}function u(_){let H=_.nodes().map(I=>{let S={};return _.outEdges(I).forEach(v=>{S[v.w]=(S[v.w]||0)+_.edge(v).weight;}),S});return Z(_.nodes(),H)}function p(_){let H=_.nodes().map(I=>{let S={};return _.inEdges(I).forEach(v=>{S[v.v]=(S[v.v]||0)+_.edge(v).weight;}),S});return Z(_.nodes(),H)}function c(_,H){let I=_.x,S=_.y,v=H.x-I,V=H.y-S,z=_.width/2,L=_.height/2;if(!v&&!V)throw new Error("Not possible to find intersection inside of the rectangle");let D,T;return Math.abs(V)*z>Math.abs(v)*L?(V<0&&(L=-L),D=L*v/V,T=L):(v<0&&(z=-z),D=z,T=z*V/v),{x:I+D,y:S+T}}function f(_){let H=X(M(_)+1).map(()=>[]);return _.nodes().forEach(I=>{let S=_.node(I),v=S.rank;v!==void 0&&(H[v][S.order]=I);}),H}function g(_){let H=_.nodes().map(S=>{let v=_.node(S).rank;return v===void 0?Number.MAX_VALUE:v}),I=y(Math.min,H);_.nodes().forEach(S=>{let v=_.node(S);Object.hasOwn(v,"rank")&&(v.rank-=I);});}function x(_){let H=_.nodes().map(z=>_.node(z).rank),I=y(Math.min,H),S=[];_.nodes().forEach(z=>{let L=_.node(z).rank-I;S[L]||(S[L]=[]),S[L].push(z);});let v=0,V=_.graph().nodeRankFactor;Array.from(S).forEach((z,L)=>{z===void 0&&L%V!==0?--v:z!==void 0&&v&&z.forEach(D=>_.node(D).rank+=v);});}function m(_,H,I,S){let v={width:0,height:0};return arguments.length>=4&&(v.rank=I,v.order=S),s(_,"border",v,H)}function h(_,H=b){let I=[];for(let S=0;S<_.length;S+=H){let v=_.slice(S,S+H);I.push(v);}return I}let b=65535;function y(_,H){if(H.length>b){let I=h(H);return _.apply(null,I.map(S=>_.apply(null,S)))}else return _.apply(null,H)}function M(_){let I=_.nodes().map(S=>{let v=_.node(S).rank;return v===void 0?Number.MIN_VALUE:v});return y(Math.max,I)}function A(_,H){let I={lhs:[],rhs:[]};return _.forEach(S=>{H(S)?I.lhs.push(S):I.rhs.push(S);}),I}function w(_,H){let I=Date.now();try{return H()}finally{console.log(_+" time: "+(Date.now()-I)+"ms");}}function $(_,H){return H()}let k=0;function P(_){var H=++k;return _+(""+H)}function X(_,H,I=1){H==null&&(H=_,_=0);let S=V=>V<H;I<0&&(S=V=>H<V);let v=[];for(let V=_;S(V);V+=I)v.push(V);return v}function N(_,H){let I={};for(let S of H)_[S]!==void 0&&(I[S]=_[S]);return I}function F(_,H){let I=H;return typeof H=="string"&&(I=S=>S[H]),Object.entries(_).reduce((S,[v,V])=>(S[v]=I(V,v),S),{})}function Z(_,H){return _.reduce((I,S,v)=>(I[S]=H[v],I),{})}},{"@dagrejs/graphlib":29}],28:[function(n,o,i){o.exports="1.1.8";},{}],29:[function(n,o,i){var a=n("./lib");o.exports={Graph:a.Graph,json:n("./lib/json"),alg:n("./lib/alg"),version:a.version};},{"./lib":45,"./lib/alg":36,"./lib/json":46}],30:[function(n,o,i){o.exports=a;function a(s){var l={},d=[],u;function p(c){Object.hasOwn(l,c)||(l[c]=true,u.push(c),s.successors(c).forEach(p),s.predecessors(c).forEach(p));}return s.nodes().forEach(function(c){u=[],p(c),u.length&&d.push(u);}),d}},{}],31:[function(n,o,i){o.exports=a;function a(u,p,c){Array.isArray(p)||(p=[p]);var f=u.isDirected()?h=>u.successors(h):h=>u.neighbors(h),g=c==="post"?s:l,x=[],m={};return p.forEach(h=>{if(!u.hasNode(h))throw new Error("Graph does not have node: "+h);g(h,f,m,x);}),x}function s(u,p,c,f){for(var g=[[u,false]];g.length>0;){var x=g.pop();x[1]?f.push(x[0]):Object.hasOwn(c,x[0])||(c[x[0]]=true,g.push([x[0],true]),d(p(x[0]),m=>g.push([m,false])));}}function l(u,p,c,f){for(var g=[u];g.length>0;){var x=g.pop();Object.hasOwn(c,x)||(c[x]=true,f.push(x),d(p(x),m=>g.push(m)));}}function d(u,p){for(var c=u.length;c--;)p(u[c],c,u);return u}},{}],32:[function(n,o,i){var a=n("./dijkstra");o.exports=s;function s(l,d,u){return l.nodes().reduce(function(p,c){return p[c]=a(l,c,d,u),p},{})}},{"./dijkstra":33}],33:[function(n,o,i){var a=n("../data/priority-queue");o.exports=l;var s=()=>1;function l(u,p,c,f){return d(u,String(p),c||s,f||function(g){return u.outEdges(g)})}function d(u,p,c,f){var g={},x=new a,m,h,b=function(y){var M=y.v!==m?y.v:y.w,A=g[M],w=c(y),$=h.distance+w;if(w<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+y+" Weight: "+w);$<A.distance&&(A.distance=$,A.predecessor=m,x.decrease(M,$));};for(u.nodes().forEach(function(y){var M=y===p?0:Number.POSITIVE_INFINITY;g[y]={distance:M},x.add(y,M);});x.size()>0&&(m=x.removeMin(),h=g[m],h.distance!==Number.POSITIVE_INFINITY);)f(m).forEach(b);return g}},{"../data/priority-queue":43}],34:[function(n,o,i){var a=n("./tarjan");o.exports=s;function s(l){return a(l).filter(function(d){return d.length>1||d.length===1&&l.hasEdge(d[0],d[0])})}},{"./tarjan":41}],35:[function(n,o,i){o.exports=s;var a=()=>1;function s(d,u,p){return l(d,u||a,p||function(c){return d.outEdges(c)})}function l(d,u,p){var c={},f=d.nodes();return f.forEach(function(g){c[g]={},c[g][g]={distance:0},f.forEach(function(x){g!==x&&(c[g][x]={distance:Number.POSITIVE_INFINITY});}),p(g).forEach(function(x){var m=x.v===g?x.w:x.v,h=u(x);c[g][m]={distance:h,predecessor:g};});}),f.forEach(function(g){var x=c[g];f.forEach(function(m){var h=c[m];f.forEach(function(b){var y=h[g],M=x[b],A=h[b],w=y.distance+M.distance;w<A.distance&&(A.distance=w,A.predecessor=M.predecessor);});});}),c}},{}],36:[function(n,o,i){o.exports={components:n("./components"),dijkstra:n("./dijkstra"),dijkstraAll:n("./dijkstra-all"),findCycles:n("./find-cycles"),floydWarshall:n("./floyd-warshall"),isAcyclic:n("./is-acyclic"),postorder:n("./postorder"),preorder:n("./preorder"),prim:n("./prim"),tarjan:n("./tarjan"),topsort:n("./topsort")};},{"./components":30,"./dijkstra":33,"./dijkstra-all":32,"./find-cycles":34,"./floyd-warshall":35,"./is-acyclic":37,"./postorder":38,"./preorder":39,"./prim":40,"./tarjan":41,"./topsort":42}],37:[function(n,o,i){var a=n("./topsort");o.exports=s;function s(l){try{a(l);}catch(d){if(d instanceof a.CycleException)return  false;throw d}return  true}},{"./topsort":42}],38:[function(n,o,i){var a=n("./dfs");o.exports=s;function s(l,d){return a(l,d,"post")}},{"./dfs":31}],39:[function(n,o,i){var a=n("./dfs");o.exports=s;function s(l,d){return a(l,d,"pre")}},{"./dfs":31}],40:[function(n,o,i){var a=n("../graph"),s=n("../data/priority-queue");o.exports=l;function l(d,u){var p=new a,c={},f=new s,g;function x(h){var b=h.v===g?h.w:h.v,y=f.priority(b);if(y!==void 0){var M=u(h);M<y&&(c[b]=g,f.decrease(b,M));}}if(d.nodeCount()===0)return p;d.nodes().forEach(function(h){f.add(h,Number.POSITIVE_INFINITY),p.setNode(h);}),f.decrease(d.nodes()[0],0);for(var m=false;f.size()>0;){if(g=f.removeMin(),Object.hasOwn(c,g))p.setEdge(g,c[g]);else {if(m)throw new Error("Input graph is not connected: "+d);m=true;}d.nodeEdges(g).forEach(x);}return p}},{"../data/priority-queue":43,"../graph":44}],41:[function(n,o,i){o.exports=a;function a(s){var l=0,d=[],u={},p=[];function c(f){var g=u[f]={onStack:true,lowlink:l,index:l++};if(d.push(f),s.successors(f).forEach(function(h){Object.hasOwn(u,h)?u[h].onStack&&(g.lowlink=Math.min(g.lowlink,u[h].index)):(c(h),g.lowlink=Math.min(g.lowlink,u[h].lowlink));}),g.lowlink===g.index){var x=[],m;do m=d.pop(),u[m].onStack=false,x.push(m);while(f!==m);p.push(x);}}return s.nodes().forEach(function(f){Object.hasOwn(u,f)||c(f);}),p}},{}],42:[function(n,o,i){function a(l){var d={},u={},p=[];function c(f){if(Object.hasOwn(u,f))throw new s;Object.hasOwn(d,f)||(u[f]=true,d[f]=true,l.predecessors(f).forEach(c),delete u[f],p.push(f));}if(l.sinks().forEach(c),Object.keys(d).length!==l.nodeCount())throw new s;return p}class s extends Error{constructor(){super(...arguments);}}o.exports=a,a.CycleException=s;},{}],43:[function(n,o,i){class a{_arr=[];_keyIndices={};size(){return this._arr.length}keys(){return this._arr.map(function(l){return l.key})}has(l){return Object.hasOwn(this._keyIndices,l)}priority(l){var d=this._keyIndices[l];if(d!==void 0)return this._arr[d].priority}min(){if(this.size()===0)throw new Error("Queue underflow");return this._arr[0].key}add(l,d){var u=this._keyIndices;if(l=String(l),!Object.hasOwn(u,l)){var p=this._arr,c=p.length;return u[l]=c,p.push({key:l,priority:d}),this._decrease(c),true}return  false}removeMin(){this._swap(0,this._arr.length-1);var l=this._arr.pop();return delete this._keyIndices[l.key],this._heapify(0),l.key}decrease(l,d){var u=this._keyIndices[l];if(d>this._arr[u].priority)throw new Error("New priority is greater than current priority. Key: "+l+" Old: "+this._arr[u].priority+" New: "+d);this._arr[u].priority=d,this._decrease(u);}_heapify(l){var d=this._arr,u=2*l,p=u+1,c=l;u<d.length&&(c=d[u].priority<d[c].priority?u:c,p<d.length&&(c=d[p].priority<d[c].priority?p:c),c!==l&&(this._swap(l,c),this._heapify(c)));}_decrease(l){for(var d=this._arr,u=d[l].priority,p;l!==0&&(p=l>>1,!(d[p].priority<u));)this._swap(l,p),l=p;}_swap(l,d){var u=this._arr,p=this._keyIndices,c=u[l],f=u[d];u[l]=f,u[d]=c,p[f.key]=l,p[c.key]=d;}}o.exports=a;},{}],44:[function(n,o,i){var a="\0",s="\0",l="";class d{_isDirected=true;_isMultigraph=false;_isCompound=false;_label;_defaultNodeLabelFn=()=>{};_defaultEdgeLabelFn=()=>{};_nodes={};_in={};_preds={};_out={};_sucs={};_edgeObjs={};_edgeLabels={};_nodeCount=0;_edgeCount=0;_parent;_children;constructor(m){m&&(this._isDirected=Object.hasOwn(m,"directed")?m.directed:true,this._isMultigraph=Object.hasOwn(m,"multigraph")?m.multigraph:false,this._isCompound=Object.hasOwn(m,"compound")?m.compound:false),this._isCompound&&(this._parent={},this._children={},this._children[s]={});}isDirected(){return this._isDirected}isMultigraph(){return this._isMultigraph}isCompound(){return this._isCompound}setGraph(m){return this._label=m,this}graph(){return this._label}setDefaultNodeLabel(m){return this._defaultNodeLabelFn=m,typeof m!="function"&&(this._defaultNodeLabelFn=()=>m),this}nodeCount(){return this._nodeCount}nodes(){return Object.keys(this._nodes)}sources(){var m=this;return this.nodes().filter(h=>Object.keys(m._in[h]).length===0)}sinks(){var m=this;return this.nodes().filter(h=>Object.keys(m._out[h]).length===0)}setNodes(m,h){var b=arguments,y=this;return m.forEach(function(M){b.length>1?y.setNode(M,h):y.setNode(M);}),this}setNode(m,h){return Object.hasOwn(this._nodes,m)?(arguments.length>1&&(this._nodes[m]=h),this):(this._nodes[m]=arguments.length>1?h:this._defaultNodeLabelFn(m),this._isCompound&&(this._parent[m]=s,this._children[m]={},this._children[s][m]=true),this._in[m]={},this._preds[m]={},this._out[m]={},this._sucs[m]={},++this._nodeCount,this)}node(m){return this._nodes[m]}hasNode(m){return Object.hasOwn(this._nodes,m)}removeNode(m){var h=this;if(Object.hasOwn(this._nodes,m)){var b=y=>h.removeEdge(h._edgeObjs[y]);delete this._nodes[m],this._isCompound&&(this._removeFromParentsChildList(m),delete this._parent[m],this.children(m).forEach(function(y){h.setParent(y);}),delete this._children[m]),Object.keys(this._in[m]).forEach(b),delete this._in[m],delete this._preds[m],Object.keys(this._out[m]).forEach(b),delete this._out[m],delete this._sucs[m],--this._nodeCount;}return this}setParent(m,h){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(h===void 0)h=s;else {h+="";for(var b=h;b!==void 0;b=this.parent(b))if(b===m)throw new Error("Setting "+h+" as parent of "+m+" would create a cycle");this.setNode(h);}return this.setNode(m),this._removeFromParentsChildList(m),this._parent[m]=h,this._children[h][m]=true,this}_removeFromParentsChildList(m){delete this._children[this._parent[m]][m];}parent(m){if(this._isCompound){var h=this._parent[m];if(h!==s)return h}}children(m=s){if(this._isCompound){var h=this._children[m];if(h)return Object.keys(h)}else {if(m===s)return this.nodes();if(this.hasNode(m))return []}}predecessors(m){var h=this._preds[m];if(h)return Object.keys(h)}successors(m){var h=this._sucs[m];if(h)return Object.keys(h)}neighbors(m){var h=this.predecessors(m);if(h){let y=new Set(h);for(var b of this.successors(m))y.add(b);return Array.from(y.values())}}isLeaf(m){var h;return this.isDirected()?h=this.successors(m):h=this.neighbors(m),h.length===0}filterNodes(m){var h=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});h.setGraph(this.graph());var b=this;Object.entries(this._nodes).forEach(function([A,w]){m(A)&&h.setNode(A,w);}),Object.values(this._edgeObjs).forEach(function(A){h.hasNode(A.v)&&h.hasNode(A.w)&&h.setEdge(A,b.edge(A));});var y={};function M(A){var w=b.parent(A);return w===void 0||h.hasNode(w)?(y[A]=w,w):w in y?y[w]:M(w)}return this._isCompound&&h.nodes().forEach(A=>h.setParent(A,M(A))),h}setDefaultEdgeLabel(m){return this._defaultEdgeLabelFn=m,typeof m!="function"&&(this._defaultEdgeLabelFn=()=>m),this}edgeCount(){return this._edgeCount}edges(){return Object.values(this._edgeObjs)}setPath(m,h){var b=this,y=arguments;return m.reduce(function(M,A){return y.length>1?b.setEdge(M,A,h):b.setEdge(M,A),A}),this}setEdge(){var m,h,b,y,M=false,A=arguments[0];typeof A=="object"&&A!==null&&"v"in A?(m=A.v,h=A.w,b=A.name,arguments.length===2&&(y=arguments[1],M=true)):(m=A,h=arguments[1],b=arguments[3],arguments.length>2&&(y=arguments[2],M=true)),m=""+m,h=""+h,b!==void 0&&(b=""+b);var w=c(this._isDirected,m,h,b);if(Object.hasOwn(this._edgeLabels,w))return M&&(this._edgeLabels[w]=y),this;if(b!==void 0&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(m),this.setNode(h),this._edgeLabels[w]=M?y:this._defaultEdgeLabelFn(m,h,b);var $=f(this._isDirected,m,h,b);return m=$.v,h=$.w,Object.freeze($),this._edgeObjs[w]=$,u(this._preds[h],m),u(this._sucs[m],h),this._in[h][w]=$,this._out[m][w]=$,this._edgeCount++,this}edge(m,h,b){var y=arguments.length===1?g(this._isDirected,arguments[0]):c(this._isDirected,m,h,b);return this._edgeLabels[y]}edgeAsObj(){let m=this.edge(...arguments);return typeof m!="object"?{label:m}:m}hasEdge(m,h,b){var y=arguments.length===1?g(this._isDirected,arguments[0]):c(this._isDirected,m,h,b);return Object.hasOwn(this._edgeLabels,y)}removeEdge(m,h,b){var y=arguments.length===1?g(this._isDirected,arguments[0]):c(this._isDirected,m,h,b),M=this._edgeObjs[y];return M&&(m=M.v,h=M.w,delete this._edgeLabels[y],delete this._edgeObjs[y],p(this._preds[h],m),p(this._sucs[m],h),delete this._in[h][y],delete this._out[m][y],this._edgeCount--),this}inEdges(m,h){var b=this._in[m];if(b){var y=Object.values(b);return h?y.filter(M=>M.v===h):y}}outEdges(m,h){var b=this._out[m];if(b){var y=Object.values(b);return h?y.filter(M=>M.w===h):y}}nodeEdges(m,h){var b=this.inEdges(m,h);if(b)return b.concat(this.outEdges(m,h))}}function u(x,m){x[m]?x[m]++:x[m]=1;}function p(x,m){--x[m]||delete x[m];}function c(x,m,h,b){var y=""+m,M=""+h;if(!x&&y>M){var A=y;y=M,M=A;}return y+l+M+l+(b===void 0?a:b)}function f(x,m,h,b){var y=""+m,M=""+h;if(!x&&y>M){var A=y;y=M,M=A;}var w={v:y,w:M};return b&&(w.name=b),w}function g(x,m){return c(x,m.v,m.w,m.name)}o.exports=d;},{}],45:[function(n,o,i){o.exports={Graph:n("./graph"),version:n("./version")};},{"./graph":44,"./version":47}],46:[function(n,o,i){var a=n("./graph");o.exports={write:s,read:u};function s(p){var c={options:{directed:p.isDirected(),multigraph:p.isMultigraph(),compound:p.isCompound()},nodes:l(p),edges:d(p)};return p.graph()!==void 0&&(c.value=structuredClone(p.graph())),c}function l(p){return p.nodes().map(function(c){var f=p.node(c),g=p.parent(c),x={v:c};return f!==void 0&&(x.value=f),g!==void 0&&(x.parent=g),x})}function d(p){return p.edges().map(function(c){var f=p.edge(c),g={v:c.v,w:c.w};return c.name!==void 0&&(g.name=c.name),f!==void 0&&(g.value=f),g})}function u(p){var c=new a(p.options).setGraph(p.value);return p.nodes.forEach(function(f){c.setNode(f.v,f.value),f.parent&&c.setParent(f.v,f.parent);}),p.edges.forEach(function(f){c.setEdge({v:f.v,w:f.w,name:f.name},f.value);}),c}},{"./graph":44}],47:[function(n,o,i){o.exports="2.2.4";},{}]},{},[1])(1)});});var ie={bg:"#FFFFFF",fg:"#27272A"},Dt={textSec:60,textMuted:40,textFaint:25,line:30,arrow:50,nodeFill:3,nodeStroke:20,groupHeader:5,innerStroke:12,keyBadge:10},He={"zinc-light":{bg:"#FFFFFF",fg:"#27272A"},"zinc-dark":{bg:"#18181B",fg:"#FAFAFA"},"tokyo-night":{bg:"#1a1b26",fg:"#a9b1d6",line:"#3d59a1",accent:"#7aa2f7",muted:"#565f89"},"tokyo-night-storm":{bg:"#24283b",fg:"#a9b1d6",line:"#3d59a1",accent:"#7aa2f7",muted:"#565f89"},"tokyo-night-light":{bg:"#d5d6db",fg:"#343b58",line:"#34548a",accent:"#34548a",muted:"#9699a3"},"catppuccin-mocha":{bg:"#1e1e2e",fg:"#cdd6f4",line:"#585b70",accent:"#cba6f7",muted:"#6c7086"},"catppuccin-latte":{bg:"#eff1f5",fg:"#4c4f69",line:"#9ca0b0",accent:"#8839ef",muted:"#9ca0b0"},nord:{bg:"#2e3440",fg:"#d8dee9",line:"#4c566a",accent:"#88c0d0",muted:"#616e88"},"nord-light":{bg:"#eceff4",fg:"#2e3440",line:"#aab1c0",accent:"#5e81ac",muted:"#7b88a1"},dracula:{bg:"#282a36",fg:"#f8f8f2",line:"#6272a4",accent:"#bd93f9",muted:"#6272a4"},"github-light":{bg:"#ffffff",fg:"#1f2328",line:"#d1d9e0",accent:"#0969da",muted:"#59636e"},"github-dark":{bg:"#0d1117",fg:"#e6edf3",line:"#3d444d",accent:"#4493f8",muted:"#9198a1"},"solarized-light":{bg:"#fdf6e3",fg:"#657b83",line:"#93a1a1",accent:"#268bd2",muted:"#93a1a1"},"solarized-dark":{bg:"#002b36",fg:"#839496",line:"#586e75",accent:"#268bd2",muted:"#586e75"},"one-dark":{bg:"#282c34",fg:"#abb2bf",line:"#4b5263",accent:"#c678dd",muted:"#5c6370"}};function We(t){let e=t.colors??{},r=t.type==="dark",n=o=>t.tokenColors?.find(i=>Array.isArray(i.scope)?i.scope.includes(o):i.scope===o)?.settings?.foreground;return {bg:e["editor.background"]??(r?"#1e1e1e":"#ffffff"),fg:e["editor.foreground"]??(r?"#d4d4d4":"#333333"),line:e["editorLineNumber.foreground"]??void 0,accent:e.focusBorder??n("keyword")??void 0,muted:n("comment")??e["editorLineNumber.foreground"]??void 0,surface:e["editor.selectionBackground"]??void 0,border:e["editorWidget.border"]??void 0}}function Ft(t,e){let r=[`@import url('https://fonts.googleapis.com/css2?family=${encodeURIComponent(t)}:wght@400;500;600;700&amp;display=swap');`,...e?["@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&amp;display=swap');"]:[]],n=`
    /* Derived from --bg and --fg (overridable via --line, --accent, etc.) */
    --_text:          var(--fg);
    --_text-sec:      var(--muted, color-mix(in srgb, var(--fg) ${Dt.textSec}%, var(--bg)));
    --_text-muted:    var(--muted, color-mix(in srgb, var(--fg) ${Dt.textMuted}%, var(--bg)));
    --_text-faint:    color-mix(in srgb, var(--fg) ${Dt.textFaint}%, var(--bg));
    --_line:          var(--line, color-mix(in srgb, var(--fg) ${Dt.line}%, var(--bg)));
    --_arrow:         var(--accent, color-mix(in srgb, var(--fg) ${Dt.arrow}%, var(--bg)));
    --_node-fill:     var(--surface, color-mix(in srgb, var(--fg) ${Dt.nodeFill}%, var(--bg)));
    --_node-stroke:   var(--border, color-mix(in srgb, var(--fg) ${Dt.nodeStroke}%, var(--bg)));
    --_group-fill:    var(--bg);
    --_group-hdr:     color-mix(in srgb, var(--fg) ${Dt.groupHeader}%, var(--bg));
    --_inner-stroke:  color-mix(in srgb, var(--fg) ${Dt.innerStroke}%, var(--bg));
    --_key-badge:     color-mix(in srgb, var(--fg) ${Dt.keyBadge}%, var(--bg));`;return ["<style>",`  ${r.join(`
  `)}`,`  text { font-family: '${t}', system-ui, sans-serif; }`,...e?["  .mono { font-family: 'JetBrains Mono', 'SF Mono', 'Fira Code', ui-monospace, monospace; }"]:[],`  svg {${n}`,"  }","</style>"].join(`
`)}function Ht(t,e,r,n){let o=[`--bg:${r.bg}`,`--fg:${r.fg}`,r.line?`--line:${r.line}`:"",r.accent?`--accent:${r.accent}`:"",r.muted?`--muted:${r.muted}`:"",r.surface?`--surface:${r.surface}`:"",r.border?`--border:${r.border}`:""].filter(Boolean).join(";");return `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${t} ${e}" width="${t}" height="${e}" style="${o}${n?"":";background:var(--bg)"}">`}function ge(t){let e=t.split(/[\n;]/).map(n=>n.trim()).filter(n=>n.length>0&&!n.startsWith("%%"));if(e.length===0)throw new Error("Empty mermaid diagram");let r=e[0];return /^stateDiagram(-v2)?\s*$/i.test(r)?yo(e):bo(e)}function bo(t){let e=t[0].match(/^(?:graph|flowchart)\s+(TD|TB|LR|BT|RL)\s*$/i);if(!e)throw new Error(`Invalid mermaid header: "${t[0]}". Expected "graph TD", "flowchart LR", "stateDiagram-v2", etc.`);let n={direction:e[1].toUpperCase(),nodes:new Map,edges:[],subgraphs:[],classDefs:new Map,classAssignments:new Map,nodeStyles:new Map},o=[];for(let i=1;i<t.length;i++){let a=t[i],s=a.match(/^classDef\s+(\w+)\s+(.+)$/);if(s){let c=s[1],f=s[2],g=Sn(f);n.classDefs.set(c,g);continue}let l=a.match(/^class\s+([^\s]+)\s+(\w+)$/);if(l){let c=l[1].split(",").map(g=>g.trim()),f=l[2];for(let g of c)n.classAssignments.set(g,f);continue}let d=a.match(/^style\s+([^\s]+)\s+(.+)$/);if(d){let c=d[1].split(",").map(g=>g.trim()),f=Sn(d[2]);for(let g of c)n.nodeStyles.set(g,{...n.nodeStyles.get(g),...f});continue}let u=a.match(/^direction\s+(TD|TB|LR|BT|RL)\s*$/i);if(u&&o.length>0){o[o.length-1].direction=u[1].toUpperCase();continue}let p=a.match(/^subgraph\s+(.+)$/);if(p){let c=p[1].trim(),f=c.match(/^([\p{L}\p{N}_-]+)\s*\[(.+)\]$/u),g,x;f?(g=f[1],x=f[2]):(x=c,g=c.replace(/\s+/g,"_").replace(/[^\p{L}\p{N}_]/gu,""));let m={id:g,label:x,nodeIds:[],children:[]};o.push(m);continue}if(a==="end"){let c=o.pop();c&&(o.length>0?o[o.length-1].children.push(c):n.subgraphs.push(c));continue}So(a,n,o);}return n}function yo(t){let e={direction:"TD",nodes:new Map,edges:[],subgraphs:[],classDefs:new Map,classAssignments:new Map,nodeStyles:new Map},r=[],n=0,o=0;for(let i=1;i<t.length;i++){let a=t[i],s=a.match(/^direction\s+(TD|TB|LR|BT|RL)\s*$/i);if(s){r.length>0?r[r.length-1].direction=s[1].toUpperCase():e.direction=s[1].toUpperCase();continue}let l=a.match(/^state\s+(?:"([^"]+)"\s+as\s+)?([\p{L}\p{N}_-]+)\s*\{$/u);if(l){let c=l[1]??l[2],g={id:l[2],label:c,nodeIds:[],children:[]};r.push(g);continue}if(a==="}"){let c=r.pop();c&&(r.length>0?r[r.length-1].children.push(c):e.subgraphs.push(c));continue}let d=a.match(/^state\s+"([^"]+)"\s+as\s+([\p{L}\p{N}_-]+)\s*$/u);if(d){let c=d[1],f=d[2];pe(e,r,{id:f,label:c,shape:"rounded"});continue}let u=a.match(/^(\[\*\]|[\p{L}\p{N}_-]+)\s*(-->)\s*(\[\*\]|[\p{L}\p{N}_-]+)(?:\s*:\s*(.+))?$/u);if(u){let c=u[1],f=u[3],g=u[4]?.trim()||void 0;c==="[*]"?(n++,c=`_start${n>1?n:""}`,pe(e,r,{id:c,label:"",shape:"state-start"})):Cn(e,r,c),f==="[*]"?(o++,f=`_end${o>1?o:""}`,pe(e,r,{id:f,label:"",shape:"state-end"})):Cn(e,r,f),e.edges.push({source:c,target:f,label:g,style:"solid",hasArrowStart:false,hasArrowEnd:true});continue}let p=a.match(/^([\p{L}\p{N}_-]+)\s*:\s*(.+)$/u);if(p){let c=p[1],f=p[2].trim();pe(e,r,{id:c,label:f,shape:"rounded"});continue}}return e}function pe(t,e,r){if(!t.nodes.has(r.id)&&t.nodes.set(r.id,r),e.length>0){let o=e[e.length-1];o.nodeIds.includes(r.id)||o.nodeIds.push(r.id);}}function Cn(t,e,r){if(!t.nodes.has(r))pe(t,e,{id:r,label:r,shape:"rounded"});else if(e.length>0){let n=e[e.length-1];n.nodeIds.includes(r)||n.nodeIds.push(r);}}function Sn(t){let e={};for(let r of t.split(",")){let n=r.indexOf(":");if(n>0){let o=r.slice(0,n).trim(),i=r.slice(n+1).trim();o&&i&&(e[o]=i);}}return e}var $n=/^(<)?(-->|-.->|==>|---|-\.-|===)(?:\|([^|]*)\|)?/,wo=[{regex:/^([\p{L}\p{N}_-]+)\(\(\((.+?)\)\)\)/u,shape:"doublecircle"},{regex:/^([\p{L}\p{N}_-]+)\(\[(.+?)\]\)/u,shape:"stadium"},{regex:/^([\p{L}\p{N}_-]+)\(\((.+?)\)\)/u,shape:"circle"},{regex:/^([\p{L}\p{N}_-]+)\[\[(.+?)\]\]/u,shape:"subroutine"},{regex:/^([\p{L}\p{N}_-]+)\[\((.+?)\)\]/u,shape:"cylinder"},{regex:/^([\p{L}\p{N}_-]+)\[\/(.+?)\\\]/u,shape:"trapezoid"},{regex:/^([\p{L}\p{N}_-]+)\[\\(.+?)\/\]/u,shape:"trapezoid-alt"},{regex:/^([\p{L}\p{N}_-]+)>(.+?)\]/u,shape:"asymmetric"},{regex:/^([\p{L}\p{N}_-]+)\{\{(.+?)\}\}/u,shape:"hexagon"},{regex:/^([\p{L}\p{N}_-]+)\[(.+?)\]/u,shape:"rectangle"},{regex:/^([\p{L}\p{N}_-]+)\((.+?)\)/u,shape:"rounded"},{regex:/^([\p{L}\p{N}_-]+)\{(.+?)\}/u,shape:"diamond"}],An=/^([\p{L}\p{N}_-]+)/u,Mo=/^:::([\w][\w-]*)/;function Co(t){let e=t.trim();return e.length>=2&&e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1).replaceAll('\\"','"'):t}function So(t,e,r){let n=t.trim(),o=vn(n,e,r);if(!o||o.ids.length===0)return;n=o.remaining.trim();let i=o.ids;for(;n.length>0;){let a=n.match($n);if(!a)break;let s=!!a[1],l=a[2],d=a[3]?.trim()||void 0;n=n.slice(a[0].length).trim();let u=ko(l),p=l.endsWith(">"),c=vn(n,e,r);if(!c||c.ids.length===0)break;n=c.remaining.trim();for(let f of i)for(let g of c.ids)e.edges.push({source:f,target:g,label:d,style:u,hasArrowStart:s,hasArrowEnd:p});i=c.ids;}}function vn(t,e,r){let n=kn(t,e,r);if(!n)return null;let o=[n.id],i=n.remaining.trim();for(;i.startsWith("&");){i=i.slice(1).trim();let a=kn(i,e,r);if(!a)break;o.push(a.id),i=a.remaining.trim();}return {ids:o,remaining:i}}function kn(t,e,r){let n=null,o=t;for(let{regex:a,shape:s}of wo){let l=t.match(a);if(l){n=l[1];let d=Co(l[2]);En(e,r,{id:n,label:d,shape:s}),o=t.slice(l[0].length);break}}if(n===null){let a=t.match(An);if(a){let s=a[1],l=vo(t,s.length);n=t.slice(0,l),e.nodes.has(n)?Ln(r,n):En(e,r,{id:n,label:n,shape:"rectangle"}),o=t.slice(l);}}if(n===null)return null;let i=o.match(Mo);return i&&(e.classAssignments.set(n,i[1]),o=o.slice(i[0].length)),{id:n,remaining:o}}function vo(t,e){for(let r=e;r>=1;r--){let n=t.slice(r),o=n.match($n);if(!o)continue;let i=n.slice(o[0].length).trimStart();if(i.length!==0&&An.test(i))return r}for(let r=e;r>=1;r--){let n=t.slice(r);if(n.length===0)return r;let o=n[0];if(/\s/.test(o)||o==="&"||n.startsWith(":::"))return r}return Math.max(1,e)}function En(t,e,r){!t.nodes.has(r.id)&&t.nodes.set(r.id,r),Ln(e,r.id);}function Ln(t,e){if(t.length>0){let r=t[t.length-1];r.nodeIds.includes(e)||r.nodeIds.push(e);}}function ko(t){return t==="-.->"||t==="-.-"?"dotted":t==="==>"||t==="==="?"thick":"solid"}var ct={x:1,y:0},ot={x:1,y:2},lt={x:0,y:1},at={x:2,y:1},Ct={x:2,y:0},wt={x:0,y:0},kt={x:2,y:2},St={x:0,y:2},Ot={x:1,y:1};function se(t,e){return t.x===e.x&&t.y===e.y}function Ee(t,e){return t.x===e.x&&t.y===e.y}function xe(t,e){return {x:t.x+e.x,y:t.y+e.y}}function Ue(t){return `${t.x},${t.y}`}var _n={name:"",styles:{}};function Eo(t){return t>=768&&t<=879||t>=6832&&t<=6911||t>=7616&&t<=7679||t>=8400&&t<=8447||t>=65056&&t<=65071}function $o(t){return t>=4352&&t<=4447||t>=11904&&t<=42191||t>=44032&&t<=55203||t>=63744&&t<=64255||t>=65040&&t<=65049||t>=65072&&t<=65135||t>=65280&&t<=65376||t>=65504&&t<=65510||t>=127744&&t<=129791||t>=129280&&t<=129535}function ae(t){let e=t.codePointAt(0);return e==null||e===0||e<32||e>=127&&e<160||Eo(e)?0:$o(e)?2:1}function ht(t){let e=0;for(let r of t)e+=ae(r);return e}function be(t,e){if(e<=0)return "";let r=0,n="";for(let o of t){let i=ae(o);if(r+i>e)break;n+=o,r+=i;}return n}function bt(t,e){let r=[];for(let n=0;n<=t;n++){let o=[];for(let i=0;i<=e;i++)o.push(" ");r.push(o);}return r}function Kt(t){let[e,r]=vt(t);return bt(e,r)}function vt(t){return [t.length-1,(t[0]?.length??1)-1]}function Rt(t,e,r){let[n,o]=vt(t),i=Math.max(e,n),a=Math.max(r,o),s=bt(i,a);for(let l=0;l<s.length;l++)for(let d=0;d<s[0].length;d++)l<t.length&&d<t[0].length&&(s[l][d]=t[l][d]);return t.length=0,t.push(...s),t}var Ao=new Set(["\u2500","\u2502","\u250C","\u2510","\u2514","\u2518","\u251C","\u2524","\u252C","\u2534","\u253C","\u2574","\u2575","\u2576","\u2577"]);function Tn(t){return Ao.has(t)}var Lo={"\u2500":{"\u2502":"\u253C","\u250C":"\u252C","\u2510":"\u252C","\u2514":"\u2534","\u2518":"\u2534","\u251C":"\u253C","\u2524":"\u253C","\u252C":"\u252C","\u2534":"\u2534"},"\u2502":{"\u2500":"\u253C","\u250C":"\u251C","\u2510":"\u2524","\u2514":"\u251C","\u2518":"\u2524","\u251C":"\u251C","\u2524":"\u2524","\u252C":"\u253C","\u2534":"\u253C"},"\u250C":{"\u2500":"\u252C","\u2502":"\u251C","\u2510":"\u252C","\u2514":"\u251C","\u2518":"\u253C","\u251C":"\u251C","\u2524":"\u253C","\u252C":"\u252C","\u2534":"\u253C"},"\u2510":{"\u2500":"\u252C","\u2502":"\u2524","\u250C":"\u252C","\u2514":"\u253C","\u2518":"\u2524","\u251C":"\u253C","\u2524":"\u2524","\u252C":"\u252C","\u2534":"\u253C"},"\u2514":{"\u2500":"\u2534","\u2502":"\u251C","\u250C":"\u251C","\u2510":"\u253C","\u2518":"\u2534","\u251C":"\u251C","\u2524":"\u253C","\u252C":"\u253C","\u2534":"\u2534"},"\u2518":{"\u2500":"\u2534","\u2502":"\u2524","\u250C":"\u253C","\u2510":"\u2524","\u2514":"\u2534","\u251C":"\u253C","\u2524":"\u2524","\u252C":"\u253C","\u2534":"\u2534"},"\u251C":{"\u2500":"\u253C","\u2502":"\u251C","\u250C":"\u251C","\u2510":"\u253C","\u2514":"\u251C","\u2518":"\u253C","\u2524":"\u253C","\u252C":"\u253C","\u2534":"\u253C"},"\u2524":{"\u2500":"\u253C","\u2502":"\u2524","\u250C":"\u253C","\u2510":"\u2524","\u2514":"\u253C","\u2518":"\u2524","\u251C":"\u253C","\u252C":"\u253C","\u2534":"\u253C"},"\u252C":{"\u2500":"\u252C","\u2502":"\u253C","\u250C":"\u252C","\u2510":"\u252C","\u2514":"\u253C","\u2518":"\u253C","\u251C":"\u253C","\u2524":"\u253C","\u2534":"\u253C"},"\u2534":{"\u2500":"\u2534","\u2502":"\u253C","\u250C":"\u253C","\u2510":"\u253C","\u2514":"\u2534","\u2518":"\u2534","\u251C":"\u253C","\u2524":"\u253C","\u252C":"\u253C"}};function _o(t,e){return Lo[t]?.[e]??t}function Nt(t,e,r,...n){let[o,i]=vt(t);for(let s of n){let[l,d]=vt(s);o=Math.max(o,l+e.x),i=Math.max(i,d+e.y);}let a=bt(o,i);for(let s=0;s<=o;s++)for(let l=0;l<=i;l++)s<t.length&&l<t[0].length&&(a[s][l]=t[s][l]);for(let s of n)for(let l=0;l<s.length;l++)for(let d=0;d<s[0].length;d++){let u=s[l][d];if(u!==" "){let p=l+e.x,c=d+e.y,f=a[p][c];!r&&Tn(u)&&Tn(f)?a[p][c]=_o(f,u):a[p][c]=u;}}return a}function In(t){return t==="\u2500"||t==="\u253C"||t==="\u252C"||t==="\u2534"||t==="\u2524"||t==="\u2510"||t==="\u2518"}function Pn(t){return t==="\u2500"||t==="\u253C"||t==="\u252C"||t==="\u2534"||t==="\u251C"||t==="\u250C"||t==="\u2514"}function Dn(t){return t==="\u2502"||t==="\u253C"||t==="\u251C"||t==="\u2524"||t==="\u2534"||t==="\u2514"||t==="\u2518"}function Rn(t){return t==="\u2502"||t==="\u253C"||t==="\u251C"||t==="\u2524"||t==="\u252C"||t==="\u250C"||t==="\u2510"}function On(t,e){let[r,n]=vt(t),o=1,i=2,a=4,s=8,l=o|i|a|s;function d(u){return u===l?null:u===(o|i)?"\u2500":u===(a|s)?"\u2502":u===(a|i)?"\u2514":u===(a|o)?"\u2518":u===(s|i)?"\u250C":u===(s|o)?"\u2510":u===(a|o|i)?"\u2534":u===(s|o|i)?"\u252C":u===(a|s|o)?"\u2524":u===(a|s|i)?"\u251C":null}for(let u=0;u<=r;u++)for(let p=0;p<=n;p++){if(t[u][p]!=="\u253C")continue;let c=u>0?t[u-1][p]:" ",f=u<r?t[u+1][p]:" ",g=p>0?t[u][p-1]:" ",x=p<n?t[u][p+1]:" ",m=(Pn(c)?1:0)+(In(f)?1:0),h=(Rn(g)?1:0)+(Dn(x)?1:0);if(e&&e.size>0){let b=`${u},${p}`,y=e.get(b)??0;if(y!==0){let M=Pn(c),A=In(f),w=Rn(g),$=Dn(x),k=(M?o:0)|(A?i:0)|(w?a:0)|($?s:0),P=h>m,X=P?a|s:o|i,N=k&X|y;N===l&&(P?(y&o)===0?N&=~o:(y&i)===0&&(N&=~i):(y&a)===0?N&=~a:(y&s)===0&&(N&=~s));let F=d(N);if(F){t[u][p]=F;continue}}}t[u][p]=h>m?"\u2502":"\u2500";}}function Xt(t){let[e,r]=vt(t),n=[];for(let o=0;o<=r;o++){let i="";for(let a=0;a<=e;a++){let s=t[a][o];i+=s,ae(s)===2&&(a+=1);}n.push(i);}return n.join(`
`)}var To={"\u25B2":"\u25BC","\u25BC":"\u25B2","\u25E4":"\u25E3","\u25E3":"\u25E4","\u25E5":"\u25E2","\u25E2":"\u25E5","^":"v",v:"^","\u250C":"\u2514","\u2514":"\u250C","\u2510":"\u2518","\u2518":"\u2510","\u252C":"\u2534","\u2534":"\u252C","\u2575":"\u2577","\u2577":"\u2575"};function Nn(t){for(let e of t)e.reverse();for(let e of t)for(let r=0;r<e.length;r++){let n=To[e[r]];n&&(e[r]=n);}return t}function Et(t,e,r){Rt(t,e.x+ht(r),e.y);let n=e.x;for(let o of r)t[n][e.y]=o,n+=ae(o);}function Xn(t,e,r){let n=0,o=0;for(let i of e.values())n+=i;for(let i of r.values())o+=i;Rt(t,n-1,o-1);}function Bn(t,e){let r=new Map,n=0;for(let[s,l]of t.nodes){let d={name:s,displayLabel:l.label,index:n,gridCoord:null,drawingCoord:null,drawing:null,drawn:false,styleClassName:"",styleClass:_n};r.set(s,d),n++;}let o=[...r.values()],i=[];for(let s of t.edges){let l=r.get(s.source),d=r.get(s.target);!l||!d||i.push({from:l,to:d,text:s.label??"",path:[],labelLine:[],startDir:{x:0,y:0},endDir:{x:0,y:0}});}let a=[];for(let s of t.subgraphs)Gn(s,null,r,a);Io(t.subgraphs,a,r);for(let[s,l]of t.classAssignments){let d=r.get(s),u=t.classDefs.get(l);d&&u&&(d.styleClassName=l,d.styleClass={name:l,styles:u});}return {nodes:o,edges:i,canvas:bt(0,0),grid:new Map,columnWidth:new Map,rowHeight:new Map,subgraphs:a,config:e,offsetX:0,offsetY:0}}function Gn(t,e,r,n){let o={name:t.label,nodes:[],parent:e,children:[],minX:0,minY:0,maxX:0,maxY:0};for(let i of t.nodeIds){let a=r.get(i);a&&o.nodes.push(a);}n.push(o);for(let i of t.children){let a=Gn(i,o,r,n);o.children.push(a);for(let s of a.nodes)o.nodes.includes(s)||o.nodes.push(s);}return o}function Io(t,e,r,n){let o=new Map;Do(t,e,o);let i=new Map;function a(s){let l=o.get(s);if(l){for(let d of s.children)a(d);for(let d of s.nodeIds)i.has(d)||i.set(d,l);}}for(let s of t)a(s);for(let s of e)s.nodes=s.nodes.filter(l=>{let d;for(let[p,c]of r)if(c===l){d=p;break}if(!d)return  false;let u=i.get(d);return u?Po(s,u):true});}function Po(t,e){let r=e;for(;r!==null;){if(r===t)return  true;r=r.parent;}return  false}function Do(t,e,r){let n=[];function o(i){for(let a of i)n.push(a),o(a.children);}o(t);for(let i=0;i<n.length&&i<e.length;i++)r.set(n[i],e[i]);}var je=class{idxs=[];priorities=[];costs=[];poppedIdx=-1;poppedPriority=0;poppedCost=0;get length(){return this.idxs.length}clear(){this.idxs.length=0,this.priorities.length=0,this.costs.length=0,this.poppedIdx=-1,this.poppedPriority=0,this.poppedCost=0;}push(e,r,n){this.idxs.push(e),this.priorities.push(r),this.costs.push(n),this.bubbleUp(this.idxs.length-1);}pop(){if(this.idxs.length===0)return  false;this.poppedIdx=this.idxs[0],this.poppedPriority=this.priorities[0],this.poppedCost=this.costs[0];let e=this.idxs.pop(),r=this.priorities.pop(),n=this.costs.pop();return this.idxs.length>0&&(this.idxs[0]=e,this.priorities[0]=r,this.costs[0]=n,this.sinkDown(0)),true}bubbleUp(e){for(;e>0;){let r=e-1>>1;if(this.priorities[e]<this.priorities[r])[this.idxs[e],this.idxs[r]]=[this.idxs[r],this.idxs[e]],[this.priorities[e],this.priorities[r]]=[this.priorities[r],this.priorities[e]],[this.costs[e],this.costs[r]]=[this.costs[r],this.costs[e]],e=r;else break}}sinkDown(e){let r=this.idxs.length;for(;;){let n=e,o=2*e+1,i=2*e+2;if(o<r&&this.priorities[o]<this.priorities[n]&&(n=o),i<r&&this.priorities[i]<this.priorities[n]&&(n=i),n!==e)[this.idxs[e],this.idxs[n]]=[this.idxs[n],this.idxs[e]],[this.priorities[e],this.priorities[n]]=[this.priorities[n],this.priorities[e]],[this.costs[e],this.costs[n]]=[this.costs[n],this.costs[e]],e=n;else break}}};function Yn(t,e){let r=t*e;return {stride:t,height:e,blocked:new Uint8Array(r),stamp:0,costStamp:new Uint32Array(r),costSoFar:new Float64Array(r),cameFrom:new Int32Array(r),heap:new je}}function te(t,e){return e.x+e.y*t}function Fn(t,e){let r=e/t|0;return {x:e-r*t,y:r}}function Bt(t,e){if(t.length<=2)return t.length;let r=0,n=t[1]-t[0];for(let o=2;o<t.length;o++){let i=t[o]-t[o-1];i!==n&&(r++,n=i);}return 2+r}function Hn(t,e){if(t.length<=2)return t;let r=[t[0]],n=t[1]-t[0];for(let o=2;o<t.length;o++){let i=t[o]-t[o-1];i!==n&&(r.push(t[o-1]),n=i);}return r.push(t[t.length-1]),r}function Wn(t,e,r,n){let o=globalThis.__bm_getPath;if(typeof o=="function")return o(t.stride,e,r,n.maxX,n.maxY,t.blocked);let{stride:i}=t,a=n.maxX,s=n.maxY;if(a<0||s<0)return null;let l=r/i|0,d=r-l*i;t.stamp=t.stamp+1>>>0,t.stamp===0&&(t.stamp=1);let u=t.stamp;for(t.heap.clear(),t.costStamp[e]=u,t.costSoFar[e]=0,t.cameFrom[e]=-1,t.heap.push(e,0,0);t.heap.pop();){let p=t.heap.poppedIdx,c=t.heap.poppedCost;if(t.costStamp[p]!==u||c!==t.costSoFar[p])continue;if(p===r){let m=[],h=p;for(;h!==-1;)m.push(h),h=t.cameFrom[h];return m.reverse(),m}let f=t.costSoFar[p],g=p/i|0,x=p-g*i;if(x<a){let m=p+1;if(!t.blocked[m]||m===r){let h=f+1;if(t.costStamp[m]!==u||h<t.costSoFar[m]){t.costStamp[m]=u,t.costSoFar[m]=h,t.cameFrom[m]=p;let b=x+1>=d?x+1-d:d-(x+1),y=g>=l?g-l:l-g,M=b===0||y===0?b+y:b+y+1;t.heap.push(m,h+M,h);}}}if(x>0){let m=p-1;if(!t.blocked[m]||m===r){let h=f+1;if(t.costStamp[m]!==u||h<t.costSoFar[m]){t.costStamp[m]=u,t.costSoFar[m]=h,t.cameFrom[m]=p;let b=x-1>=d?x-1-d:d-(x-1),y=g>=l?g-l:l-g,M=b===0||y===0?b+y:b+y+1;t.heap.push(m,h+M,h);}}}if(g<s){let m=p+i;if(!t.blocked[m]||m===r){let h=f+1;if(t.costStamp[m]!==u||h<t.costSoFar[m]){t.costStamp[m]=u,t.costSoFar[m]=h,t.cameFrom[m]=p;let b=x>=d?x-d:d-x,y=g+1>=l?g+1-l:l-(g+1),M=b===0||y===0?b+y:b+y+1;t.heap.push(m,h+M,h);}}}if(g>0){let m=p-i;if(!t.blocked[m]||m===r){let h=f+1;if(t.costStamp[m]!==u||h<t.costSoFar[m]){t.costStamp[m]=u,t.costSoFar[m]=h,t.cameFrom[m]=p;let b=x>=d?x-d:d-x,y=g-1>=l?g-1-l:l-(g-1),M=b===0||y===0?b+y:b+y+1;t.heap.push(m,h+M,h);}}}}return null}var qt=1,Jt=2,Zt=4,Qt=8;function Un(t,e,r,n,o){let i=globalThis.__bm_getPathStrict;if(typeof i=="function")return i(t.stride,e,r,n.maxX,n.maxY,t.blocked,o);let a=t.stride,s=n.maxX,l=n.maxY;if(s<0||l<0)return null;let d=r/a|0,u=r-d*a;t.stamp=t.stamp+1>>>0,t.stamp===0&&(t.stamp=1);let p=t.stamp,c=t.heap,f=t.blocked,g=t.costStamp,x=t.costSoFar,m=t.cameFrom;c.clear(),g[e]=p,x[e]=0,m[e]=-1,c.push(e,0,0);let h=o.usedPoints,b=o.segmentUsage,y=b.segmentUsed,M=b.usedAsMiddle;b.segmentPair;b.segmentPairMulti;let $=b.startSource,k=b.startSourceMulti,P=b.endTarget,X=b.endTargetMulti,N=o.routeFromIdx,F=o.routeToIdx,Z=o.edgeFromId,_=o.edgeToId,H=qt|Jt,I=Zt|Qt;for(;c.pop();){let S=c.poppedIdx,v=c.poppedCost;if(g[S]!==p||v!==x[S])continue;if(S===r){let D=[],T=S;for(;T!==-1;)D.push(T),T=m[T];return D.reverse(),D}let V=x[S],z=S/a|0,L=S-z*a;if(L<s){let D=S+1;if(!f[D]||D===r){let T=true;if(h){let G=h[S];if(G!==0){let W=G|Jt;(W&H)===H&&(W&I)===I&&(T=false);}if(T){let W=h[D];if(W!==0){let K=W|qt;(K&H)===H&&(K&I)===I&&(T=false);}}}if(T){let G=S*2;if(y[G]&&(T=false,!M[G])){let W=S===N,K=D===F,B=$[G],O=P[G],C=k[G]!==0,E=X[G]!==0;W&&K?T=!C&&(B===0||B===Z)&&(!E&&(O===0||O===_)):W?T=!E&&O===0&&!C&&B===Z:K&&(T=!C&&B===0&&!E&&O===_);}}if(T){let G=V+1;if(g[D]!==p||G<x[D]){g[D]=p,x[D]=G,m[D]=S;let W=L+1,K=W>=u?W-u:u-W,B=z>=d?z-d:d-z,O=K===0||B===0?K+B:K+B+1;c.push(D,G+O,G);}}}}if(L>0){let D=S-1;if(!f[D]||D===r){let T=true;if(h){let G=h[S];if(G!==0){let W=G|qt;(W&H)===H&&(W&I)===I&&(T=false);}if(T){let W=h[D];if(W!==0){let K=W|Jt;(K&H)===H&&(K&I)===I&&(T=false);}}}if(T){let G=D*2;if(y[G]&&(T=false,!M[G])){let W=S===N,K=D===F,B=$[G],O=P[G],C=k[G]!==0,E=X[G]!==0;W&&K?T=!C&&(B===0||B===Z)&&(!E&&(O===0||O===_)):W?T=!E&&O===0&&!C&&B===Z:K&&(T=!C&&B===0&&!E&&O===_);}}if(T){let G=V+1;if(g[D]!==p||G<x[D]){g[D]=p,x[D]=G,m[D]=S;let W=L-1,K=W>=u?W-u:u-W,B=z>=d?z-d:d-z,O=K===0||B===0?K+B:K+B+1;c.push(D,G+O,G);}}}}if(z<l){let D=S+a;if(!f[D]||D===r){let T=true;if(h){let G=h[S];if(G!==0){let W=G|Qt;(W&H)===H&&(W&I)===I&&(T=false);}if(T){let W=h[D];if(W!==0){let K=W|Zt;(K&H)===H&&(K&I)===I&&(T=false);}}}if(T){let G=S*2+1;if(y[G]&&(T=false,!M[G])){let W=S===N,K=D===F,B=$[G],O=P[G],C=k[G]!==0,E=X[G]!==0;W&&K?T=!C&&(B===0||B===Z)&&(!E&&(O===0||O===_)):W?T=!E&&O===0&&!C&&B===Z:K&&(T=!C&&B===0&&!E&&O===_);}}if(T){let G=V+1;if(g[D]!==p||G<x[D]){g[D]=p,x[D]=G,m[D]=S;let W=z+1,K=L>=u?L-u:u-L,B=W>=d?W-d:d-W,O=K===0||B===0?K+B:K+B+1;c.push(D,G+O,G);}}}}if(z>0){let D=S-a;if(!f[D]||D===r){let T=true;if(h){let G=h[S];if(G!==0){let W=G|Zt;(W&H)===H&&(W&I)===I&&(T=false);}if(T){let W=h[D];if(W!==0){let K=W|Qt;(K&H)===H&&(K&I)===I&&(T=false);}}}if(T){let G=D*2+1;if(y[G]&&(T=false,!M[G])){let W=S===N,K=D===F,B=$[G],O=P[G],C=k[G]!==0,E=X[G]!==0;W&&K?T=!C&&(B===0||B===Z)&&(!E&&(O===0||O===_)):W?T=!E&&O===0&&!C&&B===Z:K&&(T=!C&&B===0&&!E&&O===_);}}if(T){let G=V+1;if(g[D]!==p||G<x[D]){g[D]=p,x[D]=G,m[D]=S;let W=z-1,K=L>=u?L-u:u-L,B=W>=d?W-d:d-W,O=K===0||B===0?K+B:K+B+1;c.push(D,G+O,G);}}}}}return null}var Ro=1;function jn(t,e,r,n,o){let i=globalThis.__bm_getPathRelaxed;if(typeof i=="function")return i(t.stride,e,r,n.maxX,n.maxY,t.blocked,o);let a=t.stride,s=n.maxX,l=n.maxY;if(s<0||l<0)return null;let d=r/a|0,u=r-d*a;t.stamp=t.stamp+1>>>0,t.stamp===0&&(t.stamp=1);let p=t.stamp,c=t.heap,f=t.blocked,g=t.costStamp,x=t.costSoFar,m=t.cameFrom;c.clear(),g[e]=p,x[e]=0,m[e]=-1,c.push(e,0,0);let h=o.usedPoints,b=o.segmentUsage,y=b.segmentUsed,M=b.usedAsMiddle,A=b.segmentPair,w=b.segmentPairMulti,$=b.startSource,k=b.startSourceMulti,P=b.endTarget,X=b.endTargetMulti,N=o.routeFromIdx,F=o.routeToIdx,Z=o.edgeFromId,_=o.edgeToId,H=o.relaxedAllowEndSegmentReuse===true,I=Z>65535||_>65535?0:Z<<16|_;function S(T){return I!==0&&w[T]===0&&A[T]===I}let v=qt|Jt,V=Zt|Qt,z=[0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,4];function L(T,G){if(T===0)return 0;let W=T|G;return (W&v)===v&&(W&V)===V?Ro:0}function D(T,G,W){if(!y[T]||S(T))return  true;if(M[T]||W&&!H)return  false;let K=$[T],B=P[T],O=k[T]!==0,C=X[T]!==0;return G&&W?!O&&(K===0||K===Z)&&(!C&&(B===0||B===_)):G?!C&&B===0&&!O&&K===Z:W?!O&&K===0&&!C&&B===_:false}for(;c.pop();){let T=c.poppedIdx,G=c.poppedCost;if(g[T]!==p||G!==x[T])continue;if(T===r){let O=[],C=T;for(;C!==-1;)O.push(C),C=m[C];return O.reverse(),{path:O,cost:x[T]}}let W=x[T],K=T/a|0,B=T-K*a;if(B<s){let O=T+1;if(!f[O]||O===r){let C=0,E=true,R=T*2;if(h&&(C+=L(h[T],Jt),C+=L(h[O],qt),O!==r)){let U=h[O];if(U!==0){let J=F-O,et=J===1||J===-1||J===a||J===-a,Y=(U|qt)&15,q=z[Y];S(R)&&q<=2||(T!==N&&!et?E=false:T===N?q>=3&&(E=false):q>=4&&(E=false));}}if(E&&D(R,T===N,O===F)){let U=W+1+C;if(g[O]!==p||U<x[O]){g[O]=p,x[O]=U,m[O]=T;let J=B+1,et=J>=u?J-u:u-J,Y=K>=d?K-d:d-K,q=et===0||Y===0?et+Y:et+Y+1;c.push(O,U+q,U);}}}}if(B>0){let O=T-1;if(!f[O]||O===r){let C=0,E=true,R=O*2;if(h&&(C+=L(h[T],qt),C+=L(h[O],Jt),O!==r)){let U=h[O];if(U!==0){let J=F-O,et=J===1||J===-1||J===a||J===-a,Y=(U|Jt)&15,q=z[Y];S(R)&&q<=2||(T!==N&&!et?E=false:T===N?q>=3&&(E=false):q>=4&&(E=false));}}if(E&&D(R,T===N,O===F)){let U=W+1+C;if(g[O]!==p||U<x[O]){g[O]=p,x[O]=U,m[O]=T;let J=B-1,et=J>=u?J-u:u-J,Y=K>=d?K-d:d-K,q=et===0||Y===0?et+Y:et+Y+1;c.push(O,U+q,U);}}}}if(K<l){let O=T+a;if(!f[O]||O===r){let C=0,E=true,R=T*2+1;if(h&&(C+=L(h[T],Qt),C+=L(h[O],Zt),O!==r)){let U=h[O];if(U!==0){let J=F-O,et=J===1||J===-1||J===a||J===-a,Y=(U|Zt)&15,q=z[Y];S(R)&&q<=2||(T!==N&&!et?E=false:T===N?q>=3&&(E=false):q>=4&&(E=false));}}if(E&&D(R,T===N,O===F)){let U=W+1+C;if(g[O]!==p||U<x[O]){g[O]=p,x[O]=U,m[O]=T;let J=K+1,et=B>=u?B-u:u-B,Y=J>=d?J-d:d-J,q=et===0||Y===0?et+Y:et+Y+1;c.push(O,U+q,U);}}}}if(K>0){let O=T-a;if(!f[O]||O===r){let C=0,E=true,R=O*2+1;if(h&&(C+=L(h[T],Zt),C+=L(h[O],Qt),O!==r)){let U=h[O];if(U!==0){let J=F-O,et=J===1||J===-1||J===a||J===-a,Y=(U|Qt)&15,q=z[Y];S(R)&&q<=2||(T!==N&&!et?E=false:T===N?q>=3&&(E=false):q>=4&&(E=false));}}if(E&&D(R,T===N,O===F)){let U=W+1+C;if(g[O]!==p||U<x[O]){g[O]=p,x[O]=U,m[O]=T;let J=K-1,et=B>=u?B-u:u-B,Y=J>=d?J-d:d-J,q=et===0||Y===0?et+Y:et+Y+1;c.push(O,U+q,U);}}}}}return null}function ze(t){if(t.length<=2)return t;let e=new Set,r=t[0],n=t[1];for(let o=2;o<t.length;o++){let i=t[o],a=n.x-r.x,s=n.y-r.y,l=i.x-n.x,d=i.y-n.y;a===l&&s===d&&e.add(o-1),r=n,n=i;}return t.filter((o,i)=>!e.has(i))}var Lt=[12,24,48],Tt=[12,24,48,96,192,384],Ae=Tt[Tt.length-1];function $e(t){return t===ct?ot:t===ot?ct:t===lt?at:t===at?lt:t===Ct?St:t===wt?kt:t===kt?wt:t===St?Ct:Ot}function j(t,e){return t.x===e.x&&t.y===e.y}function $t(t,e){return t.x===e.x?t.y<e.y?ot:ct:t.y===e.y?t.x<e.x?at:lt:t.x<e.x?t.y<e.y?kt:Ct:t.y<e.y?St:wt}function Oo(t){return t==="LR"?[at,ot,ot,at]:[ot,at,at,ot]}function No(t,e,r){if(t.from===t.to)return Oo(e);let n=$t(t.from.gridCoord,t.to.gridCoord),o,i,a,s,l=e==="LR"?j(n,lt)||j(n,wt)||j(n,St):j(n,ct)||j(n,wt)||j(n,Ct);if(j(n,kt)?e==="LR"?(o=ot,i=lt,a=at,s=ct):(o=at,i=ct,a=ot,s=lt):j(n,Ct)?e==="LR"?(o=ct,i=lt,a=at,s=ot):(o=at,i=ot,a=ct,s=lt):j(n,St)?e==="LR"?(o=ot,i=ot,a=lt,s=ct):(o=lt,i=ct,a=ot,s=at):j(n,wt)?e==="LR"?(o=ot,i=ot,a=lt,s=ot):(o=at,i=at,a=ct,s=at):l?e==="LR"&&j(n,lt)?(o=ot,i=ot,a=lt,s=at):e==="TD"&&j(n,ct)?(o=at,i=at,a=ct,s=ot):(o=n,i=$e(n),a=n,s=$e(n)):(o=n,i=$e(n),a=n,s=$e(n)),r==="relaxed"){let f=t.from.gridCoord,g=t.to.gridCoord;if(f&&g){let h=function(A){return j(A,lt)?at:j(A,at)?lt:j(A,wt)?Ct:j(A,Ct)?wt:j(A,St)?kt:j(A,kt)?St:A},b=function(A){return j(A,ct)?ot:j(A,ot)?ct:j(A,wt)?St:j(A,Ct)?kt:j(A,St)?wt:j(A,kt)?Ct:A},y=function(A){let w=A,$=Math.sign(w.x-1),k=Math.sign(w.y-1);return (x<0&&$===1||x>0&&$===-1)&&(w=h(w)),(m<0&&k===1||m>0&&k===-1)&&(w=b(w)),w},M=function(A){let w=A,$=Math.sign(w.x-1),k=Math.sign(w.y-1);return (x<0&&$===-1||x>0&&$===1)&&(w=h(w)),(m<0&&k===-1||m>0&&k===1)&&(w=b(w)),w};let x=g.x-f.x,m=g.y-f.y;o=y(o),a=y(a),i=M(i),s=M(s);}}return [o,i,a,s]}function Zn(t){let e=t*2;return {segmentUsed:new Uint8Array(e),usedAsMiddle:new Uint8Array(e),segmentPair:new Uint32Array(e),segmentPairMulti:new Uint8Array(e),startSource:new Uint32Array(e),startSourceMulti:new Uint8Array(e),endTarget:new Uint32Array(e),endTargetMulti:new Uint8Array(e),usedCount:0}}var Ve=1,Ke=2,qe=4,Je=8;function Qn(t,e){let r=e-t,n=r===1||r===-1;return (t<e?t:e)*2+(n?0:1)}function zn(t,e,r){if(r.length<2)return;let n=e.from.index+1,o=e.to.index+1,i=n>65535||o>65535?0:n<<16|o;for(let a=1;a<r.length;a++){let s=r[a-1],l=r[a],d=Qn(s,l),u=a===1,p=a===r.length-1;if(t.segmentUsed[d]||(t.segmentUsed[d]=1,t.usedCount++),i!==0){let c=t.segmentPair[d];c===0?t.segmentPair[d]=i:c!==i&&(t.segmentPairMulti[d]=1);}if(u){let c=t.startSource[d];c===0?t.startSource[d]=n:c!==n&&(t.startSourceMulti[d]=1);}if(p){let c=t.endTarget[d];c===0?t.endTarget[d]=o:c!==o&&(t.endTargetMulti[d]=1);}!u&&!p&&(t.usedAsMiddle[d]=1);}}function tr(t,e,r){let n=e-t;return n===1?{fromBit:Ke,toBit:Ve}:n===-1?{fromBit:Ve,toBit:Ke}:n===r?{fromBit:Je,toBit:qe}:n===-r?{fromBit:qe,toBit:Je}:null}function Vn(t,e,r){if(r.length<2)return;let n=e.stride;for(let o=1;o<r.length;o++){let i=r[o-1],a=r[o],s=tr(i,a,n);s&&(e.blocked[i]||(t[i]=t[i]|s.fromBit),e.blocked[a]||(t[a]=t[a]|s.toBit));}}function Kn(t,e){let r=t|e,n=(r&Ve)!==0&&(r&Ke)!==0,o=(r&qe)!==0&&(r&Je)!==0;return n&&o}function Xo(t,e,r,n){if(!e)return  true;let o=tr(r,n,t.stride);if(!o)return  true;if(!t.blocked[r]){let i=e[r];if(i!==0&&Kn(i,o.fromBit))return  false}if(!t.blocked[n]){let i=e[n];if(i!==0&&Kn(i,o.toBit))return  false}return  true}function Bo(t,e,r,n,o,i,a,s){if(t.usedAsMiddle[s])return  false;let l=i===n,d=a===o,u=t.startSource[s],p=t.endTarget[s],c=t.startSourceMulti[s]!==0,f=t.endTargetMulti[s]!==0;return l&&d?!c&&(u===0||u===e)&&(!f&&(p===0||p===r)):l?!f&&p===0&&!c&&u===e:d?!c&&u===0&&!f&&p===r:false}function Qe(t,e,r,n,o,i,a,s=false){e.__bm_used_unconstrained_fallback=false;let l=e.from===e.to,d=t.config.routing,[u,p,c,f]=No(e,t.config.graphDirection,d);function g(Y){let q=[];for(let nt of Y)q.some(Q=>j(Q,nt))||q.push(nt);return q}function x(Y,q){let nt=[];for(let Q of Y)for(let tt of q){let rt=xe(e.from.gridCoord,Q),st=xe(e.to.gridCoord,tt);se(rt,st)||nt.push({startDir:Q,endDir:tt,routeFrom:rt,routeTo:st,routeFromIdx:te(r.stride,rt),routeToIdx:te(r.stride,st)});}return nt}function m(Y){return j(Y,ct)||j(Y,ot)||j(Y,lt)||j(Y,at)?0:d==="relaxed"?10:100}function h(Y){return Y.x===0||Y.y===0?200:0}let b=6;function y(Y,q){if(d!=="relaxed"||!t.portUsage||!t.config.useAscii)return 0;let nt=q.x+q.y*3,Q=Y.index*9+nt;return (t.portUsage[Q]??0)*b}function M(Y,q){return Bt(q,r.stride)+m(Y.startDir)+m(Y.endDir)+h(Y.routeFrom)+h(Y.routeTo)}function A(Y){if(!e.from.gridCoord||!e.to.gridCoord||Y.length<8)return 0;let q=r.stride,nt=Number.POSITIVE_INFINITY,Q=Number.NEGATIVE_INFINITY,tt=Number.POSITIVE_INFINITY,rt=Number.NEGATIVE_INFINITY;for(let wn of Y){let ve=wn%q,ke=wn/q|0;ve<nt&&(nt=ve),ve>Q&&(Q=ve),ke<tt&&(tt=ke),ke>rt&&(rt=ke);}let st=e.from.gridCoord,ut=e.to.gridCoord,pt=Math.min(st.x,ut.x),xt=Math.max(st.x,ut.x)+2,At=Math.min(st.y,ut.y),Pt=Math.max(st.y,ut.y)+2,Vt=2,Se=Math.max(0,pt-nt-Vt),oe=Math.max(0,Q-xt-Vt),co=Math.max(0,At-tt-Vt),lo=Math.max(0,rt-Pt-Vt),bn=Se+oe+co+lo,yn=12;return bn<=yn?0:(bn-yn)*4}let w=(()=>{let Y=Ze(t,e.from),q=Ze(t,e.to);if(!Y||!q)return null;let nt=0;q.minX>Y.maxX?nt=q.minX-Y.maxX:q.maxX<Y.minX&&(nt=q.maxX-Y.minX);let Q=0;if(q.minY>Y.maxY?Q=q.minY-Y.maxY:q.maxY<Y.minY&&(Q=q.maxY-Y.minY),nt===0&&Q===0){let tt=Math.floor((Y.minX+Y.maxX)/2),rt=Math.floor((Y.minY+Y.maxY)/2),st=Math.floor((q.minX+q.maxX)/2),ut=Math.floor((q.minY+q.maxY)/2);return {dx:st-tt,dy:ut-rt}}return {dx:nt,dy:Q}})();function $(Y){if(!w)return 0;let q=w.dx,nt=w.dy;if(q===0&&nt===0)return 0;let Q=q===0?0:q>0?1:-1,tt=nt===0?0:nt>0?1:-1,rt=Math.sign(Y.startDir.x-1),st=Math.sign(Y.startDir.y-1),ut=Math.sign(Y.endDir.x-1),pt=Math.sign(Y.endDir.y-1),xt=5e3,At=0;Q!==0&&rt!==0&&rt===-Q&&(At+=xt),tt!==0&&st!==0&&st===-tt&&(At+=xt),Q!==0&&ut!==0&&ut===Q&&(At+=xt),tt!==0&&pt!==0&&pt===tt&&(At+=xt);let Pt=Math.abs(q),Vt=Math.abs(nt),Se=2,oe=120;return Pt>=Vt+Se?(rt===0&&st!==0&&(At+=oe),ut===0&&pt!==0&&(At+=oe)):Vt>=Pt+Se&&(st===0&&rt!==0&&(At+=oe),pt===0&&ut!==0&&(At+=oe)),At}function k(Y,q){return q.cost+Bt(q.path,r.stride)+A(q.path)+$(Y)+m(Y.startDir)+m(Y.endDir)+h(Y.routeFrom)+h(Y.routeTo)+y(e.from,Y.startDir)+y(e.to,Y.endDir)}let P=g([u,c]),X=g([p,f]),N=[];function F(Y,q){if(N.some(tt=>j(tt.startDir,Y)&&j(tt.endDir,q)))return;let nt=xe(e.from.gridCoord,Y),Q=xe(e.to.gridCoord,q);se(nt,Q)||N.push({startDir:Y,endDir:q,routeFrom:nt,routeTo:Q,routeFromIdx:te(r.stride,nt),routeToIdx:te(r.stride,Q)});}if(F(u,p),F(c,f),d==="relaxed"&&P.length>1&&X.length>1)for(let Y of P)for(let q of X)F(Y,q);function Z(Y){return j(Y,ct)?{x:0,y:-1}:j(Y,ot)?{x:0,y:1}:j(Y,lt)?{x:-1,y:0}:j(Y,at)?{x:1,y:0}:null}function _(Y,q){let nt=Y[Y.length-1];if(nt.x===q.x){let Q=q.y>nt.y?1:-1;for(let tt=nt.y+Q;tt!==q.y+Q;tt+=Q)Y.push({x:nt.x,y:tt});return}if(nt.y===q.y){let Q=q.x>nt.x?1:-1;for(let tt=nt.x+Q;tt!==q.x+Q;tt+=Q)Y.push({x:tt,y:nt.y});return}throw new Error(`appendStraightLine expects straight line, got from=(${nt.x},${nt.y}) to=(${q.x},${q.y})`)}function H(Y,q){if(q.length<4)return  false;let nt=[];for(let Q=0;Q<q.length;Q++){let tt=q[Q];if(tt.x<0||tt.y<0||tt.x>=r.stride||tt.y>=r.height||(nt.push(te(r.stride,tt)),!(se(tt,Y.routeFrom)||se(tt,Y.routeTo))&&r.blocked[nt[nt.length-1]]))return  false}for(let Q=1;Q<nt.length;Q++){let tt=nt[Q-1],rt=nt[Q];if(!Xo(r,a,tt,rt))return  false;if(i){let st=Qn(tt,rt);if(i.segmentUsed[st]&&!Bo(i,e.from.index+1,e.to.index+1,Y.routeFromIdx,Y.routeToIdx,tt,rt,st))return  false}}return  true}function I(Y,q){let nt=Z(Y.startDir),Q=Z(Y.endDir);if(!nt||!Q||q<1)return null;let tt={x:Y.routeFrom.x+nt.x*q,y:Y.routeFrom.y+nt.y*q},rt={x:Y.routeTo.x+Q.x*q,y:Y.routeTo.y+Q.y*q},st=[{x:tt.x,y:rt.y},{x:rt.x,y:tt.y}];for(let ut of st){let pt=[Y.routeFrom];_(pt,tt),_(pt,ut),_(pt,rt),_(pt,Y.routeTo);let xt=pt.filter((At,Pt)=>Pt===0||!se(At,pt[Pt-1]));if(H(Y,xt)&&ze(xt).length>=4)return xt}return null}if(l){let Y=N.length>0?N:L;for(let q of Y)for(let nt=1;nt<=12;nt++){let Q=I(q,nt);if(!Q)continue;e.startDir=q.startDir,e.endDir=q.endDir,e.path=ze(Q);let tt=Q.map(rt=>te(r.stride,rt));if(i&&zn(i,e,tt),a&&Vn(a,r,tt),d==="relaxed"&&t.portUsage){let rt=e.startDir.x+e.startDir.y*3,st=e.endDir.x+e.endDir.y*3;t.portUsage[e.from.index*9+rt]=(t.portUsage[e.from.index*9+rt]??0)+1,t.portUsage[e.to.index*9+st]=(t.portUsage[e.to.index*9+st]??0)+1;}return}}let S=d==="relaxed"&&t.config.useAscii,v=[Ct,wt,kt,St],V=g([u,c,at,lt,ot,ct,...S?[Ct,wt,kt,St]:[]]),z=g([p,f,at,lt,ot,ct,...S?[Ct,wt,kt,St]:[]]),L=x(V,X),D=x(V,z),T=g([...V,...v]),G=g([...z,...v]),W=x(V,G),K=x(T,G);function B(Y){return {maxX:Math.min(r.stride-1,n+Y),maxY:Math.min(r.height-1,o+Y)}}function O(Y,q=Tt){for(let nt of q){let Q=B(nt),tt=null;for(let rt of Y){let st=Wn(r,rt.routeFromIdx,rt.routeToIdx,Q);if(!st||l&&Bt(st,r.stride)<4)continue;let ut=M(rt,st);(!tt||ut<tt.cost)&&(tt={candidate:rt,pathIdx:st,cost:ut});}if(tt)return tt}return null}function C(Y,q){if(!i||i.usedCount===0)return null;let nt={segmentUsage:i,usedPoints:a,routeFromIdx:0,routeToIdx:0,edgeFromId:e.from.index+1,edgeToId:e.to.index+1};for(let Q of q){let tt=B(Q),rt=null;for(let st of Y){nt.routeFromIdx=st.routeFromIdx,nt.routeToIdx=st.routeToIdx;let ut=Un(r,st.routeFromIdx,st.routeToIdx,tt,nt);if(!ut||l&&Bt(ut,r.stride)<4)continue;let pt=M(st,ut);(!rt||pt<rt.cost)&&(rt={candidate:st,pathIdx:ut,cost:pt});}if(rt)return rt}return null}function E(Y,q,nt){if(!i)return null;let Q={segmentUsage:i,usedPoints:a,routeFromIdx:0,routeToIdx:0,edgeFromId:e.from.index+1,edgeToId:e.to.index+1,relaxedAllowEndSegmentReuse:nt};for(let tt of q){let rt=B(tt),st=null;for(let ut of Y){Q.routeFromIdx=ut.routeFromIdx,Q.routeToIdx=ut.routeToIdx;let pt=jn(r,ut.routeFromIdx,ut.routeToIdx,rt,Q);if(!pt||l&&Bt(pt.path,r.stride)<4)continue;let xt=k(ut,pt);(!st||xt<st.cost)&&(st={candidate:ut,pathIdx:pt.path,cost:xt});}if(st)return st}return null}let R=null;if(d==="relaxed"){let Y=function(Q,tt){if(!Q)return tt;if(!tt)return Q;if(tt.cost<Q.cost)return tt;if(tt.cost>Q.cost)return Q;let rt=Bt(Q.pathIdx,r.stride);return Bt(tt.pathIdx,r.stride)<rt?tt:Q},q=function(Q){let tt=E(N,Lt,Q);if(tt){if(Bt(tt.pathIdx,r.stride)-2>4){let pt=x(V,[tt.candidate.endDir]),xt=E(pt,Lt,Q);return Y(tt,xt)}if(a&&tt.pathIdx.length>=4){let pt=false;for(let xt=1;xt<tt.pathIdx.length-1;xt++){let At=tt.pathIdx[xt],Pt=a[At]??0;if(Pt!==0&&(Pt&Pt-1)!==0){pt=true;break}}if(pt){let xt=E(N,[Ae],Q);return Y(tt,xt)}}return tt}let rt=E(L,Lt,Q)??E(D,Lt,Q);return rt=rt??E(N,Tt,Q)??E(L,Tt,Q)??E(D,Tt,Q),rt};if(R=!t.config.useAscii?q(true)??q(false):q(false)??q(true),!R){let Q=function(tt){let rt=E(W,Lt,tt)??E(K,Lt,tt);return rt=rt??E(W,Tt,tt)??E(K,Tt,tt),rt};R=Q(false)??Q(true);}}else !i||i.usedCount===0?R=O(N,Lt):(R=C(N,Lt)??C(L,Lt)??C(D,Lt),R=R??C(N,Tt)??C(L,Tt),R=R??C(D,Tt));if(!R&&d==="relaxed"&&s&&(e.__bm_used_unconstrained_fallback=true,R=O(N,Lt)??O(L,Lt)??O(D,Lt)??O(W,Lt)??O(K,Tt)),!R){e.startDir=u,e.endDir=p,e.path=[];return}if(e.startDir=R.candidate.startDir,e.endDir=R.candidate.endDir,e.path=Hn(R.pathIdx,r.stride).map(Y=>Fn(r.stride,Y)),i&&zn(i,e,R.pathIdx),a&&Vn(a,r,R.pathIdx),d==="relaxed"&&t.portUsage){let Y=e.startDir.x+e.startDir.y*3,q=e.endDir.x+e.endDir.y*3;t.portUsage[e.from.index*9+Y]=(t.portUsage[e.from.index*9+Y]??0)+1,t.portUsage[e.to.index*9+q]=(t.portUsage[e.to.index*9+q]??0)+1;}}function er(t,e){if(e.text.length===0||e.path.length<2)return;let r=ht(e.text),n=Wo(t),o=Fo(t),i=e.path[0],a=null,s=[i,e.path[1]],l=0,d=false,u=null,p=-1;for(let M=1;M<e.path.length;M++){let A=e.path[M],w=[i,A],$=qn(t,w);d||($>=r?(s=w,d=true):$>l&&(l=$,s=w));let k=nr(t,e,w,e.text),P=k?n.some(N=>Ho(N,k)):false,X=k?o.some(N=>Yo(k,N)):false;if(!P&&!X&&($>p&&(p=$,u=w),$>=r)){a=w;break}i=A;}a===null&&(a=u??s);let c=Math.min(a[0].x,a[1].x),f=Math.max(a[0].x,a[1].x),x=c+Math.floor((f-c)/2);if(t.config.routing==="relaxed"&&!t.config.useAscii){let M=new Set;for(let A of t.nodes)A.gridCoord&&(M.add(A.gridCoord.x),M.add(A.gridCoord.x+1),M.add(A.gridCoord.x+2));if(M.has(x)){let A=f-c;for(let w=1;w<=A;w++){let $=x-w;if($>=c&&$<=f&&!M.has($)){x=$;break}let k=x+w;if(k>=c&&k<=f&&!M.has(k)){x=k;break}}}}let h=t.columnWidth.get(x)??0,b=r+2,y=qn(t,a);if(y<b){let M=b-y;t.columnWidth.set(x,h+M);}e.labelLine=[a[0],a[1]];}function qn(t,e){let r=0,n=Math.min(e[0].x,e[1].x),o=Math.max(e[0].x,e[1].x);for(let i=n;i<=o;i++)r+=t.columnWidth.get(i)??0;return r}function Jn(t,e,r){let n=t.offsetX;for(let d=0;d<r.x;d++)n+=t.columnWidth.get(d)??0;let o=t.offsetY;for(let d=0;d<r.y;d++)o+=t.rowHeight.get(d)??0;let i=t.columnWidth.get(r.x)??0,a=t.rowHeight.get(r.y)??0,s=Math.floor(i/2),l=Math.floor(a/2);if(e.path.length>=2){let d=e.path[0],u=e.path[1],p=e.path[e.path.length-1],c=e.path[e.path.length-2];if(r.x===d.x&&r.y===d.y||r.x===u.x&&r.y===u.y){let x=d.x===u.x,m=d.y===u.y;x&&e.startPortOffsetX!=null&&(s=e.startPortOffsetX),m&&e.startPortOffsetY!=null&&(l=e.startPortOffsetY);}if(r.x===p.x&&r.y===p.y||r.x===c.x&&r.y===c.y){let x=p.x===c.x,m=p.y===c.y;x&&e.endPortOffsetX!=null&&(s=e.endPortOffsetX),m&&e.endPortOffsetY!=null&&(l=e.endPortOffsetY);}}return s<0&&(s=0),l<0&&(l=0),i>0&&s>i-1&&(s=i-1),a>0&&l>a-1&&(l=a-1),{x:n+s,y:o+l}}function Go(t,e){let r=t.offsetX;for(let o=0;o<e.x;o++)r+=t.columnWidth.get(o)??0;let n=t.offsetY;for(let o=0;o<e.y;o++)n+=t.rowHeight.get(o)??0;return {x:r,y:n}}function Ze(t,e){if(!e.gridCoord)return null;let r=e.gridCoord,n=0;for(let a=0;a<2;a++)n+=t.columnWidth.get(r.x+a)??0;let o=0;for(let a=0;a<2;a++)o+=t.rowHeight.get(r.y+a)??0;let i=Go(t,r);return {minX:i.x,minY:i.y,maxX:i.x+n,maxY:i.y+o}}function Yo(t,e){return t.y<e.minY||t.y>e.maxY?false:!(t.endX<e.minX||e.maxX<t.startX)}function Fo(t){let e=[];for(let r of t.nodes){let n=Ze(t,r);n&&e.push(n);}return e}function nr(t,e,r,n){let o=ht(n);if(o<=0)return null;let i=Jn(t,e,r[0]),a=Jn(t,e,r[1]),s=Math.min(i.x,a.x),l=Math.max(i.x,a.x),d=Math.min(i.y,a.y),u=Math.max(i.y,a.y),p=s+Math.floor((l-s)/2),c=d+Math.floor((u-d)/2),f=p-Math.floor(o/2);return {y:c,startX:f,endX:f+o-1}}function Ho(t,e){return t.y!==e.y?false:!(t.endX<e.startX||e.endX<t.startX)}function Wo(t){let e=[];for(let r of t.edges){if(r.text.length===0||r.labelLine.length<2)continue;let n=nr(t,r,[r.labelLine[0],r.labelLine[1]],r.text);n&&e.push(n);}return e}function _t(t,e,r){let n=0;if(t.columnStartX&&r.x>=0&&r.x<t.columnStartX.length)n=t.columnStartX[r.x]??0;else for(let d=0;d<r.x;d++)n+=t.columnWidth.get(d)??0;let o=0;if(t.rowStartY&&r.y>=0&&r.y<t.rowStartY.length)o=t.rowStartY[r.y]??0;else for(let d=0;d<r.y;d++)o+=t.rowHeight.get(d)??0;let i=t.columnWidth.get(r.x)??0,a=t.rowHeight.get(r.y)??0,s=Math.floor(i/2),l=Math.floor(a/2);if(e.path.length>=2){let d=e.path[0],u=e.path[1],p=e.path[e.path.length-1],c=e.path[e.path.length-2];if(r.x===d.x&&r.y===d.y||r.x===u.x&&r.y===u.y){let x=d.x===u.x,m=d.y===u.y;x&&e.startPortOffsetX!=null&&(s=e.startPortOffsetX),m&&e.startPortOffsetY!=null&&(l=e.startPortOffsetY);}if(r.x===p.x&&r.y===p.y||r.x===c.x&&r.y===c.y){let x=p.x===c.x,m=p.y===c.y;x&&e.endPortOffsetX!=null&&(s=e.endPortOffsetX),m&&e.endPortOffsetY!=null&&(l=e.endPortOffsetY);}}return s<0&&(s=0),l<0&&(l=0),i>0&&s>i-1&&(s=i-1),a>0&&l>a-1&&(l=a-1),{x:n+s+t.offsetX,y:o+l+t.offsetY}}function en(t,e,r){return r.map(n=>_t(t,e,n))}function sr(t,e){let r=t.gridCoord,n=e.config.useAscii,o=0;for(let f=0;f<2;f++)o+=e.columnWidth.get(r.x+f)??0;let i=0;for(let f=0;f<2;f++)i+=e.rowHeight.get(r.y+f)??0;let a={x:0,y:0},s={x:o,y:i},l=bt(Math.max(a.x,s.x),Math.max(a.y,s.y));if(n){for(let f=a.x+1;f<s.x;f++)l[f][a.y]="-";for(let f=a.x+1;f<s.x;f++)l[f][s.y]="-";for(let f=a.y+1;f<s.y;f++)l[a.x][f]="|";for(let f=a.y+1;f<s.y;f++)l[s.x][f]="|";l[a.x][a.y]="+",l[s.x][a.y]="+",l[a.x][s.y]="+",l[s.x][s.y]="+";}else {for(let f=a.x+1;f<s.x;f++)l[f][a.y]="\u2500";for(let f=a.x+1;f<s.x;f++)l[f][s.y]="\u2500";for(let f=a.y+1;f<s.y;f++)l[a.x][f]="\u2502";for(let f=a.y+1;f<s.y;f++)l[s.x][f]="\u2502";l[a.x][a.y]="\u250C",l[s.x][a.y]="\u2510",l[a.x][s.y]="\u2514",l[s.x][s.y]="\u2518";}let d=t.displayLabel,u=a.y+Math.floor(i/2),p=ht(d),c=a.x+Math.floor(o/2)-Math.ceil(p/2)+1;return Et(l,{x:c,y:u},d),l}function Le(t,e,r=1){let n=0;for(let y of t)for(let M of y)n=Math.max(n,ht(M));let i=n+2*r+2,a=0;for(let y of t)a+=Math.max(y.length,1);let s=t.length-1,l=a+s+2,d=e?"-":"\u2500",u=e?"|":"\u2502",p=e?"+":"\u250C",c=e?"+":"\u2510",f=e?"+":"\u2514",g=e?"+":"\u2518",x=e?"+":"\u251C",m=e?"+":"\u2524",h=bt(i-1,l-1);h[0][0]=p;for(let y=1;y<i-1;y++)h[y][0]=d;h[i-1][0]=c,h[0][l-1]=f;for(let y=1;y<i-1;y++)h[y][l-1]=d;h[i-1][l-1]=g;for(let y=1;y<l-1;y++)h[0][y]=u,h[i-1][y]=u;let b=1;for(let y=0;y<t.length;y++){let M=t[y],A=M.length>0?M:[""];for(let w of A){let $=1+r;Et(h,{x:$,y:b},w),b++;}if(y<t.length-1){h[0][b]=x;for(let w=1;w<i-1;w++)h[w][b]=d;h[i-1][b]=m,b++;}}return h}function Uo(t,e,r,n,o,i){let[a,s]=vt(t),l=Math.max(e.x,r.x),d=Math.max(e.y,r.y);(l>a||d>s)&&Rt(t,l,d);let u=$t(e,r),p=[],c=i?"-":"\u2500",f=i?"|":"\u2502",g=i?"\\":"\u2572",x=i?"/":"\u2571";if(j(u,ct))for(let m=e.y-n;m>=r.y-o;m--)p.push({x:e.x,y:m}),t[e.x][m]=f;else if(j(u,ot))for(let m=e.y+n;m<=r.y+o;m++)p.push({x:e.x,y:m}),t[e.x][m]=f;else if(j(u,lt))for(let m=e.x-n;m>=r.x-o;m--)p.push({x:m,y:e.y}),t[m][e.y]=c;else if(j(u,at))for(let m=e.x+n;m<=r.x+o;m++)p.push({x:m,y:e.y}),t[m][e.y]=c;else if(j(u,wt))for(let m=e.x,h=e.y-n;m>=r.x-o&&h>=r.y-o;m--,h--)p.push({x:m,y:h}),t[m][h]=g;else if(j(u,Ct))for(let m=e.x,h=e.y-n;m<=r.x+o&&h>=r.y-o;m++,h--)p.push({x:m,y:h}),t[m][h]=x;else if(j(u,St))for(let m=e.x,h=e.y+n;m>=r.x-o&&h<=r.y+o;m--,h++)p.push({x:m,y:h}),t[m][h]=x;else if(j(u,kt))for(let m=e.x,h=e.y+n;m<=r.x+o&&h<=r.y+o;m++,h++)p.push({x:m,y:h}),t[m][h]=g;return p}function jo(t,e){if(e.path.length<2){let d=Kt(t.canvas);return [d,d,d,d,d]}let[r,n,o]=zo(t,e,e.path),i=Vo(t,e),a=Ko(t,e,n[n.length-1],o[o.length-1]),s=qo(t,e,e.path),l=bt(0,0);return [r,i,a,s,l]}function ar(t,e){let a=new Map;if(e.path.length<3)return a;function s(d){return j(d,ct)?8:j(d,ot)?4:j(d,lt)?2:j(d,at)?1:0}function l(d){return j(d,ct)?4:j(d,ot)?8:j(d,lt)?1:j(d,at)?2:0}for(let d=1;d<e.path.length-1;d++){let u=e.path[d-1],p=e.path[d],c=e.path[d+1],f=$t(u,p),g=$t(p,c);if(j(f,g)||j(f,Ot)||j(g,Ot))continue;let x=_t(t,e,p),m=`${x.x},${x.y}`,h=s(f)|l(g);h!==0&&a.set(m,(a.get(m)??0)|h);}return a}function cr(t,e){let r=[],n=new Set;function o(c){let f=`${c.x},${c.y}`;n.has(f)||(n.add(f),r.push(c));}function i(c){let f=`${c.x},${c.y}`;if(!n.has(f)){n.add(f),r.push(c);return}for(let g=0;g<r.length;g++){let x=r[g];if(x.x===c.x&&x.y===c.y){r.splice(g,1);break}}r.push(c);}if(e.path.length<2)return r;if(!t.config.useAscii){let c=_t(t,e,e.path[0]),f=$t(e.path[0],e.path[1]),g=nn(e,f,c);if((j(f,lt)||j(f,at))&&g.y===c.y){let x=Math.min(g.x,c.x),m=Math.max(g.x,c.x);for(let h=x;h<=m;h++)o({x:h,y:c.y});}else if((j(f,ct)||j(f,ot))&&g.x===c.x){let x=Math.min(g.y,c.y),m=Math.max(g.y,c.y);for(let h=x;h<=m;h++)o({x:c.x,y:h});}o(g);}let a=1,s=-1,l=null,d=null,u=null;function p(c,f,g){let x=c,m=c;if(j(g,ct)){let h=c.y-a,b=f.y-s;h>=b&&(x={x:c.x,y:h},m={x:c.x,y:b});}else if(j(g,ot)){let h=c.y+a,b=f.y+s;h<=b&&(x={x:c.x,y:h},m={x:c.x,y:b});}else if(j(g,lt)){let h=c.x-a,b=f.x-s;h>=b&&(x={x:h,y:c.y},m={x:b,y:c.y});}else if(j(g,at)){let h=c.x+a,b=f.x+s;h<=b&&(x={x:h,y:c.y},m={x:b,y:c.y});}else if(j(g,wt)){let h=c.x,b=c.y-a,y=f.x-s,M=f.y-s;h>=y&&b>=M&&(x={x:h,y:b},m={x:y,y:M});}else if(j(g,Ct)){let h=c.x,b=c.y-a,y=f.x+s,M=f.y-s;h<=y&&b>=M&&(x={x:h,y:b},m={x:y,y:M});}else if(j(g,St)){let h=c.x,b=c.y+a,y=f.x-s,M=f.y+s;h>=y&&b<=M&&(x={x:h,y:b},m={x:y,y:M});}else if(j(g,kt)){let h=c.x,b=c.y+a,y=f.x+s,M=f.y+s;h<=y&&b<=M&&(x={x:h,y:b},m={x:y,y:M});}return [x,m]}for(let c=1;c<e.path.length;c++){let f=e.path[c-1],g=e.path[c],x=_t(t,e,f),m=_t(t,e,g);if(Ee(x,m))continue;let h=$t(f,g),[b,y]=p(x,m,h);if(l=b,d=y,u=h,j(h,ct))for(let M=x.y-a;M>=m.y-s;M--)o({x:x.x,y:M});else if(j(h,ot))for(let M=x.y+a;M<=m.y+s;M++)o({x:x.x,y:M});else if(j(h,lt))for(let M=x.x-a;M>=m.x-s;M--)o({x:M,y:x.y});else if(j(h,at))for(let M=x.x+a;M<=m.x+s;M++)o({x:M,y:x.y});else if(j(h,wt))for(let M=x.x,A=x.y-a;M>=m.x-s&&A>=m.y-s;M--,A--)o({x:M,y:A});else if(j(h,Ct))for(let M=x.x,A=x.y-a;M<=m.x+s&&A>=m.y-s;M++,A--)o({x:M,y:A});else if(j(h,St))for(let M=x.x,A=x.y+a;M>=m.x-s&&A<=m.y+s;M--,A++)o({x:M,y:A});else if(j(h,kt))for(let M=x.x,A=x.y+a;M<=m.x+s&&A<=m.y+s;M++,A++)o({x:M,y:A});if(c<e.path.length-1){let M=$t(g,e.path[c+1]);!j(h,M)&&!j(h,Ot)&&!j(M,Ot)&&o(_t(t,e,g));}}{let c=e.path[e.path.length-1],f=e.path[e.path.length-2],g=u??$t(f,c),x=d??_t(t,e,c),m=l??x,h=$t(m,x);(Ee(m,x)||j(h,Ot))&&(h=g);let b=rn(e,h,x);if((j(h,lt)||j(h,at))&&b.y===x.y){let y=Math.min(b.x,x.x)+1,M=Math.max(b.x,x.x)-1;for(let A=y;A<=M;A++)o({x:A,y:x.y});}else if((j(h,ct)||j(h,ot))&&b.x===x.x){let y=Math.min(b.y,x.y)+1,M=Math.max(b.y,x.y)-1;for(let A=y;A<=M;A++)o({x:x.x,y:A});}i(b);}return r}function zo(t,e,r){let n=Kt(t.canvas),o=r[0],i=[],a=[];for(let s=1;s<r.length;s++){let l=r[s],d=_t(t,e,o),u=_t(t,e,l);if(Ee(d,u)){o=l;continue}let p=$t(o,l),c=Uo(n,d,u,1,-1,t.config.useAscii);c.length===0&&c.push(d),i.push(c),a.push(p),o=l;}return [n,i,a]}function Vo(t,e){let r=Kt(t.canvas);if(t.config.useAscii||e.path.length<2)return r;let n=$t(e.path[0],e.path[1]),o=_t(t,e,e.path[0]),i=nn(e,n,o);return lr(r,o,i,n,t.config.useAscii),j(n,ct)?r[i.x][i.y]="\u2534":j(n,ot)?r[i.x][i.y]="\u252C":j(n,lt)?r[i.x][i.y]="\u2524":j(n,at)&&(r[i.x][i.y]="\u251C"),r}function Ko(t,e,r,n){let o=Kt(t.canvas);if(r.length===0)return o;let i=r[0],a=r[r.length-1],s=$t(i,a);(r.length===1||j(s,Ot))&&(s=n);let l;t.config.useAscii?j(s,ct)?l="^":j(s,ot)?l="v":j(s,lt)?l="<":j(s,at)?l=">":j(n,ct)?l="^":j(n,ot)?l="v":j(n,lt)?l="<":j(n,at)?l=">":l="*":j(s,ct)?l="\u25B2":j(s,ot)?l="\u25BC":j(s,lt)?l="\u25C4":j(s,at)?l="\u25BA":j(s,Ct)?l="\u25E5":j(s,wt)?l="\u25E4":j(s,kt)?l="\u25E2":j(s,St)?l="\u25E3":j(n,ct)?l="\u25B2":j(n,ot)?l="\u25BC":j(n,lt)?l="\u25C4":j(n,at)?l="\u25BA":j(n,Ct)?l="\u25E5":j(n,wt)?l="\u25E4":j(n,kt)?l="\u25E2":j(n,St)?l="\u25E3":l="\u25CF";let d=rn(e,s,a);return lr(o,a,d,s,t.config.useAscii),o[d.x][d.y]=l,o}function nn(t,e,r){let n=t.from.drawingCoord,o=t.from.drawing;if(!n||!o)return r;let[i,a]=vt(o),s=n.x,l=n.x+i,d=n.y,u=n.y+a;return j(e,lt)?{x:s,y:Wt(r.y,d,u)}:j(e,at)?{x:l,y:Wt(r.y,d,u)}:j(e,ct)?{x:Wt(r.x,s,l),y:d}:j(e,ot)?{x:Wt(r.x,s,l),y:u}:r}function rn(t,e,r){let n=t.to.drawingCoord,o=t.to.drawing;if(!n||!o)return r;let[i,a]=vt(o),s=n.x,l=n.x+i,d=n.y,u=n.y+a;return j(e,lt)?{x:l+1,y:Wt(r.y,d,u)}:j(e,at)?{x:s-1,y:Wt(r.y,d,u)}:j(e,ct)?{x:Wt(r.x,s,l),y:u+1}:j(e,ot)?{x:Wt(r.x,s,l),y:d-1}:r}function Wt(t,e,r){return t<e?e:t>r?r:t}function lr(t,e,r,n,o){let i=Math.max(e.x,r.x),a=Math.max(e.y,r.y);i>=0&&a>=0&&Rt(t,i,a);let[s,l]=vt(t),d=o?"-":"\u2500",u=o?"|":"\u2502",p=(x,m,h)=>{x<0||m<0||x>s||m>l||(t[x][m]=h);},c=(x,m)=>o?"+":x==="left"&&m==="down"?"\u2510":x==="left"&&m==="up"?"\u2518":x==="right"&&m==="down"?"\u250C":x==="right"&&m==="up"?"\u2514":"+",f=(x,m,h)=>{let b=Math.min(m,h),y=Math.max(m,h);for(let M=b;M<=y;M++)p(M,x,d);},g=(x,m,h)=>{let b=Math.min(m,h),y=Math.max(m,h);for(let M=b;M<=y;M++)p(x,M,u);};if(j(n,lt)||j(n,at)){if(e.y===r.y){f(e.y,e.x,r.x);return}let x={x:e.x,y:r.y};g(e.x,e.y,x.y),f(x.y,x.x,r.x);let m=e.y<x.y?"up":"down",h=r.x<x.x?"left":"right";p(x.x,x.y,c(h,m));return}if(j(n,ct)||j(n,ot)){if(e.x===r.x){g(e.x,e.y,r.y);return}if(e.y===r.y){let b=j(n,ot)?r.y-1:r.y+1,y={x:e.x,y:b},M={x:r.x,y:b};g(e.x,e.y,y.y),f(b,e.x,r.x),g(r.x,M.y,r.y);let A=e.y<y.y?"up":"down",w=r.x<y.x?"left":"right";p(y.x,y.y,c(w,A));let $=r.y<M.y?"up":"down",k=e.x<M.x?"left":"right";p(M.x,M.y,c(k,$));return}let x={x:r.x,y:e.y};f(e.y,e.x,x.x),g(x.x,x.y,r.y);let m=e.x<x.x?"left":"right",h=r.y<x.y?"up":"down";p(x.x,x.y,c(m,h));}}function qo(t,e,r){let n=Kt(t.canvas);for(let o=1;o<r.length-1;o++){let i=r[o],a=_t(t,e,i),s=$t(r[o-1],i),l=$t(i,r[o+1]),d;t.config.useAscii?d="+":j(s,at)&&j(l,ot)||j(s,ct)&&j(l,lt)?d="\u2510":j(s,at)&&j(l,ct)||j(s,ot)&&j(l,lt)?d="\u2518":j(s,lt)&&j(l,ot)||j(s,ct)&&j(l,at)?d="\u250C":j(s,lt)&&j(l,ct)||j(s,ot)&&j(l,at)?d="\u2514":d="+";let[u,p]=vt(n);(a.x>u||a.y>p)&&Rt(n,Math.max(a.x,u),Math.max(a.y,p)),n[a.x][a.y]=d;}return n}function Jo(t,e,r){let n=Kt(t.canvas);if(e.text.length===0)return n;let o=en(t,e,e.labelLine),i=[],a=fr(t,e);a&&i.push(a);let s=ur(t,e);return s&&i.push(s),dr(n,o,e.text,i,r,t.config.useAscii),n}function rr(t){return t==="\u25B2"||t==="\u25BC"||t==="\u25C4"||t==="\u25BA"||t==="\u25E5"||t==="\u25E4"||t==="\u25E2"||t==="\u25E3"||t==="\u25CF"}function Zo(t){return t==="^"||t==="v"||t==="<"||t===">"||t==="*"}function or(t){return t==="\u253C"||t==="\u252C"||t==="\u2534"||t==="\u251C"||t==="\u2524"||t==="\u250C"||t==="\u2510"||t==="\u2514"||t==="\u2518"||t==="\u2574"||t==="\u2575"||t==="\u2576"||t==="\u2577"}function Qo(t){return t==="+"}function ce(t,e){return e?t==="|"||t==="+":t==="\u2502"||t==="\u253C"||t==="\u252C"||t==="\u2534"||t==="\u251C"||t==="\u2524"||t==="\u250C"||t==="\u2510"||t==="\u2514"||t==="\u2518"||t==="\u2577"||t==="\u2575"}function le(t,e){return e?t==="-"||t==="+":t==="\u2500"||t==="\u253C"||t==="\u252C"||t==="\u2534"||t==="\u251C"||t==="\u2524"||t==="\u250C"||t==="\u2510"||t==="\u2514"||t==="\u2518"||t==="\u2574"||t==="\u2576"}function ti(t,e,r,n){let[o,i]=vt(t);if(e<0||r<0||e>o||r>i)return  false;let a=t[e][r],s=e>0?t[e-1][r]:" ",l=e<o?t[e+1][r]:" ",d=r>0?t[e][r-1]:" ",u=r<i?t[e][r+1]:" ",p=ce(d,n)&&ce(u,n),c=le(s,n)&&le(l,n);return !!((a===" "||le(a,n))&&p||(a===" "||ce(a,n))&&c)}function ei(t,e,r,n){let[o,i]=vt(t);if(e<0||r<0||e>o||r>i)return  false;let a=t[e][r];if(n){if(Zo(a)||Qo(a))return  true}else if(rr(a)||or(a))return  true;if(ti(t,e,r,n)||!n&&a!==" "&&!ce(a,n)&&!le(a,n))return  true;if(!n){let s=e>0?t[e-1][r]:" ",l=e<o?t[e+1][r]:" ",d=p=>p!==" "&&!rr(p)&&!or(p)&&!ce(p,n)&&!le(p,n);if((a===" "||ce(a,n)||le(a,n))&&(d(s)||d(l)))return  true}return  false}function ir(t,e,r,n){for(let o of n)if(o.y===t&&o.x>=e&&o.x<=r)return  true;return  false}function ni(t,e,r,n,o){for(let i=r;i<=n;i++)if(ei(t,i,e,o))return  true;return  false}function tn(t){let{desiredStartX:e,minStartX:r,maxStartX:n,isValid:o}=t;if(o(e))return e;let i=Math.max(0,n-r);for(let a=1;a<=i;a++){let s=e-a;if(s>=r&&o(s))return s;let l=e+a;if(l<=n&&o(l))return l}return e}function dr(t,e,r,n=[],o,i=false){if(e.length<2)return;let a=Math.min(e[0].x,e[1].x),s=Math.max(e[0].x,e[1].x),l=Math.min(e[0].y,e[1].y),d=Math.max(e[0].y,e[1].y),u=a+Math.floor((s-a)/2),p=l+Math.floor((d-l)/2),c=ht(r),f=u-Math.floor(c/2);if(o){let[x]=vt(o),m=0,h=Math.max(m,x-c+1),b=e[0].y===e[1].y,y=a,M=s-c+1,A=b&&M>=y?Math.max(m,y):m,w=b&&M>=y?Math.min(h,M):h;if(w>=A){f<A&&(f=A),f>w&&(f=w);let $=P=>{let X=P+c-1;return !(ir(p,P,X,n)||ni(o,p,P,X,i))},k=f;if(f=tn({desiredStartX:k,minStartX:A,maxStartX:w,isValid:$}),!i){if(!$(f)&&b&&M>=y){let X=Math.max(0,x-c+1);if(X>=0){let N=Math.min(Math.max(k,0),X),F=tn({desiredStartX:N,minStartX:0,maxStartX:X,isValid:$});$(F)&&(f=F);}}if(!$(f))return}}Et(t,{x:f,y:p},r);return}if(e[0].y===e[1].y){let x=a,m=s-c+1;if(m>=x){f<x&&(f=x),f>m&&(f=m);for(let h of n){if(h.y!==p)continue;let b=f+c-1;if(!(h.x>=f&&h.x<=b))continue;let M=h.x-c,A=h.x+1,w=[];M>=x&&M<=m&&w.push(M),A>=x&&A<=m&&w.push(A),w.length!==0&&(w.sort(($,k)=>Math.abs($-f)-Math.abs(k-f)),f=w[0]);}f=tn({desiredStartX:f,minStartX:x,maxStartX:m,isValid:h=>{let b=h+c-1;return !ir(p,h,b,n)}});}}Et(t,{x:f,y:p},r);}function fr(t,e){if(e.path.length<2)return null;let r=e.path[e.path.length-1],n=e.path[e.path.length-2],o=$t(n,r),i=_t(t,e,r),a=i;return j(o,ct)&&(a={x:i.x,y:i.y+1}),j(o,ot)&&(a={x:i.x,y:i.y-1}),j(o,lt)&&(a={x:i.x+1,y:i.y}),j(o,at)&&(a={x:i.x-1,y:i.y}),rn(e,o,a)}function ur(t,e){if(e.path.length<2)return null;let r=$t(e.path[0],e.path[1]),n=_t(t,e,e.path[0]);return nn(e,r,n)}function ri(t,e){let r=t.maxX-t.minX,n=t.maxY-t.minY;if(r<=0||n<=0)return bt(0,0);let o={x:0,y:0},i={x:r,y:n},a=bt(r,n);if(e.config.useAscii){for(let s=o.x+1;s<i.x;s++)a[s][o.y]="-";for(let s=o.x+1;s<i.x;s++)a[s][i.y]="-";for(let s=o.y+1;s<i.y;s++)a[o.x][s]="|";for(let s=o.y+1;s<i.y;s++)a[i.x][s]="|";a[o.x][o.y]="+",a[i.x][o.y]="+",a[o.x][i.y]="+",a[i.x][i.y]="+";}else {for(let s=o.x+1;s<i.x;s++)a[s][o.y]="\u2500";for(let s=o.x+1;s<i.x;s++)a[s][i.y]="\u2500";for(let s=o.y+1;s<i.y;s++)a[o.x][s]="\u2502";for(let s=o.y+1;s<i.y;s++)a[i.x][s]="\u2502";a[o.x][o.y]="\u250C",a[i.x][o.y]="\u2510",a[o.x][i.y]="\u2514",a[i.x][i.y]="\u2518";}return a}function oi(t,e){let r=t.maxX-t.minX,n=t.maxY-t.minY;if(r<=0||n<=0)return [bt(0,0),{x:0,y:0}];let o=bt(r,n),i=1,a=Math.floor(r/2)-Math.floor(ht(t.name)/2);return a<1&&(a=1),Et(o,{x:a,y:i},t.name),[o,{x:t.minX,y:t.minY}]}function ii(t){function e(n){return n.parent===null?0:1+e(n.parent)}let r=[...t];return r.sort((n,o)=>e(n)-e(o)),r}function si(t){let e=new Map,r=new Map;for(let n of t){if(n.text.length===0)continue;let o=`${n.from.name}\u2192${n.to.name}`,i=e.get(o);i?i.push(n):e.set(o,[n]);}for(let n of e.values()){let o=`${n[0].from.name}\u2192${n[0].to.name}`;if(!(n.length<=1))for(let i=0;i<n.length;i++)r.set(n[i],{key:o,rank:i,size:n.length});}return r}function ai(t,e,r){let n=new Map;if(e.size===0)return n;let o=new Map;for(let a of t.edges){let s=e.get(a);if(!s)continue;let l=en(t,a,a.labelLine),d=o.get(s.key);d?d.push({edge:a,stack:s,baseLine:l}):o.set(s.key,[{edge:a,stack:s,baseLine:l}]);}let[,i]=vt(r);for(let a of o.values()){if(a.length===0)continue;let s=0;for(let d of a)if(d.baseLine.length>=2){let u=Math.min(d.baseLine[0].y,d.baseLine[1].y),p=Math.max(d.baseLine[0].y,d.baseLine[1].y);s+=u+Math.floor((p-u)/2);}let l=Math.round(s/a.length);for(let d of a){let u=d.baseLine;if(u.length<2){n.set(d.edge,u);continue}let p=Math.min(u[0].x,u[1].x),c=Math.max(u[0].x,u[1].x),f=(d.stack.size-1)/2,g=Math.round((d.stack.rank-f)*2),x=l+g;x<0&&(x=0),x>i&&(x=i),n.set(d.edge,[{x:p,y:x},{x:c,y:x}]);}}return n}function hr(t){let e=t.config.useAscii,r=ii(t.subgraphs);for(let p of r){let c=ri(p,t),f={x:p.minX,y:p.minY};t.canvas=Nt(t.canvas,f,e,c);}for(let p of t.nodes)!p.drawn&&p.drawingCoord&&p.drawing&&(t.canvas=Nt(t.canvas,p.drawingCoord,e,p.drawing),p.drawn=true);let n=[],o=[],i=[],a=[];for(let p of t.edges){let[c,f,g,x,m]=jo(t,p);n.push(c),o.push(x),i.push(g),a.push(f);}let s={x:0,y:0};t.canvas=Nt(t.canvas,s,e,...n),t.canvas=Nt(t.canvas,s,e,...o),t.canvas=Nt(t.canvas,s,e,...i),t.canvas=Nt(t.canvas,s,e,...a);let l=t.config.routing==="relaxed"&&!t.config.useAscii,d=l?si(t.edges):new Map,u=l?ai(t,d,t.canvas):new Map;if(l)for(let p of t.edges){if(p.text.length===0)continue;let c=u.get(p)??en(t,p,p.labelLine),f=[],g=fr(t,p);g&&f.push(g);let x=ur(t,p);x&&f.push(x),dr(t.canvas,c,p.text,f,t.canvas,e);}else {let p=[],c=t.canvas;for(let f of t.edges)p.push(Jo(t,f,c));t.canvas=Nt(t.canvas,s,e,...p);}for(let p of t.subgraphs){if(p.nodes.length===0)continue;let[c,f]=oi(p);t.canvas=Nt(t.canvas,f,e,c);}return t.canvas}function ci(t,e,r){let n=e,o=0;if(t.columnStartX&&n.x>=0&&n.x<t.columnStartX.length)o=t.columnStartX[n.x]??0;else for(let l=0;l<n.x;l++)o+=t.columnWidth.get(l)??0;let i=0;if(t.rowStartY&&n.y>=0&&n.y<t.rowStartY.length)i=t.rowStartY[n.y]??0;else for(let l=0;l<n.y;l++)i+=t.rowHeight.get(l)??0;let a=t.columnWidth.get(n.x)??0,s=t.rowHeight.get(n.y)??0;return {x:o+Math.floor(a/2)+t.offsetX,y:i+Math.floor(s/2)+t.offsetY}}function Ut(t,e,r,n=4){if(t.grid.has(Ue(r)))return t.config.graphDirection==="LR"?Ut(t,e,{x:r.x,y:r.y+n},n):t.config.routing==="relaxed"&&!t.config.useAscii?Ut(t,e,{x:r.x,y:r.y+n},n):Ut(t,e,{x:r.x+n,y:r.y},n);for(let o=0;o<3;o++)for(let i=0;i<3;i++){let a={x:r.x+o,y:r.y+i};t.grid.set(Ue(a),e);}return e.gridCoord=r,r}function li(t,e){let r=e.gridCoord,n=t.config.boxBorderPadding,o=[1,2*n+ht(e.displayLabel),1],i=[1,1+2*n,1];for(let a=0;a<o.length;a++){let s=r.x+a,l=t.columnWidth.get(s)??0;t.columnWidth.set(s,Math.max(l,o[a]));}for(let a=0;a<i.length;a++){let s=r.y+a,l=t.rowHeight.get(s)??0;t.rowHeight.set(s,Math.max(l,i[a]));}if(r.x>0){let a=t.columnWidth.get(r.x-1)??0;t.columnWidth.set(r.x-1,Math.max(a,t.config.paddingX));}if(r.y>0){let a=t.config.paddingY;di(t,e)&&(a+=4);let s=t.rowHeight.get(r.y-1)??0;t.rowHeight.set(r.y-1,Math.max(s,a));}}function on(t,e){if(e.length===0)return;function r(o){t.columnWidth.has(o.x)||t.columnWidth.set(o.x,Math.floor(t.config.paddingX/2)),t.rowHeight.has(o.y)||t.rowHeight.set(o.y,Math.floor(t.config.paddingY/2));}let n=e[0];r(n);for(let o=1;o<e.length;o++){let i=e[o];if(n.x===i.x){let a=i.y>n.y?1:-1;for(let s=n.y;s!==i.y;s+=a)r({x:n.x,y:s}),r({x:n.x,y:s+a});}else if(n.y===i.y){let a=i.x>n.x?1:-1;for(let s=n.x;s!==i.x;s+=a)r({x:s,y:n.y}),r({x:s+a,y:n.y});}else r(i);n=i;}}function _e(t,e){return t.subgraphs.some(r=>r.nodes.includes(e))}function sn(t,e){for(let r of t.subgraphs)if(r.nodes.includes(e))return r;return null}function di(t,e){let r=sn(t,e);if(!r)return  false;let n=false;for(let o of t.edges)if(o.to===e&&sn(t,o.from)!==r){n=true;break}if(!n)return  false;for(let o of r.nodes){if(o===e||!o.gridCoord)continue;let i=false;for(let a of t.edges)if(a.to===o&&sn(t,a.from)!==r){i=true;break}if(i&&o.gridCoord.y<e.gridCoord.y)return  false}return  true}function mr(t,e){if(e.nodes.length===0)return;let r=1e6,n=1e6,o=-1e6,i=-1e6;for(let l of e.children)mr(t,l),l.nodes.length>0&&(r=Math.min(r,l.minX),n=Math.min(n,l.minY),o=Math.max(o,l.maxX),i=Math.max(i,l.maxY));for(let l of e.nodes){if(!l.drawingCoord||!l.drawing)continue;let d=l.drawingCoord.x,u=l.drawingCoord.y,p=d+l.drawing.length-1,c=u+l.drawing[0].length-1;r=Math.min(r,d),n=Math.min(n,u),o=Math.max(o,p),i=Math.max(i,c);}let a=2,s=2;e.minX=r-a,e.minY=n-a-s,e.maxX=o+a,e.maxY=i+a;}function fi(t){let r=t.subgraphs.filter(n=>n.parent===null&&n.nodes.length>0);for(let n=0;n<r.length;n++)for(let o=n+1;o<r.length;o++){let i=r[n],a=r[o];i.minX<a.maxX&&i.maxX>a.minX&&(i.maxY>=a.minY-1&&i.minY<a.minY?a.minY=i.maxY+1+1:a.maxY>=i.minY-1&&a.minY<i.minY&&(i.minY=a.maxY+1+1)),i.minY<a.maxY&&i.maxY>a.minY&&(i.maxX>=a.minX-1&&i.minX<a.minX?a.minX=i.maxX+1+1:a.maxX>=i.minX-1&&a.minX<i.minX&&(i.minX=a.maxX+1+1));}}function ui(t){for(let e of t.subgraphs)mr(t,e);fi(t);}function hi(t){if(t.subgraphs.length===0)return;let e=0,r=0;for(let i of t.subgraphs)e=Math.min(e,i.minX),r=Math.min(r,i.minY);let n=-e,o=-r;if(!(n===0&&o===0)){t.offsetX=n,t.offsetY=o;for(let i of t.subgraphs)i.minX+=n,i.minY+=o,i.maxX+=n,i.maxY+=o;for(let i of t.nodes)i.drawingCoord&&(i.drawingCoord.x+=n,i.drawingCoord.y+=o);}}function pr(t){let e=[0,1,2,3,4];for(let r of e)if(mi(t),xi(t,r))return}function mi(t){t.grid=new Map,t.columnWidth=new Map,t.rowHeight=new Map,t.canvas=bt(0,0),t.offsetX=0,t.offsetY=0,t.columnStartX=void 0,t.rowStartY=void 0,t.portUsage=t.config.routing==="relaxed"?new Uint16Array(t.nodes.length*9):void 0;for(let e of t.nodes)e.gridCoord=null,e.drawingCoord=null,e.drawing=null,e.drawn=false;for(let e of t.edges)e.path=[],e.labelLine=[],e.startDir={x:0,y:0},e.endDir={x:0,y:0},e.startPortOffsetX=void 0,e.startPortOffsetY=void 0,e.endPortOffsetX=void 0,e.endPortOffsetY=void 0;for(let e of t.subgraphs)e.minX=0,e.minY=0,e.maxX=0,e.maxY=0;}function pi(t){if(t.config.routing!=="relaxed")return 4;let r=t.nodes.length;if(r===0)return 4;let n=1,o=new Map;for(let s of t.edges){let l=s.from.index*r+s.to.index,d=(o.get(l)??0)+1;o.set(l,d),d>n&&(n=d);}let i=0,a=new Uint16Array(r);for(let s of t.edges){let l=(a[s.from.index]??0)+1;a[s.from.index]=l,l>i&&(i=l);}return n>=5||i>=8?8:n>=3||i>=4?6:4}function gi(t){let e=0;for(let s of t.columnWidth.keys())e=Math.max(e,s);let r=0;for(let s of t.rowHeight.keys())r=Math.max(r,s);let n=new Int32Array(e+2),o=0;for(let s=0;s<n.length;s++)n[s]=o,o+=t.columnWidth.get(s)??0;let i=new Int32Array(r+2),a=0;for(let s=0;s<i.length;s++)i[s]=a,a+=t.rowHeight.get(s)??0;t.columnStartX=n,t.rowStartY=i;}function xi(t,e){let r=t.config.graphDirection,n=pi(t),o=new Array(Math.max(100,(t.nodes.length+2)*n+16)).fill(0),i=[];if(t.config.routing==="strict"){let S=new Set;for(let v of t.nodes){S.has(v.name)||i.push(v),S.add(v.name);for(let V of an(t,v))S.add(V.name);}}else {let S=new Set;for(let v of t.edges)S.add(v.to.name);i=t.nodes.filter(v=>!S.has(v.name)),i.length===0&&t.nodes.length>0&&(i=[t.nodes[0]]);}let a=false,s=false;for(let S of i)_e(t,S)?an(t,S).length>0&&(s=true):a=true;let l=r==="LR"&&a&&s,d,u=[];l?(d=i.filter(S=>!_e(t,S)),u=i.filter(S=>_e(t,S))):d=i;for(let S of d){let v=r==="LR"?{x:0+e,y:o[0]+e}:{x:o[0]+e,y:0+e};Ut(t,t.nodes[S.index],v,n),o[0]=o[0]+n;}if(l&&u.length>0){let S=n;for(let v of u){let V=r==="LR"?{x:S+e,y:o[S]+e}:{x:o[S]+e,y:S+e};Ut(t,t.nodes[v.index],V,n),o[S]=o[S]+n;}}let p=true;for(;p;){p=false;for(let z of t.nodes){let L=z.gridCoord;if(!L)continue;let T=(r==="LR"?L.x-e:L.y-e)+n,G=o[T]??0;for(let W of an(t,z)){if(W.gridCoord!==null)continue;if(r!=="LR"&&t.config.routing==="relaxed"&&!t.config.useAscii&&t.edges.some(O=>O.from===W&&O.to===z)){let O=T+n,C={x:L.x,y:O+e};Ut(t,t.nodes[W.index],C,n);let E=L.x-e,R=o[O]??0;o[O]=Math.max(R,E+n),p=true;continue}let K=r==="LR"?{x:T+e,y:G+e}:{x:G+e,y:T+e};Ut(t,t.nodes[W.index],K,n),o[T]=G+n,G=o[T],p=true;}}if(p)continue;let S=t.nodes.find(z=>z.gridCoord===null);if(!S)break;let v=l&&_e(t,S)?n:0,V=r==="LR"?{x:v+e,y:o[v]+e}:{x:o[v]+e,y:v+e};Ut(t,t.nodes[S.index],V,n),o[v]=o[v]+n,p=true;}if(t.nodes.some(S=>S.gridCoord===null))return  false;let c=0,f=0;for(let S of t.nodes)S.gridCoord&&(c=Math.max(c,S.gridCoord.x+2),f=Math.max(f,S.gridCoord.y+2));let g=c+Ae+1,x=f+Ae+1,m=Yn(g,x);for(let S of t.nodes)if(S.gridCoord)for(let v=0;v<3;v++)for(let V=0;V<3;V++){let z=S.gridCoord.x+v,L=S.gridCoord.y+V;m.blocked[z+L*g]=1;}let h=Zn(m.blocked.length),b=new Uint8Array(m.blocked.length);for(let S of t.nodes)li(t,S);function y(){let S=new Map;for(let B of t.nodes)S.set(B.name,0);for(let B of t.edges)S.set(B.to.name,(S.get(B.to.name)??0)+1);let v=new Map;for(let B of t.edges){let O=v.get(B.from.name);O?O.push(B):v.set(B.from.name,[B]);}let V=[];for(let B of t.nodes)(S.get(B.name)??0)===0&&V.push(B);V.length===0&&t.nodes.length>0&&V.push(t.nodes[0]);let z=new Set,L=new Set,D=[],T=B=>{z.has(B.name)||(z.add(B.name),D.push(B));};for(let B of V)T(B);let G=0;for(;;){for(;G<D.length;){let O=D[G++],C=v.get(O.name)??[];for(let E of C)z.has(E.to.name)||(L.add(E),T(E.to));}if(z.size>=t.nodes.length)break;let B=t.nodes.find(O=>!z.has(O.name));if(!B)break;T(B);}let W=[],K=[];for(let B of t.edges)L.has(B)?W.push(B):K.push(B);return W.concat(K)}let M=t.config.routing==="relaxed"&&!t.config.useAscii?y():t.edges;function A(S){return `${S.from.name}\u2192${S.to.name}`}function w(S,v){v.path=S.path.map(V=>({x:V.x,y:V.y})),v.startDir={x:S.startDir.x,y:S.startDir.y},v.endDir={x:S.endDir.x,y:S.endDir.y},v.startPortOffsetX=void 0,v.startPortOffsetY=void 0,v.endPortOffsetX=void 0,v.endPortOffsetY=void 0;}let $=t.config.routing==="relaxed"&&!t.config.useAscii,k=new Map;if($)for(let S of M){let v=A(S),V=k.get(v);V?V.push(S):k.set(v,[S]);}let P=new Map,X=e>=4;for(let S of M){if($){let v=A(S);if((k.get(v)??[]).length>=2){let z=P.get(v);if(!z){Qe(t,S,m,c,f,h,b,X),S.path.length>=2&&P.set(v,S),on(t,S.path);continue}if(z.path.length>=2){w(z,S),on(t,S.path);continue}}}Qe(t,S,m,c,f,h,b,X),on(t,S.path);}if(t.edges.some(S=>S.path.length<2))return  false;if(!t.config.useAscii&&t.config.routing==="relaxed"){let S=function(z,L,D){if(z.x===1&&z.y===0)return "up";if(z.x===1&&z.y===2)return "down";if(z.x===0&&z.y===1)return "left";if(z.x===2&&z.y===1)return "right";if(!L||!D)return null;let T=D.x-L.x,G=D.y-L.y,W=Math.abs(T)>=Math.abs(G);return z.x===2&&z.y===0?W?"right":"up":z.x===0&&z.y===0?W?"left":"up":z.x===2&&z.y===2?W?"right":"down":z.x===0&&z.y===2?W?"left":"down":null},v=function(z,L){if(z<=0)return [];if(L<=0)return [];if(z===1)return [Math.floor(L/2)];let D=[];for(let T=0;T<z;T++)D.push(Math.floor(T*(L-1)/(z-1)));return D};let V=t.nodes.map(()=>({up:[],down:[],left:[],right:[]}));for(let z=0;z<t.edges.length;z++){let L=t.edges[z];if(L.path.length<2)continue;let D=S(L.startDir,L.from.gridCoord,L.to.gridCoord),T=S(L.endDir,L.to.gridCoord,L.from.gridCoord);if(D){let G=L.to.gridCoord,W=D==="left"||D==="right"?G?.y??0:G?.x??0;V[L.from.index][D].push({edge:L,kind:"start",otherSort:W,edgeOrder:z});}if(T){let G=L.from.gridCoord,W=T==="left"||T==="right"?G?.y??0:G?.x??0;V[L.to.index][T].push({edge:L,kind:"end",otherSort:W,edgeOrder:z});}}for(let z of t.nodes){let B=function(et){if(et<=3)return 0;let Y=Math.floor((et-3+1)/2);return Math.min(4,Y)};if(!z.gridCoord)continue;let L=V[z.index],D=t.config.boxBorderPadding,T=2*D+ht(z.displayLabel),G=1+2*D,W=Math.max(L.up.length,L.down.length),K=Math.max(L.left.length,L.right.length),O=Math.max(T,W+B(W)),C=Math.max(G,K+B(K)),E=z.gridCoord.x+1,R=z.gridCoord.y+1,U=t.columnWidth.get(E)??0;O>U&&t.columnWidth.set(E,O);let J=t.rowHeight.get(R)??0;C>J&&t.rowHeight.set(R,C);}for(let z of t.nodes){let K=function(B,O){if(B.length===0)return;B.sort((R,U)=>R.otherSort-U.otherSort||R.edgeOrder-U.edgeOrder);let C=O==="left"||O==="right"?W:G,E=v(B.length,C);for(let R=0;R<B.length;R++){let U=B[R],J=E[R];if(B.length===1&&C>=2){let et=O==="left"||O==="up"?-1:1;U.kind==="start"&&(et=-et);let Y=J+et;Y<0?J=0:Y>C-1?J=C-1:J=Y;}O==="left"||O==="right"?U.kind==="start"?U.edge.startPortOffsetY=J:U.edge.endPortOffsetY=J:U.kind==="start"?U.edge.startPortOffsetX=J:U.edge.endPortOffsetX=J;}};if(!z.gridCoord)continue;let L=V[z.index],D=z.gridCoord.x+1,T=z.gridCoord.y+1,G=t.columnWidth.get(D)??0,W=t.rowHeight.get(T)??0;K(L.left,"left"),K(L.right,"right"),K(L.up,"up"),K(L.down,"down");}}for(let S of t.edges)er(t,S);gi(t);for(let S of t.nodes)S.drawingCoord=ci(t,S.gridCoord),S.drawing=sr(S,t);return Xn(t.canvas,t.columnWidth,t.rowHeight),ui(t),hi(t),true}function bi(t,e){return t.edges.filter(r=>r.from.name===e.name)}function an(t,e){return bi(t,e).map(r=>r.to)}function Te(t){let e={actors:[],messages:[],blocks:[],notes:[]},r=new Set,n=[];for(let o=1;o<t.length;o++){let i=t[o],a=i.match(/^(participant|actor)\s+(\S+?)(?:\s+as\s+(.+))?$/);if(a){let c=a[1],f=a[2],g=a[3]?.trim()??f;r.has(f)||(r.add(f),e.actors.push({id:f,label:g,type:c}));continue}let s=i.match(/^Note\s+(left of|right of|over)\s+([^:]+):\s*(.+)$/i);if(s){let c=s[1].toLowerCase(),f=s[2].trim(),g=s[3].trim(),x=f.split(",").map(h=>h.trim());for(let h of x)ye(e,r,h);let m="over";c==="left of"?m="left":c==="right of"&&(m="right"),e.notes.push({actorIds:x,text:g,position:m,afterIndex:e.messages.length-1});continue}let l=i.match(/^(loop|alt|opt|par|critical|break|rect)\s*(.*)$/);if(l){let c=l[1],f=l[2]?.trim()??"";n.push({type:c,label:f,startIndex:e.messages.length,dividers:[]});continue}let d=i.match(/^(else|and)\s*(.*)$/);if(d&&n.length>0){let c=d[2]?.trim()??"";n[n.length-1].dividers.push({index:e.messages.length,label:c});continue}if(i==="end"&&n.length>0){let c=n.pop();e.blocks.push({type:c.type,label:c.label,startIndex:c.startIndex,endIndex:Math.max(e.messages.length-1,c.startIndex),dividers:c.dividers});continue}let u=i.match(/^(\S+?)\s*(--?>?>|--?[)x]|--?>>|--?>)\s*([+-]?)(\S+?)\s*:\s*(.+)$/);if(u){let c=u[1],f=u[2],g=u[3],x=u[4],m=u[5].trim();ye(e,r,c),ye(e,r,x);let h=f.startsWith("--")?"dashed":"solid",b=f.includes(">>")||f.includes("x")?"filled":"open",y={from:c,to:x,label:m,lineStyle:h,arrowHead:b};g==="+"&&(y.activate=true),g==="-"&&(y.deactivate=true),e.messages.push(y);continue}let p=i.match(/^(\S+?)\s*(->>|-->>|-\)|--\)|-x|--x|->|-->)\s*([+-]?)(\S+?)\s*:\s*(.+)$/);if(p){let c=p[1],f=p[2],g=p[3],x=p[4],m=p[5].trim();ye(e,r,c),ye(e,r,x);let h=f.startsWith("--")?"dashed":"solid",b=f.includes(">>")||f.includes("x")?"filled":"open",y={from:c,to:x,label:m,lineStyle:h,arrowHead:b};g==="+"&&(y.activate=true),g==="-"&&(y.deactivate=true),e.messages.push(y);continue}}return e}function ye(t,e,r){e.has(r)||(e.add(r),t.actors.push({id:r,label:r,type:"participant"}));}function gr(t,e){let r=t.split(`
`).map(L=>L.trim()).filter(L=>L.length>0&&!L.startsWith("%%")),n=Te(r);if(n.actors.length===0)return "";let o=e.useAscii,i=o?"-":"\u2500",a=o?"|":"\u2502",s=o?"+":"\u250C",l=o?"+":"\u2510",d=o?"+":"\u2514",u=o?"+":"\u2518",p=o?"+":"\u252C",c=o?"+":"\u2534",f=o?"+":"\u251C",g=o?"+":"\u2524",x=new Map;n.actors.forEach((L,D)=>x.set(L.id,D));let m=1,b=n.actors.map(L=>ht(L.label)+2*m+2).map(L=>Math.ceil(L/2)),y=3,M=new Array(Math.max(n.actors.length-1,0)).fill(0);for(let L of n.messages){let D=x.get(L.from),T=x.get(L.to);if(D===T)continue;let G=Math.min(D,T),W=Math.max(D,T),K=ht(L.label)+4,B=W-G,O=Math.ceil(K/B);for(let C=G;C<W;C++)M[C]=Math.max(M[C],O);}let A=[b[0]];for(let L=1;L<n.actors.length;L++){let D=Math.max(b[L-1]+b[L]+2,M[L-1]+2,10);A[L]=A[L-1]+D;}let w=[],$=[],k=new Map,P=new Map,X=new Map,N=[],F=y;for(let L=0;L<n.messages.length;L++){for(let G=0;G<n.blocks.length;G++)n.blocks[G].startIndex===L&&(F+=2,k.set(G,F-1));for(let G=0;G<n.blocks.length;G++)for(let W=0;W<n.blocks[G].dividers.length;W++)n.blocks[G].dividers[W].index===L&&(F+=1,X.set(`${G}:${W}`,F),F+=1);F+=1;let D=n.messages[L];D.from===D.to?($[L]=F+1,w[L]=F,F+=3):($[L]=F,w[L]=F+1,F+=2);for(let G=0;G<n.notes.length;G++)if(n.notes[G].afterIndex===L){F+=1;let W=n.notes[G],K=W.text.split("\\n"),B=Math.max(...K.map(R=>ht(R)))+4,O=K.length+2,C=x.get(W.actorIds[0])??0,E;if(W.position==="left")E=A[C]-B-1;else if(W.position==="right")E=A[C]+2;else if(W.actorIds.length>=2){let R=x.get(W.actorIds[1])??C;E=Math.floor((A[C]+A[R])/2)-Math.floor(B/2);}else E=A[C]-Math.floor(B/2);E=Math.max(0,E),N.push({x:E,y:F,width:B,height:O,lines:K}),F+=O;}for(let G=0;G<n.blocks.length;G++)n.blocks[G].endIndex===L&&(F+=1,P.set(G,F),F+=1);}F+=1;let Z=F,_=Z+y,H=A[A.length-1]??0,I=b[b.length-1]??0,S=H+I+2;for(let L=0;L<n.messages.length;L++){let D=n.messages[L];if(D.from===D.to){let T=x.get(D.from),G=A[T]+6+2+ht(D.label);S=Math.max(S,G+1);}}for(let L of N)S=Math.max(S,L.x+L.width+1);let v=bt(S,_-1);function V(L,D,T){let G=ht(T)+2*m+2,W=L-Math.floor(G/2);v[W][D]=s;for(let B=1;B<G-1;B++)v[W+B][D]=i;v[W+G-1][D]=l,v[W][D+1]=a,v[W+G-1][D+1]=a;let K=W+1+m;Et(v,{x:K,y:D+1},T),v[W][D+2]=d;for(let B=1;B<G-1;B++)v[W+B][D+2]=i;v[W+G-1][D+2]=u;}for(let L=0;L<n.actors.length;L++){let D=A[L];for(let T=y;T<=Z;T++)v[D][T]=a;}for(let L=0;L<n.actors.length;L++){let D=n.actors[L];V(A[L],0,D.label),V(A[L],Z,D.label),o||(v[A[L]][y-1]=p,v[A[L]][Z]=c);}for(let L=0;L<n.messages.length;L++){let D=n.messages[L],T=x.get(D.from),G=x.get(D.to),W=A[T],K=A[G],B=T===G,O=D.lineStyle==="dashed",C=D.arrowHead==="filled",E=O?o?".":"\u254C":i;if(B){let R=w[L],U=Math.max(4,4);v[W][R]=f;for(let Y=W+1;Y<W+U;Y++)v[Y][R]=E;v[W+U][R]=o?"+":"\u2510",v[W+U][R+1]=a;let J=W+U+2;Et(v,{x:J,y:R+1},D.label);let et=C?o?"<":"\u25C0":o?"<":"\u25C1";v[W][R+2]=et;for(let Y=W+1;Y<W+U;Y++)v[Y][R+2]=E;v[W+U][R+2]=o?"+":"\u2518";}else {let R=$[L],U=w[L],J=W<K,Y=Math.floor((W+K)/2)-Math.floor(ht(D.label)/2);if(Et(v,{x:Math.max(0,Y),y:R},D.label),J){for(let nt=W+1;nt<K;nt++)v[nt][U]=E;let q=C?o?">":"\u25B6":o?">":"\u25B7";v[K][U]=q;}else {for(let nt=K+1;nt<W;nt++)v[nt][U]=E;let q=C?o?"<":"\u25C0":o?"<":"\u25C1";v[K][U]=q;}}}for(let L=0;L<n.blocks.length;L++){let D=n.blocks[L],T=k.get(L),G=P.get(L);if(T===void 0||G===void 0)continue;let W=S,K=0;for(let E=D.startIndex;E<=D.endIndex&&!(E>=n.messages.length);E++){let R=n.messages[E],U=x.get(R.from)??0,J=x.get(R.to)??0;W=Math.min(W,A[Math.min(U,J)]),K=Math.max(K,A[Math.max(U,J)]);}let B=Math.max(0,W-4),O=Math.min(S-1,K+4);v[B][T]=s;for(let E=B+1;E<O;E++)v[E][T]=i;v[O][T]=l;let C=D.label?`${D.type} [${D.label}]`:D.type;Et(v,{x:B+1,y:T},be(C,O-(B+1))),v[B][G]=d;for(let E=B+1;E<O;E++)v[E][G]=i;v[O][G]=u;for(let E=T+1;E<G;E++)v[B][E]=a,v[O][E]=a;for(let E=0;E<D.dividers.length;E++){let R=X.get(`${L}:${E}`);if(R===void 0)continue;let U=z();v[B][R]=f;for(let et=B+1;et<O;et++)v[et][R]=U;v[O][R]=g;let J=D.dividers[E].label;if(J){let et=`[${J}]`;Et(v,{x:B+1,y:R},be(et,O-(B+1)));}}}for(let L of N){Rt(v,L.x+L.width,L.y+L.height),v[L.x][L.y]=s;for(let T=1;T<L.width-1;T++)v[L.x+T][L.y]=i;v[L.x+L.width-1][L.y]=l;for(let T=0;T<L.lines.length;T++){let G=L.y+1+T;v[L.x][G]=a,v[L.x+L.width-1][G]=a,Et(v,{x:L.x+2,y:G},L.lines[T]);}let D=L.y+L.height-1;v[L.x][D]=d;for(let T=1;T<L.width-1;T++)v[L.x+T][D]=i;v[L.x+L.width-1][D]=u;}return Xt(v);function z(){return o?"-":"\u254C"}}function Ie(t){let e={classes:[],relationships:[],namespaces:[]},r=new Map,n=null,o=null,i=0;for(let a=1;a<t.length;a++){let s=t[a];if(o&&i>0){if(s==="}"){i--,i===0&&(o=null);continue}let g=s.match(/^<<(\w+)>>$/);if(g){o.annotation=g[1];continue}let x=xr(s);x&&(x.isMethod?o.methods.push(x.member):o.attributes.push(x.member));continue}let l=s.match(/^namespace\s+(\S+)\s*\{$/);if(l){n={name:l[1],classIds:[]};continue}if(s==="}"&&n){e.namespaces.push(n),n=null;continue}let d=s.match(/^class\s+(\S+?)(?:\s*~(\w+)~)?\s*\{$/);if(d){let g=d[1],x=d[2],m=de(r,g);x&&(m.label=`${g}<${x}>`),o=m,i=1,n&&n.classIds.push(g);continue}let u=s.match(/^class\s+(\S+?)(?:\s*~(\w+)~)?\s*$/);if(u){let g=u[1],x=u[2],m=de(r,g);x&&(m.label=`${g}<${x}>`),n&&n.classIds.push(g);continue}let p=s.match(/^class\s+(\S+?)\s*\{\s*<<(\w+)>>\s*\}$/);if(p){let g=de(r,p[1]);g.annotation=p[2];continue}let c=s.match(/^(\S+?)\s*:\s*(.+)$/);if(c){let g=c[2];if(!g.match(/<\|--|--|\*--|o--|-->|\.\.>|\.\.\|>/)){let x=de(r,c[1]),m=xr(g);m&&(m.isMethod?x.methods.push(m.member):x.attributes.push(m.member));continue}}let f=yi(s);if(f){de(r,f.from),de(r,f.to),e.relationships.push(f);continue}}return e.classes=[...r.values()],e}function de(t,e){let r=t.get(e);return r||(r={id:e,label:e,attributes:[],methods:[]},t.set(e,r)),r}function xr(t){let e=t.trim().replace(/;$/,"");if(!e)return null;let r="",n=e;/^[+\-#~]/.test(n)&&(r=n[0],n=n.slice(1).trim());let o=n.match(/^(.+?)\(([^)]*)\)(?:\s*(.+))?$/);if(o){let u=o[1].trim(),p=o[3]?.trim(),c=u.endsWith("$")||n.includes("$"),f=u.endsWith("*")||n.includes("*");return {member:{visibility:r,name:u.replace(/[$*]$/,""),type:p||void 0,isStatic:c,isAbstract:f},isMethod:true}}let i=n.split(/\s+/),a,s;i.length>=2?(s=i[0],a=i.slice(1).join(" ")):a=i[0]??n;let l=a.endsWith("$"),d=a.endsWith("*");return {member:{visibility:r,name:a.replace(/[$*]$/,""),type:s||void 0,isStatic:l,isAbstract:d},isMethod:false}}function yi(t){let e=t.match(/^(\S+?)\s+(?:"([^"]*?)"\s+)?(<\|--|<\|\.\.|\*--|o--|-->|--\*|--o|--|>\s*|\.\.>|\.\.\|>|--)\s+(?:"([^"]*?)"\s+)?(\S+?)(?:\s*:\s*(.+))?$/);if(!e)return null;let r=e[1],n=e[2]||void 0,o=e[3].trim(),i=e[4]||void 0,a=e[5],s=e[6]?.trim()||void 0,l=wi(o);return l?{from:r,to:a,type:l.type,markerAt:l.markerAt,label:s,fromCardinality:n,toCardinality:i}:null}function wi(t){switch(t){case "<|--":return {type:"inheritance",markerAt:"from"};case "<|..":return {type:"realization",markerAt:"from"};case "*--":return {type:"composition",markerAt:"from"};case "--*":return {type:"composition",markerAt:"to"};case "o--":return {type:"aggregation",markerAt:"from"};case "--o":return {type:"aggregation",markerAt:"to"};case "-->":return {type:"association",markerAt:"to"};case "..>":return {type:"dependency",markerAt:"to"};case "..|>":return {type:"realization",markerAt:"to"};case "--":return {type:"association",markerAt:"to"};default:return null}}function br(t){let e=t.visibility||"",r=t.type?`: ${t.type}`:"";return `${e}${t.name}${r}`}function Mi(t){let e=[];t.annotation&&e.push(`<<${t.annotation}>>`),e.push(t.label);let r=t.attributes.map(br),n=t.methods.map(br);return r.length===0&&n.length===0?[e]:n.length===0?[e,r]:[e,r,n]}function Ci(t,e){return {type:t,markerAt:e,dashed:t==="dependency"||t==="realization"}}function fe(t,e,r){switch(t){case "inheritance":case "realization":return r==="down"?e?"^":"\u25B3":r==="up"?e?"v":"\u25BD":r==="left"?e?">":"\u25C1":e?"<":"\u25B7";case "composition":return e?"*":"\u25C6";case "aggregation":return e?"o":"\u25C7";case "association":case "dependency":return r==="down"?e?"v":"\u25BC":r==="up"?e?"^":"\u25B2":r==="left"?e?"<":"\u25C0":e?">":"\u25B6"}}function yr(t,e){let r=t.split(`
`).map(I=>I.trim()).filter(I=>I.length>0&&!I.startsWith("%%")),n=Ie(r);if(n.classes.length===0)return "";let o=e.useAscii,i=n.relationships.reduce((I,S)=>Math.max(I,S.label?ht(` ${S.label} `):0),0),a=Math.max(4,Math.ceil(i/2)+1),s=3,l=new Map,d=new Map,u=new Map;for(let I of n.classes){let S=Mi(I);l.set(I.id,S);let v=0;for(let D of S)for(let T of D)v=Math.max(v,ht(T));let V=v+4,z=0;for(let D of S)z+=Math.max(D.length,1);let L=z+(S.length-1)+2;d.set(I.id,V),u.set(I.id,L);}let p=new Map;for(let I of n.classes)p.set(I.id,I);let c=new Map,f=new Map;for(let I of n.relationships){let S=I.type==="inheritance"||I.type==="realization",v=S&&I.markerAt==="to"?I.to:I.from,V=S&&I.markerAt==="to"?I.from:I.to;c.has(V)||c.set(V,new Set),c.get(V).add(v),f.has(v)||f.set(v,new Set),f.get(v).add(V);}let g=new Map,m=n.classes.filter(I=>!c.has(I.id)||c.get(I.id).size===0).map(I=>I.id);for(let I of m)g.set(I,0);let h=n.classes.length-1,b=0;for(;b<m.length;){let I=m[b++],S=f.get(I);if(S)for(let v of S){let V=(g.get(I)??0)+1;V>h||(!g.has(v)||g.get(v)<V)&&(g.set(v,V),m.push(v));}}for(let I of n.classes)g.has(I.id)||g.set(I.id,0);let y=Math.max(...g.values(),0),M=Array.from({length:y+1},()=>[]);for(let I of n.classes)M[g.get(I.id)].push(I.id);let A=new Map,w=0;for(let I=0;I<=y;I++){let S=M[I];if(S.length===0)continue;let v=0,V=0;for(let z of S){let L=p.get(z),D=d.get(z),T=u.get(z);A.set(z,{cls:L,sections:l.get(z),x:v,y:w,width:D,height:T}),v+=D+a,V=Math.max(V,T);}w+=V+s;}let $=0;for(let I of n.relationships){if(!I.label)continue;let S=A.get(I.from),v=A.get(I.to);if(!S||!v)continue;let V=S.x+Math.floor(S.width/2),z=v.x+Math.floor(v.width/2),L=Math.floor((V+z)/2),D=` ${I.label} `,T=L-Math.floor(ht(D)/2);$=Math.min($,T);}let k=$<0?-$:0;if(k>0)for(let I of A.values())I.x+=k;let P=0,X=0;for(let I of A.values())P=Math.max(P,I.x+I.width),X=Math.max(X,I.y+I.height);P+=4,X+=2;let N=bt(P-1,X-1);for(let I of A.values()){let S=Le(I.sections,o);for(let v=0;v<S.length;v++)for(let V=0;V<S[0].length;V++){let z=S[v][V];if(z!==" "){let L=I.x+v,D=I.y+V;L<P&&D<X&&(N[L][D]=z);}}}let F=o?"-":"\u2500",Z=o?"|":"\u2502",_=o?".":"\u254C",H=o?":":"\u250A";for(let I of n.relationships){let S=A.get(I.from),v=A.get(I.to);if(!S||!v)continue;let V=Ci(I.type,I.markerAt),z=V.dashed?_:F,L=V.dashed?H:Z,D=S.x+Math.floor(S.width/2),T=S.y+S.height-1,G=v.x+Math.floor(v.width/2),W=v.y;if(T<W){let K=T+Math.floor((W-T)/2);for(let B=T+1;B<=K;B++)B<X&&(N[D][B]=L);if(D!==G){let B=Math.min(D,G),O=Math.max(D,G);for(let C=B;C<=O;C++)C<P&&K<X&&(N[C][K]=z);!o&&K<X&&(D<G?(N[D][K]="\u2514",N[G][K]="\u2510"):(N[D][K]="\u2518",N[G][K]="\u250C"));}for(let B=K+1;B<W;B++)B<X&&(N[G][B]=L);if(V.markerAt==="to"){let B=fe(V.type,o,"down"),O=W-1;if(O>=0&&O<X)for(let C=0;C<B.length;C++){let E=G-Math.floor(B.length/2)+C;E>=0&&E<P&&(N[E][O]=B[C]);}}if(V.markerAt==="from"){let B=fe(V.type,o,"down"),O=T+1;if(O<X)for(let C=0;C<B.length;C++){let E=D-Math.floor(B.length/2)+C;E>=0&&E<P&&(N[E][O]=B[C]);}}}else if(v.y+v.height-1<S.y){let K=S.y,B=v.y+v.height-1,O=B+Math.floor((K-B)/2);for(let C=K-1;C>=O;C--)C>=0&&C<X&&(N[D][C]=L);if(D!==G){let C=Math.min(D,G),E=Math.max(D,G);for(let R=C;R<=E;R++)R<P&&O>=0&&O<X&&(N[R][O]=z);!o&&O>=0&&O<X&&(D<G?(N[D][O]="\u250C",N[G][O]="\u2518"):(N[D][O]="\u2510",N[G][O]="\u2514"));}for(let C=O-1;C>B;C--)C>=0&&C<X&&(N[G][C]=L);if(V.markerAt==="from"){let C=fe(V.type,o,"up"),E=K-1;if(E>=0&&E<X)for(let R=0;R<C.length;R++){let U=D-Math.floor(C.length/2)+R;U>=0&&U<P&&(N[U][E]=C[R]);}}if(V.markerAt==="to"){let E=V.type==="inheritance"||V.type==="realization"?"down":"up",R=fe(V.type,o,E),U=B+1;if(U<X)for(let J=0;J<R.length;J++){let et=G-Math.floor(R.length/2)+J;et>=0&&et<P&&(N[et][U]=R[J]);}}}else {let K=Math.max(T,v.y+v.height-1)+2;Rt(N,P,K+1);for(let C=T+1;C<=K;C++)N[D][C]=L;let B=Math.min(D,G),O=Math.max(D,G);for(let C=B;C<=O;C++)N[C][K]=z;for(let C=K-1;C>=v.y+v.height;C--)N[G][C]=L;if(V.markerAt==="from"){let C=fe(V.type,o,"down"),E=T+1;if(E<X)for(let R=0;R<C.length;R++){let U=D-Math.floor(C.length/2)+R;U>=0&&U<P&&(N[U][E]=C[R]);}}if(V.markerAt==="to"){let C=fe(V.type,o,"up"),E=v.y+v.height;if(E<X)for(let R=0;R<C.length;R++){let U=G-Math.floor(C.length/2)+R;U>=0&&U<P&&(N[U][E]=C[R]);}}}if(I.label){let K=` ${I.label} `,B=Math.floor((D+G)/2),O;if(T<W)O=Math.floor((T+1+W-1)/2);else if(v.y+v.height-1<S.y){let E=v.y+v.height-1;O=Math.floor((E+1+S.y-1)/2);}else O=Math.max(T,v.y+v.height-1)+2;let C=B-Math.floor(ht(K)/2);O>=0&&O<X&&Et(N,{x:Math.max(0,C),y:O},K);}}return Xt(N)}function Pe(t){let e={entities:[],relationships:[]},r=new Map,n=null;for(let o=1;o<t.length;o++){let i=t[o];if(n){if(i==="}"){n=null;continue}let l=Si(i);l&&n.attributes.push(l);continue}let a=i.match(/^(\S+)\s*\{$/);if(a){let l=a[1];n=cn(r,l);continue}let s=vi(i);if(s){cn(r,s.entity1),cn(r,s.entity2),e.relationships.push(s);continue}}return e.entities=[...r.values()],e}function cn(t,e){let r=t.get(e);return r||(r={id:e,label:e,attributes:[]},t.set(e,r)),r}function Si(t){let e=t.match(/^(\S+)\s+(\S+)(?:\s+(.+))?$/);if(!e)return null;let r=e[1],n=e[2],o=e[3]?.trim()??"",i=[],a,s=o.match(/"([^"]*)"/);s&&(a=s[1]);let l=o.replace(/"[^"]*"/,"").trim();for(let d of l.split(/\s+/)){let u=d.toUpperCase();(u==="PK"||u==="FK"||u==="UK")&&i.push(u);}return {type:r,name:n,keys:i,comment:a}}function vi(t){let e=t.match(/^(\S+)\s+([|o}{]+(?:--|\.\.)[|o}{]+)\s+(\S+)\s*:\s*(.+)$/);if(!e)return null;let r=e[1],n=e[2],o=e[3],i=e[4].trim(),a=n.match(/^([|o}{]+)(--|\.\.?)([|o}{]+)$/);if(!a)return null;let s=a[1],l=a[2],d=a[3],u=wr(s),p=wr(d),c=l==="--";return !u||!p?null:{entity1:r,entity2:o,cardinality1:u,cardinality2:p,label:i,identifying:c}}function wr(t){let e=t.split("").sort().join("");return e==="||"?"one":e==="o|"?"zero-one":e==="|}"||e==="{|"?"many":e==="{o"||e==="o{"?"zero-many":null}function ki(t){return `${t.keys.length>0?t.keys.join(",")+" ":"   "}${t.type} ${t.name}`}function Ei(t){let e=[t.label],r=t.attributes.map(ki);return r.length===0?[e]:[e,r]}function De(t,e){if(e)switch(t){case "one":return "||";case "zero-one":return "o|";case "many":return "}|";case "zero-many":return "o{"}else switch(t){case "one":return "\u2551";case "zero-one":return "o\u2551";case "many":return "\u255F";case "zero-many":return "o\u255F"}}function Mr(t,e){let r=t.split(`
`).map(k=>k.trim()).filter(k=>k.length>0&&!k.startsWith("%%")),n=Pe(r);if(n.entities.length===0)return "";let o=e.useAscii,i=n.relationships.reduce((k,P)=>Math.max(k,ht(P.label)),0),a=Math.max(6,i),s=4,l=new Map,d=new Map,u=new Map;for(let k of n.entities){let P=Ei(k);l.set(k.id,P);let X=0;for(let _ of P)for(let H of _)X=Math.max(X,ht(H));let N=X+4,F=0;for(let _ of P)F+=Math.max(_.length,1);let Z=F+(P.length-1)+2;d.set(k.id,N),u.set(k.id,Z);}let p=Math.max(2,Math.ceil(Math.sqrt(n.entities.length))),c=new Map,f=0,g=0,x=0,m=0;for(let k of n.entities){let P=d.get(k.id),X=u.get(k.id);m>=p&&(g+=x+s,f=0,x=0,m=0),c.set(k.id,{entity:k,sections:l.get(k.id),x:f,y:g,width:P,height:X}),f+=P+a,x=Math.max(x,X),m++;}let h=0,b=0;for(let k of c.values())h=Math.max(h,k.x+k.width),b=Math.max(b,k.y+k.height);h+=4,b+=2;let y=bt(h-1,b-1);for(let k of c.values()){let P=Le(k.sections,o);for(let X=0;X<P.length;X++)for(let N=0;N<P[0].length;N++){let F=P[X][N];if(F!==" "){let Z=k.x+X,_=k.y+N;Z<h&&_<b&&(y[Z][_]=F);}}}let M=o?"-":"\u2500",A=o?"|":"\u2502",w=o?".":"\u254C",$=o?":":"\u250A";for(let k of n.relationships){let P=c.get(k.entity1),X=c.get(k.entity2);if(!P||!X)continue;let N=k.identifying?M:w,F=k.identifying?A:$,Z=P.x+Math.floor(P.width/2),_=P.y+Math.floor(P.height/2),H=X.x+Math.floor(X.width/2),I=X.y+Math.floor(X.height/2);if(Math.abs(_-I)<Math.max(P.height,X.height)){let[v,V]=Z<H?[P,X]:[X,P],[z,L]=Z<H?[k.cardinality1,k.cardinality2]:[k.cardinality2,k.cardinality1],D=v.x+v.width,T=V.x-1,G=v.y+Math.floor(v.height/2);for(let B=D;B<=T;B++)B<h&&(y[B][G]=N);let W=De(z,o);for(let B=0;B<W.length;B++){let O=D+B;O<h&&(y[O][G]=W[B]);}let K=De(L,o);for(let B=0;B<K.length;B++){let O=T-K.length+1+B;O>=0&&O<h&&(y[O][G]=K[B]);}if(k.label){let B=Math.floor((D+T)/2),O=Math.max(D,B-Math.floor(ht(k.label)/2)),C=G-1;if(C>=0){let E=Math.max(0,T-O+1),R=be(k.label,E);Et(y,{x:O,y:C},R);}}}else {let[v,V]=_<I?[P,X]:[X,P],[z,L]=_<I?[k.cardinality1,k.cardinality2]:[k.cardinality2,k.cardinality1],D=v.y+v.height,T=V.y-1,G=v.x+Math.floor(v.width/2);for(let C=D;C<=T;C++)C<b&&(y[G][C]=F);let W=V.x+Math.floor(V.width/2);if(G!==W){let C=Math.floor((D+T)/2),E=Math.min(G,W),R=Math.max(G,W);for(let U=E;U<=R;U++)U<h&&C<b&&(y[U][C]=N);for(let U=C+1;U<=T;U++)U<b&&(y[W][U]=F);}let K=De(z,o);if(D<b)for(let C=0;C<K.length;C++){let E=G-Math.floor(K.length/2)+C;E>=0&&E<h&&(y[E][D]=K[C]);}let B=G!==W?W:G,O=De(L,o);if(T>=0&&T<b)for(let C=0;C<O.length;C++){let E=B-Math.floor(O.length/2)+C;E>=0&&E<h&&(y[E][T]=O[C]);}if(k.label){let C=Math.floor((D+T)/2),E=G+2;C>=0&&Et(y,{x:E,y:C},k.label);}}}return Xt(y)}function kr(t){let e=t.trim().split(/[\n;]/)[0]?.trim().toLowerCase()??"";return /^sequencediagram\s*$/.test(e)?"sequence":/^classdiagram\s*$/.test(e)?"class":/^erdiagram\s*$/.test(e)?"er":"flowchart"}function Er(t){let e=t.useAscii??false,r=t.routing??(e?"strict":"relaxed");return {useAscii:e,paddingX:t.paddingX??5,paddingY:t.paddingY??5,boxBorderPadding:t.boxBorderPadding??1,graphDirection:"TD",routing:r}}function $r(t,e){let r=ge(t);r.direction==="LR"||r.direction==="RL"?e.graphDirection="LR":e.graphDirection="TD";let n=Bn(r,e);pr(n),hr(n);let o=r.direction==="BT";if(o&&Nn(n.canvas),!n.config.useAscii){let i=new Map;for(let a of n.edges)for(let[s,l]of ar(n,a))i.set(s,l);On(n.canvas,i);}return {graph:n,flippedVertically:o}}function Ai(t){let e=t.nodes.filter(n=>n.drawingCoord&&n.drawing).map(n=>{let[o,i]=vt(n.drawing);return {id:n.name,label:n.displayLabel,box:{x:n.drawingCoord.x,y:n.drawingCoord.y,width:o+1,height:i+1}}}),r=t.edges.map(n=>({from:n.from.name,to:n.to.name,label:n.text,path:cr(t,n)}));return {nodes:e,edges:r}}function Li(t,e){return {nodes:t.nodes.map(r=>({...r,box:{...r.box,y:e-(r.box.y+r.box.height-1)}})),edges:t.edges.map(r=>({...r,path:r.path.map(n=>({x:n.x,y:e-n.y}))}))}}function Re(t,e={}){let r=Er(e);switch(kr(t)){case "sequence":return gr(t,r);case "class":return yr(t,r);case "er":return Mr(t,r);default:{let{graph:o}=$r(t,r);return Xt(o.canvas)}}}function ln(t,e={}){let r=Er(e);switch(kr(t)){case "sequence":case "class":case "er":return {text:Re(t,e),meta:{nodes:[],edges:[]}};default:{let{graph:o,flippedVertically:i}=$r(t,r),a=Xt(o.canvas),s=Ai(o);if(!i)return {text:a,meta:s};let[,l]=vt(o.canvas);return {text:a,meta:Li(s,l)}}}}var Ce=Fe(Oe());function gt(t,e,r){let n=r>=600?.58:r>=500?.55:.52;return t.length*e*n}function Ne(t,e){return t.length*e*.6}var it={nodeLabel:13,edgeLabel:11,groupHeader:12},dt={nodeLabel:500,edgeLabel:400,groupHeader:600},Lr=8,ue={horizontal:16,vertical:10,diamondExtra:24},mt={outerBox:1,innerBox:.75,connector:.75},Mt="0.35em",he={width:8,height:4.8};function Gt(t,e,r,n){return {x:t-r/2,y:e-n/2}}function we(t,e,r,n,o){let i=t.x-e,a=t.y-r;if(Math.abs(i)<.5&&Math.abs(a)<.5)return t;let s=1/(Math.abs(i)/n+Math.abs(a)/o);return {x:e+s*i,y:r+s*a}}function Me(t,e,r,n){let o=t.x-e,i=t.y-r,a=Math.sqrt(o*o+i*i);if(a<.5)return t;let s=n/a;return {x:e+s*o,y:r+s*i}}function jt(t,e=true){if(t.length<2)return t;let r=[t[0]];for(let n=1;n<t.length;n++){let o=r[r.length-1],i=t[n],a=Math.abs(i.x-o.x),s=Math.abs(i.y-o.y);if(a<1||s<1){r.push(i);continue}e?r.push({x:o.x,y:i.y}):r.push({x:i.x,y:o.y}),r.push(i);}return Ti(r)}function Ti(t){if(t.length<3)return t;let e=[t[0]];for(let r=1;r<t.length-1;r++){let n=e[e.length-1],o=t[r],i=t[r+1],a=Math.abs(n.x-o.x)<1&&Math.abs(o.x-i.x)<1,s=Math.abs(n.y-o.y)<1&&Math.abs(o.y-i.y)<1;a||s||e.push(o);}return e.push(t[t.length-1]),e}function ee(t,e,r){if(t.length<2)return t;let n=t.map(o=>({...o}));if(r){let o=n.length-1;if(t.length===2){let i=n[0],a=n[o],s=Math.abs(a.x-i.x);if(Math.abs(a.y-i.y)>=s){let u=a.y>i.y?r.cy-r.hh:r.cy+r.hh;n[o]={x:a.x,y:u};}else {let u=a.x>i.x?r.cx-r.hw:r.cx+r.hw;n[o]={x:u,y:a.y};}}else {let i=n[o-1],a=n[o],s=Math.abs(a.x-i.x),l=Math.abs(a.y-i.y),d=l<1&&s>=1,u=s<1&&l>=1,p=!d&&!u&&l<s,c=!d&&!u&&s<l;if(d){let g=a.x>i.x?r.cx-r.hw:r.cx+r.hw;n[o]={x:g,y:r.cy},n[o-1]={...i,y:r.cy};}else if(u){let g=a.y>i.y?r.cy-r.hh:r.cy+r.hh;n[o]={x:r.cx,y:g},n[o-1]={...i,x:r.cx};}else if(p){let g=a.x>i.x?r.cx-r.hw:r.cx+r.hw;i.y>=r.cy-r.hh&&i.y<=r.cy+r.hh?n[o]={x:g,y:i.y}:(n[o]={x:g,y:r.cy},n[o-1]={...i,y:r.cy});}else if(c){let g=a.y>i.y?r.cy-r.hh:r.cy+r.hh;i.x>=r.cx-r.hw&&i.x<=r.cx+r.hw?n[o]={x:i.x,y:g}:(n[o]={x:r.cx,y:g},n[o-1]={...i,x:r.cx});}}}if(e&&t.length>=3){let o=n[0],i=n[1],a=Math.abs(i.x-o.x),s=Math.abs(i.y-o.y),l=s<1&&a>=1,d=a<1&&s>=1,u=!l&&!d&&s<a,p=!l&&!d&&a<s;if(l){let f=i.x>o.x?e.cx+e.hw:e.cx-e.hw;n[0]={x:f,y:e.cy},n[1]={...n[1],y:e.cy};}else if(d){let f=i.y>o.y?e.cy+e.hh:e.cy-e.hh;n[0]={x:e.cx,y:f},n[1]={...n[1],x:e.cx};}else if(u){let f=i.x>o.x?e.cx+e.hw:e.cx-e.hw;i.y>=e.cy-e.hh&&i.y<=e.cy+e.hh?n[0]={x:f,y:i.y}:(n[0]={x:f,y:e.cy},n[1]={...n[1],y:e.cy});}else if(p){let f=i.y>o.y?e.cy+e.hh:e.cy-e.hh;i.x>=e.cx-e.hw&&i.x<=e.cx+e.hw?n[0]={x:i.x,y:f}:(n[0]={x:e.cx,y:f},n[1]={...n[1],x:e.cx});}}return n}function _r(t){let e=Array.from(t.nodes.keys());if(e.length===0)return [];let r=new Map,n=new Map;for(let u of e)r.set(u,u),n.set(u,0);function o(u){return r.get(u)!==u&&r.set(u,o(r.get(u))),r.get(u)}function i(u,p){let c=o(u),f=o(p);if(c===f)return;let g=n.get(c),x=n.get(f);g<x?r.set(c,f):g>x?r.set(f,c):(r.set(f,c),n.set(c,g+1));}for(let u of t.edges)r.has(u.source)&&r.has(u.target)&&i(u.source,u.target);function a(u){let p=[...u.nodeIds];for(let c of u.children)s(c,p);if(r.has(u.id)&&p.length>0)for(let c of p)r.has(c)&&i(u.id,c);if(p.length>1){let c=p[0];for(let f=1;f<p.length;f++)r.has(c)&&r.has(p[f])&&i(c,p[f]);}for(let c of u.children)a(c);}function s(u,p){p.push(...u.nodeIds);for(let c of u.children)s(c,p);}for(let u of t.subgraphs)a(u);let l=new Map;for(let u of e){let p=o(u);l.has(p)||l.set(p,new Set),l.get(p).add(u);}let d=[];for(let[u,p]of l){let c={nodeIds:p,subgraphIds:new Set,edgeIndices:new Set};for(let f=0;f<t.edges.length;f++){let g=t.edges[f];p.has(g.source)&&p.has(g.target)&&c.edgeIndices.add(f);}d.push(c);}return Tr(t.subgraphs,d),d.sort((u,p)=>{let c=Math.min(...Array.from(u.nodeIds).map(g=>g.charCodeAt(0))),f=Math.min(...Array.from(p.nodeIds).map(g=>g.charCodeAt(0)));return c-f}),d}function Tr(t,e){for(let r of t){let n=Ir(r);if(n.size>0){let o=n.values().next().value;for(let i of e)if(i.nodeIds.has(o)){i.subgraphIds.add(r.id),Pr(r,i.subgraphIds);break}}Tr(r.children,e);}}function Ir(t){let e=new Set(t.nodeIds);for(let r of t.children)for(let n of Ir(r))e.add(n);return e}function Pr(t,e){for(let r of t.children)e.add(r.id),Pr(r,e);}function Dr(t,e,r){if(t.length===0)return {width:0,height:0,nodes:[],edges:[],groups:[]};if(t.length===1)return t[0];let n=e==="TD"||e==="TB"||e==="BT",o={width:0,height:0,nodes:[],edges:[],groups:[]},i=0;for(let a=0;a<t.length;a++){let s=t[a];if(n){for(let l of s.nodes)o.nodes.push({...l,x:l.x+i});for(let l of s.edges)o.edges.push({...l,points:l.points.map(d=>({x:d.x+i,y:d.y})),labelPosition:l.labelPosition?{x:l.labelPosition.x+i,y:l.labelPosition.y}:void 0});for(let l of s.groups)o.groups.push(Rr(l,i));o.width=i+s.width,o.height=Math.max(o.height,s.height),i+=s.width+r;}else {for(let l of s.nodes)o.nodes.push({...l,y:l.y+i});for(let l of s.edges)o.edges.push({...l,points:l.points.map(d=>({x:d.x,y:d.y+i})),labelPosition:l.labelPosition?{x:l.labelPosition.x,y:l.labelPosition.y+i}:void 0});for(let l of s.groups)o.groups.push(Or(l,i));o.width=Math.max(o.width,s.width),o.height=i+s.height,i+=s.height+r;}}return o}function Rr(t,e){return {...t,x:t.x+e,children:t.children.map(r=>Rr(r,e))}}function Or(t,e){return {...t,y:t.y+e,children:t.children.map(r=>Or(r,e))}}var Xe=new Set(["circle","doublecircle","state-start","state-end"]),Be=new Set(["diamond","circle","doublecircle","state-start","state-end"]),Ii={font:"Inter",padding:40,nodeSpacing:24,layerSpacing:40};function Pi(t,e,r){let n=new Ce.default.graphlib.Graph({directed:true,compound:true});n.setGraph({rankdir:Yr(t.direction),acyclicer:"greedy",nodesep:r.nodeSpacing,ranksep:r.layerSpacing,marginx:16,marginy:12}),n.setDefaultEdgeLabel(()=>({}));let o=new Set;o.add(t.id),hn(t,o);for(let c of t.nodeIds){let f=e.nodes.get(c);if(f){let g=fn(c,f.label,f.shape);n.setNode(c,{label:f.label,width:g.width,height:g.height});}}for(let c of t.children)un(n,c,e);let i=new Set;for(let c=0;c<e.edges.length;c++){let f=e.edges[c];if(o.has(f.source)&&o.has(f.target)){i.add(c);let g={_index:c};f.label&&(g.label=f.label,g.width=gt(f.label,it.edgeLabel,dt.edgeLabel)+8,g.height=it.edgeLabel+6,g.labelpos="c"),n.setEdge(f.source,f.target,g);}}Ce.default.layout(n);let a=t.direction==="TD"||t.direction==="TB"||t.direction==="BT",s=new Set;for(let c of t.children)pn(c,s);let l=[];for(let c of n.nodes()){if(s.has(c))continue;let f=e.nodes.get(c);if(!f)continue;let g=n.node(c);if(!g)continue;let x=Gt(g.x,g.y,g.width,g.height);l.push({id:c,label:f.label,shape:f.shape,x:x.x,y:x.y,width:g.width,height:g.height,inlineStyle:Hr(e,c)});}let d=n.edges().map(c=>{let f=n.edge(c),g=e.edges[f._index],x=f.points??[];if(x.length>0){let $=e.nodes.get(c.v)?.shape;if($==="diamond"){let P=n.node(c.v);x[0]=we(x[0],P.x,P.y,P.width/2,P.height/2);}else if($&&Xe.has($)){let P=n.node(c.v);x[0]=Me(x[0],P.x,P.y,Math.min(P.width,P.height)/2);}let k=e.nodes.get(c.w)?.shape;if(k==="diamond"){let P=n.node(c.w),X=x.length-1;x[X]=we(x[X],P.x,P.y,P.width/2,P.height/2);}else if(k&&Xe.has(k)){let P=n.node(c.w),X=x.length-1;x[X]=Me(x[X],P.x,P.y,Math.min(P.width,P.height)/2);}}let m=jt(x,a),h=e.nodes.get(c.v)?.shape,b=e.nodes.get(c.w)?.shape,y=h&&!Be.has(h)||!h?(()=>{let $=n.node(c.v);return $?{cx:$.x,cy:$.y,hw:$.width/2,hh:$.height/2}:null})():null,M=b&&!Be.has(b)||!b?(()=>{let $=n.node(c.w);return $?{cx:$.x,cy:$.y,hw:$.width/2,hh:$.height/2}:null})():null,A=ee(m,y,M),w;return g.label&&f.x!=null&&f.y!=null&&(w={x:f.x,y:f.y}),{source:g.source,target:g.target,label:g.label,style:g.style,hasArrowStart:g.hasArrowStart,hasArrowEnd:g.hasArrowEnd,points:A,labelPosition:w}}),u=t.children.map(c=>mn(n,c)),p=n.graph();return {id:t.id,label:t.label,width:p.width??200,height:p.height??100,nodes:l,edges:d,groups:u,nodeIds:o,internalEdgeIndices:i}}async function Xr(t,e={}){let r={...Ii,...e},n=_r(t);if(n.length>1){let o=[];for(let s of n){let l=Di(t,s),d=await Nr(l,r);o.push(d);}let a=(r.componentSpacing??r.nodeSpacing)-2*r.padding;return Dr(o,t.direction,a)}return Nr(t,r)}function Di(t,e){let r=new Set,n=Gr(t.subgraphs,e.subgraphIds);for(let a of n)Br(a,r);let o=new Map(Array.from(t.nodes.entries()).filter(([a])=>e.nodeIds.has(a)&&!r.has(a))),i=t.edges.filter((a,s)=>e.edgeIndices.has(s));return {direction:t.direction,nodes:o,edges:i,subgraphs:n,classDefs:t.classDefs,classAssignments:t.classAssignments,nodeStyles:t.nodeStyles}}function Br(t,e){e.add(t.id);for(let r of t.children)Br(r,e);}function Gr(t,e){return t.filter(r=>e.has(r.id)).map(r=>({...r,children:Gr(r.children,e)}))}async function Nr(t,e){let r=new Map;for(let d of t.subgraphs)d.direction&&d.direction!==t.direction&&r.set(d.id,Pi(d,t,e));let n=new Ce.default.graphlib.Graph({directed:true,compound:true});n.setGraph({rankdir:Yr(t.direction),acyclicer:"greedy",nodesep:e.nodeSpacing,ranksep:e.layerSpacing,marginx:e.padding,marginy:e.padding}),n.setDefaultEdgeLabel(()=>({}));let o=new Set;for(let d of t.subgraphs)o.add(d.id),hn(d,o);for(let[d,u]of t.nodes)if(!o.has(d)){let p=fn(d,u.label,u.shape);n.setNode(d,{label:u.label,width:p.width,height:p.height});}for(let d of t.subgraphs)if(r.has(d.id)){let u=r.get(d.id);n.setNode(d.id,{width:u.width,height:u.height});}else un(n,d,t);let i=new Map,a=new Map;for(let d of t.subgraphs)r.has(d.id)||Fr(d,i,a);for(let[d,u]of r)for(let p of u.nodeIds)i.set(p,d),a.set(p,d);let s=new Set;for(let d of r.values())for(let u of d.internalEdgeIndices)s.add(u);let l=new Set;for(let d=0;d<t.edges.length;d++){if(s.has(d))continue;let u=t.edges[d],p=a.get(u.source)??u.source,c=i.get(u.target)??u.target,f={_index:d};u.label&&(f.label=u.label,f.width=gt(u.label,it.edgeLabel,dt.edgeLabel)+8,f.height=it.edgeLabel+6,f.labelpos="c"),l.has(c)||(f.weight=2,l.add(c)),n.setEdge(p,c,f);}try{Ce.default.layout(n);}catch(d){let u=d instanceof Error?d.message:String(d);throw new Error(`Dagre layout failed: ${u}`)}return Ri(n,t,e.padding,r)}function Yr(t){switch(t){case "LR":return "LR";case "RL":return "RL";case "BT":return "BT";default:return "TB"}}function fn(t,e,r){let o=gt(e,it.nodeLabel,dt.nodeLabel)+ue.horizontal*2,i=it.nodeLabel+ue.vertical*2;if(r==="diamond"){let a=Math.max(o,i)+ue.diamondExtra;o=a,i=a;}if(r==="circle"||r==="doublecircle"){let a=Math.ceil(Math.sqrt(o*o+i*i))+8;o=r==="doublecircle"?a+12:a,i=o;}return r==="hexagon"&&(o+=ue.horizontal),(r==="trapezoid"||r==="trapezoid-alt")&&(o+=ue.horizontal),r==="asymmetric"&&(o+=12),r==="cylinder"&&(i+=14),(r==="state-start"||r==="state-end")&&(o=28,i=28),o=Math.max(o,60),i=Math.max(i,36),{width:o,height:i}}function un(t,e,r,n){t.setNode(e.id,{label:e.label}),n&&t.setParent(e.id,n);for(let o of e.nodeIds){let i=r.nodes.get(o);if(i){let a=fn(o,i.label,i.shape);t.setNode(o,{label:i.label,width:a.width,height:a.height}),t.setParent(o,e.id);}}for(let o of e.children)un(t,o,r,e.id);}function Fr(t,e,r){for(let a of t.children)Fr(a,e,r);let n=[...t.nodeIds,...t.children.map(a=>a.id)];if(n.length===0){e.set(t.id,t.id),r.set(t.id,t.id);return}let o=n[0],i=n[n.length-1];e.set(t.id,e.get(o)??o),r.set(t.id,r.get(i)??i);}function Hr(t,e){let r=t.classAssignments.get(e),n=r?t.classDefs.get(r):void 0,o=t.nodeStyles.get(e);if(!(!n&&!o))return {...n,...o}}function hn(t,e){for(let r of t.nodeIds)e.add(r);for(let r of t.children)hn(r,e);}function Ri(t,e,r,n){let o=[],i=[],a=new Set;for(let h of e.subgraphs)pn(h,a);let s=new Set;if(n)for(let h of n.values())for(let b of h.nodeIds)s.add(b);for(let h of t.nodes()){if(a.has(h))continue;let b=e.nodes.get(h);if(!b)continue;let y=t.node(h);if(!y)continue;let M=Gt(y.x,y.y,y.width,y.height);o.push({id:h,label:b.label,shape:b.shape,x:M.x,y:M.y,width:y.width,height:y.height,inlineStyle:Hr(e,h)});}for(let h of e.subgraphs)i.push(mn(t,h));let l=e.direction==="TD"||e.direction==="TB"||e.direction==="BT",d=t.edges().map(h=>{let b=t.edge(h),y=e.edges[b._index],M=b.points??[];if(M.length>0){let F=e.nodes.get(h.v)?.shape;if(F==="diamond"){let _=t.node(h.v);M[0]=we(M[0],_.x,_.y,_.width/2,_.height/2);}else if(F&&Xe.has(F)){let _=t.node(h.v);M[0]=Me(M[0],_.x,_.y,Math.min(_.width,_.height)/2);}let Z=e.nodes.get(h.w)?.shape;if(Z==="diamond"){let _=t.node(h.w),H=M.length-1;M[H]=we(M[H],_.x,_.y,_.width/2,_.height/2);}else if(Z&&Xe.has(Z)){let _=t.node(h.w),H=M.length-1;M[H]=Me(M[H],_.x,_.y,Math.min(_.width,_.height)/2);}}let A=jt(M,l),w=e.nodes.get(h.v)?.shape,$=e.nodes.get(h.w)?.shape,k=w&&!Be.has(w)||!w?(()=>{let F=t.node(h.v);return F?{cx:F.x,cy:F.y,hw:F.width/2,hh:F.height/2}:null})():null,P=$&&!Be.has($)||!$?(()=>{let F=t.node(h.w);return F?{cx:F.x,cy:F.y,hw:F.width/2,hh:F.height/2}:null})():null,X=ee(A,k,P),N;return y.label&&b.x!=null&&b.y!=null&&(N={x:b.x,y:b.y}),{source:y.source,target:y.target,label:y.label,style:y.style,hasArrowStart:y.hasArrowStart,hasArrowEnd:y.hasArrowEnd,points:X,labelPosition:N}});if(n&&n.size>0){let h=new Map;for(let b of o)h.set(b.id,{cx:b.x+b.width/2,cy:b.y+b.height/2});for(let[b,y]of n){let M=t.node(b);if(!M)continue;let A=Gt(M.x,M.y,M.width,M.height);for(let $ of y.nodes){let k={...$,x:$.x+A.x,y:$.y+A.y};o.push(k),h.set(k.id,{cx:k.x+k.width/2,cy:k.y+k.height/2});}for(let $ of y.edges)d.push({...$,points:$.points.map(k=>({x:k.x+A.x,y:k.y+A.y})),labelPosition:$.labelPosition?{x:$.labelPosition.x+A.x,y:$.labelPosition.y+A.y}:void 0});let w=jr(i,b);w&&y.groups.length>0&&(w.children=y.groups.map($=>zr($,A.x,A.y)));}for(let b of d){if(s.has(b.source)&&s.has(b.target))continue;let y=false;if(s.has(b.source)){let M=h.get(b.source);M&&b.points.length>0&&(b.points[0]={x:M.cx,y:M.cy},y=true);}if(s.has(b.target)){let M=h.get(b.target);M&&b.points.length>0&&(b.points[b.points.length-1]={x:M.cx,y:M.cy},y=true);}y&&(b.points=jt(b.points,l));}}let u=it.groupHeader+16;Oi(i,u);let p=Ur(i),c=[...o.map(h=>h.y),...p.map(h=>h.y)],f=c.length>0?Math.min(...c):r,g=t.graph().width??800,x=t.graph().height??600;if(f<r){let h=r-f;for(let b of o)b.y+=h;for(let b of d){for(let y of b.points)y.y+=h;b.labelPosition&&(b.labelPosition.y+=h);}for(let b of p)b.y+=h;x+=h;}let m=Math.max(...o.map(h=>h.y+h.height),...p.map(h=>h.y+h.height),...d.flatMap(h=>h.points.map(b=>b.y)));return m+r>x&&(x=m+r),{width:g,height:x,nodes:o,edges:d,groups:i}}function mn(t,e){let r=t.node(e.id),n=r?Gt(r.x,r.y,r.width,r.height):{x:0,y:0};return {id:e.id,label:e.label,x:n.x,y:n.y,width:r?.width??0,height:r?.height??0,children:e.children.map(o=>mn(t,o))}}function Oi(t,e){for(let r of t)Wr(r,e);}function Wr(t,e){for(let r of t.children)Wr(r,e);if(t.children.length>0){let r=t.y,n=t.y+t.height;for(let o of t.children)r=Math.min(r,o.y),n=Math.max(n,o.y+o.height);t.height=n-r,t.y=r;}if(t.label){let r=e+Lr;t.y-=r,t.height+=r;}}function Ur(t){let e=[];for(let r of t)e.push(r),e.push(...Ur(r.children));return e}function jr(t,e){for(let r of t){if(r.id===e)return r;let n=jr(r.children,e);if(n)return n}}function zr(t,e,r){return {...t,x:t.x+e,y:t.y+r,children:t.children.map(n=>zr(n,e,r))}}function pn(t,e){e.add(t.id);for(let r of t.children)pn(r,e);}function Kr(t,e,r="Inter",n=false){let o=[];o.push(Ht(t.width,t.height,e,n)),o.push(Ft(r,false)),o.push("<defs>"),o.push(Ni()),o.push("</defs>");for(let i of t.groups)o.push(qr(i));for(let i of t.edges)o.push(Xi(i));for(let i of t.edges)i.label&&o.push(Gi(i));for(let i of t.nodes)o.push(Fi(i));for(let i of t.nodes)o.push(rs(i));return o.push("</svg>"),o.join(`
`)}function Ni(){let t=he.width,e=he.height;return `  <marker id="arrowhead" markerWidth="${t}" markerHeight="${e}" refX="${t}" refY="${e/2}" orient="auto">
    <polygon points="0 0, ${t} ${e/2}, 0 ${e}" fill="var(--_arrow)" />
  </marker>
  <marker id="arrowhead-start" markerWidth="${t}" markerHeight="${e}" refX="0" refY="${e/2}" orient="auto-start-reverse">
    <polygon points="${t} 0, 0 ${e/2}, ${t} ${e}" fill="var(--_arrow)" />
  </marker>`}function qr(t,e){let r=it.groupHeader+16,n=[];n.push(`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" rx="0" ry="0" fill="var(--_group-fill)" stroke="var(--_node-stroke)" stroke-width="${mt.outerBox}" />`),n.push(`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${r}" rx="0" ry="0" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="${mt.outerBox}" />`),n.push(`<text x="${t.x+12}" y="${t.y+r/2}" dy="${Mt}" font-size="${it.groupHeader}" font-weight="${dt.groupHeader}" fill="var(--_text-sec)">${ne(t.label)}</text>`);for(let o of t.children)n.push(qr(o));return n.join(`
`)}function Xi(t){if(t.points.length<2)return "";let e=Bi(t.points),r=t.style==="dotted"?' stroke-dasharray="4 4"':"",n=t.style==="thick"?mt.connector*2:mt.connector,o="";return t.hasArrowEnd&&(o+=' marker-end="url(#arrowhead)"'),t.hasArrowStart&&(o+=' marker-start="url(#arrowhead-start)"'),`<polyline points="${e}" fill="none" stroke="var(--_line)" stroke-width="${n}"${r}${o} />`}function Bi(t){return t.map(e=>`${e.x},${e.y}`).join(" ")}function Gi(t,e){let r=t.labelPosition??Yi(t.points),n=t.label,o=gt(n,it.edgeLabel,dt.edgeLabel),i=8,a=o+i*2,s=it.edgeLabel+i*2;return `<rect x="${r.x-a/2}" y="${r.y-s/2}" width="${a}" height="${s}" rx="4" ry="4" fill="var(--bg)" stroke="var(--_inner-stroke)" stroke-width="0.5" />
<text x="${r.x}" y="${r.y}" text-anchor="middle" dy="${Mt}" font-size="${it.edgeLabel}" font-weight="${dt.edgeLabel}" fill="var(--_text-muted)">${ne(n)}</text>`}function Yi(t){if(t.length===0)return {x:0,y:0};if(t.length===1)return t[0];let e=0;for(let n=1;n<t.length;n++)e+=Vr(t[n-1],t[n]);let r=e/2;for(let n=1;n<t.length;n++){let o=Vr(t[n-1],t[n]);if(r<=o){let i=r/o;return {x:t[n-1].x+i*(t[n].x-t[n-1].x),y:t[n-1].y+i*(t[n].y-t[n-1].y)}}r-=o;}return t[t.length-1]}function Vr(t,e){return Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2)}function Fi(t){let{x:e,y:r,width:n,height:o,shape:i,inlineStyle:a}=t,s=ne(a?.fill??"var(--_node-fill)"),l=ne(a?.stroke??"var(--_node-stroke)"),d=ne(a?.["stroke-width"]??String(mt.innerBox));switch(i){case "diamond":return zi(e,r,n,o,s,l,d);case "rounded":return Wi(e,r,n,o,s,l,d);case "stadium":return Ui(e,r,n,o,s,l,d);case "circle":return ji(e,r,n,o,s,l,d);case "subroutine":return Vi(e,r,n,o,s,l,d);case "doublecircle":return Ki(e,r,n,o,s,l,d);case "hexagon":return qi(e,r,n,o,s,l,d);case "cylinder":return Ji(e,r,n,o,s,l,d);case "asymmetric":return Zi(e,r,n,o,s,l,d);case "trapezoid":return Qi(e,r,n,o,s,l,d);case "trapezoid-alt":return ts(e,r,n,o,s,l,d);case "state-start":return es(e,r,n,o);case "state-end":return ns(e,r,n,o);default:return Hi(e,r,n,o,s,l,d)}}function Hi(t,e,r,n,o,i,a){return `<rect x="${t}" y="${e}" width="${r}" height="${n}" rx="0" ry="0" fill="${o}" stroke="${i}" stroke-width="${a}" />`}function Wi(t,e,r,n,o,i,a){return `<rect x="${t}" y="${e}" width="${r}" height="${n}" rx="6" ry="6" fill="${o}" stroke="${i}" stroke-width="${a}" />`}function Ui(t,e,r,n,o,i,a){let s=n/2;return `<rect x="${t}" y="${e}" width="${r}" height="${n}" rx="${s}" ry="${s}" fill="${o}" stroke="${i}" stroke-width="${a}" />`}function ji(t,e,r,n,o,i,a){let s=t+r/2,l=e+n/2,d=Math.min(r,n)/2;return `<circle cx="${s}" cy="${l}" r="${d}" fill="${o}" stroke="${i}" stroke-width="${a}" />`}function zi(t,e,r,n,o,i,a){let s=t+r/2,l=e+n/2,d=r/2,u=n/2;return `<polygon points="${[`${s},${l-u}`,`${s+d},${l}`,`${s},${l+u}`,`${s-d},${l}`].join(" ")}" fill="${o}" stroke="${i}" stroke-width="${a}" />`}function Vi(t,e,r,n,o,i,a){return `<rect x="${t}" y="${e}" width="${r}" height="${n}" rx="0" ry="0" fill="${o}" stroke="${i}" stroke-width="${a}" />
<line x1="${t+8}" y1="${e}" x2="${t+8}" y2="${e+n}" stroke="${i}" stroke-width="${a}" />
<line x1="${t+r-8}" y1="${e}" x2="${t+r-8}" y2="${e+n}" stroke="${i}" stroke-width="${a}" />`}function Ki(t,e,r,n,o,i,a){let s=t+r/2,l=e+n/2,d=Math.min(r,n)/2,u=d-5;return `<circle cx="${s}" cy="${l}" r="${d}" fill="${o}" stroke="${i}" stroke-width="${a}" />
<circle cx="${s}" cy="${l}" r="${u}" fill="${o}" stroke="${i}" stroke-width="${a}" />`}function qi(t,e,r,n,o,i,a){let s=n/4;return `<polygon points="${[`${t+s},${e}`,`${t+r-s},${e}`,`${t+r},${e+n/2}`,`${t+r-s},${e+n}`,`${t+s},${e+n}`,`${t},${e+n/2}`].join(" ")}" fill="${o}" stroke="${i}" stroke-width="${a}" />`}function Ji(t,e,r,n,o,i,a){let l=t+r/2,d=e+7,u=n-14;return `<rect x="${t}" y="${d}" width="${r}" height="${u}" fill="${o}" stroke="none" />
<line x1="${t}" y1="${d}" x2="${t}" y2="${d+u}" stroke="${i}" stroke-width="${a}" />
<line x1="${t+r}" y1="${d}" x2="${t+r}" y2="${d+u}" stroke="${i}" stroke-width="${a}" />
<ellipse cx="${l}" cy="${e+n-7}" rx="${r/2}" ry="7" fill="${o}" stroke="${i}" stroke-width="${a}" />
<ellipse cx="${l}" cy="${d}" rx="${r/2}" ry="7" fill="${o}" stroke="${i}" stroke-width="${a}" />`}function Zi(t,e,r,n,o,i,a){return `<polygon points="${[`${t+12},${e}`,`${t+r},${e}`,`${t+r},${e+n}`,`${t+12},${e+n}`,`${t},${e+n/2}`].join(" ")}" fill="${o}" stroke="${i}" stroke-width="${a}" />`}function Qi(t,e,r,n,o,i,a){let s=r*.15;return `<polygon points="${[`${t+s},${e}`,`${t+r-s},${e}`,`${t+r},${e+n}`,`${t},${e+n}`].join(" ")}" fill="${o}" stroke="${i}" stroke-width="${a}" />`}function ts(t,e,r,n,o,i,a){let s=r*.15;return `<polygon points="${[`${t},${e}`,`${t+r},${e}`,`${t+r-s},${e+n}`,`${t+s},${e+n}`].join(" ")}" fill="${o}" stroke="${i}" stroke-width="${a}" />`}function es(t,e,r,n){let o=t+r/2,i=e+n/2,a=Math.min(r,n)/2-2;return `<circle cx="${o}" cy="${i}" r="${a}" fill="var(--_text)" stroke="none" />`}function ns(t,e,r,n){let o=t+r/2,i=e+n/2,a=Math.min(r,n)/2-2,s=a-4;return `<circle cx="${o}" cy="${i}" r="${a}" fill="none" stroke="var(--_text)" stroke-width="${mt.innerBox*2}" />
<circle cx="${o}" cy="${i}" r="${s}" fill="var(--_text)" stroke="none" />`}function rs(t,e){if((t.shape==="state-start"||t.shape==="state-end")&&!t.label)return "";let r=t.x+t.width/2,n=t.y+t.height/2,o=ne(t.inlineStyle?.color??"var(--_text)");return `<text x="${r}" y="${n}" text-anchor="middle" dy="${Mt}" font-size="${it.nodeLabel}" font-weight="${dt.nodeLabel}" fill="${o}">${ne(t.label)}</text>`}function ne(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}var ft={padding:30,actorGap:140,actorHeight:40,actorPadX:16,headerGap:20,messageRowHeight:40,selfMessageHeight:30,activationWidth:10,blockPadX:10,blockPadTop:40,blockPadBottom:8,blockHeaderExtra:28,dividerExtra:24,noteWidth:120,notePadding:8,noteGap:10};function Jr(t,e={}){if(t.actors.length===0)return {width:0,height:0,actors:[],lifelines:[],messages:[],activations:[],blocks:[],notes:[]};let r=t.actors.map(w=>{let $=gt(w.label,it.nodeLabel,dt.nodeLabel);return Math.max($+ft.actorPadX*2,80)}),n=[],o=ft.padding+r[0]/2;for(let w=0;w<t.actors.length;w++){if(w>0){let $=Math.max(ft.actorGap,(r[w-1]+r[w])/2+40);o+=$;}n.push(o);}let i=new Map;for(let w=0;w<t.actors.length;w++)i.set(t.actors[w].id,w);let a=ft.padding,s=t.actors.map((w,$)=>({id:w.id,label:w.label,type:w.type,x:n[$],y:a,width:r[$],height:ft.actorHeight})),l=a+ft.actorHeight+ft.headerGap,d=[],u=new Map;for(let w of t.blocks){let $=u.get(w.startIndex)??0;u.set(w.startIndex,Math.max($,ft.blockHeaderExtra));for(let k of w.dividers){let P=u.get(k.index)??0;u.set(k.index,Math.max(P,ft.dividerExtra));}}let p=new Map,c=[];for(let w=0;w<t.messages.length;w++){let $=t.messages[w],k=i.get($.from)??0,P=i.get($.to)??0,X=$.from===$.to,N=u.get(w)??0;N>0&&(l+=N);let F=n[k],Z=n[P];if(d.push({from:$.from,to:$.to,label:$.label,lineStyle:$.lineStyle,arrowHead:$.arrowHead,x1:F,x2:Z,y:l,isSelf:X}),$.activate&&(p.has($.to)||p.set($.to,[]),p.get($.to).push(l)),$.deactivate){let _=p.get($.from);if(_&&_.length>0){let H=_.pop(),I=i.get($.from)??0;c.push({actorId:$.from,x:n[I]-ft.activationWidth/2,topY:H,bottomY:l,width:ft.activationWidth});}}l+=X?ft.selfMessageHeight+ft.messageRowHeight:ft.messageRowHeight;}for(let[w,$]of p)for(let k of $){let P=i.get(w)??0;c.push({actorId:w,x:n[P]-ft.activationWidth/2,topY:k,bottomY:l-ft.messageRowHeight/2,width:ft.activationWidth});}let f=t.blocks.map(w=>{let $=d[w.startIndex],k=d[w.endIndex],P=($?.y??l)-ft.blockPadTop,X=(k?.y??l)+ft.blockPadBottom+12,N=new Set;for(let S=w.startIndex;S<=w.endIndex;S++){let v=t.messages[S];v&&(N.add(i.get(v.from)??0),N.add(i.get(v.to)??0));}if(N.size===0)for(let S=0;S<t.actors.length;S++)N.add(S);let F=Math.min(...N),Z=Math.max(...N),_=n[F]-r[F]/2-ft.blockPadX,H=n[Z]+r[Z]/2+ft.blockPadX,I=w.dividers.map(S=>{let v=d[S.index],V=v?.y??l,z=28;if(S.label&&v?.label){let L=`[${S.label}]`,D=gt(L,it.edgeLabel,dt.edgeLabel),T=_+8,G=T+D,W=gt(v.label,it.edgeLabel,dt.edgeLabel),K=v.isSelf?v.x1+36:(v.x1+v.x2)/2-W/2,B=K+W;G>K&&T<B&&(z=36);}return {y:V-z,label:S.label}});return {type:w.type,label:w.label,x:_,y:P,width:H-_,height:X-P,dividers:I}}),g=t.notes.map(w=>{let $=Math.max(ft.noteWidth,gt(w.text,it.edgeLabel,dt.edgeLabel)+ft.notePadding*2),k=it.edgeLabel+ft.notePadding*2,X=(d[w.afterIndex]?.y??a+ft.actorHeight)+4,N=i.get(w.actorIds[0]??"")??0,F;if(w.position==="left")F=n[N]-r[N]/2-$-ft.noteGap;else if(w.position==="right")F=n[N]+r[N]/2+ft.noteGap;else if(w.actorIds.length>1){let Z=i.get(w.actorIds[w.actorIds.length-1]??"")??N;F=(n[N]+n[Z])/2-$/2;}else F=n[N]-$/2;return {text:w.text,x:F,y:X,width:$,height:k}}),x=l+ft.padding,m=ft.padding,h=0;for(let w of s)m=Math.min(m,w.x-w.width/2),h=Math.max(h,w.x+w.width/2);for(let w of f)m=Math.min(m,w.x),h=Math.max(h,w.x+w.width);for(let w of g)m=Math.min(m,w.x),h=Math.max(h,w.x+w.width);let b=m<ft.padding?ft.padding-m:0;if(b>0){for(let w of s)w.x+=b;for(let w of d)w.x1+=b,w.x2+=b;for(let w of c)w.x+=b;for(let w of f)w.x+=b;for(let w of g)w.x+=b;for(let w=0;w<n.length;w++)n[w]+=b;}let y=t.actors.map((w,$)=>({actorId:w.id,x:n[$],topY:a+ft.actorHeight,bottomY:x-ft.padding})),M=h+b+ft.padding,A=x;return {width:Math.max(M,200),height:Math.max(A,100),actors:s,lifelines:y,messages:d,activations:c,blocks:f,notes:g}}function Zr(t,e,r="Inter",n=false){let o=[];o.push(Ht(t.width,t.height,e,n)),o.push(Ft(r,false)),o.push("<defs>"),o.push(os()),o.push("</defs>");for(let i of t.blocks)o.push(ls(i));for(let i of t.lifelines)o.push(ss(i));for(let i of t.activations)o.push(as(i));for(let i of t.messages)o.push(cs(i));for(let i of t.notes)o.push(ds(i));for(let i of t.actors)o.push(is(i));return o.push("</svg>"),o.join(`
`)}function os(){let t=he.width,e=he.height;return `  <marker id="seq-arrow" markerWidth="${t}" markerHeight="${e}" refX="${t}" refY="${e/2}" orient="auto-start-reverse">
    <polygon points="0 0, ${t} ${e/2}, 0 ${e}" fill="var(--_arrow)" />
  </marker>
  <marker id="seq-arrow-open" markerWidth="${t}" markerHeight="${e}" refX="${t}" refY="${e/2}" orient="auto-start-reverse">
    <polyline points="0 0, ${t} ${e/2}, 0 ${e}" fill="none" stroke="var(--_arrow)" stroke-width="1" />
  </marker>`}function is(t){let{x:e,y:r,width:n,height:o,label:i,type:a}=t;if(a==="actor"){let l=o/24*.9,d=e-12*l,u=r+(o-24*l)/2,p=mt.outerBox/l,c="var(--_line)";return `<g transform="translate(${d},${u}) scale(${l})">
  <path d="M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" fill="none" stroke="${c}" stroke-width="${p}" />
  <path d="M15 10C15 11.6569 13.6569 13 12 13C10.3431 13 9 11.6569 9 10C9 8.34315 10.3431 7 12 7C13.6569 7 15 8.34315 15 10Z" fill="none" stroke="${c}" stroke-width="${p}" />
  <path d="M5.62842 18.3563C7.08963 17.0398 9.39997 16 12 16C14.6 16 16.9104 17.0398 18.3716 18.3563" fill="none" stroke="${c}" stroke-width="${p}" />
</g>
<text x="${e}" y="${r+o+14}" text-anchor="middle" font-size="${it.nodeLabel}" font-weight="${dt.nodeLabel}" fill="var(--_text)">${re(i)}</text>`}return `<rect x="${e-n/2}" y="${r}" width="${n}" height="${o}" rx="4" ry="4" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="${mt.outerBox}" />
<text x="${e}" y="${r+o/2}" text-anchor="middle" dy="${Mt}" font-size="${it.nodeLabel}" font-weight="${dt.nodeLabel}" fill="var(--_text)">${re(i)}</text>`}function ss(t){return `<line x1="${t.x}" y1="${t.topY}" x2="${t.x}" y2="${t.bottomY}" stroke="var(--_line)" stroke-width="0.75" stroke-dasharray="6 4" />`}function as(t){return `<rect x="${t.x}" y="${t.topY}" width="${t.width}" height="${t.bottomY-t.topY}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="${mt.innerBox}" />`}function cs(t){let e=[],r=t.lineStyle==="dashed"?' stroke-dasharray="6 4"':"",n=t.arrowHead==="filled"?"seq-arrow":"seq-arrow-open";if(t.isSelf)e.push(`<polyline points="${t.x1},${t.y} ${t.x1+30},${t.y} ${t.x1+30},${t.y+20} ${t.x2},${t.y+20}" fill="none" stroke="var(--_line)" stroke-width="${mt.connector}"${r} marker-end="url(#${n})" />`),e.push(`<text x="${t.x1+30+6}" y="${t.y+20/2}" dy="${Mt}" font-size="${it.edgeLabel}" font-weight="${dt.edgeLabel}" fill="var(--_text-muted)">${re(t.label)}</text>`);else {e.push(`<line x1="${t.x1}" y1="${t.y}" x2="${t.x2}" y2="${t.y}" stroke="var(--_line)" stroke-width="${mt.connector}"${r} marker-end="url(#${n})" />`);let o=(t.x1+t.x2)/2;e.push(`<text x="${o}" y="${t.y-6}" text-anchor="middle" font-size="${it.edgeLabel}" font-weight="${dt.edgeLabel}" fill="var(--_text-muted)">${re(t.label)}</text>`);}return e.join(`
`)}function ls(t){let e=[];e.push(`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" rx="0" ry="0" fill="none" stroke="var(--_node-stroke)" stroke-width="${mt.outerBox}" />`);let r=`${t.type}${t.label?` [${t.label}]`:""}`,n=gt(r,it.edgeLabel,dt.groupHeader)+16,o=18;e.push(`<rect x="${t.x}" y="${t.y}" width="${n}" height="${o}" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="${mt.outerBox}" />`),e.push(`<text x="${t.x+6}" y="${t.y+o/2}" dy="${Mt}" font-size="${it.edgeLabel}" font-weight="${dt.groupHeader}" fill="var(--_text-sec)">${re(r)}</text>`);for(let i of t.dividers)e.push(`<line x1="${t.x}" y1="${i.y}" x2="${t.x+t.width}" y2="${i.y}" stroke="var(--_line)" stroke-width="0.75" stroke-dasharray="6 4" />`),i.label&&e.push(`<text x="${t.x+8}" y="${i.y+14}" font-size="${it.edgeLabel}" font-weight="${dt.edgeLabel}" fill="var(--_text-muted)">[${re(i.label)}]</text>`);return e.join(`
`)}function ds(t){return `<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="${mt.innerBox}" />
<polygon points="${t.x+t.width-6},${t.y} ${t.x+t.width},${t.y+6} ${t.x+t.width-6},${t.y+6}" fill="var(--_inner-stroke)" />
<text x="${t.x+t.width/2}" y="${t.y+t.height/2}" text-anchor="middle" dy="${Mt}" font-size="${it.edgeLabel}" font-weight="${dt.edgeLabel}" fill="var(--_text-muted)">${re(t.text)}</text>`}function re(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}var gn=Fe(Oe());var yt={padding:40,boxPadX:8,headerBaseHeight:32,annotationHeight:16,memberRowHeight:20,sectionPadY:8,emptySectionHeight:8,minWidth:120,memberFontSize:11,nodeSpacing:40,layerSpacing:60};async function to(t,e={}){if(t.classes.length===0)return {width:0,height:0,classes:[],relationships:[]};let r=new Map;for(let s of t.classes){let l=s.annotation?yt.headerBaseHeight+yt.annotationHeight:yt.headerBaseHeight,d=s.attributes.length>0?s.attributes.length*yt.memberRowHeight+yt.sectionPadY:yt.emptySectionHeight,u=s.methods.length>0?s.methods.length*yt.memberRowHeight+yt.sectionPadY:yt.emptySectionHeight,p=gt(s.label,it.nodeLabel,dt.nodeLabel),c=Qr(s.attributes),f=Qr(s.methods),g=Math.max(yt.minWidth,p+yt.boxPadX*2,c+yt.boxPadX*2,f+yt.boxPadX*2),x=l+d+u;r.set(s.id,{width:g,height:x,headerHeight:l,attrHeight:d,methodHeight:u});}let n=new gn.default.graphlib.Graph({directed:true});n.setGraph({rankdir:"TB",acyclicer:"greedy",nodesep:yt.nodeSpacing,ranksep:yt.layerSpacing,marginx:yt.padding,marginy:yt.padding}),n.setDefaultEdgeLabel(()=>({}));for(let s of t.classes){let l=r.get(s.id);n.setNode(s.id,{width:l.width,height:l.height});}for(let s=0;s<t.relationships.length;s++){let l=t.relationships[s],d={_index:s};l.label&&(d.label=l.label,d.width=gt(l.label,it.edgeLabel,dt.edgeLabel)+8,d.height=it.edgeLabel+6,d.labelpos="c"),n.setEdge(l.from,l.to,d);}try{gn.default.layout(n);}catch(s){let l=s instanceof Error?s.message:String(s);throw new Error(`Dagre layout failed (class diagram): ${l}`)}let o=new Map;for(let s of t.classes)o.set(s.id,s);let i=t.classes.map(s=>{let l=n.node(s.id),d=r.get(s.id),u=Gt(l.x,l.y,l.width,l.height);return {id:s.id,label:s.label,annotation:s.annotation,attributes:s.attributes,methods:s.methods,x:u.x,y:u.y,width:l.width??d.width,height:l.height??d.height,headerHeight:d.headerHeight,attrHeight:d.attrHeight,methodHeight:d.methodHeight}}),a=n.edges().map(s=>{let l=n.edge(s),d=t.relationships[l._index],u=l.points??[],p=jt(u,true),c=n.node(s.v),f=n.node(s.w),g=ee(p,c?{cx:c.x,cy:c.y,hw:c.width/2,hh:c.height/2}:null,f?{cx:f.x,cy:f.y,hw:f.width/2,hh:f.height/2}:null),x;return d.label&&l.x!=null&&l.y!=null&&(x={x:l.x,y:l.y}),{from:d.from,to:d.to,type:d.type,markerAt:d.markerAt,label:d.label,fromCardinality:d.fromCardinality,toCardinality:d.toCardinality,points:g,labelPosition:x}});return {width:n.graph().width??600,height:n.graph().height??400,classes:i,relationships:a}}function Qr(t){if(t.length===0)return 0;let e=0;for(let r of t){let n=fs(r),o=Ne(n,yt.memberFontSize);o>e&&(e=o);}return e}function fs(t){let e=t.visibility?`${t.visibility} `:"",r=t.type?`: ${t.type}`:"";return `${e}${t.name}${r}`}var Ge={memberSize:11,memberWeight:400,annotationSize:10,annotationWeight:500};function ro(t,e,r="Inter",n=false){let o=[];o.push(Ht(t.width,t.height,e,n)),o.push(Ft(r,true)),o.push("<defs>"),o.push(us()),o.push("</defs>");for(let i of t.relationships)o.push(ms(i));for(let i of t.classes)o.push(hs(i));for(let i of t.relationships)o.push(xs(i));return o.push("</svg>"),o.join(`
`)}function us(){return `  <marker id="cls-inherit" markerWidth="12" markerHeight="10" refX="12" refY="5" orient="auto-start-reverse">
    <polygon points="0 0, 12 5, 0 10" fill="var(--bg)" stroke="var(--_arrow)" stroke-width="1.5" />
  </marker>
  <marker id="cls-composition" markerWidth="12" markerHeight="10" refX="0" refY="5" orient="auto-start-reverse">
    <polygon points="6 0, 12 5, 6 10, 0 5" fill="var(--_arrow)" stroke="var(--_arrow)" stroke-width="1" />
  </marker>
  <marker id="cls-aggregation" markerWidth="12" markerHeight="10" refX="0" refY="5" orient="auto-start-reverse">
    <polygon points="6 0, 12 5, 6 10, 0 5" fill="var(--bg)" stroke="var(--_arrow)" stroke-width="1.5" />
  </marker>
  <marker id="cls-arrow" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto-start-reverse">
    <polyline points="0 0, 8 3, 0 6" fill="none" stroke="var(--_arrow)" stroke-width="1.5" />
  </marker>`}function hs(t){let{x:e,y:r,width:n,height:o,headerHeight:i,attrHeight:a,methodHeight:s}=t,l=[];l.push(`<rect x="${e}" y="${r}" width="${n}" height="${o}" rx="0" ry="0" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="${mt.outerBox}" />`),l.push(`<rect x="${e}" y="${r}" width="${n}" height="${i}" rx="0" ry="0" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="${mt.outerBox}" />`);let d=r+i/2;if(t.annotation){let f=r+12;l.push(`<text x="${e+n/2}" y="${f}" text-anchor="middle" dy="${Mt}" font-size="${Ge.annotationSize}" font-weight="${Ge.annotationWeight}" font-style="italic" fill="var(--_text-muted)">&lt;&lt;${zt(t.annotation)}&gt;&gt;</text>`),d=r+i/2+6;}l.push(`<text x="${e+n/2}" y="${d}" text-anchor="middle" dy="${Mt}" font-size="${it.nodeLabel}" font-weight="700" fill="var(--_text)">${zt(t.label)}</text>`);let u=r+i;l.push(`<line x1="${e}" y1="${u}" x2="${e+n}" y2="${u}" stroke="var(--_node-stroke)" stroke-width="${mt.innerBox}" />`);let p=20;for(let f=0;f<t.attributes.length;f++){let g=t.attributes[f],x=u+4+f*p+p/2;l.push(eo(g,e+yt.boxPadX,x));}let c=u+a;l.push(`<line x1="${e}" y1="${c}" x2="${e+n}" y2="${c}" stroke="var(--_node-stroke)" stroke-width="${mt.innerBox}" />`);for(let f=0;f<t.methods.length;f++){let g=t.methods[f],x=c+4+f*p+p/2;l.push(eo(g,e+yt.boxPadX,x));}return l.join(`
`)}function eo(t,e,r){let n=t.isAbstract?' font-style="italic"':"",o=t.isStatic?' text-decoration="underline"':"",i=[];return t.visibility&&i.push(`<tspan fill="var(--_text-faint)">${zt(t.visibility)} </tspan>`),i.push(`<tspan fill="var(--_text-sec)">${zt(t.name)}</tspan>`),t.type&&(i.push('<tspan fill="var(--_text-faint)">: </tspan>'),i.push(`<tspan fill="var(--_text-muted)">${zt(t.type)}</tspan>`)),`<text x="${e}" y="${r}" class="mono" dy="${Mt}" font-size="${Ge.memberSize}" font-weight="${Ge.memberWeight}"${n}${o}>${i.join("")}</text>`}function ms(t){if(t.points.length<2)return "";let e=t.points.map(i=>`${i.x},${i.y}`).join(" "),n=t.type==="dependency"||t.type==="realization"?' stroke-dasharray="6 4"':"",o=ps(t.type,t.markerAt);return `<polyline points="${e}" fill="none" stroke="var(--_line)" stroke-width="${mt.connector}"${n}${o} />`}function ps(t,e){let r=gs(t);return r?e==="from"?` marker-start="url(#${r})"`:` marker-end="url(#${r})"`:""}function gs(t){switch(t){case "inheritance":case "realization":return "cls-inherit";case "composition":return "cls-composition";case "aggregation":return "cls-aggregation";case "association":case "dependency":return "cls-arrow";default:return null}}function xs(t){if(!t.label&&!t.fromCardinality&&!t.toCardinality||t.points.length<2)return "";let e=[];if(t.label){let r=t.labelPosition??bs(t.points);e.push(`<text x="${r.x}" y="${r.y-8}" text-anchor="middle" font-size="${it.edgeLabel}" font-weight="${dt.edgeLabel}" fill="var(--_text-muted)">${zt(t.label)}</text>`);}if(t.fromCardinality){let r=t.points[0],n=t.points[1],o=no(r,n);e.push(`<text x="${r.x+o.x}" y="${r.y+o.y}" text-anchor="middle" font-size="${it.edgeLabel}" font-weight="${dt.edgeLabel}" fill="var(--_text-muted)">${zt(t.fromCardinality)}</text>`);}if(t.toCardinality){let r=t.points[t.points.length-1],n=t.points[t.points.length-2],o=no(r,n);e.push(`<text x="${r.x+o.x}" y="${r.y+o.y}" text-anchor="middle" font-size="${it.edgeLabel}" font-weight="${dt.edgeLabel}" fill="var(--_text-muted)">${zt(t.toCardinality)}</text>`);}return e.join(`
`)}function bs(t){if(t.length===0)return {x:0,y:0};let e=Math.floor(t.length/2);return t[e]}function no(t,e){let r=e.x-t.x,n=e.y-t.y;return Math.abs(r)>Math.abs(n)?{x:r>0?14:-14,y:-10}:{x:-14,y:n>0?14:-14}}function zt(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}var xn=Fe(Oe());var It={padding:40,boxPadX:12,headerHeight:32,rowHeight:22,minWidth:140,attrFontSize:11,nodeSpacing:50,layerSpacing:70};async function oo(t,e={}){if(t.entities.length===0)return {width:0,height:0,entities:[],relationships:[]};let r=new Map;for(let s of t.entities){let l=gt(s.label,it.nodeLabel,dt.nodeLabel),d=0;for(let c of s.attributes){let f=`${c.type}  ${c.name}${c.keys.length>0?"  "+c.keys.join(","):""}`,g=Ne(f,It.attrFontSize);g>d&&(d=g);}let u=Math.max(It.minWidth,l+It.boxPadX*2,d+It.boxPadX*2),p=It.headerHeight+Math.max(s.attributes.length,1)*It.rowHeight;r.set(s.id,{width:u,height:p});}let n=new xn.default.graphlib.Graph({directed:true});n.setGraph({rankdir:"LR",acyclicer:"greedy",nodesep:It.nodeSpacing,ranksep:It.layerSpacing,marginx:It.padding,marginy:It.padding}),n.setDefaultEdgeLabel(()=>({}));for(let s of t.entities){let l=r.get(s.id);n.setNode(s.id,{width:l.width,height:l.height});}for(let s=0;s<t.relationships.length;s++){let l=t.relationships[s];n.setEdge(l.entity1,l.entity2,{_index:s,label:l.label,width:gt(l.label,it.edgeLabel,dt.edgeLabel)+8,height:it.edgeLabel+6,labelpos:"c"});}try{xn.default.layout(n);}catch(s){let l=s instanceof Error?s.message:String(s);throw new Error(`Dagre layout failed (ER diagram): ${l}`)}let o=new Map;for(let s of t.entities)o.set(s.id,s);let i=t.entities.map(s=>{let l=n.node(s.id),d=Gt(l.x,l.y,l.width,l.height);return {id:s.id,label:s.label,attributes:s.attributes,x:d.x,y:d.y,width:l.width??r.get(s.id).width,height:l.height??r.get(s.id).height,headerHeight:It.headerHeight,rowHeight:It.rowHeight}}),a=n.edges().map(s=>{let l=n.edge(s),d=t.relationships[l._index],u=l.points??[],p=jt(u,false),c=n.node(s.v),f=n.node(s.w),g=ee(p,c?{cx:c.x,cy:c.y,hw:c.width/2,hh:c.height/2}:null,f?{cx:f.x,cy:f.y,hw:f.width/2,hh:f.height/2}:null);return {entity1:d.entity1,entity2:d.entity2,cardinality1:d.cardinality1,cardinality2:d.cardinality2,label:d.label,identifying:d.identifying,points:g}});return {width:n.graph().width??600,height:n.graph().height??400,entities:i,relationships:a}}var Yt={attrSize:11,attrWeight:400,keySize:9,keyWeight:600};function so(t,e,r="Inter",n=false){let o=[];o.push(Ht(t.width,t.height,e,n)),o.push(Ft(r,true)),o.push("<defs>"),o.push("</defs>");for(let i of t.relationships)o.push(Ms(i));for(let i of t.entities)o.push(ys(i));for(let i of t.relationships)o.push(Ss(i));for(let i of t.relationships)o.push(Cs(i));return o.push("</svg>"),o.join(`
`)}function ys(t){let{x:e,y:r,width:n,height:o,headerHeight:i,rowHeight:a,label:s,attributes:l}=t,d=[];d.push(`<rect x="${e}" y="${r}" width="${n}" height="${o}" rx="0" ry="0" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="${mt.outerBox}" />`),d.push(`<rect x="${e}" y="${r}" width="${n}" height="${i}" rx="0" ry="0" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="${mt.outerBox}" />`),d.push(`<text x="${e+n/2}" y="${r+i/2}" text-anchor="middle" dy="${Mt}" font-size="${it.nodeLabel}" font-weight="700" fill="var(--_text)">${Ye(s)}</text>`);let u=r+i;d.push(`<line x1="${e}" y1="${u}" x2="${e+n}" y2="${u}" stroke="var(--_node-stroke)" stroke-width="${mt.innerBox}" />`);for(let p=0;p<l.length;p++){let c=l[p],f=u+p*a+a/2;d.push(ws(c,e,f,n));}return l.length===0&&d.push(`<text x="${e+n/2}" y="${u+a/2}" text-anchor="middle" dy="${Mt}" font-size="${Yt.attrSize}" fill="var(--_text-faint)" font-style="italic">(no attributes)</text>`),d.join(`
`)}function ws(t,e,r,n){let o=[],i=0;if(t.keys.length>0){let l=t.keys.join(",");i=gt(l,Yt.keySize,Yt.keyWeight)+8,o.push(`<rect x="${e+6}" y="${r-7}" width="${i}" height="14" rx="2" ry="2" fill="var(--_key-badge)" />`),o.push(`<text x="${e+6+i/2}" y="${r}" text-anchor="middle" dy="${Mt}" font-size="${Yt.keySize}" font-weight="${Yt.keyWeight}" fill="var(--_text-sec)">${t.keys.join(",")}</text>`);}let a=e+8+(i>0?i+6:0);o.push(`<text x="${a}" y="${r}" class="mono" dy="${Mt}" font-size="${Yt.attrSize}" font-weight="${Yt.attrWeight}"><tspan fill="var(--_text-muted)">${Ye(t.type)}</tspan></text>`);let s=e+n-8;return o.push(`<text x="${s}" y="${r}" class="mono" text-anchor="end" dy="${Mt}" font-size="${Yt.attrSize}" font-weight="${Yt.attrWeight}"><tspan fill="var(--_text-sec)">${Ye(t.name)}</tspan></text>`),o.join(`
`)}function Ms(t){if(t.points.length<2)return "";let e=t.points.map(n=>`${n.x},${n.y}`).join(" "),r=t.identifying?"":' stroke-dasharray="6 4"';return `<polyline points="${e}" fill="none" stroke="var(--_line)" stroke-width="${mt.connector}"${r} />`}function Cs(t){if(!t.label||t.points.length<2)return "";let e=vs(t.points),n=gt(t.label,it.edgeLabel,dt.edgeLabel)+8,o=it.edgeLabel+6;return `<rect x="${e.x-n/2}" y="${e.y-o/2}" width="${n}" height="${o}" rx="2" ry="2" fill="var(--bg)" stroke="var(--_inner-stroke)" stroke-width="0.5" />
<text x="${e.x}" y="${e.y}" text-anchor="middle" dy="${Mt}" font-size="${it.edgeLabel}" font-weight="${dt.edgeLabel}" fill="var(--_text-muted)">${Ye(t.label)}</text>`}function Ss(t){if(t.points.length<2)return "";let e=[],r=t.points[0],n=t.points[1];e.push(io(r,n,t.cardinality1));let o=t.points[t.points.length-1],i=t.points[t.points.length-2];return e.push(io(o,i,t.cardinality2)),e.join(`
`)}function io(t,e,r){let n=[],o=mt.connector+.25,i=t.x-e.x,a=t.y-e.y,s=Math.sqrt(i*i+a*a);if(s===0)return "";let l=i/s,d=a/s,u=-d,p=l,c=t.x-l*4,f=t.y-d*4,g=t.x-l*16,x=t.y-d*16,m=r==="one"||r==="zero-one",h=r==="many"||r==="zero-many",b=r==="zero-one"||r==="zero-many";if(m){n.push(`<line x1="${c+u*6}" y1="${f+p*6}" x2="${c-u*6}" y2="${f-p*6}" stroke="var(--_line)" stroke-width="${o}" />`);let M=c-l*4,A=f-d*4;n.push(`<line x1="${M+u*6}" y1="${A+p*6}" x2="${M-u*6}" y2="${A-p*6}" stroke="var(--_line)" stroke-width="${o}" />`);}if(h){let M=c,A=f;n.push(`<line x1="${M+u*7}" y1="${A+p*7}" x2="${g}" y2="${x}" stroke="var(--_line)" stroke-width="${o}" />`),n.push(`<line x1="${M}" y1="${A}" x2="${g}" y2="${x}" stroke="var(--_line)" stroke-width="${o}" />`),n.push(`<line x1="${M-u*7}" y1="${A-p*7}" x2="${g}" y2="${x}" stroke="var(--_line)" stroke-width="${o}" />`);}if(b){let y=h?20:12,M=t.x-l*y,A=t.y-d*y;n.push(`<circle cx="${M}" cy="${A}" r="4" fill="var(--bg)" stroke="var(--_line)" stroke-width="${o}" />`);}return n.join(`
`)}function vs(t){if(t.length===0)return {x:0,y:0};if(t.length===1)return t[0];let e=0;for(let o=1;o<t.length;o++){let i=t[o].x-t[o-1].x,a=t[o].y-t[o-1].y;e+=Math.sqrt(i*i+a*a);}if(e===0)return t[0];let r=e/2,n=0;for(let o=1;o<t.length;o++){let i=t[o].x-t[o-1].x,a=t[o].y-t[o-1].y,s=Math.sqrt(i*i+a*a);if(n+s>=r){let l=s>0?(r-n)/s:0;return {x:t[o-1].x+i*l,y:t[o-1].y+a*l}}n+=s;}return t[t.length-1]}function Ye(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function ks(t){let e=t.trim().split(/[\n;]/)[0]?.trim().toLowerCase()??"";return /^sequencediagram\s*$/.test(e)?"sequence":/^classdiagram\s*$/.test(e)?"class":/^erdiagram\s*$/.test(e)?"er":"flowchart"}function Es(t){return {bg:t.bg??ie.bg,fg:t.fg??ie.fg,line:t.line,accent:t.accent,muted:t.muted,surface:t.surface,border:t.border}}async function ao(t,e={}){let r=Es(e),n=e.font??"Inter",o=e.transparent??false,i=ks(t),a=t.split(/[\n;]/).map(s=>s.trim()).filter(s=>s.length>0&&!s.startsWith("%%"));switch(i){case "sequence":{let s=Te(a),l=Jr(s,e);return Zr(l,r,n,o)}case "class":{let s=Ie(a),l=await to(s,e);return ro(l,r,n,o)}case "er":{let s=Pe(a),l=await oo(s,e);return so(l,r,n,o)}default:{let s=ge(t),l=await Xr(s,e);return Kr(l,r,n,o)}}}typeof window<"u"&&(window.__mermaid={renderMermaid:ao,renderMermaidAscii:Re,renderMermaidAsciiWithMeta:ln,THEMES:He,DEFAULTS:ie,fromShikiTheme:We});exports.DEFAULTS=ie;exports.THEMES=He;exports.fromShikiTheme=We;exports.renderMermaid=ao;exports.renderMermaidAscii=Re;exports.renderMermaidAsciiWithMeta=ln;return exports;})({});//# sourceMappingURL=beautiful-mermaid.browser.global.js.map
//# sourceMappingURL=beautiful-mermaid.browser.global.js.map