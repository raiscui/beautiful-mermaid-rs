var beautifulMermaid=(function(exports){'use strict';var bo=Object.create;var Ln=Object.defineProperty;var yo=Object.getOwnPropertyDescriptor;var wo=Object.getOwnPropertyNames;var Mo=Object.getPrototypeOf,Co=Object.prototype.hasOwnProperty;var we=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,r)=>(typeof require<"u"?require:e)[r]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var So=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var vo=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of wo(e))!Co.call(t,o)&&o!==r&&Ln(t,o,{get:()=>e[o],enumerable:!(n=yo(e,o))||n.enumerable});return t};var Ke=(t,e,r)=>(r=t!=null?bo(Mo(t)):{},vo(Ln(r,"default",{value:t,enumerable:true}),t));var Fe=So((Or,bn)=>{(function(t){if(typeof Or=="object"&&typeof bn<"u")bn.exports=t();else if(typeof define=="function"&&define.amd)define([],t);else {var e;typeof window<"u"?e=window:typeof global<"u"?e=global:typeof self<"u"?e=self:e=this,e.dagre=t();}})(function(){return (function(){function n(o,i,c){function s(h,g){if(!i[h]){if(!o[h]){var a=typeof we=="function"&&we;if(!g&&a)return a(h,true);if(l)return l(h,true);var f=new Error("Cannot find module '"+h+"'");throw f.code="MODULE_NOT_FOUND",f}var p=i[h]={exports:{}};o[h][0].call(p.exports,function(x){var m=o[h][1][x];return s(m||x)},p,p.exports,n,o,i,c);}return i[h].exports}for(var l=typeof we=="function"&&we,d=0;d<c.length;d++)s(c[d]);return s}return n})()({1:[function(n,o,i){o.exports={graphlib:n("@dagrejs/graphlib"),layout:n("./lib/layout"),debug:n("./lib/debug"),util:{time:n("./lib/util").time,notime:n("./lib/util").notime},version:n("./lib/version")};},{"./lib/debug":6,"./lib/layout":8,"./lib/util":27,"./lib/version":28,"@dagrejs/graphlib":29}],2:[function(n,o,i){let c=n("./greedy-fas"),s=n("./util").uniqueId;o.exports={run:l,undo:h};function l(g){(g.graph().acyclicer==="greedy"?c(g,f(g)):d(g)).forEach(p=>{let x=g.edge(p);g.removeEdge(p),x.forwardName=p.name,x.reversed=true,g.setEdge(p.w,p.v,x,s("rev"));});function f(p){return x=>p.edge(x).weight}}function d(g){let a=[],f={},p={};function x(m){Object.hasOwn(p,m)||(p[m]=true,f[m]=true,g.outEdges(m).forEach(u=>{Object.hasOwn(f,u.w)?a.push(u):x(u.w);}),delete f[m]);}return g.nodes().forEach(x),a}function h(g){g.edges().forEach(a=>{let f=g.edge(a);if(f.reversed){g.removeEdge(a);let p=f.forwardName;delete f.reversed,delete f.forwardName,g.setEdge(a.w,a.v,f,p);}});}},{"./greedy-fas":7,"./util":27}],3:[function(n,o,i){let c=n("./util");o.exports=s;function s(d){function h(g){let a=d.children(g),f=d.node(g);if(a.length&&a.forEach(h),Object.hasOwn(f,"minRank")){f.borderLeft=[],f.borderRight=[];for(let p=f.minRank,x=f.maxRank+1;p<x;++p)l(d,"borderLeft","_bl",g,f,p),l(d,"borderRight","_br",g,f,p);}}d.children().forEach(h);}function l(d,h,g,a,f,p){let x={width:0,height:0,rank:p,borderType:h},m=f[h][p-1],u=c.addDummyNode(d,"border",x,g);f[h][p]=u,d.setParent(u,a),m&&d.setEdge(m,u,{weight:1});}},{"./util":27}],4:[function(n,o,i){o.exports={adjust:c,undo:s};function c(p){let x=p.graph().rankdir.toLowerCase();(x==="lr"||x==="rl")&&l(p);}function s(p){let x=p.graph().rankdir.toLowerCase();(x==="bt"||x==="rl")&&h(p),(x==="lr"||x==="rl")&&(a(p),l(p));}function l(p){p.nodes().forEach(x=>d(p.node(x))),p.edges().forEach(x=>d(p.edge(x)));}function d(p){let x=p.width;p.width=p.height,p.height=x;}function h(p){p.nodes().forEach(x=>g(p.node(x))),p.edges().forEach(x=>{let m=p.edge(x);m.points.forEach(g),Object.hasOwn(m,"y")&&g(m);});}function g(p){p.y=-p.y;}function a(p){p.nodes().forEach(x=>f(p.node(x))),p.edges().forEach(x=>{let m=p.edge(x);m.points.forEach(f),Object.hasOwn(m,"x")&&f(m);});}function f(p){let x=p.x;p.x=p.y,p.y=x;}},{}],5:[function(n,o,i){class c{constructor(){let h={};h._next=h._prev=h,this._sentinel=h;}dequeue(){let h=this._sentinel,g=h._prev;if(g!==h)return s(g),g}enqueue(h){let g=this._sentinel;h._prev&&h._next&&s(h),h._next=g._next,g._next._prev=h,g._next=h,h._prev=g;}toString(){let h=[],g=this._sentinel,a=g._prev;for(;a!==g;)h.push(JSON.stringify(a,l)),a=a._prev;return "["+h.join(", ")+"]"}}function s(d){d._prev._next=d._next,d._next._prev=d._prev,delete d._next,delete d._prev;}function l(d,h){if(d!=="_next"&&d!=="_prev")return h}o.exports=c;},{}],6:[function(n,o,i){let c=n("./util"),s=n("@dagrejs/graphlib").Graph;o.exports={debugOrdering:l};function l(d){let h=c.buildLayerMatrix(d),g=new s({compound:true,multigraph:true}).setGraph({});return d.nodes().forEach(a=>{g.setNode(a,{label:a}),g.setParent(a,"layer"+d.node(a).rank);}),d.edges().forEach(a=>g.setEdge(a.v,a.w,{},a.name)),h.forEach((a,f)=>{let p="layer"+f;g.setNode(p,{rank:"same"}),a.reduce((x,m)=>(g.setEdge(x,m,{style:"invis"}),m));}),g}},{"./util":27,"@dagrejs/graphlib":29}],7:[function(n,o,i){let c=n("@dagrejs/graphlib").Graph,s=n("./data/list");o.exports=d;let l=()=>1;function d(x,m){if(x.nodeCount()<=1)return [];let u=a(x,m||l);return h(u.graph,u.buckets,u.zeroIdx).flatMap(y=>x.outEdges(y.v,y.w))}function h(x,m,u){let b=[],y=m[m.length-1],M=m[0],A;for(;x.nodeCount();){for(;A=M.dequeue();)g(x,m,u,A);for(;A=y.dequeue();)g(x,m,u,A);if(x.nodeCount()){for(let w=m.length-2;w>0;--w)if(A=m[w].dequeue(),A){b=b.concat(g(x,m,u,A,true));break}}}return b}function g(x,m,u,b,y){let M=y?[]:void 0;return x.inEdges(b.v).forEach(A=>{let w=x.edge(A),$=x.node(A.v);y&&M.push({v:A.v,w:A.w}),$.out-=w,f(m,u,$);}),x.outEdges(b.v).forEach(A=>{let w=x.edge(A),$=A.w,k=x.node($);k.in-=w,f(m,u,k);}),x.removeNode(b.v),M}function a(x,m){let u=new c,b=0,y=0;x.nodes().forEach(w=>{u.setNode(w,{v:w,in:0,out:0});}),x.edges().forEach(w=>{let $=u.edge(w.v,w.w)||0,k=m(w),I=$+k;u.setEdge(w.v,w.w,I),y=Math.max(y,u.node(w.v).out+=k),b=Math.max(b,u.node(w.w).in+=k);});let M=p(y+b+3).map(()=>new s),A=b+1;return u.nodes().forEach(w=>{f(M,A,u.node(w));}),{graph:u,buckets:M,zeroIdx:A}}function f(x,m,u){u.out?u.in?x[u.out-u.in+m].enqueue(u):x[x.length-1].enqueue(u):x[0].enqueue(u);}function p(x){let m=[];for(let u=0;u<x;u++)m.push(u);return m}},{"./data/list":5,"@dagrejs/graphlib":29}],8:[function(n,o,i){let c=n("./acyclic"),s=n("./normalize"),l=n("./rank"),d=n("./util").normalizeRanks,h=n("./parent-dummy-chains"),g=n("./util").removeEmptyRanks,a=n("./nesting-graph"),f=n("./add-border-segments"),p=n("./coordinate-system"),x=n("./order"),m=n("./position"),u=n("./util"),b=n("@dagrejs/graphlib").Graph;o.exports=y;function y(C,E){let R=E&&E.debugTiming?u.time:u.notime;R("layout",()=>{let W=R("  buildLayoutGraph",()=>_(C));R("  runLayout",()=>M(W,R,E)),R("  updateInputGraph",()=>A(C,W));});}function M(C,E,R){E("    makeSpaceForEdgeLabels",()=>F(C)),E("    removeSelfEdges",()=>G(C)),E("    acyclic",()=>c.run(C)),E("    nestingGraph.run",()=>a.run(C)),E("    rank",()=>l(u.asNonCompoundGraph(C))),E("    injectEdgeLabelProxies",()=>D(C)),E("    removeEmptyRanks",()=>g(C)),E("    nestingGraph.cleanup",()=>a.cleanup(C)),E("    normalizeRanks",()=>d(C)),E("    assignRankMinMax",()=>S(C)),E("    removeEdgeLabelProxies",()=>v(C)),E("    normalize.run",()=>s.run(C)),E("    parentDummyChains",()=>h(C)),E("    addBorderSegments",()=>f(C)),E("    order",()=>x(C,R)),E("    insertSelfEdges",()=>H(C)),E("    adjustCoordinateSystem",()=>p.adjust(C)),E("    position",()=>m(C)),E("    positionSelfEdges",()=>V(C)),E("    removeBorderNodes",()=>T(C)),E("    normalize.undo",()=>s.undo(C)),E("    fixupEdgeLabelCoords",()=>L(C)),E("    undoCoordinateSystem",()=>p.undo(C)),E("    translateGraph",()=>z(C)),E("    assignNodeIntersects",()=>j(C)),E("    reversePoints",()=>P(C)),E("    acyclic.undo",()=>c.undo(C));}function A(C,E){C.nodes().forEach(R=>{let W=C.node(R),J=E.node(R);W&&(W.x=J.x,W.y=J.y,W.rank=J.rank,E.children(R).length&&(W.width=J.width,W.height=J.height));}),C.edges().forEach(R=>{let W=C.edge(R),J=E.edge(R);W.points=J.points,Object.hasOwn(J,"x")&&(W.x=J.x,W.y=J.y);}),C.graph().width=E.graph().width,C.graph().height=E.graph().height;}let w=["nodesep","edgesep","ranksep","marginx","marginy"],$={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},k=["acyclicer","ranker","rankdir","align"],I=["width","height","rank"],X={width:0,height:0},N=["minlen","weight","width","height","labeloffset"],Y={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},q=["labelpos"];function _(C){let E=new b({multigraph:true,compound:true}),R=O(C.graph());return E.setGraph(Object.assign({},$,B(R,w),u.pick(R,k))),C.nodes().forEach(W=>{let J=O(C.node(W)),et=B(J,I);Object.keys(X).forEach(rt=>{et[rt]===void 0&&(et[rt]=X[rt]);}),E.setNode(W,et),E.setParent(W,C.parent(W));}),C.edges().forEach(W=>{let J=O(C.edge(W));E.setEdge(W,Object.assign({},Y,B(J,N),u.pick(J,q)));}),E}function F(C){let E=C.graph();E.ranksep/=2,C.edges().forEach(R=>{let W=C.edge(R);W.minlen*=2,W.labelpos.toLowerCase()!=="c"&&(E.rankdir==="TB"||E.rankdir==="BT"?W.width+=W.labeloffset:W.height+=W.labeloffset);});}function D(C){C.edges().forEach(E=>{let R=C.edge(E);if(R.width&&R.height){let W=C.node(E.v),et={rank:(C.node(E.w).rank-W.rank)/2+W.rank,e:E};u.addDummyNode(C,"edge-proxy",et,"_ep");}});}function S(C){let E=0;C.nodes().forEach(R=>{let W=C.node(R);W.borderTop&&(W.minRank=C.node(W.borderTop).rank,W.maxRank=C.node(W.borderBottom).rank,E=Math.max(E,W.maxRank));}),C.graph().maxRank=E;}function v(C){C.nodes().forEach(E=>{let R=C.node(E);R.dummy==="edge-proxy"&&(C.edge(R.e).labelRank=R.rank,C.removeNode(E));});}function z(C){let E=Number.POSITIVE_INFINITY,R=0,W=Number.POSITIVE_INFINITY,J=0,et=C.graph(),rt=et.marginx||0,dt=et.marginy||0;function K(Z){let Q=Z.x,nt=Z.y,it=Z.width,ct=Z.height;E=Math.min(E,Q-it/2),R=Math.max(R,Q+it/2),W=Math.min(W,nt-ct/2),J=Math.max(J,nt+ct/2);}C.nodes().forEach(Z=>K(C.node(Z))),C.edges().forEach(Z=>{let Q=C.edge(Z);Object.hasOwn(Q,"x")&&K(Q);}),E-=rt,W-=dt,C.nodes().forEach(Z=>{let Q=C.node(Z);Q.x-=E,Q.y-=W;}),C.edges().forEach(Z=>{let Q=C.edge(Z);Q.points.forEach(nt=>{nt.x-=E,nt.y-=W;}),Object.hasOwn(Q,"x")&&(Q.x-=E),Object.hasOwn(Q,"y")&&(Q.y-=W);}),et.width=R-E+rt,et.height=J-W+dt;}function j(C){C.edges().forEach(E=>{let R=C.edge(E),W=C.node(E.v),J=C.node(E.w),et,rt;R.points?(et=R.points[0],rt=R.points[R.points.length-1]):(R.points=[],et=J,rt=W),R.points.unshift(u.intersectRect(W,et)),R.points.push(u.intersectRect(J,rt));});}function L(C){C.edges().forEach(E=>{let R=C.edge(E);if(Object.hasOwn(R,"x"))switch((R.labelpos==="l"||R.labelpos==="r")&&(R.width-=R.labeloffset),R.labelpos){case "l":R.x-=R.width/2+R.labeloffset;break;case "r":R.x+=R.width/2+R.labeloffset;break}});}function P(C){C.edges().forEach(E=>{let R=C.edge(E);R.reversed&&R.points.reverse();});}function T(C){C.nodes().forEach(E=>{if(C.children(E).length){let R=C.node(E),W=C.node(R.borderTop),J=C.node(R.borderBottom),et=C.node(R.borderLeft[R.borderLeft.length-1]),rt=C.node(R.borderRight[R.borderRight.length-1]);R.width=Math.abs(rt.x-et.x),R.height=Math.abs(J.y-W.y),R.x=et.x+R.width/2,R.y=W.y+R.height/2;}}),C.nodes().forEach(E=>{C.node(E).dummy==="border"&&C.removeNode(E);});}function G(C){C.edges().forEach(E=>{if(E.v===E.w){var R=C.node(E.v);R.selfEdges||(R.selfEdges=[]),R.selfEdges.push({e:E,label:C.edge(E)}),C.removeEdge(E);}});}function H(C){var E=u.buildLayerMatrix(C);E.forEach(R=>{var W=0;R.forEach((J,et)=>{var rt=C.node(J);rt.order=et+W,(rt.selfEdges||[]).forEach(dt=>{u.addDummyNode(C,"selfedge",{width:dt.label.width,height:dt.label.height,rank:rt.rank,order:et+ ++W,e:dt.e,label:dt.label},"_se");}),delete rt.selfEdges;});});}function V(C){C.nodes().forEach(E=>{var R=C.node(E);if(R.dummy==="selfedge"){var W=C.node(R.e.v),J=W.x+W.width/2,et=W.y,rt=R.x-J,dt=W.height/2;C.setEdge(R.e,R.label),C.removeNode(E),R.label.points=[{x:J+2*rt/3,y:et-dt},{x:J+5*rt/6,y:et-dt},{x:J+rt,y:et},{x:J+5*rt/6,y:et+dt},{x:J+2*rt/3,y:et+dt}],R.label.x=R.x,R.label.y=R.y;}});}function B(C,E){return u.mapValues(u.pick(C,E),Number)}function O(C){var E={};return C&&Object.entries(C).forEach(([R,W])=>{typeof R=="string"&&(R=R.toLowerCase()),E[R]=W;}),E}},{"./acyclic":2,"./add-border-segments":3,"./coordinate-system":4,"./nesting-graph":9,"./normalize":10,"./order":15,"./parent-dummy-chains":20,"./position":22,"./rank":24,"./util":27,"@dagrejs/graphlib":29}],9:[function(n,o,i){let c=n("./util");o.exports={run:s,cleanup:g};function s(a){let f=c.addDummyNode(a,"root",{},"_root"),p=d(a),x=Object.values(p),m=c.applyWithChunking(Math.max,x)-1,u=2*m+1;a.graph().nestingRoot=f,a.edges().forEach(y=>a.edge(y).minlen*=u);let b=h(a)+1;a.children().forEach(y=>l(a,f,u,b,m,p,y)),a.graph().nodeRankFactor=u;}function l(a,f,p,x,m,u,b){let y=a.children(b);if(!y.length){b!==f&&a.setEdge(f,b,{weight:0,minlen:p});return}let M=c.addBorderNode(a,"_bt"),A=c.addBorderNode(a,"_bb"),w=a.node(b);a.setParent(M,b),w.borderTop=M,a.setParent(A,b),w.borderBottom=A,y.forEach($=>{l(a,f,p,x,m,u,$);let k=a.node($),I=k.borderTop?k.borderTop:$,X=k.borderBottom?k.borderBottom:$,N=k.borderTop?x:2*x,Y=I!==X?1:m-u[b]+1;a.setEdge(M,I,{weight:N,minlen:Y,nestingEdge:true}),a.setEdge(X,A,{weight:N,minlen:Y,nestingEdge:true});}),a.parent(b)||a.setEdge(f,M,{weight:0,minlen:m+u[b]});}function d(a){var f={};function p(x,m){var u=a.children(x);u&&u.length&&u.forEach(b=>p(b,m+1)),f[x]=m;}return a.children().forEach(x=>p(x,1)),f}function h(a){return a.edges().reduce((f,p)=>f+a.edge(p).weight,0)}function g(a){var f=a.graph();a.removeNode(f.nestingRoot),delete f.nestingRoot,a.edges().forEach(p=>{var x=a.edge(p);x.nestingEdge&&a.removeEdge(p);});}},{"./util":27}],10:[function(n,o,i){let c=n("./util");o.exports={run:s,undo:d};function s(h){h.graph().dummyChains=[],h.edges().forEach(g=>l(h,g));}function l(h,g){let a=g.v,f=h.node(a).rank,p=g.w,x=h.node(p).rank,m=g.name,u=h.edge(g),b=u.labelRank;if(x===f+1)return;h.removeEdge(g);let y,M,A;for(A=0,++f;f<x;++A,++f)u.points=[],M={width:0,height:0,edgeLabel:u,edgeObj:g,rank:f},y=c.addDummyNode(h,"edge",M,"_d"),f===b&&(M.width=u.width,M.height=u.height,M.dummy="edge-label",M.labelpos=u.labelpos),h.setEdge(a,y,{weight:u.weight},m),A===0&&h.graph().dummyChains.push(y),a=y;h.setEdge(a,p,{weight:u.weight},m);}function d(h){h.graph().dummyChains.forEach(g=>{let a=h.node(g),f=a.edgeLabel,p;for(h.setEdge(a.edgeObj,f);a.dummy;)p=h.successors(g)[0],h.removeNode(g),f.points.push({x:a.x,y:a.y}),a.dummy==="edge-label"&&(f.x=a.x,f.y=a.y,f.width=a.width,f.height=a.height),g=p,a=h.node(g);});}},{"./util":27}],11:[function(n,o,i){o.exports=c;function c(s,l,d){let h={},g;d.forEach(a=>{let f=s.parent(a),p,x;for(;f;){if(p=s.parent(f),p?(x=h[p],h[p]=f):(x=g,g=f),x&&x!==f){l.setEdge(x,f);return}f=p;}});}},{}],12:[function(n,o,i){o.exports=c;function c(s,l=[]){return l.map(d=>{let h=s.inEdges(d);if(h.length){let g=h.reduce((a,f)=>{let p=s.edge(f),x=s.node(f.v);return {sum:a.sum+p.weight*x.order,weight:a.weight+p.weight}},{sum:0,weight:0});return {v:d,barycenter:g.sum/g.weight,weight:g.weight}}else return {v:d}})}},{}],13:[function(n,o,i){let c=n("@dagrejs/graphlib").Graph,s=n("../util");o.exports=l;function l(h,g,a,f){f||(f=h.nodes());let p=d(h),x=new c({compound:true}).setGraph({root:p}).setDefaultNodeLabel(m=>h.node(m));return f.forEach(m=>{let u=h.node(m),b=h.parent(m);(u.rank===g||u.minRank<=g&&g<=u.maxRank)&&(x.setNode(m),x.setParent(m,b||p),h[a](m).forEach(y=>{let M=y.v===m?y.w:y.v,A=x.edge(M,m),w=A!==void 0?A.weight:0;x.setEdge(M,m,{weight:h.edge(y).weight+w});}),Object.hasOwn(u,"minRank")&&x.setNode(m,{borderLeft:u.borderLeft[g],borderRight:u.borderRight[g]}));}),x}function d(h){for(var g;h.hasNode(g=s.uniqueId("_root")););return g}},{"../util":27,"@dagrejs/graphlib":29}],14:[function(n,o,i){let c=n("../util").zipObject;o.exports=s;function s(d,h){let g=0;for(let a=1;a<h.length;++a)g+=l(d,h[a-1],h[a]);return g}function l(d,h,g){let a=c(g,g.map((b,y)=>y)),f=h.flatMap(b=>d.outEdges(b).map(y=>({pos:a[y.w],weight:d.edge(y).weight})).sort((y,M)=>y.pos-M.pos)),p=1;for(;p<g.length;)p<<=1;let x=2*p-1;p-=1;let m=new Array(x).fill(0),u=0;return f.forEach(b=>{let y=b.pos+p;m[y]+=b.weight;let M=0;for(;y>0;)y%2&&(M+=m[y+1]),y=y-1>>1,m[y]+=b.weight;u+=b.weight*M;}),u}},{"../util":27}],15:[function(n,o,i){let c=n("./init-order"),s=n("./cross-count"),l=n("./sort-subgraph"),d=n("./build-layer-graph"),h=n("./add-subgraph-constraints"),g=n("@dagrejs/graphlib").Graph,a=n("../util");o.exports=f;function f(u,b){if(b&&typeof b.customOrder=="function"){b.customOrder(u,f);return}let y=a.maxRank(u),M=p(u,a.range(1,y+1),"inEdges"),A=p(u,a.range(y-1,-1,-1),"outEdges"),w=c(u);if(m(u,w),b&&b.disableOptimalOrderHeuristic)return;let $=Number.POSITIVE_INFINITY,k;for(let I=0,X=0;X<4;++I,++X){x(I%2?M:A,I%4>=2),w=a.buildLayerMatrix(u);let N=s(u,w);N<$&&(X=0,k=Object.assign({},w),$=N);}m(u,k);}function p(u,b,y){let M=new Map,A=(w,$)=>{M.has(w)||M.set(w,[]),M.get(w).push($);};for(let w of u.nodes()){let $=u.node(w);if(typeof $.rank=="number"&&A($.rank,w),typeof $.minRank=="number"&&typeof $.maxRank=="number")for(let k=$.minRank;k<=$.maxRank;k++)k!==$.rank&&A(k,w);}return b.map(function(w){return d(u,w,y,M.get(w)||[])})}function x(u,b){let y=new g;u.forEach(function(M){let A=M.graph().root,w=l(M,A,y,b);w.vs.forEach(($,k)=>M.node($).order=k),h(M,y,w.vs);});}function m(u,b){Object.values(b).forEach(y=>y.forEach((M,A)=>u.node(M).order=A));}},{"../util":27,"./add-subgraph-constraints":11,"./build-layer-graph":13,"./cross-count":14,"./init-order":16,"./sort-subgraph":18,"@dagrejs/graphlib":29}],16:[function(n,o,i){let c=n("../util");o.exports=s;function s(l){let d={},h=l.nodes().filter(m=>!l.children(m).length),g=h.map(m=>l.node(m).rank),a=c.applyWithChunking(Math.max,g),f=c.range(a+1).map(()=>[]);function p(m){if(d[m])return;d[m]=true;let u=l.node(m);f[u.rank].push(m),l.successors(m).forEach(p);}return h.sort((m,u)=>l.node(m).rank-l.node(u).rank).forEach(p),f}},{"../util":27}],17:[function(n,o,i){let c=n("../util");o.exports=s;function s(h,g){let a={};h.forEach((p,x)=>{let m=a[p.v]={indegree:0,in:[],out:[],vs:[p.v],i:x};p.barycenter!==void 0&&(m.barycenter=p.barycenter,m.weight=p.weight);}),g.edges().forEach(p=>{let x=a[p.v],m=a[p.w];x!==void 0&&m!==void 0&&(m.indegree++,x.out.push(a[p.w]));});let f=Object.values(a).filter(p=>!p.indegree);return l(f)}function l(h){let g=[];function a(p){return x=>{x.merged||(x.barycenter===void 0||p.barycenter===void 0||x.barycenter>=p.barycenter)&&d(p,x);}}function f(p){return x=>{x.in.push(p),--x.indegree===0&&h.push(x);}}for(;h.length;){let p=h.pop();g.push(p),p.in.reverse().forEach(a(p)),p.out.forEach(f(p));}return g.filter(p=>!p.merged).map(p=>c.pick(p,["vs","i","barycenter","weight"]))}function d(h,g){let a=0,f=0;h.weight&&(a+=h.barycenter*h.weight,f+=h.weight),g.weight&&(a+=g.barycenter*g.weight,f+=g.weight),h.vs=g.vs.concat(h.vs),h.barycenter=a/f,h.weight=f,h.i=Math.min(g.i,h.i),g.merged=true;}},{"../util":27}],18:[function(n,o,i){let c=n("./barycenter"),s=n("./resolve-conflicts"),l=n("./sort");o.exports=d;function d(a,f,p,x){let m=a.children(f),u=a.node(f),b=u?u.borderLeft:void 0,y=u?u.borderRight:void 0,M={};b&&(m=m.filter(k=>k!==b&&k!==y));let A=c(a,m);A.forEach(k=>{if(a.children(k.v).length){let I=d(a,k.v,p,x);M[k.v]=I,Object.hasOwn(I,"barycenter")&&g(k,I);}});let w=s(A,p);h(w,M);let $=l(w,x);if(b&&($.vs=[b,$.vs,y].flat(true),a.predecessors(b).length)){let k=a.node(a.predecessors(b)[0]),I=a.node(a.predecessors(y)[0]);Object.hasOwn($,"barycenter")||($.barycenter=0,$.weight=0),$.barycenter=($.barycenter*$.weight+k.order+I.order)/($.weight+2),$.weight+=2;}return $}function h(a,f){a.forEach(p=>{p.vs=p.vs.flatMap(x=>f[x]?f[x].vs:x);});}function g(a,f){a.barycenter!==void 0?(a.barycenter=(a.barycenter*a.weight+f.barycenter*f.weight)/(a.weight+f.weight),a.weight+=f.weight):(a.barycenter=f.barycenter,a.weight=f.weight);}},{"./barycenter":12,"./resolve-conflicts":17,"./sort":19}],19:[function(n,o,i){let c=n("../util");o.exports=s;function s(h,g){let a=c.partition(h,M=>Object.hasOwn(M,"barycenter")),f=a.lhs,p=a.rhs.sort((M,A)=>A.i-M.i),x=[],m=0,u=0,b=0;f.sort(d(!!g)),b=l(x,p,b),f.forEach(M=>{b+=M.vs.length,x.push(M.vs),m+=M.barycenter*M.weight,u+=M.weight,b=l(x,p,b);});let y={vs:x.flat(true)};return u&&(y.barycenter=m/u,y.weight=u),y}function l(h,g,a){let f;for(;g.length&&(f=g[g.length-1]).i<=a;)g.pop(),h.push(f.vs),a++;return a}function d(h){return (g,a)=>g.barycenter<a.barycenter?-1:g.barycenter>a.barycenter?1:h?a.i-g.i:g.i-a.i}},{"../util":27}],20:[function(n,o,i){o.exports=c;function c(d){let h=l(d);d.graph().dummyChains.forEach(g=>{let a=d.node(g),f=a.edgeObj,p=s(d,h,f.v,f.w),x=p.path,m=p.lca,u=0,b=x[u],y=true;for(;g!==f.w;){if(a=d.node(g),y){for(;(b=x[u])!==m&&d.node(b).maxRank<a.rank;)u++;b===m&&(y=false);}if(!y){for(;u<x.length-1&&d.node(b=x[u+1]).minRank<=a.rank;)u++;b=x[u];}d.setParent(g,b),g=d.successors(g)[0];}});}function s(d,h,g,a){let f=[],p=[],x=Math.min(h[g].low,h[a].low),m=Math.max(h[g].lim,h[a].lim),u,b;u=g;do u=d.parent(u),f.push(u);while(u&&(h[u].low>x||m>h[u].lim));for(b=u,u=a;(u=d.parent(u))!==b;)p.push(u);return {path:f.concat(p.reverse()),lca:b}}function l(d){let h={},g=0;function a(f){let p=g;d.children(f).forEach(a),h[f]={low:p,lim:g++};}return d.children().forEach(a),h}},{}],21:[function(n,o,i){let c=n("@dagrejs/graphlib").Graph,s=n("../util");o.exports={positionX:y,findType1Conflicts:l,findType2Conflicts:d,addConflict:g,hasConflict:a,verticalAlignment:f,horizontalCompaction:p,alignCoordinates:u,findSmallestWidthAlignment:m,balance:b};function l(w,$){let k={};function I(X,N){let Y=0,q=0,_=X.length,F=N[N.length-1];return N.forEach((D,S)=>{let v=h(w,D),z=v?w.node(v).order:_;(v||D===F)&&(N.slice(q,S+1).forEach(j=>{w.predecessors(j).forEach(L=>{let P=w.node(L),T=P.order;(T<Y||z<T)&&!(P.dummy&&w.node(j).dummy)&&g(k,L,j);});}),q=S+1,Y=z);}),N}return $.length&&$.reduce(I),k}function d(w,$){let k={};function I(N,Y,q,_,F){let D;s.range(Y,q).forEach(S=>{D=N[S],w.node(D).dummy&&w.predecessors(D).forEach(v=>{let z=w.node(v);z.dummy&&(z.order<_||z.order>F)&&g(k,v,D);});});}function X(N,Y){let q=-1,_,F=0;return Y.forEach((D,S)=>{if(w.node(D).dummy==="border"){let v=w.predecessors(D);v.length&&(_=w.node(v[0]).order,I(Y,F,S,q,_),F=S,q=_);}I(Y,F,Y.length,_,N.length);}),Y}return $.length&&$.reduce(X),k}function h(w,$){if(w.node($).dummy)return w.predecessors($).find(k=>w.node(k).dummy)}function g(w,$,k){if($>k){let X=$;$=k,k=X;}let I=w[$];I||(w[$]=I={}),I[k]=true;}function a(w,$,k){if($>k){let I=$;$=k,k=I;}return !!w[$]&&Object.hasOwn(w[$],k)}function f(w,$,k,I){let X={},N={},Y={};return $.forEach(q=>{q.forEach((_,F)=>{X[_]=_,N[_]=_,Y[_]=F;});}),$.forEach(q=>{let _=-1;q.forEach(F=>{let D=I(F);if(D.length){D=D.sort((v,z)=>Y[v]-Y[z]);let S=(D.length-1)/2;for(let v=Math.floor(S),z=Math.ceil(S);v<=z;++v){let j=D[v];N[F]===F&&_<Y[j]&&!a(k,F,j)&&(N[j]=F,N[F]=X[F]=X[j],_=Y[j]);}}});}),{root:X,align:N}}function p(w,$,k,I,X){let N={},Y=x(w,$,k,X),q=X?"borderLeft":"borderRight";function _(S,v){let z=Y.nodes(),j=z.pop(),L={};for(;j;)L[j]?S(j):(L[j]=true,z.push(j),z=z.concat(v(j))),j=z.pop();}function F(S){N[S]=Y.inEdges(S).reduce((v,z)=>Math.max(v,N[z.v]+Y.edge(z)),0);}function D(S){let v=Y.outEdges(S).reduce((j,L)=>Math.min(j,N[L.w]-Y.edge(L)),Number.POSITIVE_INFINITY),z=w.node(S);v!==Number.POSITIVE_INFINITY&&z.borderType!==q&&(N[S]=Math.max(N[S],v));}return _(F,Y.predecessors.bind(Y)),_(D,Y.successors.bind(Y)),Object.keys(I).forEach(S=>N[S]=N[k[S]]),N}function x(w,$,k,I){let X=new c,N=w.graph(),Y=M(N.nodesep,N.edgesep,I);return $.forEach(q=>{let _;q.forEach(F=>{let D=k[F];if(X.setNode(D),_){var S=k[_],v=X.edge(S,D);X.setEdge(S,D,Math.max(Y(w,F,_),v||0));}_=F;});}),X}function m(w,$){return Object.values($).reduce((k,I)=>{let X=Number.NEGATIVE_INFINITY,N=Number.POSITIVE_INFINITY;Object.entries(I).forEach(([q,_])=>{let F=A(w,q)/2;X=Math.max(_+F,X),N=Math.min(_-F,N);});let Y=X-N;return Y<k[0]&&(k=[Y,I]),k},[Number.POSITIVE_INFINITY,null])[1]}function u(w,$){let k=Object.values($),I=s.applyWithChunking(Math.min,k),X=s.applyWithChunking(Math.max,k);["u","d"].forEach(N=>{["l","r"].forEach(Y=>{let q=N+Y,_=w[q];if(_===$)return;let F=Object.values(_),D=I-s.applyWithChunking(Math.min,F);Y!=="l"&&(D=X-s.applyWithChunking(Math.max,F)),D&&(w[q]=s.mapValues(_,S=>S+D));});});}function b(w,$){return s.mapValues(w.ul,(k,I)=>{if($)return w[$.toLowerCase()][I];{let X=Object.values(w).map(N=>N[I]).sort((N,Y)=>N-Y);return (X[1]+X[2])/2}})}function y(w){let $=s.buildLayerMatrix(w),k=Object.assign(l(w,$),d(w,$)),I={},X;["u","d"].forEach(Y=>{X=Y==="u"?$:Object.values($).reverse(),["l","r"].forEach(q=>{q==="r"&&(X=X.map(S=>Object.values(S).reverse()));let _=(Y==="u"?w.predecessors:w.successors).bind(w),F=f(w,X,k,_),D=p(w,X,F.root,F.align,q==="r");q==="r"&&(D=s.mapValues(D,S=>-S)),I[Y+q]=D;});});let N=m(w,I);return u(I,N),b(I,w.graph().align)}function M(w,$,k){return (I,X,N)=>{let Y=I.node(X),q=I.node(N),_=0,F;if(_+=Y.width/2,Object.hasOwn(Y,"labelpos"))switch(Y.labelpos.toLowerCase()){case "l":F=-Y.width/2;break;case "r":F=Y.width/2;break}if(F&&(_+=k?F:-F),F=0,_+=(Y.dummy?$:w)/2,_+=(q.dummy?$:w)/2,_+=q.width/2,Object.hasOwn(q,"labelpos"))switch(q.labelpos.toLowerCase()){case "l":F=q.width/2;break;case "r":F=-q.width/2;break}return F&&(_+=k?F:-F),F=0,_}}function A(w,$){return w.node($).width}},{"../util":27,"@dagrejs/graphlib":29}],22:[function(n,o,i){let c=n("../util"),s=n("./bk").positionX;o.exports=l;function l(h){h=c.asNonCompoundGraph(h),d(h),Object.entries(s(h)).forEach(([g,a])=>h.node(g).x=a);}function d(h){let g=c.buildLayerMatrix(h),a=h.graph().ranksep,f=0;g.forEach(p=>{let x=p.reduce((m,u)=>{let b=h.node(u).height;return m>b?m:b},0);p.forEach(m=>h.node(m).y=f+x/2),f+=x+a;});}},{"../util":27,"./bk":21}],23:[function(n,o,i){var c=n("@dagrejs/graphlib").Graph,s=n("./util").slack;o.exports=l;function l(a){var f=new c({directed:false}),p=a.nodes()[0],x=a.nodeCount();f.setNode(p,{});for(var m,u;d(f,a)<x;)m=h(f,a),u=f.hasNode(m.v)?s(a,m):-s(a,m),g(f,a,u);return f}function d(a,f){function p(x){f.nodeEdges(x).forEach(m=>{var u=m.v,b=x===u?m.w:u;!a.hasNode(b)&&!s(f,m)&&(a.setNode(b,{}),a.setEdge(x,b,{}),p(b));});}return a.nodes().forEach(p),a.nodeCount()}function h(a,f){return f.edges().reduce((x,m)=>{let u=Number.POSITIVE_INFINITY;return a.hasNode(m.v)!==a.hasNode(m.w)&&(u=s(f,m)),u<x[0]?[u,m]:x},[Number.POSITIVE_INFINITY,null])[1]}function g(a,f,p){a.nodes().forEach(x=>f.node(x).rank+=p);}},{"./util":26,"@dagrejs/graphlib":29}],24:[function(n,o,i){var c=n("./util"),s=c.longestPath,l=n("./feasible-tree"),d=n("./network-simplex");o.exports=h;function h(p){var x=p.graph().ranker;if(x instanceof Function)return x(p);switch(p.graph().ranker){case "network-simplex":f(p);break;case "tight-tree":a(p);break;case "longest-path":g(p);break;case "none":break;default:f(p);}}var g=s;function a(p){s(p),l(p);}function f(p){d(p);}},{"./feasible-tree":23,"./network-simplex":25,"./util":26}],25:[function(n,o,i){var c=n("./feasible-tree"),s=n("./util").slack,l=n("./util").longestPath,d=n("@dagrejs/graphlib").alg.preorder,h=n("@dagrejs/graphlib").alg.postorder,g=n("../util").simplify;o.exports=a,a.initLowLimValues=m,a.initCutValues=f,a.calcCutValue=x,a.leaveEdge=b,a.enterEdge=y,a.exchangeEdges=M;function a(k){k=g(k),l(k);var I=c(k);m(I),f(I,k);for(var X,N;X=b(I);)N=y(I,k,X),M(I,k,X,N);}function f(k,I){var X=h(k,k.nodes());X=X.slice(0,X.length-1),X.forEach(N=>p(k,I,N));}function p(k,I,X){var N=k.node(X),Y=N.parent;k.edge(X,Y).cutvalue=x(k,I,X);}function x(k,I,X){var N=k.node(X),Y=N.parent,q=true,_=I.edge(X,Y),F=0;return _||(q=false,_=I.edge(Y,X)),F=_.weight,I.nodeEdges(X).forEach(D=>{var S=D.v===X,v=S?D.w:D.v;if(v!==Y){var z=S===q,j=I.edge(D).weight;if(F+=z?j:-j,w(k,X,v)){var L=k.edge(X,v).cutvalue;F+=z?-L:L;}}}),F}function m(k,I){arguments.length<2&&(I=k.nodes()[0]),u(k,{},1,I);}function u(k,I,X,N,Y){var q=X,_=k.node(N);return I[N]=true,k.neighbors(N).forEach(F=>{Object.hasOwn(I,F)||(X=u(k,I,X,F,N));}),_.low=q,_.lim=X++,Y?_.parent=Y:delete _.parent,X}function b(k){return k.edges().find(I=>k.edge(I).cutvalue<0)}function y(k,I,X){var N=X.v,Y=X.w;I.hasEdge(N,Y)||(N=X.w,Y=X.v);var q=k.node(N),_=k.node(Y),F=q,D=false;q.lim>_.lim&&(F=_,D=true);var S=I.edges().filter(v=>D===$(k,k.node(v.v),F)&&D!==$(k,k.node(v.w),F));return S.reduce((v,z)=>s(I,z)<s(I,v)?z:v)}function M(k,I,X,N){var Y=X.v,q=X.w;k.removeEdge(Y,q),k.setEdge(N.v,N.w,{}),m(k),f(k,I),A(k,I);}function A(k,I){var X=k.nodes().find(Y=>!I.node(Y).parent),N=d(k,X);N=N.slice(1),N.forEach(Y=>{var q=k.node(Y).parent,_=I.edge(Y,q),F=false;_||(_=I.edge(q,Y),F=true),I.node(Y).rank=I.node(q).rank+(F?_.minlen:-_.minlen);});}function w(k,I,X){return k.hasEdge(I,X)}function $(k,I,X){return X.low<=I.lim&&I.lim<=X.lim}},{"../util":27,"./feasible-tree":23,"./util":26,"@dagrejs/graphlib":29}],26:[function(n,o,i){let{applyWithChunking:c}=n("../util");o.exports={longestPath:s,slack:l};function s(d){var h={};function g(a){var f=d.node(a);if(Object.hasOwn(h,a))return f.rank;h[a]=true;let p=d.outEdges(a).map(m=>m==null?Number.POSITIVE_INFINITY:g(m.w)-d.edge(m).minlen);var x=c(Math.min,p);return x===Number.POSITIVE_INFINITY&&(x=0),f.rank=x}d.sources().forEach(g);}function l(d,h){return d.node(h.w).rank-d.node(h.v).rank-d.edge(h).minlen}},{"../util":27}],27:[function(n,o,i){let c=n("@dagrejs/graphlib").Graph;o.exports={addBorderNode:m,addDummyNode:s,applyWithChunking:y,asNonCompoundGraph:d,buildLayerMatrix:f,intersectRect:a,mapValues:Y,maxRank:M,normalizeRanks:p,notime:$,partition:A,pick:N,predecessorWeights:g,range:X,removeEmptyRanks:x,simplify:l,successorWeights:h,time:w,uniqueId:I,zipObject:q};function s(_,F,D,S){for(var v=S;_.hasNode(v);)v=I(S);return D.dummy=F,_.setNode(v,D),v}function l(_){let F=new c().setGraph(_.graph());return _.nodes().forEach(D=>F.setNode(D,_.node(D))),_.edges().forEach(D=>{let S=F.edge(D.v,D.w)||{weight:0,minlen:1},v=_.edge(D);F.setEdge(D.v,D.w,{weight:S.weight+v.weight,minlen:Math.max(S.minlen,v.minlen)});}),F}function d(_){let F=new c({multigraph:_.isMultigraph()}).setGraph(_.graph());return _.nodes().forEach(D=>{_.children(D).length||F.setNode(D,_.node(D));}),_.edges().forEach(D=>{F.setEdge(D,_.edge(D));}),F}function h(_){let F=_.nodes().map(D=>{let S={};return _.outEdges(D).forEach(v=>{S[v.w]=(S[v.w]||0)+_.edge(v).weight;}),S});return q(_.nodes(),F)}function g(_){let F=_.nodes().map(D=>{let S={};return _.inEdges(D).forEach(v=>{S[v.v]=(S[v.v]||0)+_.edge(v).weight;}),S});return q(_.nodes(),F)}function a(_,F){let D=_.x,S=_.y,v=F.x-D,z=F.y-S,j=_.width/2,L=_.height/2;if(!v&&!z)throw new Error("Not possible to find intersection inside of the rectangle");let P,T;return Math.abs(z)*j>Math.abs(v)*L?(z<0&&(L=-L),P=L*v/z,T=L):(v<0&&(j=-j),P=j,T=j*z/v),{x:D+P,y:S+T}}function f(_){let F=X(M(_)+1).map(()=>[]);return _.nodes().forEach(D=>{let S=_.node(D),v=S.rank;v!==void 0&&(F[v][S.order]=D);}),F}function p(_){let F=_.nodes().map(S=>{let v=_.node(S).rank;return v===void 0?Number.MAX_VALUE:v}),D=y(Math.min,F);_.nodes().forEach(S=>{let v=_.node(S);Object.hasOwn(v,"rank")&&(v.rank-=D);});}function x(_){let F=_.nodes().map(j=>_.node(j).rank),D=y(Math.min,F),S=[];_.nodes().forEach(j=>{let L=_.node(j).rank-D;S[L]||(S[L]=[]),S[L].push(j);});let v=0,z=_.graph().nodeRankFactor;Array.from(S).forEach((j,L)=>{j===void 0&&L%z!==0?--v:j!==void 0&&v&&j.forEach(P=>_.node(P).rank+=v);});}function m(_,F,D,S){let v={width:0,height:0};return arguments.length>=4&&(v.rank=D,v.order=S),s(_,"border",v,F)}function u(_,F=b){let D=[];for(let S=0;S<_.length;S+=F){let v=_.slice(S,S+F);D.push(v);}return D}let b=65535;function y(_,F){if(F.length>b){let D=u(F);return _.apply(null,D.map(S=>_.apply(null,S)))}else return _.apply(null,F)}function M(_){let D=_.nodes().map(S=>{let v=_.node(S).rank;return v===void 0?Number.MIN_VALUE:v});return y(Math.max,D)}function A(_,F){let D={lhs:[],rhs:[]};return _.forEach(S=>{F(S)?D.lhs.push(S):D.rhs.push(S);}),D}function w(_,F){let D=Date.now();try{return F()}finally{console.log(_+" time: "+(Date.now()-D)+"ms");}}function $(_,F){return F()}let k=0;function I(_){var F=++k;return _+(""+F)}function X(_,F,D=1){F==null&&(F=_,_=0);let S=z=>z<F;D<0&&(S=z=>F<z);let v=[];for(let z=_;S(z);z+=D)v.push(z);return v}function N(_,F){let D={};for(let S of F)_[S]!==void 0&&(D[S]=_[S]);return D}function Y(_,F){let D=F;return typeof F=="string"&&(D=S=>S[F]),Object.entries(_).reduce((S,[v,z])=>(S[v]=D(z,v),S),{})}function q(_,F){return _.reduce((D,S,v)=>(D[S]=F[v],D),{})}},{"@dagrejs/graphlib":29}],28:[function(n,o,i){o.exports="1.1.8";},{}],29:[function(n,o,i){var c=n("./lib");o.exports={Graph:c.Graph,json:n("./lib/json"),alg:n("./lib/alg"),version:c.version};},{"./lib":45,"./lib/alg":36,"./lib/json":46}],30:[function(n,o,i){o.exports=c;function c(s){var l={},d=[],h;function g(a){Object.hasOwn(l,a)||(l[a]=true,h.push(a),s.successors(a).forEach(g),s.predecessors(a).forEach(g));}return s.nodes().forEach(function(a){h=[],g(a),h.length&&d.push(h);}),d}},{}],31:[function(n,o,i){o.exports=c;function c(h,g,a){Array.isArray(g)||(g=[g]);var f=h.isDirected()?u=>h.successors(u):u=>h.neighbors(u),p=a==="post"?s:l,x=[],m={};return g.forEach(u=>{if(!h.hasNode(u))throw new Error("Graph does not have node: "+u);p(u,f,m,x);}),x}function s(h,g,a,f){for(var p=[[h,false]];p.length>0;){var x=p.pop();x[1]?f.push(x[0]):Object.hasOwn(a,x[0])||(a[x[0]]=true,p.push([x[0],true]),d(g(x[0]),m=>p.push([m,false])));}}function l(h,g,a,f){for(var p=[h];p.length>0;){var x=p.pop();Object.hasOwn(a,x)||(a[x]=true,f.push(x),d(g(x),m=>p.push(m)));}}function d(h,g){for(var a=h.length;a--;)g(h[a],a,h);return h}},{}],32:[function(n,o,i){var c=n("./dijkstra");o.exports=s;function s(l,d,h){return l.nodes().reduce(function(g,a){return g[a]=c(l,a,d,h),g},{})}},{"./dijkstra":33}],33:[function(n,o,i){var c=n("../data/priority-queue");o.exports=l;var s=()=>1;function l(h,g,a,f){return d(h,String(g),a||s,f||function(p){return h.outEdges(p)})}function d(h,g,a,f){var p={},x=new c,m,u,b=function(y){var M=y.v!==m?y.v:y.w,A=p[M],w=a(y),$=u.distance+w;if(w<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+y+" Weight: "+w);$<A.distance&&(A.distance=$,A.predecessor=m,x.decrease(M,$));};for(h.nodes().forEach(function(y){var M=y===g?0:Number.POSITIVE_INFINITY;p[y]={distance:M},x.add(y,M);});x.size()>0&&(m=x.removeMin(),u=p[m],u.distance!==Number.POSITIVE_INFINITY);)f(m).forEach(b);return p}},{"../data/priority-queue":43}],34:[function(n,o,i){var c=n("./tarjan");o.exports=s;function s(l){return c(l).filter(function(d){return d.length>1||d.length===1&&l.hasEdge(d[0],d[0])})}},{"./tarjan":41}],35:[function(n,o,i){o.exports=s;var c=()=>1;function s(d,h,g){return l(d,h||c,g||function(a){return d.outEdges(a)})}function l(d,h,g){var a={},f=d.nodes();return f.forEach(function(p){a[p]={},a[p][p]={distance:0},f.forEach(function(x){p!==x&&(a[p][x]={distance:Number.POSITIVE_INFINITY});}),g(p).forEach(function(x){var m=x.v===p?x.w:x.v,u=h(x);a[p][m]={distance:u,predecessor:p};});}),f.forEach(function(p){var x=a[p];f.forEach(function(m){var u=a[m];f.forEach(function(b){var y=u[p],M=x[b],A=u[b],w=y.distance+M.distance;w<A.distance&&(A.distance=w,A.predecessor=M.predecessor);});});}),a}},{}],36:[function(n,o,i){o.exports={components:n("./components"),dijkstra:n("./dijkstra"),dijkstraAll:n("./dijkstra-all"),findCycles:n("./find-cycles"),floydWarshall:n("./floyd-warshall"),isAcyclic:n("./is-acyclic"),postorder:n("./postorder"),preorder:n("./preorder"),prim:n("./prim"),tarjan:n("./tarjan"),topsort:n("./topsort")};},{"./components":30,"./dijkstra":33,"./dijkstra-all":32,"./find-cycles":34,"./floyd-warshall":35,"./is-acyclic":37,"./postorder":38,"./preorder":39,"./prim":40,"./tarjan":41,"./topsort":42}],37:[function(n,o,i){var c=n("./topsort");o.exports=s;function s(l){try{c(l);}catch(d){if(d instanceof c.CycleException)return  false;throw d}return  true}},{"./topsort":42}],38:[function(n,o,i){var c=n("./dfs");o.exports=s;function s(l,d){return c(l,d,"post")}},{"./dfs":31}],39:[function(n,o,i){var c=n("./dfs");o.exports=s;function s(l,d){return c(l,d,"pre")}},{"./dfs":31}],40:[function(n,o,i){var c=n("../graph"),s=n("../data/priority-queue");o.exports=l;function l(d,h){var g=new c,a={},f=new s,p;function x(u){var b=u.v===p?u.w:u.v,y=f.priority(b);if(y!==void 0){var M=h(u);M<y&&(a[b]=p,f.decrease(b,M));}}if(d.nodeCount()===0)return g;d.nodes().forEach(function(u){f.add(u,Number.POSITIVE_INFINITY),g.setNode(u);}),f.decrease(d.nodes()[0],0);for(var m=false;f.size()>0;){if(p=f.removeMin(),Object.hasOwn(a,p))g.setEdge(p,a[p]);else {if(m)throw new Error("Input graph is not connected: "+d);m=true;}d.nodeEdges(p).forEach(x);}return g}},{"../data/priority-queue":43,"../graph":44}],41:[function(n,o,i){o.exports=c;function c(s){var l=0,d=[],h={},g=[];function a(f){var p=h[f]={onStack:true,lowlink:l,index:l++};if(d.push(f),s.successors(f).forEach(function(u){Object.hasOwn(h,u)?h[u].onStack&&(p.lowlink=Math.min(p.lowlink,h[u].index)):(a(u),p.lowlink=Math.min(p.lowlink,h[u].lowlink));}),p.lowlink===p.index){var x=[],m;do m=d.pop(),h[m].onStack=false,x.push(m);while(f!==m);g.push(x);}}return s.nodes().forEach(function(f){Object.hasOwn(h,f)||a(f);}),g}},{}],42:[function(n,o,i){function c(l){var d={},h={},g=[];function a(f){if(Object.hasOwn(h,f))throw new s;Object.hasOwn(d,f)||(h[f]=true,d[f]=true,l.predecessors(f).forEach(a),delete h[f],g.push(f));}if(l.sinks().forEach(a),Object.keys(d).length!==l.nodeCount())throw new s;return g}class s extends Error{constructor(){super(...arguments);}}o.exports=c,c.CycleException=s;},{}],43:[function(n,o,i){class c{_arr=[];_keyIndices={};size(){return this._arr.length}keys(){return this._arr.map(function(l){return l.key})}has(l){return Object.hasOwn(this._keyIndices,l)}priority(l){var d=this._keyIndices[l];if(d!==void 0)return this._arr[d].priority}min(){if(this.size()===0)throw new Error("Queue underflow");return this._arr[0].key}add(l,d){var h=this._keyIndices;if(l=String(l),!Object.hasOwn(h,l)){var g=this._arr,a=g.length;return h[l]=a,g.push({key:l,priority:d}),this._decrease(a),true}return  false}removeMin(){this._swap(0,this._arr.length-1);var l=this._arr.pop();return delete this._keyIndices[l.key],this._heapify(0),l.key}decrease(l,d){var h=this._keyIndices[l];if(d>this._arr[h].priority)throw new Error("New priority is greater than current priority. Key: "+l+" Old: "+this._arr[h].priority+" New: "+d);this._arr[h].priority=d,this._decrease(h);}_heapify(l){var d=this._arr,h=2*l,g=h+1,a=l;h<d.length&&(a=d[h].priority<d[a].priority?h:a,g<d.length&&(a=d[g].priority<d[a].priority?g:a),a!==l&&(this._swap(l,a),this._heapify(a)));}_decrease(l){for(var d=this._arr,h=d[l].priority,g;l!==0&&(g=l>>1,!(d[g].priority<h));)this._swap(l,g),l=g;}_swap(l,d){var h=this._arr,g=this._keyIndices,a=h[l],f=h[d];h[l]=f,h[d]=a,g[f.key]=l,g[a.key]=d;}}o.exports=c;},{}],44:[function(n,o,i){var c="\0",s="\0",l="";class d{_isDirected=true;_isMultigraph=false;_isCompound=false;_label;_defaultNodeLabelFn=()=>{};_defaultEdgeLabelFn=()=>{};_nodes={};_in={};_preds={};_out={};_sucs={};_edgeObjs={};_edgeLabels={};_nodeCount=0;_edgeCount=0;_parent;_children;constructor(m){m&&(this._isDirected=Object.hasOwn(m,"directed")?m.directed:true,this._isMultigraph=Object.hasOwn(m,"multigraph")?m.multigraph:false,this._isCompound=Object.hasOwn(m,"compound")?m.compound:false),this._isCompound&&(this._parent={},this._children={},this._children[s]={});}isDirected(){return this._isDirected}isMultigraph(){return this._isMultigraph}isCompound(){return this._isCompound}setGraph(m){return this._label=m,this}graph(){return this._label}setDefaultNodeLabel(m){return this._defaultNodeLabelFn=m,typeof m!="function"&&(this._defaultNodeLabelFn=()=>m),this}nodeCount(){return this._nodeCount}nodes(){return Object.keys(this._nodes)}sources(){var m=this;return this.nodes().filter(u=>Object.keys(m._in[u]).length===0)}sinks(){var m=this;return this.nodes().filter(u=>Object.keys(m._out[u]).length===0)}setNodes(m,u){var b=arguments,y=this;return m.forEach(function(M){b.length>1?y.setNode(M,u):y.setNode(M);}),this}setNode(m,u){return Object.hasOwn(this._nodes,m)?(arguments.length>1&&(this._nodes[m]=u),this):(this._nodes[m]=arguments.length>1?u:this._defaultNodeLabelFn(m),this._isCompound&&(this._parent[m]=s,this._children[m]={},this._children[s][m]=true),this._in[m]={},this._preds[m]={},this._out[m]={},this._sucs[m]={},++this._nodeCount,this)}node(m){return this._nodes[m]}hasNode(m){return Object.hasOwn(this._nodes,m)}removeNode(m){var u=this;if(Object.hasOwn(this._nodes,m)){var b=y=>u.removeEdge(u._edgeObjs[y]);delete this._nodes[m],this._isCompound&&(this._removeFromParentsChildList(m),delete this._parent[m],this.children(m).forEach(function(y){u.setParent(y);}),delete this._children[m]),Object.keys(this._in[m]).forEach(b),delete this._in[m],delete this._preds[m],Object.keys(this._out[m]).forEach(b),delete this._out[m],delete this._sucs[m],--this._nodeCount;}return this}setParent(m,u){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(u===void 0)u=s;else {u+="";for(var b=u;b!==void 0;b=this.parent(b))if(b===m)throw new Error("Setting "+u+" as parent of "+m+" would create a cycle");this.setNode(u);}return this.setNode(m),this._removeFromParentsChildList(m),this._parent[m]=u,this._children[u][m]=true,this}_removeFromParentsChildList(m){delete this._children[this._parent[m]][m];}parent(m){if(this._isCompound){var u=this._parent[m];if(u!==s)return u}}children(m=s){if(this._isCompound){var u=this._children[m];if(u)return Object.keys(u)}else {if(m===s)return this.nodes();if(this.hasNode(m))return []}}predecessors(m){var u=this._preds[m];if(u)return Object.keys(u)}successors(m){var u=this._sucs[m];if(u)return Object.keys(u)}neighbors(m){var u=this.predecessors(m);if(u){let y=new Set(u);for(var b of this.successors(m))y.add(b);return Array.from(y.values())}}isLeaf(m){var u;return this.isDirected()?u=this.successors(m):u=this.neighbors(m),u.length===0}filterNodes(m){var u=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});u.setGraph(this.graph());var b=this;Object.entries(this._nodes).forEach(function([A,w]){m(A)&&u.setNode(A,w);}),Object.values(this._edgeObjs).forEach(function(A){u.hasNode(A.v)&&u.hasNode(A.w)&&u.setEdge(A,b.edge(A));});var y={};function M(A){var w=b.parent(A);return w===void 0||u.hasNode(w)?(y[A]=w,w):w in y?y[w]:M(w)}return this._isCompound&&u.nodes().forEach(A=>u.setParent(A,M(A))),u}setDefaultEdgeLabel(m){return this._defaultEdgeLabelFn=m,typeof m!="function"&&(this._defaultEdgeLabelFn=()=>m),this}edgeCount(){return this._edgeCount}edges(){return Object.values(this._edgeObjs)}setPath(m,u){var b=this,y=arguments;return m.reduce(function(M,A){return y.length>1?b.setEdge(M,A,u):b.setEdge(M,A),A}),this}setEdge(){var m,u,b,y,M=false,A=arguments[0];typeof A=="object"&&A!==null&&"v"in A?(m=A.v,u=A.w,b=A.name,arguments.length===2&&(y=arguments[1],M=true)):(m=A,u=arguments[1],b=arguments[3],arguments.length>2&&(y=arguments[2],M=true)),m=""+m,u=""+u,b!==void 0&&(b=""+b);var w=a(this._isDirected,m,u,b);if(Object.hasOwn(this._edgeLabels,w))return M&&(this._edgeLabels[w]=y),this;if(b!==void 0&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(m),this.setNode(u),this._edgeLabels[w]=M?y:this._defaultEdgeLabelFn(m,u,b);var $=f(this._isDirected,m,u,b);return m=$.v,u=$.w,Object.freeze($),this._edgeObjs[w]=$,h(this._preds[u],m),h(this._sucs[m],u),this._in[u][w]=$,this._out[m][w]=$,this._edgeCount++,this}edge(m,u,b){var y=arguments.length===1?p(this._isDirected,arguments[0]):a(this._isDirected,m,u,b);return this._edgeLabels[y]}edgeAsObj(){let m=this.edge(...arguments);return typeof m!="object"?{label:m}:m}hasEdge(m,u,b){var y=arguments.length===1?p(this._isDirected,arguments[0]):a(this._isDirected,m,u,b);return Object.hasOwn(this._edgeLabels,y)}removeEdge(m,u,b){var y=arguments.length===1?p(this._isDirected,arguments[0]):a(this._isDirected,m,u,b),M=this._edgeObjs[y];return M&&(m=M.v,u=M.w,delete this._edgeLabels[y],delete this._edgeObjs[y],g(this._preds[u],m),g(this._sucs[m],u),delete this._in[u][y],delete this._out[m][y],this._edgeCount--),this}inEdges(m,u){var b=this._in[m];if(b){var y=Object.values(b);return u?y.filter(M=>M.v===u):y}}outEdges(m,u){var b=this._out[m];if(b){var y=Object.values(b);return u?y.filter(M=>M.w===u):y}}nodeEdges(m,u){var b=this.inEdges(m,u);if(b)return b.concat(this.outEdges(m,u))}}function h(x,m){x[m]?x[m]++:x[m]=1;}function g(x,m){--x[m]||delete x[m];}function a(x,m,u,b){var y=""+m,M=""+u;if(!x&&y>M){var A=y;y=M,M=A;}return y+l+M+l+(b===void 0?c:b)}function f(x,m,u,b){var y=""+m,M=""+u;if(!x&&y>M){var A=y;y=M,M=A;}var w={v:y,w:M};return b&&(w.name=b),w}function p(x,m){return a(x,m.v,m.w,m.name)}o.exports=d;},{}],45:[function(n,o,i){o.exports={Graph:n("./graph"),version:n("./version")};},{"./graph":44,"./version":47}],46:[function(n,o,i){var c=n("./graph");o.exports={write:s,read:h};function s(g){var a={options:{directed:g.isDirected(),multigraph:g.isMultigraph(),compound:g.isCompound()},nodes:l(g),edges:d(g)};return g.graph()!==void 0&&(a.value=structuredClone(g.graph())),a}function l(g){return g.nodes().map(function(a){var f=g.node(a),p=g.parent(a),x={v:a};return f!==void 0&&(x.value=f),p!==void 0&&(x.parent=p),x})}function d(g){return g.edges().map(function(a){var f=g.edge(a),p={v:a.v,w:a.w};return a.name!==void 0&&(p.name=a.name),f!==void 0&&(p.value=f),p})}function h(g){var a=new c(g.options).setGraph(g.value);return g.nodes.forEach(function(f){a.setNode(f.v,f.value),f.parent&&a.setParent(f.v,f.parent);}),g.edges.forEach(function(f){a.setEdge({v:f.v,w:f.w,name:f.name},f.value);}),a}},{"./graph":44}],47:[function(n,o,i){o.exports="2.2.4";},{}]},{},[1])(1)});});var fe={bg:"#FFFFFF",fg:"#27272A"},Gt={textSec:60,textMuted:40,textFaint:25,line:30,arrow:50,nodeFill:3,nodeStroke:20,groupHeader:5,innerStroke:12,keyBadge:10},qe={"zinc-light":{bg:"#FFFFFF",fg:"#27272A"},"zinc-dark":{bg:"#18181B",fg:"#FAFAFA"},"tokyo-night":{bg:"#1a1b26",fg:"#a9b1d6",line:"#3d59a1",accent:"#7aa2f7",muted:"#565f89"},"tokyo-night-storm":{bg:"#24283b",fg:"#a9b1d6",line:"#3d59a1",accent:"#7aa2f7",muted:"#565f89"},"tokyo-night-light":{bg:"#d5d6db",fg:"#343b58",line:"#34548a",accent:"#34548a",muted:"#9699a3"},"catppuccin-mocha":{bg:"#1e1e2e",fg:"#cdd6f4",line:"#585b70",accent:"#cba6f7",muted:"#6c7086"},"catppuccin-latte":{bg:"#eff1f5",fg:"#4c4f69",line:"#9ca0b0",accent:"#8839ef",muted:"#9ca0b0"},nord:{bg:"#2e3440",fg:"#d8dee9",line:"#4c566a",accent:"#88c0d0",muted:"#616e88"},"nord-light":{bg:"#eceff4",fg:"#2e3440",line:"#aab1c0",accent:"#5e81ac",muted:"#7b88a1"},dracula:{bg:"#282a36",fg:"#f8f8f2",line:"#6272a4",accent:"#bd93f9",muted:"#6272a4"},"github-light":{bg:"#ffffff",fg:"#1f2328",line:"#d1d9e0",accent:"#0969da",muted:"#59636e"},"github-dark":{bg:"#0d1117",fg:"#e6edf3",line:"#3d444d",accent:"#4493f8",muted:"#9198a1"},"solarized-light":{bg:"#fdf6e3",fg:"#657b83",line:"#93a1a1",accent:"#268bd2",muted:"#93a1a1"},"solarized-dark":{bg:"#002b36",fg:"#839496",line:"#586e75",accent:"#268bd2",muted:"#586e75"},"one-dark":{bg:"#282c34",fg:"#abb2bf",line:"#4b5263",accent:"#c678dd",muted:"#5c6370"}};function Je(t){let e=t.colors??{},r=t.type==="dark",n=o=>t.tokenColors?.find(i=>Array.isArray(i.scope)?i.scope.includes(o):i.scope===o)?.settings?.foreground;return {bg:e["editor.background"]??(r?"#1e1e1e":"#ffffff"),fg:e["editor.foreground"]??(r?"#d4d4d4":"#333333"),line:e["editorLineNumber.foreground"]??void 0,accent:e.focusBorder??n("keyword")??void 0,muted:n("comment")??e["editorLineNumber.foreground"]??void 0,surface:e["editor.selectionBackground"]??void 0,border:e["editorWidget.border"]??void 0}}function qt(t,e){let r=[`@import url('https://fonts.googleapis.com/css2?family=${encodeURIComponent(t)}:wght@400;500;600;700&amp;display=swap');`,...e?["@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&amp;display=swap');"]:[]],n=`
    /* Derived from --bg and --fg (overridable via --line, --accent, etc.) */
    --_text:          var(--fg);
    --_text-sec:      var(--muted, color-mix(in srgb, var(--fg) ${Gt.textSec}%, var(--bg)));
    --_text-muted:    var(--muted, color-mix(in srgb, var(--fg) ${Gt.textMuted}%, var(--bg)));
    --_text-faint:    color-mix(in srgb, var(--fg) ${Gt.textFaint}%, var(--bg));
    --_line:          var(--line, color-mix(in srgb, var(--fg) ${Gt.line}%, var(--bg)));
    --_arrow:         var(--accent, color-mix(in srgb, var(--fg) ${Gt.arrow}%, var(--bg)));
    --_node-fill:     var(--surface, color-mix(in srgb, var(--fg) ${Gt.nodeFill}%, var(--bg)));
    --_node-stroke:   var(--border, color-mix(in srgb, var(--fg) ${Gt.nodeStroke}%, var(--bg)));
    --_group-fill:    var(--bg);
    --_group-hdr:     color-mix(in srgb, var(--fg) ${Gt.groupHeader}%, var(--bg));
    --_inner-stroke:  color-mix(in srgb, var(--fg) ${Gt.innerStroke}%, var(--bg));
    --_key-badge:     color-mix(in srgb, var(--fg) ${Gt.keyBadge}%, var(--bg));`;return ["<style>",`  ${r.join(`
  `)}`,`  text { font-family: '${t}', system-ui, sans-serif; }`,...e?["  .mono { font-family: 'JetBrains Mono', 'SF Mono', 'Fira Code', ui-monospace, monospace; }"]:[],`  svg {${n}`,"  }","</style>"].join(`
`)}function Jt(t,e,r,n){let o=[`--bg:${r.bg}`,`--fg:${r.fg}`,r.line?`--line:${r.line}`:"",r.accent?`--accent:${r.accent}`:"",r.muted?`--muted:${r.muted}`:"",r.surface?`--surface:${r.surface}`:"",r.border?`--border:${r.border}`:""].filter(Boolean).join(";");return `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${t} ${e}" width="${t}" height="${e}" style="${o}${n?"":";background:var(--bg)"}">`}function Ce(t){let e=t.split(/[\n;]/).map(n=>n.trim()).filter(n=>n.length>0&&!n.startsWith("%%"));if(e.length===0)throw new Error("Empty mermaid diagram");let r=e[0];return /^stateDiagram(-v2)?\s*$/i.test(r)?Eo(e):ko(e)}function ko(t){let e=t[0].match(/^(?:graph|flowchart)\s+(TD|TB|LR|BT|RL)\s*$/i);if(!e)throw new Error(`Invalid mermaid header: "${t[0]}". Expected "graph TD", "flowchart LR", "stateDiagram-v2", etc.`);let n={direction:e[1].toUpperCase(),nodes:new Map,edges:[],subgraphs:[],classDefs:new Map,classAssignments:new Map,nodeStyles:new Map},o=[];for(let i=1;i<t.length;i++){let c=t[i],s=c.match(/^classDef\s+(\w+)\s+(.+)$/);if(s){let a=s[1],f=s[2],p=Tn(f);n.classDefs.set(a,p);continue}let l=c.match(/^class\s+([^\s]+)\s+(\w+)$/);if(l){let a=l[1].split(",").map(p=>p.trim()),f=l[2];for(let p of a)n.classAssignments.set(p,f);continue}let d=c.match(/^style\s+([^\s]+)\s+(.+)$/);if(d){let a=d[1].split(",").map(p=>p.trim()),f=Tn(d[2]);for(let p of a)n.nodeStyles.set(p,{...n.nodeStyles.get(p),...f});continue}let h=c.match(/^direction\s+(TD|TB|LR|BT|RL)\s*$/i);if(h&&o.length>0){o[o.length-1].direction=h[1].toUpperCase();continue}let g=c.match(/^subgraph\s+(.+)$/);if(g){let a=g[1].trim(),f=a.match(/^([\p{L}\p{N}_-]+)\s*\[(.+)\]$/u),p,x;f?(p=f[1],x=f[2]):(x=a,p=a.replace(/\s+/g,"_").replace(/[^\p{L}\p{N}_]/gu,""));let m={id:p,label:x,nodeIds:[],children:[]};o.push(m);continue}if(c==="end"){let a=o.pop();a&&(o.length>0?o[o.length-1].children.push(a):n.subgraphs.push(a));continue}_o(c,n,o);}return n}function Eo(t){let e={direction:"TD",nodes:new Map,edges:[],subgraphs:[],classDefs:new Map,classAssignments:new Map,nodeStyles:new Map},r=[],n=0,o=0;for(let i=1;i<t.length;i++){let c=t[i],s=c.match(/^direction\s+(TD|TB|LR|BT|RL)\s*$/i);if(s){r.length>0?r[r.length-1].direction=s[1].toUpperCase():e.direction=s[1].toUpperCase();continue}let l=c.match(/^state\s+(?:"([^"]+)"\s+as\s+)?([\p{L}\p{N}_-]+)\s*\{$/u);if(l){let a=l[1]??l[2],p={id:l[2],label:a,nodeIds:[],children:[]};r.push(p);continue}if(c==="}"){let a=r.pop();a&&(r.length>0?r[r.length-1].children.push(a):e.subgraphs.push(a));continue}let d=c.match(/^state\s+"([^"]+)"\s+as\s+([\p{L}\p{N}_-]+)\s*$/u);if(d){let a=d[1],f=d[2];Me(e,r,{id:f,label:a,shape:"rounded"});continue}let h=c.match(/^(\[\*\]|[\p{L}\p{N}_-]+)\s*(-->)\s*(\[\*\]|[\p{L}\p{N}_-]+)(?:\s*:\s*(.+))?$/u);if(h){let a=h[1],f=h[3],p=h[4]?.trim()||void 0;a==="[*]"?(n++,a=`_start${n>1?n:""}`,Me(e,r,{id:a,label:"",shape:"state-start"})):_n(e,r,a),f==="[*]"?(o++,f=`_end${o>1?o:""}`,Me(e,r,{id:f,label:"",shape:"state-end"})):_n(e,r,f),e.edges.push({source:a,target:f,label:p,style:"solid",hasArrowStart:false,hasArrowEnd:true});continue}let g=c.match(/^([\p{L}\p{N}_-]+)\s*:\s*(.+)$/u);if(g){let a=g[1],f=g[2].trim();Me(e,r,{id:a,label:f,shape:"rounded"});continue}}return e}function Me(t,e,r){if(!t.nodes.has(r.id)&&t.nodes.set(r.id,r),e.length>0){let o=e[e.length-1];o.nodeIds.includes(r.id)||o.nodeIds.push(r.id);}}function _n(t,e,r){if(!t.nodes.has(r))Me(t,e,{id:r,label:r,shape:"rounded"});else if(e.length>0){let n=e[e.length-1];n.nodeIds.includes(r)||n.nodeIds.push(r);}}function Tn(t){let e={};for(let r of t.split(",")){let n=r.indexOf(":");if(n>0){let o=r.slice(0,n).trim(),i=r.slice(n+1).trim();o&&i&&(e[o]=i);}}return e}var Rn=/^(<)?(-->|-.->|==>|---|-\.-|===)(?:\|([^|]*)\|)?/,$o=[{regex:/^([\p{L}\p{N}_-]+)\(\(\((.+?)\)\)\)/u,shape:"doublecircle"},{regex:/^([\p{L}\p{N}_-]+)\(\[(.+?)\]\)/u,shape:"stadium"},{regex:/^([\p{L}\p{N}_-]+)\(\((.+?)\)\)/u,shape:"circle"},{regex:/^([\p{L}\p{N}_-]+)\[\[(.+?)\]\]/u,shape:"subroutine"},{regex:/^([\p{L}\p{N}_-]+)\[\((.+?)\)\]/u,shape:"cylinder"},{regex:/^([\p{L}\p{N}_-]+)\[\/(.+?)\\\]/u,shape:"trapezoid"},{regex:/^([\p{L}\p{N}_-]+)\[\\(.+?)\/\]/u,shape:"trapezoid-alt"},{regex:/^([\p{L}\p{N}_-]+)>(.+?)\]/u,shape:"asymmetric"},{regex:/^([\p{L}\p{N}_-]+)\{\{(.+?)\}\}/u,shape:"hexagon"},{regex:/^([\p{L}\p{N}_-]+)\[(.+?)\]/u,shape:"rectangle"},{regex:/^([\p{L}\p{N}_-]+)\((.+?)\)/u,shape:"rounded"},{regex:/^([\p{L}\p{N}_-]+)\{(.+?)\}/u,shape:"diamond"}],On=/^([\p{L}\p{N}_-]+)/u,Ao=/^:::([\w][\w-]*)/;function Lo(t){let e=t.trim();return e.length>=2&&e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1).replaceAll('\\"','"'):t}function _o(t,e,r){let n=t.trim(),o=Dn(n,e,r);if(!o||o.ids.length===0)return;n=o.remaining.trim();let i=o.ids;for(;n.length>0;){let c=n.match(Rn);if(!c)break;let s=!!c[1],l=c[2],d=c[3]?.trim()||void 0;n=n.slice(c[0].length).trim();let h=Do(l),g=l.endsWith(">"),a=Dn(n,e,r);if(!a||a.ids.length===0)break;n=a.remaining.trim();for(let f of i)for(let p of a.ids)e.edges.push({source:f,target:p,label:d,style:h,hasArrowStart:s,hasArrowEnd:g});i=a.ids;}}function Dn(t,e,r){let n=In(t,e,r);if(!n)return null;let o=[n.id],i=n.remaining.trim();for(;i.startsWith("&");){i=i.slice(1).trim();let c=In(i,e,r);if(!c)break;o.push(c.id),i=c.remaining.trim();}return {ids:o,remaining:i}}function In(t,e,r){let n=null,o=t;for(let{regex:c,shape:s}of $o){let l=t.match(c);if(l){n=l[1];let d=Lo(l[2]);Pn(e,r,{id:n,label:d,shape:s}),o=t.slice(l[0].length);break}}if(n===null){let c=t.match(On);if(c){let s=c[1],l=To(t,s.length);n=t.slice(0,l),e.nodes.has(n)?Nn(r,n):Pn(e,r,{id:n,label:n,shape:"rectangle"}),o=t.slice(l);}}if(n===null)return null;let i=o.match(Ao);return i&&(e.classAssignments.set(n,i[1]),o=o.slice(i[0].length)),{id:n,remaining:o}}function To(t,e){for(let r=e;r>=1;r--){let n=t.slice(r),o=n.match(Rn);if(!o)continue;let i=n.slice(o[0].length).trimStart();if(i.length!==0&&On.test(i))return r}for(let r=e;r>=1;r--){let n=t.slice(r);if(n.length===0)return r;let o=n[0];if(/\s/.test(o)||o==="&"||n.startsWith(":::"))return r}return Math.max(1,e)}function Pn(t,e,r){!t.nodes.has(r.id)&&t.nodes.set(r.id,r),Nn(e,r.id);}function Nn(t,e){if(t.length>0){let r=t[t.length-1];r.nodeIds.includes(e)||r.nodeIds.push(e);}}function Do(t){return t==="-.->"||t==="-.-"?"dotted":t==="==>"||t==="==="?"thick":"solid"}var ft={x:1,y:0},st={x:1,y:2},ut={x:0,y:1},lt={x:2,y:1},kt={x:2,y:0},St={x:0,y:0},Lt={x:2,y:2},Et={x:0,y:2},Wt={x:1,y:1};function ue(t,e){return t.x===e.x&&t.y===e.y}function De(t,e){return t.x===e.x&&t.y===e.y}function Se(t,e){return {x:t.x+e.x,y:t.y+e.y}}function Ze(t){return `${t.x},${t.y}`}var Xn={name:"",styles:{}};function Io(t){return t>=768&&t<=879||t>=6832&&t<=6911||t>=7616&&t<=7679||t>=8400&&t<=8447||t>=65056&&t<=65071}function Po(t){return t>=4352&&t<=4447||t>=11904&&t<=42191||t>=44032&&t<=55203||t>=63744&&t<=64255||t>=65040&&t<=65049||t>=65072&&t<=65135||t>=65280&&t<=65376||t>=65504&&t<=65510||t>=127744&&t<=129791||t>=129280&&t<=129535}function he(t){let e=t.codePointAt(0);return e==null||e===0||e<32||e>=127&&e<160||Io(e)?0:Po(e)?2:1}function gt(t){let e=0;for(let r of t)e+=he(r);return e}function ve(t,e){if(e<=0)return "";let r=0,n="";for(let o of t){let i=he(o);if(r+i>e)break;n+=o,r+=i;}return n}function Mt(t,e){let r=[];for(let n=0;n<=t;n++){let o=[];for(let i=0;i<=e;i++)o.push(" ");r.push(o);}return r}function ne(t){let[e,r]=$t(t);return Mt(e,r)}function $t(t){return [t.length-1,(t[0]?.length??1)-1]}function Yt(t,e,r){let[n,o]=$t(t),i=Math.max(e,n),c=Math.max(r,o),s=Mt(i,c);for(let l=0;l<s.length;l++)for(let d=0;d<s[0].length;d++)l<t.length&&d<t[0].length&&(s[l][d]=t[l][d]);return t.length=0,t.push(...s),t}var Ro=new Set(["\u2500","\u2502","\u250C","\u2510","\u2514","\u2518","\u251C","\u2524","\u252C","\u2534","\u253C","\u2574","\u2575","\u2576","\u2577"]);function Bn(t){return Ro.has(t)}var Oo={"\u2500":{"\u2502":"\u253C","\u250C":"\u252C","\u2510":"\u252C","\u2514":"\u2534","\u2518":"\u2534","\u251C":"\u253C","\u2524":"\u253C","\u252C":"\u252C","\u2534":"\u2534"},"\u2502":{"\u2500":"\u253C","\u250C":"\u251C","\u2510":"\u2524","\u2514":"\u251C","\u2518":"\u2524","\u251C":"\u251C","\u2524":"\u2524","\u252C":"\u253C","\u2534":"\u253C"},"\u250C":{"\u2500":"\u252C","\u2502":"\u251C","\u2510":"\u252C","\u2514":"\u251C","\u2518":"\u253C","\u251C":"\u251C","\u2524":"\u253C","\u252C":"\u252C","\u2534":"\u253C"},"\u2510":{"\u2500":"\u252C","\u2502":"\u2524","\u250C":"\u252C","\u2514":"\u253C","\u2518":"\u2524","\u251C":"\u253C","\u2524":"\u2524","\u252C":"\u252C","\u2534":"\u253C"},"\u2514":{"\u2500":"\u2534","\u2502":"\u251C","\u250C":"\u251C","\u2510":"\u253C","\u2518":"\u2534","\u251C":"\u251C","\u2524":"\u253C","\u252C":"\u253C","\u2534":"\u2534"},"\u2518":{"\u2500":"\u2534","\u2502":"\u2524","\u250C":"\u253C","\u2510":"\u2524","\u2514":"\u2534","\u251C":"\u253C","\u2524":"\u2524","\u252C":"\u253C","\u2534":"\u2534"},"\u251C":{"\u2500":"\u253C","\u2502":"\u251C","\u250C":"\u251C","\u2510":"\u253C","\u2514":"\u251C","\u2518":"\u253C","\u2524":"\u253C","\u252C":"\u253C","\u2534":"\u253C"},"\u2524":{"\u2500":"\u253C","\u2502":"\u2524","\u250C":"\u253C","\u2510":"\u2524","\u2514":"\u253C","\u2518":"\u2524","\u251C":"\u253C","\u252C":"\u253C","\u2534":"\u253C"},"\u252C":{"\u2500":"\u252C","\u2502":"\u253C","\u250C":"\u252C","\u2510":"\u252C","\u2514":"\u253C","\u2518":"\u253C","\u251C":"\u253C","\u2524":"\u253C","\u2534":"\u253C"},"\u2534":{"\u2500":"\u2534","\u2502":"\u253C","\u250C":"\u253C","\u2510":"\u253C","\u2514":"\u2534","\u2518":"\u2534","\u251C":"\u253C","\u2524":"\u253C","\u252C":"\u253C"}};function No(t,e){return Oo[t]?.[e]??t}function Ut(t,e,r,...n){let[o,i]=$t(t);for(let s of n){let[l,d]=$t(s);o=Math.max(o,l+e.x),i=Math.max(i,d+e.y);}let c=Mt(o,i);for(let s=0;s<=o;s++)for(let l=0;l<=i;l++)s<t.length&&l<t[0].length&&(c[s][l]=t[s][l]);for(let s of n)for(let l=0;l<s.length;l++)for(let d=0;d<s[0].length;d++){let h=s[l][d];if(h!==" "){let g=l+e.x,a=d+e.y,f=c[g][a];!r&&Bn(h)&&Bn(f)?c[g][a]=No(f,h):c[g][a]=h;}}return c}function Gn(t){return t==="\u2500"||t==="\u253C"||t==="\u252C"||t==="\u2534"||t==="\u2524"||t==="\u2510"||t==="\u2518"}function Yn(t){return t==="\u2500"||t==="\u253C"||t==="\u252C"||t==="\u2534"||t==="\u251C"||t==="\u250C"||t==="\u2514"}function Fn(t){return t==="\u2502"||t==="\u253C"||t==="\u251C"||t==="\u2524"||t==="\u2534"||t==="\u2514"||t==="\u2518"}function Hn(t){return t==="\u2502"||t==="\u253C"||t==="\u251C"||t==="\u2524"||t==="\u252C"||t==="\u250C"||t==="\u2510"}function Wn(t,e){let[r,n]=$t(t),o=1,i=2,c=4,s=8,l=o|i|c|s;function d(h){return h===l?null:h===(o|i)?"\u2500":h===(c|s)?"\u2502":h===(c|i)?"\u2514":h===(c|o)?"\u2518":h===(s|i)?"\u250C":h===(s|o)?"\u2510":h===(c|o|i)?"\u2534":h===(s|o|i)?"\u252C":h===(c|s|o)?"\u2524":h===(c|s|i)?"\u251C":null}for(let h=0;h<=r;h++)for(let g=0;g<=n;g++){if(t[h][g]!=="\u253C")continue;let a=h>0?t[h-1][g]:" ",f=h<r?t[h+1][g]:" ",p=g>0?t[h][g-1]:" ",x=g<n?t[h][g+1]:" ",m=(Yn(a)?1:0)+(Gn(f)?1:0),u=(Hn(p)?1:0)+(Fn(x)?1:0);if(e&&e.size>0){let b=`${h},${g}`,y=e.get(b)??0;if(y!==0){let M=Yn(a),A=Gn(f),w=Hn(p),$=Fn(x),k=(M?o:0)|(A?i:0)|(w?c:0)|($?s:0),I=u>m,X=I?c|s:o|i,N=k&X|y;N===l&&(I?(y&o)===0?N&=~o:(y&i)===0&&(N&=~i):(y&c)===0?N&=~c:(y&s)===0&&(N&=~s));let Y=d(N);if(Y){t[h][g]=Y;continue}}}t[h][g]=u>m?"\u2502":"\u2500";}}function jt(t){let[e,r]=$t(t),n=[];for(let o=0;o<=r;o++){let i="";for(let c=0;c<=e;c++){let s=t[c][o];i+=s,he(s)===2&&(c+=1);}n.push(i);}return n.join(`
`)}var Xo={"\u25B2":"\u25BC","\u25BC":"\u25B2","\u25E4":"\u25E3","\u25E3":"\u25E4","\u25E5":"\u25E2","\u25E2":"\u25E5","^":"v",v:"^","\u250C":"\u2514","\u2514":"\u250C","\u2510":"\u2518","\u2518":"\u2510","\u252C":"\u2534","\u2534":"\u252C","\u2575":"\u2577","\u2577":"\u2575"};function Un(t){for(let e of t)e.reverse();for(let e of t)for(let r=0;r<e.length;r++){let n=Xo[e[r]];n&&(e[r]=n);}return t}function yt(t,e,r){Yt(t,e.x+gt(r),e.y);let n=e.x;for(let o of r)t[n][e.y]=o,n+=he(o);}function jn(t,e,r){let n=0,o=0;for(let i of e.values())n+=i;for(let i of r.values())o+=i;Yt(t,n-1,o-1);}function zn(t,e){let r=new Map,n=0;for(let[s,l]of t.nodes){let d={name:s,displayLabel:l.label,index:n,gridCoord:null,drawingCoord:null,drawing:null,drawn:false,styleClassName:"",styleClass:Xn};r.set(s,d),n++;}let o=[...r.values()],i=[];for(let s of t.edges){let l=r.get(s.source),d=r.get(s.target);!l||!d||i.push({from:l,to:d,text:s.label??"",path:[],labelLine:[],startDir:{x:0,y:0},endDir:{x:0,y:0}});}let c=[];for(let s of t.subgraphs)Vn(s,null,r,c);Bo(t.subgraphs,c,r);for(let[s,l]of t.classAssignments){let d=r.get(s),h=t.classDefs.get(l);d&&h&&(d.styleClassName=l,d.styleClass={name:l,styles:h});}return {nodes:o,edges:i,canvas:Mt(0,0),grid:new Map,columnWidth:new Map,rowHeight:new Map,subgraphs:c,config:e,offsetX:0,offsetY:0}}function Vn(t,e,r,n){let o={name:t.label,nodes:[],parent:e,children:[],minX:0,minY:0,maxX:0,maxY:0};for(let i of t.nodeIds){let c=r.get(i);c&&o.nodes.push(c);}n.push(o);for(let i of t.children){let c=Vn(i,o,r,n);o.children.push(c);for(let s of c.nodes)o.nodes.includes(s)||o.nodes.push(s);}return o}function Bo(t,e,r,n){let o=new Map;Yo(t,e,o);let i=new Map;function c(s){let l=o.get(s);if(l){for(let d of s.children)c(d);for(let d of s.nodeIds)i.has(d)||i.set(d,l);}}for(let s of t)c(s);for(let s of e)s.nodes=s.nodes.filter(l=>{let d;for(let[g,a]of r)if(a===l){d=g;break}if(!d)return  false;let h=i.get(d);return h?Go(s,h):true});}function Go(t,e){let r=e;for(;r!==null;){if(r===t)return  true;r=r.parent;}return  false}function Yo(t,e,r){let n=[];function o(i){for(let c of i)n.push(c),o(c.children);}o(t);for(let i=0;i<n.length&&i<e.length;i++)r.set(n[i],e[i]);}var Qe=class{idxs=[];priorities=[];costs=[];poppedIdx=-1;poppedPriority=0;poppedCost=0;get length(){return this.idxs.length}clear(){this.idxs.length=0,this.priorities.length=0,this.costs.length=0,this.poppedIdx=-1,this.poppedPriority=0,this.poppedCost=0;}push(e,r,n){this.idxs.push(e),this.priorities.push(r),this.costs.push(n),this.bubbleUp(this.idxs.length-1);}pop(){if(this.idxs.length===0)return  false;this.poppedIdx=this.idxs[0],this.poppedPriority=this.priorities[0],this.poppedCost=this.costs[0];let e=this.idxs.pop(),r=this.priorities.pop(),n=this.costs.pop();return this.idxs.length>0&&(this.idxs[0]=e,this.priorities[0]=r,this.costs[0]=n,this.sinkDown(0)),true}bubbleUp(e){for(;e>0;){let r=e-1>>1;if(this.priorities[e]<this.priorities[r])[this.idxs[e],this.idxs[r]]=[this.idxs[r],this.idxs[e]],[this.priorities[e],this.priorities[r]]=[this.priorities[r],this.priorities[e]],[this.costs[e],this.costs[r]]=[this.costs[r],this.costs[e]],e=r;else break}}sinkDown(e){let r=this.idxs.length;for(;;){let n=e,o=2*e+1,i=2*e+2;if(o<r&&this.priorities[o]<this.priorities[n]&&(n=o),i<r&&this.priorities[i]<this.priorities[n]&&(n=i),n!==e)[this.idxs[e],this.idxs[n]]=[this.idxs[n],this.idxs[e]],[this.priorities[e],this.priorities[n]]=[this.priorities[n],this.priorities[e]],[this.costs[e],this.costs[n]]=[this.costs[n],this.costs[e]],e=n;else break}}};function Kn(t,e){let r=t*e;return {stride:t,height:e,blocked:new Uint8Array(r),stamp:0,costStamp:new Uint32Array(r),costSoFar:new Float64Array(r),cameFrom:new Int32Array(r),heap:new Qe}}function ae(t,e){return e.x+e.y*t}function qn(t,e){let r=e/t|0;return {x:e-r*t,y:r}}function Ft(t,e){if(t.length<=2)return t.length;let r=0,n=t[1]-t[0];for(let o=2;o<t.length;o++){let i=t[o]-t[o-1];i!==n&&(r++,n=i);}return 2+r}function Jn(t,e){if(t.length<=2)return t;let r=[t[0]],n=t[1]-t[0];for(let o=2;o<t.length;o++){let i=t[o]-t[o-1];i!==n&&(r.push(t[o-1]),n=i);}return r.push(t[t.length-1]),r}function Zn(t,e,r,n){let o=globalThis.__bm_getPath;if(typeof o=="function")return o(t.stride,e,r,n.maxX,n.maxY,t.blocked);let{stride:i}=t,c=n.maxX,s=n.maxY;if(c<0||s<0)return null;let l=r/i|0,d=r-l*i;t.stamp=t.stamp+1>>>0,t.stamp===0&&(t.stamp=1);let h=t.stamp;for(t.heap.clear(),t.costStamp[e]=h,t.costSoFar[e]=0,t.cameFrom[e]=-1,t.heap.push(e,0,0);t.heap.pop();){let g=t.heap.poppedIdx,a=t.heap.poppedCost;if(t.costStamp[g]!==h||a!==t.costSoFar[g])continue;if(g===r){let m=[],u=g;for(;u!==-1;)m.push(u),u=t.cameFrom[u];return m.reverse(),m}let f=t.costSoFar[g],p=g/i|0,x=g-p*i;if(x<c){let m=g+1;if(!t.blocked[m]||m===r){let u=f+1;if(t.costStamp[m]!==h||u<t.costSoFar[m]){t.costStamp[m]=h,t.costSoFar[m]=u,t.cameFrom[m]=g;let b=x+1>=d?x+1-d:d-(x+1),y=p>=l?p-l:l-p,M=b===0||y===0?b+y:b+y+1;t.heap.push(m,u+M,u);}}}if(x>0){let m=g-1;if(!t.blocked[m]||m===r){let u=f+1;if(t.costStamp[m]!==h||u<t.costSoFar[m]){t.costStamp[m]=h,t.costSoFar[m]=u,t.cameFrom[m]=g;let b=x-1>=d?x-1-d:d-(x-1),y=p>=l?p-l:l-p,M=b===0||y===0?b+y:b+y+1;t.heap.push(m,u+M,u);}}}if(p<s){let m=g+i;if(!t.blocked[m]||m===r){let u=f+1;if(t.costStamp[m]!==h||u<t.costSoFar[m]){t.costStamp[m]=h,t.costSoFar[m]=u,t.cameFrom[m]=g;let b=x>=d?x-d:d-x,y=p+1>=l?p+1-l:l-(p+1),M=b===0||y===0?b+y:b+y+1;t.heap.push(m,u+M,u);}}}if(p>0){let m=g-i;if(!t.blocked[m]||m===r){let u=f+1;if(t.costStamp[m]!==h||u<t.costSoFar[m]){t.costStamp[m]=h,t.costSoFar[m]=u,t.cameFrom[m]=g;let b=x>=d?x-d:d-x,y=p-1>=l?p-1-l:l-(p-1),M=b===0||y===0?b+y:b+y+1;t.heap.push(m,u+M,u);}}}}return null}var re=1,oe=2,ie=4,se=8;function Qn(t,e,r,n,o){let i=globalThis.__bm_getPathStrict;if(typeof i=="function")return i(t.stride,e,r,n.maxX,n.maxY,t.blocked,o);let c=t.stride,s=n.maxX,l=n.maxY;if(s<0||l<0)return null;let d=r/c|0,h=r-d*c;t.stamp=t.stamp+1>>>0,t.stamp===0&&(t.stamp=1);let g=t.stamp,a=t.heap,f=t.blocked,p=t.costStamp,x=t.costSoFar,m=t.cameFrom;a.clear(),p[e]=g,x[e]=0,m[e]=-1,a.push(e,0,0);let u=o.usedPoints,b=o.segmentUsage,y=b.segmentUsed,M=b.usedAsMiddle;b.segmentPair;b.segmentPairMulti;let $=b.startSource,k=b.startSourceMulti,I=b.endTarget,X=b.endTargetMulti,N=o.routeFromIdx,Y=o.routeToIdx,q=o.edgeFromId,_=o.edgeToId,F=re|oe,D=ie|se;for(;a.pop();){let S=a.poppedIdx,v=a.poppedCost;if(p[S]!==g||v!==x[S])continue;if(S===r){let P=[],T=S;for(;T!==-1;)P.push(T),T=m[T];return P.reverse(),P}let z=x[S],j=S/c|0,L=S-j*c;if(L<s){let P=S+1;if(!f[P]||P===r){let T=true;if(u){let G=u[S];if(G!==0){let H=G|oe;(H&F)===F&&(H&D)===D&&(T=false);}if(T){let H=u[P];if(H!==0){let V=H|re;(V&F)===F&&(V&D)===D&&(T=false);}}}if(T){let G=S*2;if(y[G]&&(T=false,!M[G])){let H=S===N,V=P===Y,B=$[G],O=I[G],C=k[G]!==0,E=X[G]!==0;H&&V?T=!C&&(B===0||B===q)&&(!E&&(O===0||O===_)):H?T=!E&&O===0&&!C&&B===q:V&&(T=!C&&B===0&&!E&&O===_);}}if(T){let G=z+1;if(p[P]!==g||G<x[P]){p[P]=g,x[P]=G,m[P]=S;let H=L+1,V=H>=h?H-h:h-H,B=j>=d?j-d:d-j,O=V===0||B===0?V+B:V+B+1;a.push(P,G+O,G);}}}}if(L>0){let P=S-1;if(!f[P]||P===r){let T=true;if(u){let G=u[S];if(G!==0){let H=G|re;(H&F)===F&&(H&D)===D&&(T=false);}if(T){let H=u[P];if(H!==0){let V=H|oe;(V&F)===F&&(V&D)===D&&(T=false);}}}if(T){let G=P*2;if(y[G]&&(T=false,!M[G])){let H=S===N,V=P===Y,B=$[G],O=I[G],C=k[G]!==0,E=X[G]!==0;H&&V?T=!C&&(B===0||B===q)&&(!E&&(O===0||O===_)):H?T=!E&&O===0&&!C&&B===q:V&&(T=!C&&B===0&&!E&&O===_);}}if(T){let G=z+1;if(p[P]!==g||G<x[P]){p[P]=g,x[P]=G,m[P]=S;let H=L-1,V=H>=h?H-h:h-H,B=j>=d?j-d:d-j,O=V===0||B===0?V+B:V+B+1;a.push(P,G+O,G);}}}}if(j<l){let P=S+c;if(!f[P]||P===r){let T=true;if(u){let G=u[S];if(G!==0){let H=G|se;(H&F)===F&&(H&D)===D&&(T=false);}if(T){let H=u[P];if(H!==0){let V=H|ie;(V&F)===F&&(V&D)===D&&(T=false);}}}if(T){let G=S*2+1;if(y[G]&&(T=false,!M[G])){let H=S===N,V=P===Y,B=$[G],O=I[G],C=k[G]!==0,E=X[G]!==0;H&&V?T=!C&&(B===0||B===q)&&(!E&&(O===0||O===_)):H?T=!E&&O===0&&!C&&B===q:V&&(T=!C&&B===0&&!E&&O===_);}}if(T){let G=z+1;if(p[P]!==g||G<x[P]){p[P]=g,x[P]=G,m[P]=S;let H=j+1,V=L>=h?L-h:h-L,B=H>=d?H-d:d-H,O=V===0||B===0?V+B:V+B+1;a.push(P,G+O,G);}}}}if(j>0){let P=S-c;if(!f[P]||P===r){let T=true;if(u){let G=u[S];if(G!==0){let H=G|ie;(H&F)===F&&(H&D)===D&&(T=false);}if(T){let H=u[P];if(H!==0){let V=H|se;(V&F)===F&&(V&D)===D&&(T=false);}}}if(T){let G=P*2+1;if(y[G]&&(T=false,!M[G])){let H=S===N,V=P===Y,B=$[G],O=I[G],C=k[G]!==0,E=X[G]!==0;H&&V?T=!C&&(B===0||B===q)&&(!E&&(O===0||O===_)):H?T=!E&&O===0&&!C&&B===q:V&&(T=!C&&B===0&&!E&&O===_);}}if(T){let G=z+1;if(p[P]!==g||G<x[P]){p[P]=g,x[P]=G,m[P]=S;let H=j-1,V=L>=h?L-h:h-L,B=H>=d?H-d:d-H,O=V===0||B===0?V+B:V+B+1;a.push(P,G+O,G);}}}}}return null}var Fo=1;function tr(t,e,r,n,o){let i=globalThis.__bm_getPathRelaxed;if(typeof i=="function")return i(t.stride,e,r,n.maxX,n.maxY,t.blocked,o);let c=t.stride,s=n.maxX,l=n.maxY;if(s<0||l<0)return null;let d=r/c|0,h=r-d*c;t.stamp=t.stamp+1>>>0,t.stamp===0&&(t.stamp=1);let g=t.stamp,a=t.heap,f=t.blocked,p=t.costStamp,x=t.costSoFar,m=t.cameFrom;a.clear(),p[e]=g,x[e]=0,m[e]=-1,a.push(e,0,0);let u=o.usedPoints,b=o.segmentUsage,y=b.segmentUsed,M=b.usedAsMiddle,A=b.segmentPair,w=b.segmentPairMulti,$=b.startSource,k=b.startSourceMulti,I=b.endTarget,X=b.endTargetMulti,N=o.routeFromIdx,Y=o.routeToIdx,q=o.edgeFromId,_=o.edgeToId,F=o.relaxedAllowEndSegmentReuse===true,D=q>65535||_>65535?0:q<<16|_;function S(T){return D!==0&&w[T]===0&&A[T]===D}let v=re|oe,z=ie|se,j=[0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,4];function L(T,G){if(T===0)return 0;let H=T|G;return (H&v)===v&&(H&z)===z?Fo:0}function P(T,G,H){if(!y[T]||S(T))return  true;if(M[T]||H&&!F)return  false;let V=$[T],B=I[T],O=k[T]!==0,C=X[T]!==0;return G&&H?!O&&(V===0||V===q)&&(!C&&(B===0||B===_)):G?!C&&B===0&&!O&&V===q:H?!O&&V===0&&!C&&B===_:false}for(;a.pop();){let T=a.poppedIdx,G=a.poppedCost;if(p[T]!==g||G!==x[T])continue;if(T===r){let O=[],C=T;for(;C!==-1;)O.push(C),C=m[C];return O.reverse(),{path:O,cost:x[T]}}let H=x[T],V=T/c|0,B=T-V*c;if(B<s){let O=T+1;if(!f[O]||O===r){let C=0,E=true,R=T*2;if(u&&(C+=L(u[T],oe),C+=L(u[O],re),O!==r)){let W=u[O];if(W!==0){let J=Y-O,et=J===1||J===-1||J===c||J===-c,rt=(W|re)&15,dt=j[rt];S(R)&&dt<=2||(T!==N&&!et?E=false:T===N?dt>=3&&(E=false):dt>=4&&(E=false));}}if(E&&P(R,T===N,O===Y)){let W=H+1+C;if(p[O]!==g||W<x[O]){p[O]=g,x[O]=W,m[O]=T;let J=B+1,et=J>=h?J-h:h-J,rt=V>=d?V-d:d-V,dt=et===0||rt===0?et+rt:et+rt+1;a.push(O,W+dt,W);}}}}if(B>0){let O=T-1;if(!f[O]||O===r){let C=0,E=true,R=O*2;if(u&&(C+=L(u[T],re),C+=L(u[O],oe),O!==r)){let W=u[O];if(W!==0){let J=Y-O,et=J===1||J===-1||J===c||J===-c,rt=(W|oe)&15,dt=j[rt];S(R)&&dt<=2||(T!==N&&!et?E=false:T===N?dt>=3&&(E=false):dt>=4&&(E=false));}}if(E&&P(R,T===N,O===Y)){let W=H+1+C;if(p[O]!==g||W<x[O]){p[O]=g,x[O]=W,m[O]=T;let J=B-1,et=J>=h?J-h:h-J,rt=V>=d?V-d:d-V,dt=et===0||rt===0?et+rt:et+rt+1;a.push(O,W+dt,W);}}}}if(V<l){let O=T+c;if(!f[O]||O===r){let C=0,E=true,R=T*2+1;if(u&&(C+=L(u[T],se),C+=L(u[O],ie),O!==r)){let W=u[O];if(W!==0){let J=Y-O,et=J===1||J===-1||J===c||J===-c,rt=(W|ie)&15,dt=j[rt];S(R)&&dt<=2||(T!==N&&!et?E=false:T===N?dt>=3&&(E=false):dt>=4&&(E=false));}}if(E&&P(R,T===N,O===Y)){let W=H+1+C;if(p[O]!==g||W<x[O]){p[O]=g,x[O]=W,m[O]=T;let J=V+1,et=B>=h?B-h:h-B,rt=J>=d?J-d:d-J,dt=et===0||rt===0?et+rt:et+rt+1;a.push(O,W+dt,W);}}}}if(V>0){let O=T-c;if(!f[O]||O===r){let C=0,E=true,R=O*2+1;if(u&&(C+=L(u[T],ie),C+=L(u[O],se),O!==r)){let W=u[O];if(W!==0){let J=Y-O,et=J===1||J===-1||J===c||J===-c,rt=(W|se)&15,dt=j[rt];S(R)&&dt<=2||(T!==N&&!et?E=false:T===N?dt>=3&&(E=false):dt>=4&&(E=false));}}if(E&&P(R,T===N,O===Y)){let W=H+1+C;if(p[O]!==g||W<x[O]){p[O]=g,x[O]=W,m[O]=T;let J=V-1,et=B>=h?B-h:h-B,rt=J>=d?J-d:d-J,dt=et===0||rt===0?et+rt:et+rt+1;a.push(O,W+dt,W);}}}}}return null}function tn(t){if(t.length<=2)return t;let e=new Set,r=t[0],n=t[1];for(let o=2;o<t.length;o++){let i=t[o],c=n.x-r.x,s=n.y-r.y,l=i.x-n.x,d=i.y-n.y;c===l&&s===d&&e.add(o-1),r=n,n=i;}return t.filter((o,i)=>!e.has(i))}var Dt=[12,24,48],Nt=[12,24,48,96,192,384],Pe=Nt[Nt.length-1];function Ie(t){return t===ft?st:t===st?ft:t===ut?lt:t===lt?ut:t===kt?Et:t===St?Lt:t===Lt?St:t===Et?kt:Wt}function U(t,e){return t.x===e.x&&t.y===e.y}function _t(t,e){return t.x===e.x?t.y<e.y?st:ft:t.y===e.y?t.x<e.x?lt:ut:t.x<e.x?t.y<e.y?Lt:kt:t.y<e.y?Et:St}function Ho(t){return t==="LR"?[lt,st,st,lt]:[st,lt,lt,st]}function Wo(t,e,r){if(t.from===t.to)return Ho(e);let n=_t(t.from.gridCoord,t.to.gridCoord),o,i,c,s,l=e==="LR"?U(n,ut)||U(n,St)||U(n,Et):U(n,ft)||U(n,St)||U(n,kt);if(U(n,Lt)?e==="LR"?(o=st,i=ut,c=lt,s=ft):(o=lt,i=ft,c=st,s=ut):U(n,kt)?e==="LR"?(o=ft,i=ut,c=lt,s=st):(o=lt,i=st,c=ft,s=ut):U(n,Et)?e==="LR"?(o=st,i=st,c=ut,s=ft):(o=ut,i=ft,c=st,s=lt):U(n,St)?e==="LR"?(o=st,i=st,c=ut,s=st):(o=lt,i=lt,c=ft,s=lt):l?e==="LR"&&U(n,ut)?(o=st,i=st,c=ut,s=lt):e==="TD"&&U(n,ft)?(o=lt,i=lt,c=ft,s=st):(o=n,i=Ie(n),c=n,s=Ie(n)):(o=n,i=Ie(n),c=n,s=Ie(n)),r==="relaxed"){let f=t.from.gridCoord,p=t.to.gridCoord;if(f&&p){let u=function(A){return U(A,ut)?lt:U(A,lt)?ut:U(A,St)?kt:U(A,kt)?St:U(A,Et)?Lt:U(A,Lt)?Et:A},b=function(A){return U(A,ft)?st:U(A,st)?ft:U(A,St)?Et:U(A,kt)?Lt:U(A,Et)?St:U(A,Lt)?kt:A},y=function(A){let w=A,$=Math.sign(w.x-1),k=Math.sign(w.y-1);return (x<0&&$===1||x>0&&$===-1)&&(w=u(w)),(m<0&&k===1||m>0&&k===-1)&&(w=b(w)),w},M=function(A){let w=A,$=Math.sign(w.x-1),k=Math.sign(w.y-1);return (x<0&&$===-1||x>0&&$===1)&&(w=u(w)),(m<0&&k===-1||m>0&&k===1)&&(w=b(w)),w};let x=p.x-f.x,m=p.y-f.y;o=y(o),c=y(c),i=M(i),s=M(s);}}return [o,i,c,s]}function sr(t){let e=t*2;return {segmentUsed:new Uint8Array(e),usedAsMiddle:new Uint8Array(e),segmentPair:new Uint32Array(e),segmentPairMulti:new Uint8Array(e),startSource:new Uint32Array(e),startSourceMulti:new Uint8Array(e),endTarget:new Uint32Array(e),endTargetMulti:new Uint8Array(e),usedCount:0}}var en=1,nn=2,rn=4,on=8;function ar(t,e){let r=e-t,n=r===1||r===-1;return (t<e?t:e)*2+(n?0:1)}function er(t,e,r){if(r.length<2)return;let n=e.from.index+1,o=e.to.index+1,i=n>65535||o>65535?0:n<<16|o;for(let c=1;c<r.length;c++){let s=r[c-1],l=r[c],d=ar(s,l),h=c===1,g=c===r.length-1;if(t.segmentUsed[d]||(t.segmentUsed[d]=1,t.usedCount++),i!==0){let a=t.segmentPair[d];a===0?t.segmentPair[d]=i:a!==i&&(t.segmentPairMulti[d]=1);}if(h){let a=t.startSource[d];a===0?t.startSource[d]=n:a!==n&&(t.startSourceMulti[d]=1);}if(g){let a=t.endTarget[d];a===0?t.endTarget[d]=o:a!==o&&(t.endTargetMulti[d]=1);}!h&&!g&&(t.usedAsMiddle[d]=1);}}function cr(t,e,r){let n=e-t;return n===1?{fromBit:nn,toBit:en}:n===-1?{fromBit:en,toBit:nn}:n===r?{fromBit:on,toBit:rn}:n===-r?{fromBit:rn,toBit:on}:null}function nr(t,e,r){if(r.length<2)return;let n=e.stride;for(let o=1;o<r.length;o++){let i=r[o-1],c=r[o],s=cr(i,c,n);s&&(e.blocked[i]||(t[i]=t[i]|s.fromBit),e.blocked[c]||(t[c]=t[c]|s.toBit));}}function rr(t,e){let r=t|e,n=(r&en)!==0&&(r&nn)!==0,o=(r&rn)!==0&&(r&on)!==0;return n&&o}function Uo(t,e,r,n){if(!e)return  true;let o=cr(r,n,t.stride);if(!o)return  true;if(!t.blocked[r]){let i=e[r];if(i!==0&&rr(i,o.fromBit))return  false}if(!t.blocked[n]){let i=e[n];if(i!==0&&rr(i,o.toBit))return  false}return  true}function jo(t,e,r,n,o,i,c,s){if(t.usedAsMiddle[s])return  false;let l=i===n,d=c===o,h=t.startSource[s],g=t.endTarget[s],a=t.startSourceMulti[s]!==0,f=t.endTargetMulti[s]!==0;return l&&d?!a&&(h===0||h===e)&&(!f&&(g===0||g===r)):l?!f&&g===0&&!a&&h===e:d?!a&&h===0&&!f&&g===r:false}function an(t,e,r,n,o,i,c,s=false){e.__bm_used_unconstrained_fallback=false;let l=e.from===e.to,d=t.config.routing,[h,g,a,f]=Wo(e,t.config.graphDirection,d);function p(K){let Z=[];for(let Q of K)Z.some(nt=>U(nt,Q))||Z.push(Q);return Z}function x(K,Z){let Q=[];for(let nt of K)for(let it of Z){let ct=Se(e.from.gridCoord,nt),tt=Se(e.to.gridCoord,it);ue(ct,tt)||Q.push({startDir:nt,endDir:it,routeFrom:ct,routeTo:tt,routeFromIdx:ae(r.stride,ct),routeToIdx:ae(r.stride,tt)});}return Q}function m(K){return U(K,ft)||U(K,st)||U(K,ut)||U(K,lt)?0:d==="relaxed"?10:100}function u(K){return K.x===0||K.y===0?200:0}let b=6;function y(K,Z){if(d!=="relaxed"||!t.portUsage||!t.config.useAscii)return 0;let Q=Z.x+Z.y*3,nt=K.index*9+Q;return (t.portUsage[nt]??0)*b}function M(K,Z){return Ft(Z,r.stride)+m(K.startDir)+m(K.endDir)+u(K.routeFrom)+u(K.routeTo)}function A(K){if(!e.from.gridCoord||!e.to.gridCoord||K.length<8)return 0;let Z=r.stride,Q=Number.POSITIVE_INFINITY,nt=Number.NEGATIVE_INFINITY,it=Number.POSITIVE_INFINITY,ct=Number.NEGATIVE_INFINITY;for(let An of K){let _e=An%Z,Te=An/Z|0;_e<Q&&(Q=_e),_e>nt&&(nt=_e),Te<it&&(it=Te),Te>ct&&(ct=Te);}let tt=e.from.gridCoord,ot=e.to.gridCoord,ht=Math.min(tt.x,ot.x),bt=Math.max(tt.x,ot.x)+2,At=Math.min(tt.y,ot.y),Pt=Math.max(tt.y,ot.y)+2,Tt=2,Ht=Math.max(0,ht-Q-Tt),It=Math.max(0,nt-bt-Tt),Ot=Math.max(0,At-it-Tt),Kt=Math.max(0,ct-Pt-Tt),Bt=Ht+It+Ot+Kt,Ve=Math.abs(ot.x-tt.x),Le=Math.abs(ot.y-tt.y)>=Ve+2,$n=Le?8:12;if(Bt<=$n)return 0;let xo=Le?10:4;return (Bt-$n)*xo}let w=(()=>{let K=sn(t,e.from),Z=sn(t,e.to);if(!K||!Z)return null;let Q=0;Z.minX>K.maxX?Q=Z.minX-K.maxX:Z.maxX<K.minX&&(Q=Z.maxX-K.minX);let nt=0;if(Z.minY>K.maxY?nt=Z.minY-K.maxY:Z.maxY<K.minY&&(nt=Z.maxY-K.minY),Q===0&&nt===0){let it=Math.floor((K.minX+K.maxX)/2),ct=Math.floor((K.minY+K.maxY)/2),tt=Math.floor((Z.minX+Z.maxX)/2),ot=Math.floor((Z.minY+Z.maxY)/2);return {dx:tt-it,dy:ot-ct}}return {dx:Q,dy:nt}})();function $(K){if(!w)return 0;let Z=w.dx,Q=w.dy;if(Z===0&&Q===0)return 0;let nt=Z===0?0:Z>0?1:-1,it=Q===0?0:Q>0?1:-1,ct=Math.sign(K.startDir.x-1),tt=Math.sign(K.startDir.y-1),ot=Math.sign(K.endDir.x-1),ht=Math.sign(K.endDir.y-1),bt=5e3,At=0;nt!==0&&ct!==0&&ct===-nt&&(At+=bt),it!==0&&tt!==0&&tt===-it&&(At+=bt),nt!==0&&ot!==0&&ot===nt&&(At+=bt),it!==0&&ht!==0&&ht===it&&(At+=bt);let Pt=Math.abs(Z),Tt=Math.abs(Q),Ht=2,It=120;return Pt>=Tt+Ht?(ct===0&&tt!==0&&(At+=It),ot===0&&ht!==0&&(At+=It)):Tt>=Pt+Ht&&(tt===0&&ct!==0&&(At+=It),ht===0&&ot!==0&&(At+=It)),At}function k(K,Z){return Z.cost+Ft(Z.path,r.stride)+A(Z.path)+$(K)+m(K.startDir)+m(K.endDir)+u(K.routeFrom)+u(K.routeTo)+y(e.from,K.startDir)+y(e.to,K.endDir)}let I=p([h,a]),X=p([g,f]),N=[];function Y(K,Z){if(N.some(it=>U(it.startDir,K)&&U(it.endDir,Z)))return;let Q=Se(e.from.gridCoord,K),nt=Se(e.to.gridCoord,Z);ue(Q,nt)||N.push({startDir:K,endDir:Z,routeFrom:Q,routeTo:nt,routeFromIdx:ae(r.stride,Q),routeToIdx:ae(r.stride,nt)});}if(Y(h,g),Y(a,f),d==="relaxed"&&I.length>1&&X.length>1)for(let K of I)for(let Z of X)Y(K,Z);function q(K){return U(K,ft)?{x:0,y:-1}:U(K,st)?{x:0,y:1}:U(K,ut)?{x:-1,y:0}:U(K,lt)?{x:1,y:0}:null}function _(K,Z){let Q=K[K.length-1];if(Q.x===Z.x){let nt=Z.y>Q.y?1:-1;for(let it=Q.y+nt;it!==Z.y+nt;it+=nt)K.push({x:Q.x,y:it});return}if(Q.y===Z.y){let nt=Z.x>Q.x?1:-1;for(let it=Q.x+nt;it!==Z.x+nt;it+=nt)K.push({x:it,y:Q.y});return}throw new Error(`appendStraightLine expects straight line, got from=(${Q.x},${Q.y}) to=(${Z.x},${Z.y})`)}function F(K,Z){if(Z.length<4)return  false;let Q=[];for(let nt=0;nt<Z.length;nt++){let it=Z[nt];if(it.x<0||it.y<0||it.x>=r.stride||it.y>=r.height||(Q.push(ae(r.stride,it)),!(ue(it,K.routeFrom)||ue(it,K.routeTo))&&r.blocked[Q[Q.length-1]]))return  false}for(let nt=1;nt<Q.length;nt++){let it=Q[nt-1],ct=Q[nt];if(!Uo(r,c,it,ct))return  false;if(i){let tt=ar(it,ct);if(i.segmentUsed[tt]&&!jo(i,e.from.index+1,e.to.index+1,K.routeFromIdx,K.routeToIdx,it,ct,tt))return  false}}return  true}function D(K,Z){let Q=q(K.startDir),nt=q(K.endDir);if(!Q||!nt||Z<1)return null;let it={x:K.routeFrom.x+Q.x*Z,y:K.routeFrom.y+Q.y*Z},ct={x:K.routeTo.x+nt.x*Z,y:K.routeTo.y+nt.y*Z},tt=[{x:it.x,y:ct.y},{x:ct.x,y:it.y}];for(let ot of tt){let ht=[K.routeFrom];_(ht,it),_(ht,ot),_(ht,ct),_(ht,K.routeTo);let bt=ht.filter((At,Pt)=>Pt===0||!ue(At,ht[Pt-1]));if(F(K,bt)&&tn(bt).length>=4)return bt}return null}if(l){let K=N.length>0?N:L;for(let Z of K)for(let Q=1;Q<=12;Q++){let nt=D(Z,Q);if(!nt)continue;e.startDir=Z.startDir,e.endDir=Z.endDir,e.path=tn(nt);let it=nt.map(ct=>ae(r.stride,ct));if(i&&er(i,e,it),c&&nr(c,r,it),d==="relaxed"&&t.portUsage){let ct=e.startDir.x+e.startDir.y*3,tt=e.endDir.x+e.endDir.y*3;t.portUsage[e.from.index*9+ct]=(t.portUsage[e.from.index*9+ct]??0)+1,t.portUsage[e.to.index*9+tt]=(t.portUsage[e.to.index*9+tt]??0)+1;}return}}let S=d==="relaxed"&&t.config.useAscii,v=[kt,St,Lt,Et],z=p([h,a,lt,ut,st,ft,...S?[kt,St,Lt,Et]:[]]),j=p([g,f,lt,ut,st,ft,...S?[kt,St,Lt,Et]:[]]),L=x(z,X),P=x(z,j),T=p([...z,...v]),G=p([...j,...v]),H=x(z,G),V=x(T,G);function B(K){return {maxX:Math.min(r.stride-1,n+K),maxY:Math.min(r.height-1,o+K)}}function O(K,Z=Nt){for(let Q of Z){let nt=B(Q),it=null;for(let ct of K){let tt=Zn(r,ct.routeFromIdx,ct.routeToIdx,nt);if(!tt||l&&Ft(tt,r.stride)<4)continue;let ot=M(ct,tt);(!it||ot<it.cost)&&(it={candidate:ct,pathIdx:tt,cost:ot});}if(it)return it}return null}function C(K,Z){if(!i||i.usedCount===0)return null;let Q={segmentUsage:i,usedPoints:c,routeFromIdx:0,routeToIdx:0,edgeFromId:e.from.index+1,edgeToId:e.to.index+1};for(let nt of Z){let it=B(nt),ct=null;for(let tt of K){Q.routeFromIdx=tt.routeFromIdx,Q.routeToIdx=tt.routeToIdx;let ot=Qn(r,tt.routeFromIdx,tt.routeToIdx,it,Q);if(!ot||l&&Ft(ot,r.stride)<4)continue;let ht=M(tt,ot);(!ct||ht<ct.cost)&&(ct={candidate:tt,pathIdx:ot,cost:ht});}if(ct)return ct}return null}function E(K,Z,Q){if(!i)return null;let nt={segmentUsage:i,usedPoints:c,routeFromIdx:0,routeToIdx:0,edgeFromId:e.from.index+1,edgeToId:e.to.index+1,relaxedAllowEndSegmentReuse:Q};for(let it of Z){let ct=B(it),tt=null;for(let ot of K){nt.routeFromIdx=ot.routeFromIdx,nt.routeToIdx=ot.routeToIdx;let ht=tr(r,ot.routeFromIdx,ot.routeToIdx,ct,nt);if(!ht||l&&Ft(ht.path,r.stride)<4)continue;let bt=k(ot,ht);(!tt||bt<tt.cost)&&(tt={candidate:ot,pathIdx:ht.path,cost:bt});}if(tt)return tt}return null}let R=null;if(d==="relaxed"){let K=function(tt,ot){if(!tt)return ot;if(!ot)return tt;if(ot.cost<tt.cost)return ot;if(ot.cost>tt.cost)return tt;let ht=Ft(tt.pathIdx,r.stride);return Ft(ot.pathIdx,r.stride)<ht?ot:tt},Z=function(tt){let ot=E(N,Dt,tt);if(ot){if(Ft(ot.pathIdx,r.stride)-2>4){let It=x(z,[ot.candidate.endDir]),Ot=E(It,Dt,tt);return K(ot,Ot)}if(c&&ot.pathIdx.length>=4){let It=false;for(let Ot=1;Ot<ot.pathIdx.length-1;Ot++){let Kt=ot.pathIdx[Ot],Bt=c[Kt]??0;if(Bt!==0&&(Bt&Bt-1)!==0){It=true;break}}if(It){let Ot=E(N,[Pe],tt);return K(ot,Ot)}}return ot}function ht(Tt){if(t.config.useAscii||!w)return  false;let Ht=Math.abs(w.dx);if(!(Math.abs(w.dy)>=Ht+2))return  false;let Kt=Math.sign(Tt.candidate.startDir.x-1),Bt=Math.sign(Tt.candidate.endDir.x-1),Ve=Kt!==0&&Bt!==0&&Kt!==Bt,En=Tt.pathIdx.length>=28,Le=Ft(Tt.pathIdx,r.stride)>=8;return Ve||En||Le}let bt=E(L,Dt,tt),At=bt?ht(bt)?E(P,Dt,tt):null:E(P,Dt,tt),Pt=K(bt,At);return Pt=Pt??E(N,Nt,tt)??E(L,Nt,tt)??E(P,Nt,tt),Pt},Q=function(tt){let ot=Math.sign(tt.startDir.x-1),ht=Math.sign(tt.startDir.y-1),bt=Math.sign(tt.endDir.x-1),At=Math.sign(tt.endDir.y-1);return ht===0&&At===0&&ot!==0&&bt!==0&&ot!==bt},nt=function(tt,ot){let ht=K(tt,ot);if(!tt||!ot||t.config.useAscii||!w)return ht;let bt=Math.abs(w.dx);if(!(Math.abs(w.dy)>=bt+2))return ht;let Tt=Q(ot.candidate),Ht=Q(tt.candidate);if(!Tt||Ht)return ht;let It=8,Ot=60,Kt=tt.pathIdx.length<=ot.pathIdx.length+It,Bt=tt.cost<=ot.cost+Ot;return Kt&&Bt?tt:ht};let it=Z(false),ct=Z(true);if(R=nt(it,ct),!R){let tt=function(ot){let ht=E(H,Dt,ot)??E(V,Dt,ot);return ht=ht??E(H,Nt,ot)??E(V,Nt,ot),ht};R=tt(false)??tt(true);}}else !i||i.usedCount===0?R=O(N,Dt):(R=C(N,Dt)??C(L,Dt)??C(P,Dt),R=R??C(N,Nt)??C(L,Nt),R=R??C(P,Nt));if(!R&&d==="relaxed"&&s&&(e.__bm_used_unconstrained_fallback=true,R=O(N,Dt)??O(L,Dt)??O(P,Dt)??O(H,Dt)??O(V,Nt)),!R){e.startDir=h,e.endDir=g,e.path=[];return}if(e.startDir=R.candidate.startDir,e.endDir=R.candidate.endDir,e.path=Jn(R.pathIdx,r.stride).map(K=>qn(r.stride,K)),i&&er(i,e,R.pathIdx),c&&nr(c,r,R.pathIdx),d==="relaxed"&&t.portUsage){let K=e.startDir.x+e.startDir.y*3,Z=e.endDir.x+e.endDir.y*3;t.portUsage[e.from.index*9+K]=(t.portUsage[e.from.index*9+K]??0)+1,t.portUsage[e.to.index*9+Z]=(t.portUsage[e.to.index*9+Z]??0)+1;}}function lr(t,e){if(e.text.length===0||e.path.length<2)return;let r=gt(e.text),n=Jo(t),o=Ko(t),i=e.path[0],c=null,s=[i,e.path[1]],l=0,d=false,h=null,g=-1;for(let M=1;M<e.path.length;M++){let A=e.path[M],w=[i,A],$=or(t,w);d||($>=r?(s=w,d=true):$>l&&(l=$,s=w));let k=dr(t,e,w,e.text),I=k?n.some(N=>qo(N,k)):false,X=k?o.some(N=>Vo(k,N)):false;if(!I&&!X&&($>g&&(g=$,h=w),$>=r)){c=w;break}i=A;}c===null&&(c=h??s);let a=Math.min(c[0].x,c[1].x),f=Math.max(c[0].x,c[1].x),x=a+Math.floor((f-a)/2);if(t.config.routing==="relaxed"&&!t.config.useAscii){let M=new Set;for(let A of t.nodes)A.gridCoord&&(M.add(A.gridCoord.x),M.add(A.gridCoord.x+1),M.add(A.gridCoord.x+2));if(M.has(x)){let A=f-a;for(let w=1;w<=A;w++){let $=x-w;if($>=a&&$<=f&&!M.has($)){x=$;break}let k=x+w;if(k>=a&&k<=f&&!M.has(k)){x=k;break}}}}let u=t.columnWidth.get(x)??0,b=r+2,y=or(t,c);if(y<b){let M=b-y;t.columnWidth.set(x,u+M);}e.labelLine=[c[0],c[1]];}function or(t,e){let r=0,n=Math.min(e[0].x,e[1].x),o=Math.max(e[0].x,e[1].x);for(let i=n;i<=o;i++)r+=t.columnWidth.get(i)??0;return r}function ir(t,e,r){let n=t.offsetX;for(let d=0;d<r.x;d++)n+=t.columnWidth.get(d)??0;let o=t.offsetY;for(let d=0;d<r.y;d++)o+=t.rowHeight.get(d)??0;let i=t.columnWidth.get(r.x)??0,c=t.rowHeight.get(r.y)??0,s=Math.floor(i/2),l=Math.floor(c/2);if(e.path.length>=2){let d=e.path[0],h=e.path[1],g=e.path[e.path.length-1],a=e.path[e.path.length-2];if(r.x===d.x&&r.y===d.y||r.x===h.x&&r.y===h.y){let x=d.x===h.x,m=d.y===h.y;x&&e.startPortOffsetX!=null&&(s=e.startPortOffsetX),m&&e.startPortOffsetY!=null&&(l=e.startPortOffsetY);}if(r.x===g.x&&r.y===g.y||r.x===a.x&&r.y===a.y){let x=g.x===a.x,m=g.y===a.y;x&&e.endPortOffsetX!=null&&(s=e.endPortOffsetX),m&&e.endPortOffsetY!=null&&(l=e.endPortOffsetY);}}return s<0&&(s=0),l<0&&(l=0),i>0&&s>i-1&&(s=i-1),c>0&&l>c-1&&(l=c-1),{x:n+s,y:o+l}}function zo(t,e){let r=t.offsetX;for(let o=0;o<e.x;o++)r+=t.columnWidth.get(o)??0;let n=t.offsetY;for(let o=0;o<e.y;o++)n+=t.rowHeight.get(o)??0;return {x:r,y:n}}function sn(t,e){if(!e.gridCoord)return null;let r=e.gridCoord,n=0;for(let c=0;c<2;c++)n+=t.columnWidth.get(r.x+c)??0;let o=0;for(let c=0;c<2;c++)o+=t.rowHeight.get(r.y+c)??0;let i=zo(t,r);return {minX:i.x,minY:i.y,maxX:i.x+n,maxY:i.y+o}}function Vo(t,e){return t.y<e.minY||t.y>e.maxY?false:!(t.endX<e.minX||e.maxX<t.startX)}function Ko(t){let e=[];for(let r of t.nodes){let n=sn(t,r);n&&e.push(n);}return e}function dr(t,e,r,n){let o=gt(n);if(o<=0)return null;let i=ir(t,e,r[0]),c=ir(t,e,r[1]),s=Math.min(i.x,c.x),l=Math.max(i.x,c.x),d=Math.min(i.y,c.y),h=Math.max(i.y,c.y),g=s+Math.floor((l-s)/2),a=d+Math.floor((h-d)/2),f=g-Math.floor(o/2);return {y:a,startX:f,endX:f+o-1}}function qo(t,e){return t.y!==e.y?false:!(t.endX<e.startX||e.endX<t.startX)}function Jo(t){let e=[];for(let r of t.edges){if(r.text.length===0||r.labelLine.length<2)continue;let n=dr(t,r,[r.labelLine[0],r.labelLine[1]],r.text);n&&e.push(n);}return e}function Rt(t,e,r){let n=0;if(t.columnStartX&&r.x>=0&&r.x<t.columnStartX.length)n=t.columnStartX[r.x]??0;else for(let d=0;d<r.x;d++)n+=t.columnWidth.get(d)??0;let o=0;if(t.rowStartY&&r.y>=0&&r.y<t.rowStartY.length)o=t.rowStartY[r.y]??0;else for(let d=0;d<r.y;d++)o+=t.rowHeight.get(d)??0;let i=t.columnWidth.get(r.x)??0,c=t.rowHeight.get(r.y)??0,s=Math.floor(i/2),l=Math.floor(c/2);if(e.path.length>=2){let d=e.path[0],h=e.path[1],g=e.path[e.path.length-1],a=e.path[e.path.length-2];if(r.x===d.x&&r.y===d.y||r.x===h.x&&r.y===h.y){let x=d.x===h.x,m=d.y===h.y;x&&e.startPortOffsetX!=null&&(s=e.startPortOffsetX),m&&e.startPortOffsetY!=null&&(l=e.startPortOffsetY);}if(r.x===g.x&&r.y===g.y||r.x===a.x&&r.y===a.y){let x=g.x===a.x,m=g.y===a.y;x&&e.endPortOffsetX!=null&&(s=e.endPortOffsetX),m&&e.endPortOffsetY!=null&&(l=e.endPortOffsetY);}}return s<0&&(s=0),l<0&&(l=0),i>0&&s>i-1&&(s=i-1),c>0&&l>c-1&&(l=c-1),{x:n+s+t.offsetX,y:o+l+t.offsetY}}function dn(t,e,r){return r.map(n=>Rt(t,e,n))}function mr(t,e){let r=t.gridCoord,n=e.config.useAscii,o=0;for(let f=0;f<2;f++)o+=e.columnWidth.get(r.x+f)??0;let i=0;for(let f=0;f<2;f++)i+=e.rowHeight.get(r.y+f)??0;let c={x:0,y:0},s={x:o,y:i},l=Mt(Math.max(c.x,s.x),Math.max(c.y,s.y));if(n){for(let f=c.x+1;f<s.x;f++)l[f][c.y]="-";for(let f=c.x+1;f<s.x;f++)l[f][s.y]="-";for(let f=c.y+1;f<s.y;f++)l[c.x][f]="|";for(let f=c.y+1;f<s.y;f++)l[s.x][f]="|";l[c.x][c.y]="+",l[s.x][c.y]="+",l[c.x][s.y]="+",l[s.x][s.y]="+";}else {for(let f=c.x+1;f<s.x;f++)l[f][c.y]="\u2500";for(let f=c.x+1;f<s.x;f++)l[f][s.y]="\u2500";for(let f=c.y+1;f<s.y;f++)l[c.x][f]="\u2502";for(let f=c.y+1;f<s.y;f++)l[s.x][f]="\u2502";l[c.x][c.y]="\u250C",l[s.x][c.y]="\u2510",l[c.x][s.y]="\u2514",l[s.x][s.y]="\u2518";}let d=t.displayLabel,h=c.y+Math.floor(i/2),g=gt(d),a=c.x+Math.floor(o/2)-Math.ceil(g/2)+1;return yt(l,{x:a,y:h},d),l}function Re(t,e,r=1){let n=0;for(let y of t)for(let M of y)n=Math.max(n,gt(M));let i=n+2*r+2,c=0;for(let y of t)c+=Math.max(y.length,1);let s=t.length-1,l=c+s+2,d=e?"-":"\u2500",h=e?"|":"\u2502",g=e?"+":"\u250C",a=e?"+":"\u2510",f=e?"+":"\u2514",p=e?"+":"\u2518",x=e?"+":"\u251C",m=e?"+":"\u2524",u=Mt(i-1,l-1);u[0][0]=g;for(let y=1;y<i-1;y++)u[y][0]=d;u[i-1][0]=a,u[0][l-1]=f;for(let y=1;y<i-1;y++)u[y][l-1]=d;u[i-1][l-1]=p;for(let y=1;y<l-1;y++)u[0][y]=h,u[i-1][y]=h;let b=1;for(let y=0;y<t.length;y++){let M=t[y],A=M.length>0?M:[""];for(let w of A){let $=1+r;yt(u,{x:$,y:b},w),b++;}if(y<t.length-1){u[0][b]=x;for(let w=1;w<i-1;w++)u[w][b]=d;u[i-1][b]=m,b++;}}return u}function Zo(t,e,r,n,o,i){let[c,s]=$t(t),l=Math.max(e.x,r.x),d=Math.max(e.y,r.y);(l>c||d>s)&&Yt(t,l,d);let h=_t(e,r),g=[],a=i?"-":"\u2500",f=i?"|":"\u2502",p=i?"\\":"\u2572",x=i?"/":"\u2571";if(U(h,ft))for(let m=e.y-n;m>=r.y-o;m--)g.push({x:e.x,y:m}),t[e.x][m]=f;else if(U(h,st))for(let m=e.y+n;m<=r.y+o;m++)g.push({x:e.x,y:m}),t[e.x][m]=f;else if(U(h,ut))for(let m=e.x-n;m>=r.x-o;m--)g.push({x:m,y:e.y}),t[m][e.y]=a;else if(U(h,lt))for(let m=e.x+n;m<=r.x+o;m++)g.push({x:m,y:e.y}),t[m][e.y]=a;else if(U(h,St))for(let m=e.x,u=e.y-n;m>=r.x-o&&u>=r.y-o;m--,u--)g.push({x:m,y:u}),t[m][u]=p;else if(U(h,kt))for(let m=e.x,u=e.y-n;m<=r.x+o&&u>=r.y-o;m++,u--)g.push({x:m,y:u}),t[m][u]=x;else if(U(h,Et))for(let m=e.x,u=e.y+n;m>=r.x-o&&u<=r.y+o;m--,u++)g.push({x:m,y:u}),t[m][u]=x;else if(U(h,Lt))for(let m=e.x,u=e.y+n;m<=r.x+o&&u<=r.y+o;m++,u++)g.push({x:m,y:u}),t[m][u]=p;return g}function Qo(t,e){if(e.path.length<2){let d=ne(t.canvas);return [d,d,d,d,d]}let[r,n,o]=ti(t,e,e.path),i=ei(t,e),c=ni(t,e,n[n.length-1],o[o.length-1]),s=ri(t,e,e.path),l=Mt(0,0);return [r,i,c,s,l]}function pr(t,e){let c=new Map;if(e.path.length<3)return c;function s(d){return U(d,ft)?8:U(d,st)?4:U(d,ut)?2:U(d,lt)?1:0}function l(d){return U(d,ft)?4:U(d,st)?8:U(d,ut)?1:U(d,lt)?2:0}for(let d=1;d<e.path.length-1;d++){let h=e.path[d-1],g=e.path[d],a=e.path[d+1],f=_t(h,g),p=_t(g,a);if(U(f,p)||U(f,Wt)||U(p,Wt))continue;let x=Rt(t,e,g),m=`${x.x},${x.y}`,u=s(f)|l(p);u!==0&&c.set(m,(c.get(m)??0)|u);}return c}function gr(t,e){let r=[],n=new Set;function o(a){let f=`${a.x},${a.y}`;n.has(f)||(n.add(f),r.push(a));}function i(a){let f=`${a.x},${a.y}`;if(!n.has(f)){n.add(f),r.push(a);return}for(let p=0;p<r.length;p++){let x=r[p];if(x.x===a.x&&x.y===a.y){r.splice(p,1);break}}r.push(a);}if(e.path.length<2)return r;if(!t.config.useAscii){let a=Rt(t,e,e.path[0]),f=_t(e.path[0],e.path[1]),p=fn(e,f,a);if((U(f,ut)||U(f,lt))&&p.y===a.y){let x=Math.min(p.x,a.x),m=Math.max(p.x,a.x);for(let u=x;u<=m;u++)o({x:u,y:a.y});}else if((U(f,ft)||U(f,st))&&p.x===a.x){let x=Math.min(p.y,a.y),m=Math.max(p.y,a.y);for(let u=x;u<=m;u++)o({x:a.x,y:u});}o(p);}let c=1,s=-1,l=null,d=null,h=null;function g(a,f,p){let x=a,m=a;if(U(p,ft)){let u=a.y-c,b=f.y-s;u>=b&&(x={x:a.x,y:u},m={x:a.x,y:b});}else if(U(p,st)){let u=a.y+c,b=f.y+s;u<=b&&(x={x:a.x,y:u},m={x:a.x,y:b});}else if(U(p,ut)){let u=a.x-c,b=f.x-s;u>=b&&(x={x:u,y:a.y},m={x:b,y:a.y});}else if(U(p,lt)){let u=a.x+c,b=f.x+s;u<=b&&(x={x:u,y:a.y},m={x:b,y:a.y});}else if(U(p,St)){let u=a.x,b=a.y-c,y=f.x-s,M=f.y-s;u>=y&&b>=M&&(x={x:u,y:b},m={x:y,y:M});}else if(U(p,kt)){let u=a.x,b=a.y-c,y=f.x+s,M=f.y-s;u<=y&&b>=M&&(x={x:u,y:b},m={x:y,y:M});}else if(U(p,Et)){let u=a.x,b=a.y+c,y=f.x-s,M=f.y+s;u>=y&&b<=M&&(x={x:u,y:b},m={x:y,y:M});}else if(U(p,Lt)){let u=a.x,b=a.y+c,y=f.x+s,M=f.y+s;u<=y&&b<=M&&(x={x:u,y:b},m={x:y,y:M});}return [x,m]}for(let a=1;a<e.path.length;a++){let f=e.path[a-1],p=e.path[a],x=Rt(t,e,f),m=Rt(t,e,p);if(De(x,m))continue;let u=_t(f,p),[b,y]=g(x,m,u);if(l=b,d=y,h=u,U(u,ft))for(let M=x.y-c;M>=m.y-s;M--)o({x:x.x,y:M});else if(U(u,st))for(let M=x.y+c;M<=m.y+s;M++)o({x:x.x,y:M});else if(U(u,ut))for(let M=x.x-c;M>=m.x-s;M--)o({x:M,y:x.y});else if(U(u,lt))for(let M=x.x+c;M<=m.x+s;M++)o({x:M,y:x.y});else if(U(u,St))for(let M=x.x,A=x.y-c;M>=m.x-s&&A>=m.y-s;M--,A--)o({x:M,y:A});else if(U(u,kt))for(let M=x.x,A=x.y-c;M<=m.x+s&&A>=m.y-s;M++,A--)o({x:M,y:A});else if(U(u,Et))for(let M=x.x,A=x.y+c;M>=m.x-s&&A<=m.y+s;M--,A++)o({x:M,y:A});else if(U(u,Lt))for(let M=x.x,A=x.y+c;M<=m.x+s&&A<=m.y+s;M++,A++)o({x:M,y:A});if(a<e.path.length-1){let M=_t(p,e.path[a+1]);!U(u,M)&&!U(u,Wt)&&!U(M,Wt)&&o(Rt(t,e,p));}}{let a=e.path[e.path.length-1],f=e.path[e.path.length-2],p=h??_t(f,a),x=d??Rt(t,e,a),m=l??x,u=_t(m,x);(De(m,x)||U(u,Wt))&&(u=p);let b=un(e,u,x);if((U(u,ut)||U(u,lt))&&b.y===x.y){let y=Math.min(b.x,x.x)+1,M=Math.max(b.x,x.x)-1;for(let A=y;A<=M;A++)o({x:A,y:x.y});}else if((U(u,ft)||U(u,st))&&b.x===x.x){let y=Math.min(b.y,x.y)+1,M=Math.max(b.y,x.y)-1;for(let A=y;A<=M;A++)o({x:x.x,y:A});}i(b);}return r}function ti(t,e,r){let n=ne(t.canvas),o=r[0],i=[],c=[];for(let s=1;s<r.length;s++){let l=r[s],d=Rt(t,e,o),h=Rt(t,e,l);if(De(d,h)){o=l;continue}let g=_t(o,l),a=Zo(n,d,h,1,-1,t.config.useAscii);a.length===0&&a.push(d),i.push(a),c.push(g),o=l;}return [n,i,c]}function ei(t,e){let r=ne(t.canvas);if(t.config.useAscii||e.path.length<2)return r;let n=_t(e.path[0],e.path[1]),o=Rt(t,e,e.path[0]),i=fn(e,n,o);return xr(r,o,i,n,t.config.useAscii),U(n,ft)?r[i.x][i.y]="\u2534":U(n,st)?r[i.x][i.y]="\u252C":U(n,ut)?r[i.x][i.y]="\u2524":U(n,lt)&&(r[i.x][i.y]="\u251C"),r}function ni(t,e,r,n){let o=ne(t.canvas);if(r.length===0)return o;let i=r[0],c=r[r.length-1],s=_t(i,c);(r.length===1||U(s,Wt))&&(s=n);let l;t.config.useAscii?U(s,ft)?l="^":U(s,st)?l="v":U(s,ut)?l="<":U(s,lt)?l=">":U(n,ft)?l="^":U(n,st)?l="v":U(n,ut)?l="<":U(n,lt)?l=">":l="*":U(s,ft)?l="\u25B2":U(s,st)?l="\u25BC":U(s,ut)?l="\u25C4":U(s,lt)?l="\u25BA":U(s,kt)?l="\u25E5":U(s,St)?l="\u25E4":U(s,Lt)?l="\u25E2":U(s,Et)?l="\u25E3":U(n,ft)?l="\u25B2":U(n,st)?l="\u25BC":U(n,ut)?l="\u25C4":U(n,lt)?l="\u25BA":U(n,kt)?l="\u25E5":U(n,St)?l="\u25E4":U(n,Lt)?l="\u25E2":U(n,Et)?l="\u25E3":l="\u25CF";let d=un(e,s,c);return xr(o,c,d,s,t.config.useAscii),o[d.x][d.y]=l,o}function fn(t,e,r){let n=t.from.drawingCoord,o=t.from.drawing;if(!n||!o)return r;let[i,c]=$t(o),s=n.x,l=n.x+i,d=n.y,h=n.y+c;return U(e,ut)?{x:s,y:Zt(r.y,d,h)}:U(e,lt)?{x:l,y:Zt(r.y,d,h)}:U(e,ft)?{x:Zt(r.x,s,l),y:d}:U(e,st)?{x:Zt(r.x,s,l),y:h}:r}function un(t,e,r){let n=t.to.drawingCoord,o=t.to.drawing;if(!n||!o)return r;let[i,c]=$t(o),s=n.x,l=n.x+i,d=n.y,h=n.y+c;return U(e,ut)?{x:l+1,y:Zt(r.y,d,h)}:U(e,lt)?{x:s-1,y:Zt(r.y,d,h)}:U(e,ft)?{x:Zt(r.x,s,l),y:h+1}:U(e,st)?{x:Zt(r.x,s,l),y:d-1}:r}function Zt(t,e,r){return t<e?e:t>r?r:t}function xr(t,e,r,n,o){let i=Math.max(e.x,r.x),c=Math.max(e.y,r.y);i>=0&&c>=0&&Yt(t,i,c);let[s,l]=$t(t),d=o?"-":"\u2500",h=o?"|":"\u2502",g=(x,m,u)=>{x<0||m<0||x>s||m>l||(t[x][m]=u);},a=(x,m)=>o?"+":x==="left"&&m==="down"?"\u2510":x==="left"&&m==="up"?"\u2518":x==="right"&&m==="down"?"\u250C":x==="right"&&m==="up"?"\u2514":"+",f=(x,m,u)=>{let b=Math.min(m,u),y=Math.max(m,u);for(let M=b;M<=y;M++)g(M,x,d);},p=(x,m,u)=>{let b=Math.min(m,u),y=Math.max(m,u);for(let M=b;M<=y;M++)g(x,M,h);};if(U(n,ut)||U(n,lt)){if(e.y===r.y){f(e.y,e.x,r.x);return}let x={x:e.x,y:r.y};p(e.x,e.y,x.y),f(x.y,x.x,r.x);let m=e.y<x.y?"up":"down",u=r.x<x.x?"left":"right";g(x.x,x.y,a(u,m));return}if(U(n,ft)||U(n,st)){if(e.x===r.x){p(e.x,e.y,r.y);return}if(e.y===r.y){let b=U(n,st)?r.y-1:r.y+1,y={x:e.x,y:b},M={x:r.x,y:b};p(e.x,e.y,y.y),f(b,e.x,r.x),p(r.x,M.y,r.y);let A=e.y<y.y?"up":"down",w=r.x<y.x?"left":"right";g(y.x,y.y,a(w,A));let $=r.y<M.y?"up":"down",k=e.x<M.x?"left":"right";g(M.x,M.y,a(k,$));return}let x={x:r.x,y:e.y};f(e.y,e.x,x.x),p(x.x,x.y,r.y);let m=e.x<x.x?"left":"right",u=r.y<x.y?"up":"down";g(x.x,x.y,a(m,u));}}function ri(t,e,r){let n=ne(t.canvas);for(let o=1;o<r.length-1;o++){let i=r[o],c=Rt(t,e,i),s=_t(r[o-1],i),l=_t(i,r[o+1]),d;t.config.useAscii?d="+":U(s,lt)&&U(l,st)||U(s,ft)&&U(l,ut)?d="\u2510":U(s,lt)&&U(l,ft)||U(s,st)&&U(l,ut)?d="\u2518":U(s,ut)&&U(l,st)||U(s,ft)&&U(l,lt)?d="\u250C":U(s,ut)&&U(l,ft)||U(s,st)&&U(l,lt)?d="\u2514":d="+";let[h,g]=$t(n);(c.x>h||c.y>g)&&Yt(n,Math.max(c.x,h),Math.max(c.y,g)),n[c.x][c.y]=d;}return n}function oi(t,e,r){let n=ne(t.canvas);if(e.text.length===0)return n;let o=dn(t,e,e.labelLine),i=[],c=yr(t,e);c&&i.push(c);let s=wr(t,e);return s&&i.push(s),br(n,o,e.text,i,r,t.config.useAscii),n}function fr(t){return t==="\u25B2"||t==="\u25BC"||t==="\u25C4"||t==="\u25BA"||t==="\u25E5"||t==="\u25E4"||t==="\u25E2"||t==="\u25E3"||t==="\u25CF"}function ii(t){return t==="^"||t==="v"||t==="<"||t===">"||t==="*"}function ur(t){return t==="\u253C"||t==="\u252C"||t==="\u2534"||t==="\u251C"||t==="\u2524"||t==="\u250C"||t==="\u2510"||t==="\u2514"||t==="\u2518"||t==="\u2574"||t==="\u2575"||t==="\u2576"||t==="\u2577"}function si(t){return t==="+"}function me(t,e){return e?t==="|"||t==="+":t==="\u2502"||t==="\u253C"||t==="\u252C"||t==="\u2534"||t==="\u251C"||t==="\u2524"||t==="\u250C"||t==="\u2510"||t==="\u2514"||t==="\u2518"||t==="\u2577"||t==="\u2575"}function pe(t,e){return e?t==="-"||t==="+":t==="\u2500"||t==="\u253C"||t==="\u252C"||t==="\u2534"||t==="\u251C"||t==="\u2524"||t==="\u250C"||t==="\u2510"||t==="\u2514"||t==="\u2518"||t==="\u2574"||t==="\u2576"}function ai(t,e,r,n){let[o,i]=$t(t);if(e<0||r<0||e>o||r>i)return  false;let c=t[e][r],s=e>0?t[e-1][r]:" ",l=e<o?t[e+1][r]:" ",d=r>0?t[e][r-1]:" ",h=r<i?t[e][r+1]:" ",g=me(d,n)&&me(h,n),a=pe(s,n)&&pe(l,n);return !!((c===" "||pe(c,n))&&g||(c===" "||me(c,n))&&a)}function ci(t,e,r,n){let[o,i]=$t(t);if(e<0||r<0||e>o||r>i)return  false;let c=t[e][r];if(n){if(ii(c)||si(c))return  true}else if(fr(c)||ur(c))return  true;if(ai(t,e,r,n)||!n&&c!==" "&&!me(c,n)&&!pe(c,n))return  true;if(!n){let s=e>0?t[e-1][r]:" ",l=e<o?t[e+1][r]:" ",d=g=>g!==" "&&!fr(g)&&!ur(g)&&!me(g,n)&&!pe(g,n);if((c===" "||me(c,n)||pe(c,n))&&(d(s)||d(l)))return  true}return  false}function cn(t,e,r,n){for(let o of n)if(o.y===t&&o.x>=e&&o.x<=r)return  true;return  false}function hr(t,e,r,n,o){for(let i=r;i<=n;i++)if(ci(t,i,e,o))return  true;return  false}function ln(t){let{desiredStartX:e,minStartX:r,maxStartX:n,isValid:o}=t;if(o(e))return e;let i=Math.max(0,n-r);for(let c=1;c<=i;c++){let s=e-c;if(s>=r&&o(s))return s;let l=e+c;if(l<=n&&o(l))return l}return e}function br(t,e,r,n=[],o,i=false,c={}){if(e.length<2)return;let s=Math.min(e[0].x,e[1].x),l=Math.max(e[0].x,e[1].x),d=Math.min(e[0].y,e[1].y),h=Math.max(e[0].y,e[1].y),g=s+Math.floor((l-s)/2),a=d+Math.floor((h-d)/2),f=gt(r),p=g-Math.floor(f/2);if(o){let[m,u]=$t(o),b=0,y=Math.max(b,m-f+1);if(p<b&&(p=b),p>y&&(p=y),c.verticalOnlyStack){let I=p+f-1,X=Y=>!(cn(Y,p,I,n)||hr(o,Y,p,I,i));if(X(a)){yt(t,{x:p,y:a},r);return}let N=Math.max(a,u-a);for(let Y=1;Y<=N;Y++){let q=a-Y;if(q>=0&&X(q)){yt(t,{x:p,y:q},r);return}let _=a+Y;if(_<=u&&X(_)){yt(t,{x:p,y:_},r);return}}if(!i)return;yt(t,{x:p,y:a},r);return}let M=e[0].y===e[1].y,A=s,w=l-f+1,$=M&&w>=A?Math.max(b,A):b,k=M&&w>=A?Math.min(y,w):y;if(k>=$){p<$&&(p=$),p>k&&(p=k);let I=N=>{let Y=N+f-1;return !(cn(a,N,Y,n)||hr(o,a,N,Y,i))},X=p;if(p=ln({desiredStartX:X,minStartX:$,maxStartX:k,isValid:I}),!i){if(!I(p)&&M&&w>=A){let Y=Math.max(0,m-f+1);if(Y>=0){let q=Math.min(Math.max(X,0),Y),_=ln({desiredStartX:q,minStartX:0,maxStartX:Y,isValid:I});I(_)&&(p=_);}}if(!I(p))return}}yt(t,{x:p,y:a},r);return}if(e[0].y===e[1].y){let m=s,u=l-f+1;if(u>=m){p<m&&(p=m),p>u&&(p=u);for(let b of n){if(b.y!==a)continue;let y=p+f-1;if(!(b.x>=p&&b.x<=y))continue;let A=b.x-f,w=b.x+1,$=[];A>=m&&A<=u&&$.push(A),w>=m&&w<=u&&$.push(w),$.length!==0&&($.sort((k,I)=>Math.abs(k-p)-Math.abs(I-p)),p=$[0]);}p=ln({desiredStartX:p,minStartX:m,maxStartX:u,isValid:b=>{let y=b+f-1;return !cn(a,b,y,n)}});}}yt(t,{x:p,y:a},r);}function yr(t,e){if(e.path.length<2)return null;let r=e.path[e.path.length-1],n=e.path[e.path.length-2],o=_t(n,r),i=Rt(t,e,r),c=i;return U(o,ft)&&(c={x:i.x,y:i.y+1}),U(o,st)&&(c={x:i.x,y:i.y-1}),U(o,ut)&&(c={x:i.x+1,y:i.y}),U(o,lt)&&(c={x:i.x-1,y:i.y}),un(e,o,c)}function wr(t,e){if(e.path.length<2)return null;let r=_t(e.path[0],e.path[1]),n=Rt(t,e,e.path[0]);return fn(e,r,n)}function li(t,e){let r=t.maxX-t.minX,n=t.maxY-t.minY;if(r<=0||n<=0)return Mt(0,0);let o={x:0,y:0},i={x:r,y:n},c=Mt(r,n);if(e.config.useAscii){for(let s=o.x+1;s<i.x;s++)c[s][o.y]="-";for(let s=o.x+1;s<i.x;s++)c[s][i.y]="-";for(let s=o.y+1;s<i.y;s++)c[o.x][s]="|";for(let s=o.y+1;s<i.y;s++)c[i.x][s]="|";c[o.x][o.y]="+",c[i.x][o.y]="+",c[o.x][i.y]="+",c[i.x][i.y]="+";}else {for(let s=o.x+1;s<i.x;s++)c[s][o.y]="\u2500";for(let s=o.x+1;s<i.x;s++)c[s][i.y]="\u2500";for(let s=o.y+1;s<i.y;s++)c[o.x][s]="\u2502";for(let s=o.y+1;s<i.y;s++)c[i.x][s]="\u2502";c[o.x][o.y]="\u250C",c[i.x][o.y]="\u2510",c[o.x][i.y]="\u2514",c[i.x][i.y]="\u2518";}return c}function di(t,e){let r=t.maxX-t.minX,n=t.maxY-t.minY;if(r<=0||n<=0)return [Mt(0,0),{x:0,y:0}];let o=Mt(r,n),i=1,c=Math.floor(r/2)-Math.floor(gt(t.name)/2);return c<1&&(c=1),yt(o,{x:c,y:i},t.name),[o,{x:t.minX,y:t.minY}]}function fi(t){function e(n){return n.parent===null?0:1+e(n.parent)}let r=[...t];return r.sort((n,o)=>e(n)-e(o)),r}function ui(t){let e=new Map,r=new Map;for(let n of t){if(n.text.length===0)continue;let o=`${n.from.name}\u2192${n.to.name}`,i=e.get(o);i?i.push(n):e.set(o,[n]);}for(let n of e.values()){let o=`${n[0].from.name}\u2192${n[0].to.name}`;if(!(n.length<=1))for(let i=0;i<n.length;i++)r.set(n[i],{key:o,rank:i,size:n.length});}return r}function hi(t,e,r){let n=new Map;if(e.size===0)return n;let o=new Map;for(let c of t.edges){let s=e.get(c);if(!s)continue;let l=dn(t,c,c.labelLine),d=o.get(s.key);d?d.push({edge:c,stack:s,baseLine:l}):o.set(s.key,[{edge:c,stack:s,baseLine:l}]);}let[,i]=$t(r);for(let c of o.values()){if(c.length===0)continue;let s=0;for(let a of c)if(a.baseLine.length>=2){let f=Math.min(a.baseLine[0].y,a.baseLine[1].y),p=Math.max(a.baseLine[0].y,a.baseLine[1].y);s+=f+Math.floor((p-f)/2);}let l=Math.round(s/c.length),d=[];for(let a of c){if(a.baseLine.length<2)continue;let f=Math.min(a.baseLine[0].x,a.baseLine[1].x),p=Math.max(a.baseLine[0].x,a.baseLine[1].x);d.push(f+Math.floor((p-f)/2));}let h=[...d].sort((a,f)=>a-f),g=h.length>0?h[Math.floor(h.length/2)]:0;g<0&&(g=0);for(let a of c){let f=a.baseLine;if(f.length<2){n.set(a.edge,f);continue}let p=(a.stack.size-1)/2,x=Math.round((a.stack.rank-p)*2),m=l+x;m<0&&(m=0),m>i&&(m=i),n.set(a.edge,[{x:g,y:m},{x:g,y:m}]);}}return n}function Mr(t){let e=t.config.useAscii,r=fi(t.subgraphs);for(let g of r){let a=li(g,t),f={x:g.minX,y:g.minY};t.canvas=Ut(t.canvas,f,e,a);}for(let g of t.nodes)!g.drawn&&g.drawingCoord&&g.drawing&&(t.canvas=Ut(t.canvas,g.drawingCoord,e,g.drawing),g.drawn=true);let n=[],o=[],i=[],c=[];for(let g of t.edges){let[a,f,p,x,m]=Qo(t,g);n.push(a),o.push(x),i.push(p),c.push(f);}let s={x:0,y:0};t.canvas=Ut(t.canvas,s,e,...n),t.canvas=Ut(t.canvas,s,e,...o),t.canvas=Ut(t.canvas,s,e,...i),t.canvas=Ut(t.canvas,s,e,...c);let l=t.config.routing==="relaxed"&&!t.config.useAscii,d=l?ui(t.edges):new Map,h=l?hi(t,d,t.canvas):new Map;if(l)for(let g of t.edges){if(g.text.length===0)continue;let a=h.get(g)??dn(t,g,g.labelLine),f=[],p=d.has(g),x=yr(t,g);x&&f.push(x);let m=wr(t,g);m&&f.push(m),br(t.canvas,a,g.text,f,t.canvas,e,{verticalOnlyStack:p});}else {let g=[],a=t.canvas;for(let f of t.edges)g.push(oi(t,f,a));t.canvas=Ut(t.canvas,s,e,...g);}for(let g of t.subgraphs){if(g.nodes.length===0)continue;let[a,f]=di(g);t.canvas=Ut(t.canvas,f,e,a);}return t.canvas}function mi(t,e,r){let n=e,o=0;if(t.columnStartX&&n.x>=0&&n.x<t.columnStartX.length)o=t.columnStartX[n.x]??0;else for(let l=0;l<n.x;l++)o+=t.columnWidth.get(l)??0;let i=0;if(t.rowStartY&&n.y>=0&&n.y<t.rowStartY.length)i=t.rowStartY[n.y]??0;else for(let l=0;l<n.y;l++)i+=t.rowHeight.get(l)??0;let c=t.columnWidth.get(n.x)??0,s=t.rowHeight.get(n.y)??0;return {x:o+Math.floor(c/2)+t.offsetX,y:i+Math.floor(s/2)+t.offsetY}}function Qt(t,e,r,n=4){if(t.grid.has(Ze(r)))return t.config.graphDirection==="LR"?Qt(t,e,{x:r.x,y:r.y+n},n):t.config.routing==="relaxed"&&!t.config.useAscii?Qt(t,e,{x:r.x,y:r.y+n},n):Qt(t,e,{x:r.x+n,y:r.y},n);for(let o=0;o<3;o++)for(let i=0;i<3;i++){let c={x:r.x+o,y:r.y+i};t.grid.set(Ze(c),e);}return e.gridCoord=r,r}function pi(t,e){let r=e.gridCoord,n=t.config.boxBorderPadding,o=[1,2*n+gt(e.displayLabel),1],i=[1,1+2*n,1];for(let c=0;c<o.length;c++){let s=r.x+c,l=t.columnWidth.get(s)??0;t.columnWidth.set(s,Math.max(l,o[c]));}for(let c=0;c<i.length;c++){let s=r.y+c,l=t.rowHeight.get(s)??0;t.rowHeight.set(s,Math.max(l,i[c]));}if(r.x>0){let c=t.columnWidth.get(r.x-1)??0;t.columnWidth.set(r.x-1,Math.max(c,t.config.paddingX));}if(r.y>0){let c=t.config.paddingY;gi(t,e)&&(c+=4);let s=t.rowHeight.get(r.y-1)??0;t.rowHeight.set(r.y-1,Math.max(s,c));}}function hn(t,e){if(e.length===0)return;function r(o){t.columnWidth.has(o.x)||t.columnWidth.set(o.x,Math.floor(t.config.paddingX/2)),t.rowHeight.has(o.y)||t.rowHeight.set(o.y,Math.floor(t.config.paddingY/2));}let n=e[0];r(n);for(let o=1;o<e.length;o++){let i=e[o];if(n.x===i.x){let c=i.y>n.y?1:-1;for(let s=n.y;s!==i.y;s+=c)r({x:n.x,y:s}),r({x:n.x,y:s+c});}else if(n.y===i.y){let c=i.x>n.x?1:-1;for(let s=n.x;s!==i.x;s+=c)r({x:s,y:n.y}),r({x:s+c,y:n.y});}else r(i);n=i;}}function Oe(t,e){return t.subgraphs.some(r=>r.nodes.includes(e))}function mn(t,e){for(let r of t.subgraphs)if(r.nodes.includes(e))return r;return null}function gi(t,e){let r=mn(t,e);if(!r)return  false;let n=false;for(let o of t.edges)if(o.to===e&&mn(t,o.from)!==r){n=true;break}if(!n)return  false;for(let o of r.nodes){if(o===e||!o.gridCoord)continue;let i=false;for(let c of t.edges)if(c.to===o&&mn(t,c.from)!==r){i=true;break}if(i&&o.gridCoord.y<e.gridCoord.y)return  false}return  true}function Cr(t,e){if(e.nodes.length===0)return;let r=1e6,n=1e6,o=-1e6,i=-1e6;for(let l of e.children)Cr(t,l),l.nodes.length>0&&(r=Math.min(r,l.minX),n=Math.min(n,l.minY),o=Math.max(o,l.maxX),i=Math.max(i,l.maxY));for(let l of e.nodes){if(!l.drawingCoord||!l.drawing)continue;let d=l.drawingCoord.x,h=l.drawingCoord.y,g=d+l.drawing.length-1,a=h+l.drawing[0].length-1;r=Math.min(r,d),n=Math.min(n,h),o=Math.max(o,g),i=Math.max(i,a);}let c=2,s=2;e.minX=r-c,e.minY=n-c-s,e.maxX=o+c,e.maxY=i+c;}function xi(t){let r=t.subgraphs.filter(n=>n.parent===null&&n.nodes.length>0);for(let n=0;n<r.length;n++)for(let o=n+1;o<r.length;o++){let i=r[n],c=r[o];i.minX<c.maxX&&i.maxX>c.minX&&(i.maxY>=c.minY-1&&i.minY<c.minY?c.minY=i.maxY+1+1:c.maxY>=i.minY-1&&c.minY<i.minY&&(i.minY=c.maxY+1+1)),i.minY<c.maxY&&i.maxY>c.minY&&(i.maxX>=c.minX-1&&i.minX<c.minX?c.minX=i.maxX+1+1:c.maxX>=i.minX-1&&c.minX<i.minX&&(i.minX=c.maxX+1+1));}}function bi(t){for(let e of t.subgraphs)Cr(t,e);xi(t);}function yi(t){if(t.subgraphs.length===0)return;let e=0,r=0;for(let i of t.subgraphs)e=Math.min(e,i.minX),r=Math.min(r,i.minY);let n=-e,o=-r;if(!(n===0&&o===0)){t.offsetX=n,t.offsetY=o;for(let i of t.subgraphs)i.minX+=n,i.minY+=o,i.maxX+=n,i.maxY+=o;for(let i of t.nodes)i.drawingCoord&&(i.drawingCoord.x+=n,i.drawingCoord.y+=o);}}function Sr(t){let e=[0,1,2,3,4];for(let r of e)if(wi(t),Si(t,r))return}function wi(t){t.grid=new Map,t.columnWidth=new Map,t.rowHeight=new Map,t.canvas=Mt(0,0),t.offsetX=0,t.offsetY=0,t.columnStartX=void 0,t.rowStartY=void 0,t.portUsage=t.config.routing==="relaxed"?new Uint16Array(t.nodes.length*9):void 0;for(let e of t.nodes)e.gridCoord=null,e.drawingCoord=null,e.drawing=null,e.drawn=false;for(let e of t.edges)e.path=[],e.labelLine=[],e.startDir={x:0,y:0},e.endDir={x:0,y:0},e.startPortOffsetX=void 0,e.startPortOffsetY=void 0,e.endPortOffsetX=void 0,e.endPortOffsetY=void 0;for(let e of t.subgraphs)e.minX=0,e.minY=0,e.maxX=0,e.maxY=0;}function Mi(t){if(t.config.routing!=="relaxed")return 4;let r=t.nodes.length;if(r===0)return 4;let n=1,o=new Map;for(let s of t.edges){let l=s.from.index*r+s.to.index,d=(o.get(l)??0)+1;o.set(l,d),d>n&&(n=d);}let i=0,c=new Uint16Array(r);for(let s of t.edges){let l=(c[s.from.index]??0)+1;c[s.from.index]=l,l>i&&(i=l);}return n>=5||i>=8?8:n>=3||i>=4?6:4}function Ci(t){let e=0;for(let s of t.columnWidth.keys())e=Math.max(e,s);let r=0;for(let s of t.rowHeight.keys())r=Math.max(r,s);let n=new Int32Array(e+2),o=0;for(let s=0;s<n.length;s++)n[s]=o,o+=t.columnWidth.get(s)??0;let i=new Int32Array(r+2),c=0;for(let s=0;s<i.length;s++)i[s]=c,c+=t.rowHeight.get(s)??0;t.columnStartX=n,t.rowStartY=i;}function Si(t,e){let r=t.config.graphDirection,n=Mi(t),o=new Array(Math.max(100,(t.nodes.length+2)*n+16)).fill(0),i=[];if(t.config.routing==="strict"){let S=new Set;for(let v of t.nodes){S.has(v.name)||i.push(v),S.add(v.name);for(let z of pn(t,v))S.add(z.name);}}else {let S=new Set;for(let v of t.edges)S.add(v.to.name);i=t.nodes.filter(v=>!S.has(v.name)),i.length===0&&t.nodes.length>0&&(i=[t.nodes[0]]);}let c=false,s=false;for(let S of i)Oe(t,S)?pn(t,S).length>0&&(s=true):c=true;let l=r==="LR"&&c&&s,d,h=[];l?(d=i.filter(S=>!Oe(t,S)),h=i.filter(S=>Oe(t,S))):d=i;for(let S of d){let v=r==="LR"?{x:0+e,y:o[0]+e}:{x:o[0]+e,y:0+e};Qt(t,t.nodes[S.index],v,n),o[0]=o[0]+n;}if(l&&h.length>0){let S=n;for(let v of h){let z=r==="LR"?{x:S+e,y:o[S]+e}:{x:o[S]+e,y:S+e};Qt(t,t.nodes[v.index],z,n),o[S]=o[S]+n;}}let g=true;for(;g;){g=false;for(let j of t.nodes){let L=j.gridCoord;if(!L)continue;let T=(r==="LR"?L.x-e:L.y-e)+n,G=o[T]??0;for(let H of pn(t,j)){if(H.gridCoord!==null)continue;if(r!=="LR"&&t.config.routing==="relaxed"&&!t.config.useAscii&&t.edges.some(O=>O.from===H&&O.to===j)){let O=T+n,C={x:L.x,y:O+e};Qt(t,t.nodes[H.index],C,n);let E=L.x-e,R=o[O]??0;o[O]=Math.max(R,E+n),g=true;continue}let V=r==="LR"?{x:T+e,y:G+e}:{x:G+e,y:T+e};Qt(t,t.nodes[H.index],V,n),o[T]=G+n,G=o[T],g=true;}}if(g)continue;let S=t.nodes.find(j=>j.gridCoord===null);if(!S)break;let v=l&&Oe(t,S)?n:0,z=r==="LR"?{x:v+e,y:o[v]+e}:{x:o[v]+e,y:v+e};Qt(t,t.nodes[S.index],z,n),o[v]=o[v]+n,g=true;}if(t.nodes.some(S=>S.gridCoord===null))return  false;let a=0,f=0;for(let S of t.nodes)S.gridCoord&&(a=Math.max(a,S.gridCoord.x+2),f=Math.max(f,S.gridCoord.y+2));let p=a+Pe+1,x=f+Pe+1,m=Kn(p,x);for(let S of t.nodes)if(S.gridCoord)for(let v=0;v<3;v++)for(let z=0;z<3;z++){let j=S.gridCoord.x+v,L=S.gridCoord.y+z;m.blocked[j+L*p]=1;}let u=sr(m.blocked.length),b=new Uint8Array(m.blocked.length);for(let S of t.nodes)pi(t,S);function y(){let S=new Map;for(let B of t.nodes)S.set(B.name,0);for(let B of t.edges)S.set(B.to.name,(S.get(B.to.name)??0)+1);let v=new Map;for(let B of t.edges){let O=v.get(B.from.name);O?O.push(B):v.set(B.from.name,[B]);}let z=[];for(let B of t.nodes)(S.get(B.name)??0)===0&&z.push(B);z.length===0&&t.nodes.length>0&&z.push(t.nodes[0]);let j=new Set,L=new Set,P=[],T=B=>{j.has(B.name)||(j.add(B.name),P.push(B));};for(let B of z)T(B);let G=0;for(;;){for(;G<P.length;){let O=P[G++],C=v.get(O.name)??[];for(let E of C)j.has(E.to.name)||(L.add(E),T(E.to));}if(j.size>=t.nodes.length)break;let B=t.nodes.find(O=>!j.has(O.name));if(!B)break;T(B);}let H=[],V=[];for(let B of t.edges)L.has(B)?H.push(B):V.push(B);return H.concat(V)}let M=t.config.routing==="relaxed"&&!t.config.useAscii?y():t.edges;function A(S){return `${S.from.name}\u2192${S.to.name}`}function w(S,v){v.path=S.path.map(z=>({x:z.x,y:z.y})),v.startDir={x:S.startDir.x,y:S.startDir.y},v.endDir={x:S.endDir.x,y:S.endDir.y},v.startPortOffsetX=void 0,v.startPortOffsetY=void 0,v.endPortOffsetX=void 0,v.endPortOffsetY=void 0;}let $=t.config.routing==="relaxed"&&!t.config.useAscii,k=new Map;if($)for(let S of M){let v=A(S),z=k.get(v);z?z.push(S):k.set(v,[S]);}let I=new Map,X=e>=4;for(let S of M){if($){let v=A(S);if((k.get(v)??[]).length>=2){let j=I.get(v);if(!j){an(t,S,m,a,f,u,b,X),S.path.length>=2&&I.set(v,S),hn(t,S.path);continue}if(j.path.length>=2){w(j,S),hn(t,S.path);continue}}}an(t,S,m,a,f,u,b,X),hn(t,S.path);}if(t.edges.some(S=>S.path.length<2))return  false;if(!t.config.useAscii&&t.config.routing==="relaxed"){let S=function(j,L,P){if(j.x===1&&j.y===0)return "up";if(j.x===1&&j.y===2)return "down";if(j.x===0&&j.y===1)return "left";if(j.x===2&&j.y===1)return "right";if(!L||!P)return null;let T=P.x-L.x,G=P.y-L.y,H=Math.abs(T)>=Math.abs(G);return j.x===2&&j.y===0?H?"right":"up":j.x===0&&j.y===0?H?"left":"up":j.x===2&&j.y===2?H?"right":"down":j.x===0&&j.y===2?H?"left":"down":null},v=function(j,L){if(j<=0)return [];if(L<=0)return [];if(j===1)return [Math.floor(L/2)];let P=[];for(let T=0;T<j;T++)P.push(Math.floor(T*(L-1)/(j-1)));return P};let z=t.nodes.map(()=>({up:[],down:[],left:[],right:[]}));for(let j=0;j<t.edges.length;j++){let L=t.edges[j];if(L.path.length<2)continue;let P=S(L.startDir,L.from.gridCoord,L.to.gridCoord),T=S(L.endDir,L.to.gridCoord,L.from.gridCoord);if(P){let G=L.to.gridCoord,H=P==="left"||P==="right"?G?.y??0:G?.x??0;z[L.from.index][P].push({edge:L,kind:"start",otherSort:H,edgeOrder:j});}if(T){let G=L.from.gridCoord,H=T==="left"||T==="right"?G?.y??0:G?.x??0;z[L.to.index][T].push({edge:L,kind:"end",otherSort:H,edgeOrder:j});}}for(let j of t.nodes){let B=function(et){if(et<=3)return 0;let rt=Math.floor((et-3+1)/2);return Math.min(4,rt)};if(!j.gridCoord)continue;let L=z[j.index],P=t.config.boxBorderPadding,T=2*P+gt(j.displayLabel),G=1+2*P,H=Math.max(L.up.length,L.down.length),V=Math.max(L.left.length,L.right.length),O=Math.max(T,H+B(H)),C=Math.max(G,V+B(V)),E=j.gridCoord.x+1,R=j.gridCoord.y+1,W=t.columnWidth.get(E)??0;O>W&&t.columnWidth.set(E,O);let J=t.rowHeight.get(R)??0;C>J&&t.rowHeight.set(R,C);}for(let j of t.nodes){let V=function(B,O){if(B.length===0)return;B.sort((R,W)=>R.otherSort-W.otherSort||R.edgeOrder-W.edgeOrder);let C=O==="left"||O==="right"?H:G,E=v(B.length,C);for(let R=0;R<B.length;R++){let W=B[R],J=E[R];if(B.length===1&&C>=2){let et=O==="left"||O==="up"?-1:1;W.kind==="start"&&(et=-et);let rt=J+et;rt<0?J=0:rt>C-1?J=C-1:J=rt;}O==="left"||O==="right"?W.kind==="start"?W.edge.startPortOffsetY=J:W.edge.endPortOffsetY=J:W.kind==="start"?W.edge.startPortOffsetX=J:W.edge.endPortOffsetX=J;}};if(!j.gridCoord)continue;let L=z[j.index],P=j.gridCoord.x+1,T=j.gridCoord.y+1,G=t.columnWidth.get(P)??0,H=t.rowHeight.get(T)??0;V(L.left,"left"),V(L.right,"right"),V(L.up,"up"),V(L.down,"down");}}for(let S of t.edges)lr(t,S);Ci(t);for(let S of t.nodes)S.drawingCoord=mi(t,S.gridCoord),S.drawing=mr(S,t);return jn(t.canvas,t.columnWidth,t.rowHeight),bi(t),yi(t),true}function vi(t,e){return t.edges.filter(r=>r.from.name===e.name)}function pn(t,e){return vi(t,e).map(r=>r.to)}function Ne(t){let e={actors:[],messages:[],blocks:[],notes:[]},r=new Set,n=[];for(let o=1;o<t.length;o++){let i=t[o],c=i.match(/^(participant|actor)\s+(\S+?)(?:\s+as\s+(.+))?$/);if(c){let a=c[1],f=c[2],p=c[3]?.trim()??f;r.has(f)||(r.add(f),e.actors.push({id:f,label:p,type:a}));continue}let s=i.match(/^Note\s+(left of|right of|over)\s+([^:]+):\s*(.+)$/i);if(s){let a=s[1].toLowerCase(),f=s[2].trim(),p=s[3].trim(),x=f.split(",").map(u=>u.trim());for(let u of x)ke(e,r,u);let m="over";a==="left of"?m="left":a==="right of"&&(m="right"),e.notes.push({actorIds:x,text:p,position:m,afterIndex:e.messages.length-1});continue}let l=i.match(/^(loop|alt|opt|par|critical|break|rect)\s*(.*)$/);if(l){let a=l[1],f=l[2]?.trim()??"";n.push({type:a,label:f,startIndex:e.messages.length,dividers:[]});continue}let d=i.match(/^(else|and)\s*(.*)$/);if(d&&n.length>0){let a=d[2]?.trim()??"";n[n.length-1].dividers.push({index:e.messages.length,label:a});continue}if(i==="end"&&n.length>0){let a=n.pop();e.blocks.push({type:a.type,label:a.label,startIndex:a.startIndex,endIndex:Math.max(e.messages.length-1,a.startIndex),dividers:a.dividers});continue}let h=i.match(/^(\S+?)\s*(--?>?>|--?[)x]|--?>>|--?>)\s*([+-]?)(\S+?)\s*:\s*(.+)$/);if(h){let a=h[1],f=h[2],p=h[3],x=h[4],m=h[5].trim();ke(e,r,a),ke(e,r,x);let u=f.startsWith("--")?"dashed":"solid",b=f.includes(">>")||f.includes("x")?"filled":"open",y={from:a,to:x,label:m,lineStyle:u,arrowHead:b};p==="+"&&(y.activate=true),p==="-"&&(y.deactivate=true),e.messages.push(y);continue}let g=i.match(/^(\S+?)\s*(->>|-->>|-\)|--\)|-x|--x|->|-->)\s*([+-]?)(\S+?)\s*:\s*(.+)$/);if(g){let a=g[1],f=g[2],p=g[3],x=g[4],m=g[5].trim();ke(e,r,a),ke(e,r,x);let u=f.startsWith("--")?"dashed":"solid",b=f.includes(">>")||f.includes("x")?"filled":"open",y={from:a,to:x,label:m,lineStyle:u,arrowHead:b};p==="+"&&(y.activate=true),p==="-"&&(y.deactivate=true),e.messages.push(y);continue}}return e}function ke(t,e,r){e.has(r)||(e.add(r),t.actors.push({id:r,label:r,type:"participant"}));}function vr(t,e){let r=t.split(`
`).map(L=>L.trim()).filter(L=>L.length>0&&!L.startsWith("%%")),n=Ne(r);if(n.actors.length===0)return "";let o=e.useAscii,i=o?"-":"\u2500",c=o?"|":"\u2502",s=o?"+":"\u250C",l=o?"+":"\u2510",d=o?"+":"\u2514",h=o?"+":"\u2518",g=o?"+":"\u252C",a=o?"+":"\u2534",f=o?"+":"\u251C",p=o?"+":"\u2524",x=new Map;n.actors.forEach((L,P)=>x.set(L.id,P));let m=1,b=n.actors.map(L=>gt(L.label)+2*m+2).map(L=>Math.ceil(L/2)),y=3,M=new Array(Math.max(n.actors.length-1,0)).fill(0);for(let L of n.messages){let P=x.get(L.from),T=x.get(L.to);if(P===T)continue;let G=Math.min(P,T),H=Math.max(P,T),V=gt(L.label)+4,B=H-G,O=Math.ceil(V/B);for(let C=G;C<H;C++)M[C]=Math.max(M[C],O);}let A=[b[0]];for(let L=1;L<n.actors.length;L++){let P=Math.max(b[L-1]+b[L]+2,M[L-1]+2,10);A[L]=A[L-1]+P;}let w=[],$=[],k=new Map,I=new Map,X=new Map,N=[],Y=y;for(let L=0;L<n.messages.length;L++){for(let G=0;G<n.blocks.length;G++)n.blocks[G].startIndex===L&&(Y+=2,k.set(G,Y-1));for(let G=0;G<n.blocks.length;G++)for(let H=0;H<n.blocks[G].dividers.length;H++)n.blocks[G].dividers[H].index===L&&(Y+=1,X.set(`${G}:${H}`,Y),Y+=1);Y+=1;let P=n.messages[L];P.from===P.to?($[L]=Y+1,w[L]=Y,Y+=3):($[L]=Y,w[L]=Y+1,Y+=2);for(let G=0;G<n.notes.length;G++)if(n.notes[G].afterIndex===L){Y+=1;let H=n.notes[G],V=H.text.split("\\n"),B=Math.max(...V.map(R=>gt(R)))+4,O=V.length+2,C=x.get(H.actorIds[0])??0,E;if(H.position==="left")E=A[C]-B-1;else if(H.position==="right")E=A[C]+2;else if(H.actorIds.length>=2){let R=x.get(H.actorIds[1])??C;E=Math.floor((A[C]+A[R])/2)-Math.floor(B/2);}else E=A[C]-Math.floor(B/2);E=Math.max(0,E),N.push({x:E,y:Y,width:B,height:O,lines:V}),Y+=O;}for(let G=0;G<n.blocks.length;G++)n.blocks[G].endIndex===L&&(Y+=1,I.set(G,Y),Y+=1);}Y+=1;let q=Y,_=q+y,F=A[A.length-1]??0,D=b[b.length-1]??0,S=F+D+2;for(let L=0;L<n.messages.length;L++){let P=n.messages[L];if(P.from===P.to){let T=x.get(P.from),G=A[T]+6+2+gt(P.label);S=Math.max(S,G+1);}}for(let L of N)S=Math.max(S,L.x+L.width+1);let v=Mt(S,_-1);function z(L,P,T){let G=gt(T)+2*m+2,H=L-Math.floor(G/2);v[H][P]=s;for(let B=1;B<G-1;B++)v[H+B][P]=i;v[H+G-1][P]=l,v[H][P+1]=c,v[H+G-1][P+1]=c;let V=H+1+m;yt(v,{x:V,y:P+1},T),v[H][P+2]=d;for(let B=1;B<G-1;B++)v[H+B][P+2]=i;v[H+G-1][P+2]=h;}for(let L=0;L<n.actors.length;L++){let P=A[L];for(let T=y;T<=q;T++)v[P][T]=c;}for(let L=0;L<n.actors.length;L++){let P=n.actors[L];z(A[L],0,P.label),z(A[L],q,P.label),o||(v[A[L]][y-1]=g,v[A[L]][q]=a);}for(let L=0;L<n.messages.length;L++){let P=n.messages[L],T=x.get(P.from),G=x.get(P.to),H=A[T],V=A[G],B=T===G,O=P.lineStyle==="dashed",C=P.arrowHead==="filled",E=O?o?".":"\u254C":i;if(B){let R=w[L],W=Math.max(4,4);v[H][R]=f;for(let rt=H+1;rt<H+W;rt++)v[rt][R]=E;v[H+W][R]=o?"+":"\u2510",v[H+W][R+1]=c;let J=H+W+2;yt(v,{x:J,y:R+1},P.label);let et=C?o?"<":"\u25C0":o?"<":"\u25C1";v[H][R+2]=et;for(let rt=H+1;rt<H+W;rt++)v[rt][R+2]=E;v[H+W][R+2]=o?"+":"\u2518";}else {let R=$[L],W=w[L],J=H<V,rt=Math.floor((H+V)/2)-Math.floor(gt(P.label)/2);if(yt(v,{x:Math.max(0,rt),y:R},P.label),J){for(let K=H+1;K<V;K++)v[K][W]=E;let dt=C?o?">":"\u25B6":o?">":"\u25B7";v[V][W]=dt;}else {for(let K=V+1;K<H;K++)v[K][W]=E;let dt=C?o?"<":"\u25C0":o?"<":"\u25C1";v[V][W]=dt;}}}for(let L=0;L<n.blocks.length;L++){let P=n.blocks[L],T=k.get(L),G=I.get(L);if(T===void 0||G===void 0)continue;let H=S,V=0;for(let E=P.startIndex;E<=P.endIndex&&!(E>=n.messages.length);E++){let R=n.messages[E],W=x.get(R.from)??0,J=x.get(R.to)??0;H=Math.min(H,A[Math.min(W,J)]),V=Math.max(V,A[Math.max(W,J)]);}let B=Math.max(0,H-4),O=Math.min(S-1,V+4);v[B][T]=s;for(let E=B+1;E<O;E++)v[E][T]=i;v[O][T]=l;let C=P.label?`${P.type} [${P.label}]`:P.type;yt(v,{x:B+1,y:T},ve(C,O-(B+1))),v[B][G]=d;for(let E=B+1;E<O;E++)v[E][G]=i;v[O][G]=h;for(let E=T+1;E<G;E++)v[B][E]=c,v[O][E]=c;for(let E=0;E<P.dividers.length;E++){let R=X.get(`${L}:${E}`);if(R===void 0)continue;let W=j();v[B][R]=f;for(let et=B+1;et<O;et++)v[et][R]=W;v[O][R]=p;let J=P.dividers[E].label;if(J){let et=`[${J}]`;yt(v,{x:B+1,y:R},ve(et,O-(B+1)));}}}for(let L of N){Yt(v,L.x+L.width,L.y+L.height),v[L.x][L.y]=s;for(let T=1;T<L.width-1;T++)v[L.x+T][L.y]=i;v[L.x+L.width-1][L.y]=l;for(let T=0;T<L.lines.length;T++){let G=L.y+1+T;v[L.x][G]=c,v[L.x+L.width-1][G]=c,yt(v,{x:L.x+2,y:G},L.lines[T]);}let P=L.y+L.height-1;v[L.x][P]=d;for(let T=1;T<L.width-1;T++)v[L.x+T][P]=i;v[L.x+L.width-1][P]=h;}return jt(v);function j(){return o?"-":"\u254C"}}function Xe(t){let e={classes:[],relationships:[],namespaces:[]},r=new Map,n=null,o=null,i=0;for(let c=1;c<t.length;c++){let s=t[c];if(o&&i>0){if(s==="}"){i--,i===0&&(o=null);continue}let p=s.match(/^<<(\w+)>>$/);if(p){o.annotation=p[1];continue}let x=kr(s);x&&(x.isMethod?o.methods.push(x.member):o.attributes.push(x.member));continue}let l=s.match(/^namespace\s+(\S+)\s*\{$/);if(l){n={name:l[1],classIds:[]};continue}if(s==="}"&&n){e.namespaces.push(n),n=null;continue}let d=s.match(/^class\s+(\S+?)(?:\s*~(\w+)~)?\s*\{$/);if(d){let p=d[1],x=d[2],m=ge(r,p);x&&(m.label=`${p}<${x}>`),o=m,i=1,n&&n.classIds.push(p);continue}let h=s.match(/^class\s+(\S+?)(?:\s*~(\w+)~)?\s*$/);if(h){let p=h[1],x=h[2],m=ge(r,p);x&&(m.label=`${p}<${x}>`),n&&n.classIds.push(p);continue}let g=s.match(/^class\s+(\S+?)\s*\{\s*<<(\w+)>>\s*\}$/);if(g){let p=ge(r,g[1]);p.annotation=g[2];continue}let a=s.match(/^(\S+?)\s*:\s*(.+)$/);if(a){let p=a[2];if(!p.match(/<\|--|--|\*--|o--|-->|\.\.>|\.\.\|>/)){let x=ge(r,a[1]),m=kr(p);m&&(m.isMethod?x.methods.push(m.member):x.attributes.push(m.member));continue}}let f=ki(s);if(f){ge(r,f.from),ge(r,f.to),e.relationships.push(f);continue}}return e.classes=[...r.values()],e}function ge(t,e){let r=t.get(e);return r||(r={id:e,label:e,attributes:[],methods:[]},t.set(e,r)),r}function kr(t){let e=t.trim().replace(/;$/,"");if(!e)return null;let r="",n=e;/^[+\-#~]/.test(n)&&(r=n[0],n=n.slice(1).trim());let o=n.match(/^(.+?)\(([^)]*)\)(?:\s*(.+))?$/);if(o){let h=o[1].trim(),g=o[3]?.trim(),a=h.endsWith("$")||n.includes("$"),f=h.endsWith("*")||n.includes("*");return {member:{visibility:r,name:h.replace(/[$*]$/,""),type:g||void 0,isStatic:a,isAbstract:f},isMethod:true}}let i=n.split(/\s+/),c,s;i.length>=2?(s=i[0],c=i.slice(1).join(" ")):c=i[0]??n;let l=c.endsWith("$"),d=c.endsWith("*");return {member:{visibility:r,name:c.replace(/[$*]$/,""),type:s||void 0,isStatic:l,isAbstract:d},isMethod:false}}function ki(t){let e=t.match(/^(\S+?)\s+(?:"([^"]*?)"\s+)?(<\|--|<\|\.\.|\*--|o--|-->|--\*|--o|--|>\s*|\.\.>|\.\.\|>|--)\s+(?:"([^"]*?)"\s+)?(\S+?)(?:\s*:\s*(.+))?$/);if(!e)return null;let r=e[1],n=e[2]||void 0,o=e[3].trim(),i=e[4]||void 0,c=e[5],s=e[6]?.trim()||void 0,l=Ei(o);return l?{from:r,to:c,type:l.type,markerAt:l.markerAt,label:s,fromCardinality:n,toCardinality:i}:null}function Ei(t){switch(t){case "<|--":return {type:"inheritance",markerAt:"from"};case "<|..":return {type:"realization",markerAt:"from"};case "*--":return {type:"composition",markerAt:"from"};case "--*":return {type:"composition",markerAt:"to"};case "o--":return {type:"aggregation",markerAt:"from"};case "--o":return {type:"aggregation",markerAt:"to"};case "-->":return {type:"association",markerAt:"to"};case "..>":return {type:"dependency",markerAt:"to"};case "..|>":return {type:"realization",markerAt:"to"};case "--":return {type:"association",markerAt:"to"};default:return null}}function Er(t){let e=t.visibility||"",r=t.type?`: ${t.type}`:"";return `${e}${t.name}${r}`}function $i(t){let e=[];t.annotation&&e.push(`<<${t.annotation}>>`),e.push(t.label);let r=t.attributes.map(Er),n=t.methods.map(Er);return r.length===0&&n.length===0?[e]:n.length===0?[e,r]:[e,r,n]}function Ai(t,e){return {type:t,markerAt:e,dashed:t==="dependency"||t==="realization"}}function xe(t,e,r){switch(t){case "inheritance":case "realization":return r==="down"?e?"^":"\u25B3":r==="up"?e?"v":"\u25BD":r==="left"?e?">":"\u25C1":e?"<":"\u25B7";case "composition":return e?"*":"\u25C6";case "aggregation":return e?"o":"\u25C7";case "association":case "dependency":return r==="down"?e?"v":"\u25BC":r==="up"?e?"^":"\u25B2":r==="left"?e?"<":"\u25C0":e?">":"\u25B6"}}function $r(t,e){let r=t.split(`
`).map(D=>D.trim()).filter(D=>D.length>0&&!D.startsWith("%%")),n=Xe(r);if(n.classes.length===0)return "";let o=e.useAscii,i=n.relationships.reduce((D,S)=>Math.max(D,S.label?gt(` ${S.label} `):0),0),c=Math.max(4,Math.ceil(i/2)+1),s=3,l=new Map,d=new Map,h=new Map;for(let D of n.classes){let S=$i(D);l.set(D.id,S);let v=0;for(let P of S)for(let T of P)v=Math.max(v,gt(T));let z=v+4,j=0;for(let P of S)j+=Math.max(P.length,1);let L=j+(S.length-1)+2;d.set(D.id,z),h.set(D.id,L);}let g=new Map;for(let D of n.classes)g.set(D.id,D);let a=new Map,f=new Map;for(let D of n.relationships){let S=D.type==="inheritance"||D.type==="realization",v=S&&D.markerAt==="to"?D.to:D.from,z=S&&D.markerAt==="to"?D.from:D.to;a.has(z)||a.set(z,new Set),a.get(z).add(v),f.has(v)||f.set(v,new Set),f.get(v).add(z);}let p=new Map,m=n.classes.filter(D=>!a.has(D.id)||a.get(D.id).size===0).map(D=>D.id);for(let D of m)p.set(D,0);let u=n.classes.length-1,b=0;for(;b<m.length;){let D=m[b++],S=f.get(D);if(S)for(let v of S){let z=(p.get(D)??0)+1;z>u||(!p.has(v)||p.get(v)<z)&&(p.set(v,z),m.push(v));}}for(let D of n.classes)p.has(D.id)||p.set(D.id,0);let y=Math.max(...p.values(),0),M=Array.from({length:y+1},()=>[]);for(let D of n.classes)M[p.get(D.id)].push(D.id);let A=new Map,w=0;for(let D=0;D<=y;D++){let S=M[D];if(S.length===0)continue;let v=0,z=0;for(let j of S){let L=g.get(j),P=d.get(j),T=h.get(j);A.set(j,{cls:L,sections:l.get(j),x:v,y:w,width:P,height:T}),v+=P+c,z=Math.max(z,T);}w+=z+s;}let $=0;for(let D of n.relationships){if(!D.label)continue;let S=A.get(D.from),v=A.get(D.to);if(!S||!v)continue;let z=S.x+Math.floor(S.width/2),j=v.x+Math.floor(v.width/2),L=Math.floor((z+j)/2),P=` ${D.label} `,T=L-Math.floor(gt(P)/2);$=Math.min($,T);}let k=$<0?-$:0;if(k>0)for(let D of A.values())D.x+=k;let I=0,X=0;for(let D of A.values())I=Math.max(I,D.x+D.width),X=Math.max(X,D.y+D.height);I+=4,X+=2;let N=Mt(I-1,X-1);for(let D of A.values()){let S=Re(D.sections,o);for(let v=0;v<S.length;v++)for(let z=0;z<S[0].length;z++){let j=S[v][z];if(j!==" "){let L=D.x+v,P=D.y+z;L<I&&P<X&&(N[L][P]=j);}}}let Y=o?"-":"\u2500",q=o?"|":"\u2502",_=o?".":"\u254C",F=o?":":"\u250A";for(let D of n.relationships){let S=A.get(D.from),v=A.get(D.to);if(!S||!v)continue;let z=Ai(D.type,D.markerAt),j=z.dashed?_:Y,L=z.dashed?F:q,P=S.x+Math.floor(S.width/2),T=S.y+S.height-1,G=v.x+Math.floor(v.width/2),H=v.y;if(T<H){let V=T+Math.floor((H-T)/2);for(let B=T+1;B<=V;B++)B<X&&(N[P][B]=L);if(P!==G){let B=Math.min(P,G),O=Math.max(P,G);for(let C=B;C<=O;C++)C<I&&V<X&&(N[C][V]=j);!o&&V<X&&(P<G?(N[P][V]="\u2514",N[G][V]="\u2510"):(N[P][V]="\u2518",N[G][V]="\u250C"));}for(let B=V+1;B<H;B++)B<X&&(N[G][B]=L);if(z.markerAt==="to"){let B=xe(z.type,o,"down"),O=H-1;if(O>=0&&O<X)for(let C=0;C<B.length;C++){let E=G-Math.floor(B.length/2)+C;E>=0&&E<I&&(N[E][O]=B[C]);}}if(z.markerAt==="from"){let B=xe(z.type,o,"down"),O=T+1;if(O<X)for(let C=0;C<B.length;C++){let E=P-Math.floor(B.length/2)+C;E>=0&&E<I&&(N[E][O]=B[C]);}}}else if(v.y+v.height-1<S.y){let V=S.y,B=v.y+v.height-1,O=B+Math.floor((V-B)/2);for(let C=V-1;C>=O;C--)C>=0&&C<X&&(N[P][C]=L);if(P!==G){let C=Math.min(P,G),E=Math.max(P,G);for(let R=C;R<=E;R++)R<I&&O>=0&&O<X&&(N[R][O]=j);!o&&O>=0&&O<X&&(P<G?(N[P][O]="\u250C",N[G][O]="\u2518"):(N[P][O]="\u2510",N[G][O]="\u2514"));}for(let C=O-1;C>B;C--)C>=0&&C<X&&(N[G][C]=L);if(z.markerAt==="from"){let C=xe(z.type,o,"up"),E=V-1;if(E>=0&&E<X)for(let R=0;R<C.length;R++){let W=P-Math.floor(C.length/2)+R;W>=0&&W<I&&(N[W][E]=C[R]);}}if(z.markerAt==="to"){let E=z.type==="inheritance"||z.type==="realization"?"down":"up",R=xe(z.type,o,E),W=B+1;if(W<X)for(let J=0;J<R.length;J++){let et=G-Math.floor(R.length/2)+J;et>=0&&et<I&&(N[et][W]=R[J]);}}}else {let V=Math.max(T,v.y+v.height-1)+2;Yt(N,I,V+1);for(let C=T+1;C<=V;C++)N[P][C]=L;let B=Math.min(P,G),O=Math.max(P,G);for(let C=B;C<=O;C++)N[C][V]=j;for(let C=V-1;C>=v.y+v.height;C--)N[G][C]=L;if(z.markerAt==="from"){let C=xe(z.type,o,"down"),E=T+1;if(E<X)for(let R=0;R<C.length;R++){let W=P-Math.floor(C.length/2)+R;W>=0&&W<I&&(N[W][E]=C[R]);}}if(z.markerAt==="to"){let C=xe(z.type,o,"up"),E=v.y+v.height;if(E<X)for(let R=0;R<C.length;R++){let W=G-Math.floor(C.length/2)+R;W>=0&&W<I&&(N[W][E]=C[R]);}}}if(D.label){let V=` ${D.label} `,B=Math.floor((P+G)/2),O;if(T<H)O=Math.floor((T+1+H-1)/2);else if(v.y+v.height-1<S.y){let E=v.y+v.height-1;O=Math.floor((E+1+S.y-1)/2);}else O=Math.max(T,v.y+v.height-1)+2;let C=B-Math.floor(gt(V)/2);O>=0&&O<X&&yt(N,{x:Math.max(0,C),y:O},V);}}return jt(N)}function Be(t){let e={entities:[],relationships:[]},r=new Map,n=null;for(let o=1;o<t.length;o++){let i=t[o];if(n){if(i==="}"){n=null;continue}let l=Li(i);l&&n.attributes.push(l);continue}let c=i.match(/^(\S+)\s*\{$/);if(c){let l=c[1];n=gn(r,l);continue}let s=_i(i);if(s){gn(r,s.entity1),gn(r,s.entity2),e.relationships.push(s);continue}}return e.entities=[...r.values()],e}function gn(t,e){let r=t.get(e);return r||(r={id:e,label:e,attributes:[]},t.set(e,r)),r}function Li(t){let e=t.match(/^(\S+)\s+(\S+)(?:\s+(.+))?$/);if(!e)return null;let r=e[1],n=e[2],o=e[3]?.trim()??"",i=[],c,s=o.match(/"([^"]*)"/);s&&(c=s[1]);let l=o.replace(/"[^"]*"/,"").trim();for(let d of l.split(/\s+/)){let h=d.toUpperCase();(h==="PK"||h==="FK"||h==="UK")&&i.push(h);}return {type:r,name:n,keys:i,comment:c}}function _i(t){let e=t.match(/^(\S+)\s+([|o}{]+(?:--|\.\.)[|o}{]+)\s+(\S+)\s*:\s*(.+)$/);if(!e)return null;let r=e[1],n=e[2],o=e[3],i=e[4].trim(),c=n.match(/^([|o}{]+)(--|\.\.?)([|o}{]+)$/);if(!c)return null;let s=c[1],l=c[2],d=c[3],h=Ar(s),g=Ar(d),a=l==="--";return !h||!g?null:{entity1:r,entity2:o,cardinality1:h,cardinality2:g,label:i,identifying:a}}function Ar(t){let e=t.split("").sort().join("");return e==="||"?"one":e==="o|"?"zero-one":e==="|}"||e==="{|"?"many":e==="{o"||e==="o{"?"zero-many":null}function Ti(t){return `${t.keys.length>0?t.keys.join(",")+" ":"   "}${t.type} ${t.name}`}function Di(t){let e=[t.label],r=t.attributes.map(Ti);return r.length===0?[e]:[e,r]}function Ge(t,e){if(e)switch(t){case "one":return "||";case "zero-one":return "o|";case "many":return "}|";case "zero-many":return "o{"}else switch(t){case "one":return "\u2551";case "zero-one":return "o\u2551";case "many":return "\u255F";case "zero-many":return "o\u255F"}}function Lr(t,e){let r=t.split(`
`).map(k=>k.trim()).filter(k=>k.length>0&&!k.startsWith("%%")),n=Be(r);if(n.entities.length===0)return "";let o=e.useAscii,i=n.relationships.reduce((k,I)=>Math.max(k,gt(I.label)),0),c=Math.max(6,i),s=4,l=new Map,d=new Map,h=new Map;for(let k of n.entities){let I=Di(k);l.set(k.id,I);let X=0;for(let _ of I)for(let F of _)X=Math.max(X,gt(F));let N=X+4,Y=0;for(let _ of I)Y+=Math.max(_.length,1);let q=Y+(I.length-1)+2;d.set(k.id,N),h.set(k.id,q);}let g=Math.max(2,Math.ceil(Math.sqrt(n.entities.length))),a=new Map,f=0,p=0,x=0,m=0;for(let k of n.entities){let I=d.get(k.id),X=h.get(k.id);m>=g&&(p+=x+s,f=0,x=0,m=0),a.set(k.id,{entity:k,sections:l.get(k.id),x:f,y:p,width:I,height:X}),f+=I+c,x=Math.max(x,X),m++;}let u=0,b=0;for(let k of a.values())u=Math.max(u,k.x+k.width),b=Math.max(b,k.y+k.height);u+=4,b+=2;let y=Mt(u-1,b-1);for(let k of a.values()){let I=Re(k.sections,o);for(let X=0;X<I.length;X++)for(let N=0;N<I[0].length;N++){let Y=I[X][N];if(Y!==" "){let q=k.x+X,_=k.y+N;q<u&&_<b&&(y[q][_]=Y);}}}let M=o?"-":"\u2500",A=o?"|":"\u2502",w=o?".":"\u254C",$=o?":":"\u250A";for(let k of n.relationships){let I=a.get(k.entity1),X=a.get(k.entity2);if(!I||!X)continue;let N=k.identifying?M:w,Y=k.identifying?A:$,q=I.x+Math.floor(I.width/2),_=I.y+Math.floor(I.height/2),F=X.x+Math.floor(X.width/2),D=X.y+Math.floor(X.height/2);if(Math.abs(_-D)<Math.max(I.height,X.height)){let[v,z]=q<F?[I,X]:[X,I],[j,L]=q<F?[k.cardinality1,k.cardinality2]:[k.cardinality2,k.cardinality1],P=v.x+v.width,T=z.x-1,G=v.y+Math.floor(v.height/2);for(let B=P;B<=T;B++)B<u&&(y[B][G]=N);let H=Ge(j,o);for(let B=0;B<H.length;B++){let O=P+B;O<u&&(y[O][G]=H[B]);}let V=Ge(L,o);for(let B=0;B<V.length;B++){let O=T-V.length+1+B;O>=0&&O<u&&(y[O][G]=V[B]);}if(k.label){let B=Math.floor((P+T)/2),O=Math.max(P,B-Math.floor(gt(k.label)/2)),C=G-1;if(C>=0){let E=Math.max(0,T-O+1),R=ve(k.label,E);yt(y,{x:O,y:C},R);}}}else {let[v,z]=_<D?[I,X]:[X,I],[j,L]=_<D?[k.cardinality1,k.cardinality2]:[k.cardinality2,k.cardinality1],P=v.y+v.height,T=z.y-1,G=v.x+Math.floor(v.width/2);for(let C=P;C<=T;C++)C<b&&(y[G][C]=Y);let H=z.x+Math.floor(z.width/2);if(G!==H){let C=Math.floor((P+T)/2),E=Math.min(G,H),R=Math.max(G,H);for(let W=E;W<=R;W++)W<u&&C<b&&(y[W][C]=N);for(let W=C+1;W<=T;W++)W<b&&(y[H][W]=Y);}let V=Ge(j,o);if(P<b)for(let C=0;C<V.length;C++){let E=G-Math.floor(V.length/2)+C;E>=0&&E<u&&(y[E][P]=V[C]);}let B=G!==H?H:G,O=Ge(L,o);if(T>=0&&T<b)for(let C=0;C<O.length;C++){let E=B-Math.floor(O.length/2)+C;E>=0&&E<u&&(y[E][T]=O[C]);}if(k.label){let C=Math.floor((P+T)/2),E=G+2;C>=0&&yt(y,{x:E,y:C},k.label);}}}return jt(y)}function Ir(t){let e=t.trim().split(/[\n;]/)[0]?.trim().toLowerCase()??"";return /^sequencediagram\s*$/.test(e)?"sequence":/^classdiagram\s*$/.test(e)?"class":/^erdiagram\s*$/.test(e)?"er":"flowchart"}function Pr(t){let e=t.useAscii??false,r=t.routing??(e?"strict":"relaxed");return {useAscii:e,paddingX:t.paddingX??5,paddingY:t.paddingY??5,boxBorderPadding:t.boxBorderPadding??1,graphDirection:"TD",routing:r}}function Rr(t,e){let r=Ce(t);r.direction==="LR"||r.direction==="RL"?e.graphDirection="LR":e.graphDirection="TD";let n=zn(r,e);Sr(n),Mr(n);let o=r.direction==="BT";if(o&&Un(n.canvas),!n.config.useAscii){let i=new Map;for(let c of n.edges)for(let[s,l]of pr(n,c))i.set(s,l);Wn(n.canvas,i);}return {graph:n,flippedVertically:o}}function Pi(t){let e=t.nodes.filter(n=>n.drawingCoord&&n.drawing).map(n=>{let[o,i]=$t(n.drawing);return {id:n.name,label:n.displayLabel,box:{x:n.drawingCoord.x,y:n.drawingCoord.y,width:o+1,height:i+1}}}),r=t.edges.map(n=>({from:n.from.name,to:n.to.name,label:n.text,path:gr(t,n)}));return {nodes:e,edges:r}}function Ri(t,e){return {nodes:t.nodes.map(r=>({...r,box:{...r.box,y:e-(r.box.y+r.box.height-1)}})),edges:t.edges.map(r=>({...r,path:r.path.map(n=>({x:n.x,y:e-n.y}))}))}}function Ye(t,e={}){let r=Pr(e);switch(Ir(t)){case "sequence":return vr(t,r);case "class":return $r(t,r);case "er":return Lr(t,r);default:{let{graph:o}=Rr(t,r);return jt(o.canvas)}}}function xn(t,e={}){let r=Pr(e);switch(Ir(t)){case "sequence":case "class":case "er":return {text:Ye(t,e),meta:{nodes:[],edges:[]}};default:{let{graph:o,flippedVertically:i}=Rr(t,r),c=jt(o.canvas),s=Pi(o);if(!i)return {text:c,meta:s};let[,l]=$t(o.canvas);return {text:c,meta:Ri(s,l)}}}}var Ae=Ke(Fe());function wt(t,e,r){let n=r>=600?.58:r>=500?.55:.52;return t.length*e*n}function He(t,e){return t.length*e*.6}var at={nodeLabel:13,edgeLabel:11,groupHeader:12},mt={nodeLabel:500,edgeLabel:400,groupHeader:600},Nr=8,be={horizontal:16,vertical:10,diamondExtra:24},xt={outerBox:1,innerBox:.75,connector:.75},vt="0.35em",ye={width:8,height:4.8};function zt(t,e,r,n){return {x:t-r/2,y:e-n/2}}function Ee(t,e,r,n,o){let i=t.x-e,c=t.y-r;if(Math.abs(i)<.5&&Math.abs(c)<.5)return t;let s=1/(Math.abs(i)/n+Math.abs(c)/o);return {x:e+s*i,y:r+s*c}}function $e(t,e,r,n){let o=t.x-e,i=t.y-r,c=Math.sqrt(o*o+i*i);if(c<.5)return t;let s=n/c;return {x:e+s*o,y:r+s*i}}function te(t,e=true){if(t.length<2)return t;let r=[t[0]];for(let n=1;n<t.length;n++){let o=r[r.length-1],i=t[n],c=Math.abs(i.x-o.x),s=Math.abs(i.y-o.y);if(c<1||s<1){r.push(i);continue}e?r.push({x:o.x,y:i.y}):r.push({x:i.x,y:o.y}),r.push(i);}return Ni(r)}function Ni(t){if(t.length<3)return t;let e=[t[0]];for(let r=1;r<t.length-1;r++){let n=e[e.length-1],o=t[r],i=t[r+1],c=Math.abs(n.x-o.x)<1&&Math.abs(o.x-i.x)<1,s=Math.abs(n.y-o.y)<1&&Math.abs(o.y-i.y)<1;c||s||e.push(o);}return e.push(t[t.length-1]),e}function ce(t,e,r){if(t.length<2)return t;let n=t.map(o=>({...o}));if(r){let o=n.length-1;if(t.length===2){let i=n[0],c=n[o],s=Math.abs(c.x-i.x);if(Math.abs(c.y-i.y)>=s){let h=c.y>i.y?r.cy-r.hh:r.cy+r.hh;n[o]={x:c.x,y:h};}else {let h=c.x>i.x?r.cx-r.hw:r.cx+r.hw;n[o]={x:h,y:c.y};}}else {let i=n[o-1],c=n[o],s=Math.abs(c.x-i.x),l=Math.abs(c.y-i.y),d=l<1&&s>=1,h=s<1&&l>=1,g=!d&&!h&&l<s,a=!d&&!h&&s<l;if(d){let p=c.x>i.x?r.cx-r.hw:r.cx+r.hw;n[o]={x:p,y:r.cy},n[o-1]={...i,y:r.cy};}else if(h){let p=c.y>i.y?r.cy-r.hh:r.cy+r.hh;n[o]={x:r.cx,y:p},n[o-1]={...i,x:r.cx};}else if(g){let p=c.x>i.x?r.cx-r.hw:r.cx+r.hw;i.y>=r.cy-r.hh&&i.y<=r.cy+r.hh?n[o]={x:p,y:i.y}:(n[o]={x:p,y:r.cy},n[o-1]={...i,y:r.cy});}else if(a){let p=c.y>i.y?r.cy-r.hh:r.cy+r.hh;i.x>=r.cx-r.hw&&i.x<=r.cx+r.hw?n[o]={x:i.x,y:p}:(n[o]={x:r.cx,y:p},n[o-1]={...i,x:r.cx});}}}if(e&&t.length>=3){let o=n[0],i=n[1],c=Math.abs(i.x-o.x),s=Math.abs(i.y-o.y),l=s<1&&c>=1,d=c<1&&s>=1,h=!l&&!d&&s<c,g=!l&&!d&&c<s;if(l){let f=i.x>o.x?e.cx+e.hw:e.cx-e.hw;n[0]={x:f,y:e.cy},n[1]={...n[1],y:e.cy};}else if(d){let f=i.y>o.y?e.cy+e.hh:e.cy-e.hh;n[0]={x:e.cx,y:f},n[1]={...n[1],x:e.cx};}else if(h){let f=i.x>o.x?e.cx+e.hw:e.cx-e.hw;i.y>=e.cy-e.hh&&i.y<=e.cy+e.hh?n[0]={x:f,y:i.y}:(n[0]={x:f,y:e.cy},n[1]={...n[1],y:e.cy});}else if(g){let f=i.y>o.y?e.cy+e.hh:e.cy-e.hh;i.x>=e.cx-e.hw&&i.x<=e.cx+e.hw?n[0]={x:i.x,y:f}:(n[0]={x:e.cx,y:f},n[1]={...n[1],x:e.cx});}}return n}function Xr(t){let e=Array.from(t.nodes.keys());if(e.length===0)return [];let r=new Map,n=new Map;for(let h of e)r.set(h,h),n.set(h,0);function o(h){return r.get(h)!==h&&r.set(h,o(r.get(h))),r.get(h)}function i(h,g){let a=o(h),f=o(g);if(a===f)return;let p=n.get(a),x=n.get(f);p<x?r.set(a,f):p>x?r.set(f,a):(r.set(f,a),n.set(a,p+1));}for(let h of t.edges)r.has(h.source)&&r.has(h.target)&&i(h.source,h.target);function c(h){let g=[...h.nodeIds];for(let a of h.children)s(a,g);if(r.has(h.id)&&g.length>0)for(let a of g)r.has(a)&&i(h.id,a);if(g.length>1){let a=g[0];for(let f=1;f<g.length;f++)r.has(a)&&r.has(g[f])&&i(a,g[f]);}for(let a of h.children)c(a);}function s(h,g){g.push(...h.nodeIds);for(let a of h.children)s(a,g);}for(let h of t.subgraphs)c(h);let l=new Map;for(let h of e){let g=o(h);l.has(g)||l.set(g,new Set),l.get(g).add(h);}let d=[];for(let[h,g]of l){let a={nodeIds:g,subgraphIds:new Set,edgeIndices:new Set};for(let f=0;f<t.edges.length;f++){let p=t.edges[f];g.has(p.source)&&g.has(p.target)&&a.edgeIndices.add(f);}d.push(a);}return Br(t.subgraphs,d),d.sort((h,g)=>{let a=Math.min(...Array.from(h.nodeIds).map(p=>p.charCodeAt(0))),f=Math.min(...Array.from(g.nodeIds).map(p=>p.charCodeAt(0)));return a-f}),d}function Br(t,e){for(let r of t){let n=Gr(r);if(n.size>0){let o=n.values().next().value;for(let i of e)if(i.nodeIds.has(o)){i.subgraphIds.add(r.id),Yr(r,i.subgraphIds);break}}Br(r.children,e);}}function Gr(t){let e=new Set(t.nodeIds);for(let r of t.children)for(let n of Gr(r))e.add(n);return e}function Yr(t,e){for(let r of t.children)e.add(r.id),Yr(r,e);}function Fr(t,e,r){if(t.length===0)return {width:0,height:0,nodes:[],edges:[],groups:[]};if(t.length===1)return t[0];let n=e==="TD"||e==="TB"||e==="BT",o={width:0,height:0,nodes:[],edges:[],groups:[]},i=0;for(let c=0;c<t.length;c++){let s=t[c];if(n){for(let l of s.nodes)o.nodes.push({...l,x:l.x+i});for(let l of s.edges)o.edges.push({...l,points:l.points.map(d=>({x:d.x+i,y:d.y})),labelPosition:l.labelPosition?{x:l.labelPosition.x+i,y:l.labelPosition.y}:void 0});for(let l of s.groups)o.groups.push(Hr(l,i));o.width=i+s.width,o.height=Math.max(o.height,s.height),i+=s.width+r;}else {for(let l of s.nodes)o.nodes.push({...l,y:l.y+i});for(let l of s.edges)o.edges.push({...l,points:l.points.map(d=>({x:d.x,y:d.y+i})),labelPosition:l.labelPosition?{x:l.labelPosition.x,y:l.labelPosition.y+i}:void 0});for(let l of s.groups)o.groups.push(Wr(l,i));o.width=Math.max(o.width,s.width),o.height=i+s.height,i+=s.height+r;}}return o}function Hr(t,e){return {...t,x:t.x+e,children:t.children.map(r=>Hr(r,e))}}function Wr(t,e){return {...t,y:t.y+e,children:t.children.map(r=>Wr(r,e))}}var We=new Set(["circle","doublecircle","state-start","state-end"]),Ue=new Set(["diamond","circle","doublecircle","state-start","state-end"]),Xi={font:"Inter",padding:40,nodeSpacing:24,layerSpacing:40};function Bi(t,e,r){let n=new Ae.default.graphlib.Graph({directed:true,compound:true});n.setGraph({rankdir:Kr(t.direction),acyclicer:"greedy",nodesep:r.nodeSpacing,ranksep:r.layerSpacing,marginx:16,marginy:12}),n.setDefaultEdgeLabel(()=>({}));let o=new Set;o.add(t.id),Mn(t,o);for(let a of t.nodeIds){let f=e.nodes.get(a);if(f){let p=yn(a,f.label,f.shape);n.setNode(a,{label:f.label,width:p.width,height:p.height});}}for(let a of t.children)wn(n,a,e);let i=new Set;for(let a=0;a<e.edges.length;a++){let f=e.edges[a];if(o.has(f.source)&&o.has(f.target)){i.add(a);let p={_index:a};f.label&&(p.label=f.label,p.width=wt(f.label,at.edgeLabel,mt.edgeLabel)+8,p.height=at.edgeLabel+6,p.labelpos="c"),n.setEdge(f.source,f.target,p);}}Ae.default.layout(n);let c=t.direction==="TD"||t.direction==="TB"||t.direction==="BT",s=new Set;for(let a of t.children)Sn(a,s);let l=[];for(let a of n.nodes()){if(s.has(a))continue;let f=e.nodes.get(a);if(!f)continue;let p=n.node(a);if(!p)continue;let x=zt(p.x,p.y,p.width,p.height);l.push({id:a,label:f.label,shape:f.shape,x:x.x,y:x.y,width:p.width,height:p.height,inlineStyle:Jr(e,a)});}let d=n.edges().map(a=>{let f=n.edge(a),p=e.edges[f._index],x=f.points??[];if(x.length>0){let $=e.nodes.get(a.v)?.shape;if($==="diamond"){let I=n.node(a.v);x[0]=Ee(x[0],I.x,I.y,I.width/2,I.height/2);}else if($&&We.has($)){let I=n.node(a.v);x[0]=$e(x[0],I.x,I.y,Math.min(I.width,I.height)/2);}let k=e.nodes.get(a.w)?.shape;if(k==="diamond"){let I=n.node(a.w),X=x.length-1;x[X]=Ee(x[X],I.x,I.y,I.width/2,I.height/2);}else if(k&&We.has(k)){let I=n.node(a.w),X=x.length-1;x[X]=$e(x[X],I.x,I.y,Math.min(I.width,I.height)/2);}}let m=te(x,c),u=e.nodes.get(a.v)?.shape,b=e.nodes.get(a.w)?.shape,y=u&&!Ue.has(u)||!u?(()=>{let $=n.node(a.v);return $?{cx:$.x,cy:$.y,hw:$.width/2,hh:$.height/2}:null})():null,M=b&&!Ue.has(b)||!b?(()=>{let $=n.node(a.w);return $?{cx:$.x,cy:$.y,hw:$.width/2,hh:$.height/2}:null})():null,A=ce(m,y,M),w;return p.label&&f.x!=null&&f.y!=null&&(w={x:f.x,y:f.y}),{source:p.source,target:p.target,label:p.label,style:p.style,hasArrowStart:p.hasArrowStart,hasArrowEnd:p.hasArrowEnd,points:A,labelPosition:w}}),h=t.children.map(a=>Cn(n,a)),g=n.graph();return {id:t.id,label:t.label,width:g.width??200,height:g.height??100,nodes:l,edges:d,groups:h,nodeIds:o,internalEdgeIndices:i}}async function jr(t,e={}){let r={...Xi,...e},n=Xr(t);if(n.length>1){let o=[];for(let s of n){let l=Gi(t,s),d=await Ur(l,r);o.push(d);}let c=(r.componentSpacing??r.nodeSpacing)-2*r.padding;return Fr(o,t.direction,c)}return Ur(t,r)}function Gi(t,e){let r=new Set,n=Vr(t.subgraphs,e.subgraphIds);for(let c of n)zr(c,r);let o=new Map(Array.from(t.nodes.entries()).filter(([c])=>e.nodeIds.has(c)&&!r.has(c))),i=t.edges.filter((c,s)=>e.edgeIndices.has(s));return {direction:t.direction,nodes:o,edges:i,subgraphs:n,classDefs:t.classDefs,classAssignments:t.classAssignments,nodeStyles:t.nodeStyles}}function zr(t,e){e.add(t.id);for(let r of t.children)zr(r,e);}function Vr(t,e){return t.filter(r=>e.has(r.id)).map(r=>({...r,children:Vr(r.children,e)}))}async function Ur(t,e){let r=new Map;for(let d of t.subgraphs)d.direction&&d.direction!==t.direction&&r.set(d.id,Bi(d,t,e));let n=new Ae.default.graphlib.Graph({directed:true,compound:true});n.setGraph({rankdir:Kr(t.direction),acyclicer:"greedy",nodesep:e.nodeSpacing,ranksep:e.layerSpacing,marginx:e.padding,marginy:e.padding}),n.setDefaultEdgeLabel(()=>({}));let o=new Set;for(let d of t.subgraphs)o.add(d.id),Mn(d,o);for(let[d,h]of t.nodes)if(!o.has(d)){let g=yn(d,h.label,h.shape);n.setNode(d,{label:h.label,width:g.width,height:g.height});}for(let d of t.subgraphs)if(r.has(d.id)){let h=r.get(d.id);n.setNode(d.id,{width:h.width,height:h.height});}else wn(n,d,t);let i=new Map,c=new Map;for(let d of t.subgraphs)r.has(d.id)||qr(d,i,c);for(let[d,h]of r)for(let g of h.nodeIds)i.set(g,d),c.set(g,d);let s=new Set;for(let d of r.values())for(let h of d.internalEdgeIndices)s.add(h);let l=new Set;for(let d=0;d<t.edges.length;d++){if(s.has(d))continue;let h=t.edges[d],g=c.get(h.source)??h.source,a=i.get(h.target)??h.target,f={_index:d};h.label&&(f.label=h.label,f.width=wt(h.label,at.edgeLabel,mt.edgeLabel)+8,f.height=at.edgeLabel+6,f.labelpos="c"),l.has(a)||(f.weight=2,l.add(a)),n.setEdge(g,a,f);}try{Ae.default.layout(n);}catch(d){let h=d instanceof Error?d.message:String(d);throw new Error(`Dagre layout failed: ${h}`)}return Yi(n,t,e.padding,r)}function Kr(t){switch(t){case "LR":return "LR";case "RL":return "RL";case "BT":return "BT";default:return "TB"}}function yn(t,e,r){let o=wt(e,at.nodeLabel,mt.nodeLabel)+be.horizontal*2,i=at.nodeLabel+be.vertical*2;if(r==="diamond"){let c=Math.max(o,i)+be.diamondExtra;o=c,i=c;}if(r==="circle"||r==="doublecircle"){let c=Math.ceil(Math.sqrt(o*o+i*i))+8;o=r==="doublecircle"?c+12:c,i=o;}return r==="hexagon"&&(o+=be.horizontal),(r==="trapezoid"||r==="trapezoid-alt")&&(o+=be.horizontal),r==="asymmetric"&&(o+=12),r==="cylinder"&&(i+=14),(r==="state-start"||r==="state-end")&&(o=28,i=28),o=Math.max(o,60),i=Math.max(i,36),{width:o,height:i}}function wn(t,e,r,n){t.setNode(e.id,{label:e.label}),n&&t.setParent(e.id,n);for(let o of e.nodeIds){let i=r.nodes.get(o);if(i){let c=yn(o,i.label,i.shape);t.setNode(o,{label:i.label,width:c.width,height:c.height}),t.setParent(o,e.id);}}for(let o of e.children)wn(t,o,r,e.id);}function qr(t,e,r){for(let c of t.children)qr(c,e,r);let n=[...t.nodeIds,...t.children.map(c=>c.id)];if(n.length===0){e.set(t.id,t.id),r.set(t.id,t.id);return}let o=n[0],i=n[n.length-1];e.set(t.id,e.get(o)??o),r.set(t.id,r.get(i)??i);}function Jr(t,e){let r=t.classAssignments.get(e),n=r?t.classDefs.get(r):void 0,o=t.nodeStyles.get(e);if(!(!n&&!o))return {...n,...o}}function Mn(t,e){for(let r of t.nodeIds)e.add(r);for(let r of t.children)Mn(r,e);}function Yi(t,e,r,n){let o=[],i=[],c=new Set;for(let u of e.subgraphs)Sn(u,c);let s=new Set;if(n)for(let u of n.values())for(let b of u.nodeIds)s.add(b);for(let u of t.nodes()){if(c.has(u))continue;let b=e.nodes.get(u);if(!b)continue;let y=t.node(u);if(!y)continue;let M=zt(y.x,y.y,y.width,y.height);o.push({id:u,label:b.label,shape:b.shape,x:M.x,y:M.y,width:y.width,height:y.height,inlineStyle:Jr(e,u)});}for(let u of e.subgraphs)i.push(Cn(t,u));let l=e.direction==="TD"||e.direction==="TB"||e.direction==="BT",d=t.edges().map(u=>{let b=t.edge(u),y=e.edges[b._index],M=b.points??[];if(M.length>0){let Y=e.nodes.get(u.v)?.shape;if(Y==="diamond"){let _=t.node(u.v);M[0]=Ee(M[0],_.x,_.y,_.width/2,_.height/2);}else if(Y&&We.has(Y)){let _=t.node(u.v);M[0]=$e(M[0],_.x,_.y,Math.min(_.width,_.height)/2);}let q=e.nodes.get(u.w)?.shape;if(q==="diamond"){let _=t.node(u.w),F=M.length-1;M[F]=Ee(M[F],_.x,_.y,_.width/2,_.height/2);}else if(q&&We.has(q)){let _=t.node(u.w),F=M.length-1;M[F]=$e(M[F],_.x,_.y,Math.min(_.width,_.height)/2);}}let A=te(M,l),w=e.nodes.get(u.v)?.shape,$=e.nodes.get(u.w)?.shape,k=w&&!Ue.has(w)||!w?(()=>{let Y=t.node(u.v);return Y?{cx:Y.x,cy:Y.y,hw:Y.width/2,hh:Y.height/2}:null})():null,I=$&&!Ue.has($)||!$?(()=>{let Y=t.node(u.w);return Y?{cx:Y.x,cy:Y.y,hw:Y.width/2,hh:Y.height/2}:null})():null,X=ce(A,k,I),N;return y.label&&b.x!=null&&b.y!=null&&(N={x:b.x,y:b.y}),{source:y.source,target:y.target,label:y.label,style:y.style,hasArrowStart:y.hasArrowStart,hasArrowEnd:y.hasArrowEnd,points:X,labelPosition:N}});if(n&&n.size>0){let u=new Map;for(let b of o)u.set(b.id,{cx:b.x+b.width/2,cy:b.y+b.height/2});for(let[b,y]of n){let M=t.node(b);if(!M)continue;let A=zt(M.x,M.y,M.width,M.height);for(let $ of y.nodes){let k={...$,x:$.x+A.x,y:$.y+A.y};o.push(k),u.set(k.id,{cx:k.x+k.width/2,cy:k.y+k.height/2});}for(let $ of y.edges)d.push({...$,points:$.points.map(k=>({x:k.x+A.x,y:k.y+A.y})),labelPosition:$.labelPosition?{x:$.labelPosition.x+A.x,y:$.labelPosition.y+A.y}:void 0});let w=to(i,b);w&&y.groups.length>0&&(w.children=y.groups.map($=>eo($,A.x,A.y)));}for(let b of d){if(s.has(b.source)&&s.has(b.target))continue;let y=false;if(s.has(b.source)){let M=u.get(b.source);M&&b.points.length>0&&(b.points[0]={x:M.cx,y:M.cy},y=true);}if(s.has(b.target)){let M=u.get(b.target);M&&b.points.length>0&&(b.points[b.points.length-1]={x:M.cx,y:M.cy},y=true);}y&&(b.points=te(b.points,l));}}let h=at.groupHeader+16;Fi(i,h);let g=Qr(i),a=[...o.map(u=>u.y),...g.map(u=>u.y)],f=a.length>0?Math.min(...a):r,p=t.graph().width??800,x=t.graph().height??600;if(f<r){let u=r-f;for(let b of o)b.y+=u;for(let b of d){for(let y of b.points)y.y+=u;b.labelPosition&&(b.labelPosition.y+=u);}for(let b of g)b.y+=u;x+=u;}let m=Math.max(...o.map(u=>u.y+u.height),...g.map(u=>u.y+u.height),...d.flatMap(u=>u.points.map(b=>b.y)));return m+r>x&&(x=m+r),{width:p,height:x,nodes:o,edges:d,groups:i}}function Cn(t,e){let r=t.node(e.id),n=r?zt(r.x,r.y,r.width,r.height):{x:0,y:0};return {id:e.id,label:e.label,x:n.x,y:n.y,width:r?.width??0,height:r?.height??0,children:e.children.map(o=>Cn(t,o))}}function Fi(t,e){for(let r of t)Zr(r,e);}function Zr(t,e){for(let r of t.children)Zr(r,e);if(t.children.length>0){let r=t.y,n=t.y+t.height;for(let o of t.children)r=Math.min(r,o.y),n=Math.max(n,o.y+o.height);t.height=n-r,t.y=r;}if(t.label){let r=e+Nr;t.y-=r,t.height+=r;}}function Qr(t){let e=[];for(let r of t)e.push(r),e.push(...Qr(r.children));return e}function to(t,e){for(let r of t){if(r.id===e)return r;let n=to(r.children,e);if(n)return n}}function eo(t,e,r){return {...t,x:t.x+e,y:t.y+r,children:t.children.map(n=>eo(n,e,r))}}function Sn(t,e){e.add(t.id);for(let r of t.children)Sn(r,e);}function ro(t,e,r="Inter",n=false){let o=[];o.push(Jt(t.width,t.height,e,n)),o.push(qt(r,false)),o.push("<defs>"),o.push(Hi()),o.push("</defs>");for(let i of t.groups)o.push(oo(i));for(let i of t.edges)o.push(Wi(i));for(let i of t.edges)i.label&&o.push(ji(i));for(let i of t.nodes)o.push(Vi(i));for(let i of t.nodes)o.push(ls(i));return o.push("</svg>"),o.join(`
`)}function Hi(){let t=ye.width,e=ye.height;return `  <marker id="arrowhead" markerWidth="${t}" markerHeight="${e}" refX="${t}" refY="${e/2}" orient="auto">
    <polygon points="0 0, ${t} ${e/2}, 0 ${e}" fill="var(--_arrow)" />
  </marker>
  <marker id="arrowhead-start" markerWidth="${t}" markerHeight="${e}" refX="0" refY="${e/2}" orient="auto-start-reverse">
    <polygon points="${t} 0, 0 ${e/2}, ${t} ${e}" fill="var(--_arrow)" />
  </marker>`}function oo(t,e){let r=at.groupHeader+16,n=[];n.push(`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" rx="0" ry="0" fill="var(--_group-fill)" stroke="var(--_node-stroke)" stroke-width="${xt.outerBox}" />`),n.push(`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${r}" rx="0" ry="0" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="${xt.outerBox}" />`),n.push(`<text x="${t.x+12}" y="${t.y+r/2}" dy="${vt}" font-size="${at.groupHeader}" font-weight="${mt.groupHeader}" fill="var(--_text-sec)">${le(t.label)}</text>`);for(let o of t.children)n.push(oo(o));return n.join(`
`)}function Wi(t){if(t.points.length<2)return "";let e=Ui(t.points),r=t.style==="dotted"?' stroke-dasharray="4 4"':"",n=t.style==="thick"?xt.connector*2:xt.connector,o="";return t.hasArrowEnd&&(o+=' marker-end="url(#arrowhead)"'),t.hasArrowStart&&(o+=' marker-start="url(#arrowhead-start)"'),`<polyline points="${e}" fill="none" stroke="var(--_line)" stroke-width="${n}"${r}${o} />`}function Ui(t){return t.map(e=>`${e.x},${e.y}`).join(" ")}function ji(t,e){let r=t.labelPosition??zi(t.points),n=t.label,o=wt(n,at.edgeLabel,mt.edgeLabel),i=8,c=o+i*2,s=at.edgeLabel+i*2;return `<rect x="${r.x-c/2}" y="${r.y-s/2}" width="${c}" height="${s}" rx="4" ry="4" fill="var(--bg)" stroke="var(--_inner-stroke)" stroke-width="0.5" />
<text x="${r.x}" y="${r.y}" text-anchor="middle" dy="${vt}" font-size="${at.edgeLabel}" font-weight="${mt.edgeLabel}" fill="var(--_text-muted)">${le(n)}</text>`}function zi(t){if(t.length===0)return {x:0,y:0};if(t.length===1)return t[0];let e=0;for(let n=1;n<t.length;n++)e+=no(t[n-1],t[n]);let r=e/2;for(let n=1;n<t.length;n++){let o=no(t[n-1],t[n]);if(r<=o){let i=r/o;return {x:t[n-1].x+i*(t[n].x-t[n-1].x),y:t[n-1].y+i*(t[n].y-t[n-1].y)}}r-=o;}return t[t.length-1]}function no(t,e){return Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2)}function Vi(t){let{x:e,y:r,width:n,height:o,shape:i,inlineStyle:c}=t,s=le(c?.fill??"var(--_node-fill)"),l=le(c?.stroke??"var(--_node-stroke)"),d=le(c?.["stroke-width"]??String(xt.innerBox));switch(i){case "diamond":return Qi(e,r,n,o,s,l,d);case "rounded":return qi(e,r,n,o,s,l,d);case "stadium":return Ji(e,r,n,o,s,l,d);case "circle":return Zi(e,r,n,o,s,l,d);case "subroutine":return ts(e,r,n,o,s,l,d);case "doublecircle":return es(e,r,n,o,s,l,d);case "hexagon":return ns(e,r,n,o,s,l,d);case "cylinder":return rs(e,r,n,o,s,l,d);case "asymmetric":return os(e,r,n,o,s,l,d);case "trapezoid":return is(e,r,n,o,s,l,d);case "trapezoid-alt":return ss(e,r,n,o,s,l,d);case "state-start":return as(e,r,n,o);case "state-end":return cs(e,r,n,o);default:return Ki(e,r,n,o,s,l,d)}}function Ki(t,e,r,n,o,i,c){return `<rect x="${t}" y="${e}" width="${r}" height="${n}" rx="0" ry="0" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function qi(t,e,r,n,o,i,c){return `<rect x="${t}" y="${e}" width="${r}" height="${n}" rx="6" ry="6" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function Ji(t,e,r,n,o,i,c){let s=n/2;return `<rect x="${t}" y="${e}" width="${r}" height="${n}" rx="${s}" ry="${s}" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function Zi(t,e,r,n,o,i,c){let s=t+r/2,l=e+n/2,d=Math.min(r,n)/2;return `<circle cx="${s}" cy="${l}" r="${d}" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function Qi(t,e,r,n,o,i,c){let s=t+r/2,l=e+n/2,d=r/2,h=n/2;return `<polygon points="${[`${s},${l-h}`,`${s+d},${l}`,`${s},${l+h}`,`${s-d},${l}`].join(" ")}" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function ts(t,e,r,n,o,i,c){return `<rect x="${t}" y="${e}" width="${r}" height="${n}" rx="0" ry="0" fill="${o}" stroke="${i}" stroke-width="${c}" />
<line x1="${t+8}" y1="${e}" x2="${t+8}" y2="${e+n}" stroke="${i}" stroke-width="${c}" />
<line x1="${t+r-8}" y1="${e}" x2="${t+r-8}" y2="${e+n}" stroke="${i}" stroke-width="${c}" />`}function es(t,e,r,n,o,i,c){let s=t+r/2,l=e+n/2,d=Math.min(r,n)/2,h=d-5;return `<circle cx="${s}" cy="${l}" r="${d}" fill="${o}" stroke="${i}" stroke-width="${c}" />
<circle cx="${s}" cy="${l}" r="${h}" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function ns(t,e,r,n,o,i,c){let s=n/4;return `<polygon points="${[`${t+s},${e}`,`${t+r-s},${e}`,`${t+r},${e+n/2}`,`${t+r-s},${e+n}`,`${t+s},${e+n}`,`${t},${e+n/2}`].join(" ")}" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function rs(t,e,r,n,o,i,c){let l=t+r/2,d=e+7,h=n-14;return `<rect x="${t}" y="${d}" width="${r}" height="${h}" fill="${o}" stroke="none" />
<line x1="${t}" y1="${d}" x2="${t}" y2="${d+h}" stroke="${i}" stroke-width="${c}" />
<line x1="${t+r}" y1="${d}" x2="${t+r}" y2="${d+h}" stroke="${i}" stroke-width="${c}" />
<ellipse cx="${l}" cy="${e+n-7}" rx="${r/2}" ry="7" fill="${o}" stroke="${i}" stroke-width="${c}" />
<ellipse cx="${l}" cy="${d}" rx="${r/2}" ry="7" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function os(t,e,r,n,o,i,c){return `<polygon points="${[`${t+12},${e}`,`${t+r},${e}`,`${t+r},${e+n}`,`${t+12},${e+n}`,`${t},${e+n/2}`].join(" ")}" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function is(t,e,r,n,o,i,c){let s=r*.15;return `<polygon points="${[`${t+s},${e}`,`${t+r-s},${e}`,`${t+r},${e+n}`,`${t},${e+n}`].join(" ")}" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function ss(t,e,r,n,o,i,c){let s=r*.15;return `<polygon points="${[`${t},${e}`,`${t+r},${e}`,`${t+r-s},${e+n}`,`${t+s},${e+n}`].join(" ")}" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function as(t,e,r,n){let o=t+r/2,i=e+n/2,c=Math.min(r,n)/2-2;return `<circle cx="${o}" cy="${i}" r="${c}" fill="var(--_text)" stroke="none" />`}function cs(t,e,r,n){let o=t+r/2,i=e+n/2,c=Math.min(r,n)/2-2,s=c-4;return `<circle cx="${o}" cy="${i}" r="${c}" fill="none" stroke="var(--_text)" stroke-width="${xt.innerBox*2}" />
<circle cx="${o}" cy="${i}" r="${s}" fill="var(--_text)" stroke="none" />`}function ls(t,e){if((t.shape==="state-start"||t.shape==="state-end")&&!t.label)return "";let r=t.x+t.width/2,n=t.y+t.height/2,o=le(t.inlineStyle?.color??"var(--_text)");return `<text x="${r}" y="${n}" text-anchor="middle" dy="${vt}" font-size="${at.nodeLabel}" font-weight="${mt.nodeLabel}" fill="${o}">${le(t.label)}</text>`}function le(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}var pt={padding:30,actorGap:140,actorHeight:40,actorPadX:16,headerGap:20,messageRowHeight:40,selfMessageHeight:30,activationWidth:10,blockPadX:10,blockPadTop:40,blockPadBottom:8,blockHeaderExtra:28,dividerExtra:24,noteWidth:120,notePadding:8,noteGap:10};function io(t,e={}){if(t.actors.length===0)return {width:0,height:0,actors:[],lifelines:[],messages:[],activations:[],blocks:[],notes:[]};let r=t.actors.map(w=>{let $=wt(w.label,at.nodeLabel,mt.nodeLabel);return Math.max($+pt.actorPadX*2,80)}),n=[],o=pt.padding+r[0]/2;for(let w=0;w<t.actors.length;w++){if(w>0){let $=Math.max(pt.actorGap,(r[w-1]+r[w])/2+40);o+=$;}n.push(o);}let i=new Map;for(let w=0;w<t.actors.length;w++)i.set(t.actors[w].id,w);let c=pt.padding,s=t.actors.map((w,$)=>({id:w.id,label:w.label,type:w.type,x:n[$],y:c,width:r[$],height:pt.actorHeight})),l=c+pt.actorHeight+pt.headerGap,d=[],h=new Map;for(let w of t.blocks){let $=h.get(w.startIndex)??0;h.set(w.startIndex,Math.max($,pt.blockHeaderExtra));for(let k of w.dividers){let I=h.get(k.index)??0;h.set(k.index,Math.max(I,pt.dividerExtra));}}let g=new Map,a=[];for(let w=0;w<t.messages.length;w++){let $=t.messages[w],k=i.get($.from)??0,I=i.get($.to)??0,X=$.from===$.to,N=h.get(w)??0;N>0&&(l+=N);let Y=n[k],q=n[I];if(d.push({from:$.from,to:$.to,label:$.label,lineStyle:$.lineStyle,arrowHead:$.arrowHead,x1:Y,x2:q,y:l,isSelf:X}),$.activate&&(g.has($.to)||g.set($.to,[]),g.get($.to).push(l)),$.deactivate){let _=g.get($.from);if(_&&_.length>0){let F=_.pop(),D=i.get($.from)??0;a.push({actorId:$.from,x:n[D]-pt.activationWidth/2,topY:F,bottomY:l,width:pt.activationWidth});}}l+=X?pt.selfMessageHeight+pt.messageRowHeight:pt.messageRowHeight;}for(let[w,$]of g)for(let k of $){let I=i.get(w)??0;a.push({actorId:w,x:n[I]-pt.activationWidth/2,topY:k,bottomY:l-pt.messageRowHeight/2,width:pt.activationWidth});}let f=t.blocks.map(w=>{let $=d[w.startIndex],k=d[w.endIndex],I=($?.y??l)-pt.blockPadTop,X=(k?.y??l)+pt.blockPadBottom+12,N=new Set;for(let S=w.startIndex;S<=w.endIndex;S++){let v=t.messages[S];v&&(N.add(i.get(v.from)??0),N.add(i.get(v.to)??0));}if(N.size===0)for(let S=0;S<t.actors.length;S++)N.add(S);let Y=Math.min(...N),q=Math.max(...N),_=n[Y]-r[Y]/2-pt.blockPadX,F=n[q]+r[q]/2+pt.blockPadX,D=w.dividers.map(S=>{let v=d[S.index],z=v?.y??l,j=28;if(S.label&&v?.label){let L=`[${S.label}]`,P=wt(L,at.edgeLabel,mt.edgeLabel),T=_+8,G=T+P,H=wt(v.label,at.edgeLabel,mt.edgeLabel),V=v.isSelf?v.x1+36:(v.x1+v.x2)/2-H/2,B=V+H;G>V&&T<B&&(j=36);}return {y:z-j,label:S.label}});return {type:w.type,label:w.label,x:_,y:I,width:F-_,height:X-I,dividers:D}}),p=t.notes.map(w=>{let $=Math.max(pt.noteWidth,wt(w.text,at.edgeLabel,mt.edgeLabel)+pt.notePadding*2),k=at.edgeLabel+pt.notePadding*2,X=(d[w.afterIndex]?.y??c+pt.actorHeight)+4,N=i.get(w.actorIds[0]??"")??0,Y;if(w.position==="left")Y=n[N]-r[N]/2-$-pt.noteGap;else if(w.position==="right")Y=n[N]+r[N]/2+pt.noteGap;else if(w.actorIds.length>1){let q=i.get(w.actorIds[w.actorIds.length-1]??"")??N;Y=(n[N]+n[q])/2-$/2;}else Y=n[N]-$/2;return {text:w.text,x:Y,y:X,width:$,height:k}}),x=l+pt.padding,m=pt.padding,u=0;for(let w of s)m=Math.min(m,w.x-w.width/2),u=Math.max(u,w.x+w.width/2);for(let w of f)m=Math.min(m,w.x),u=Math.max(u,w.x+w.width);for(let w of p)m=Math.min(m,w.x),u=Math.max(u,w.x+w.width);let b=m<pt.padding?pt.padding-m:0;if(b>0){for(let w of s)w.x+=b;for(let w of d)w.x1+=b,w.x2+=b;for(let w of a)w.x+=b;for(let w of f)w.x+=b;for(let w of p)w.x+=b;for(let w=0;w<n.length;w++)n[w]+=b;}let y=t.actors.map((w,$)=>({actorId:w.id,x:n[$],topY:c+pt.actorHeight,bottomY:x-pt.padding})),M=u+b+pt.padding,A=x;return {width:Math.max(M,200),height:Math.max(A,100),actors:s,lifelines:y,messages:d,activations:a,blocks:f,notes:p}}function so(t,e,r="Inter",n=false){let o=[];o.push(Jt(t.width,t.height,e,n)),o.push(qt(r,false)),o.push("<defs>"),o.push(ds()),o.push("</defs>");for(let i of t.blocks)o.push(ps(i));for(let i of t.lifelines)o.push(us(i));for(let i of t.activations)o.push(hs(i));for(let i of t.messages)o.push(ms(i));for(let i of t.notes)o.push(gs(i));for(let i of t.actors)o.push(fs(i));return o.push("</svg>"),o.join(`
`)}function ds(){let t=ye.width,e=ye.height;return `  <marker id="seq-arrow" markerWidth="${t}" markerHeight="${e}" refX="${t}" refY="${e/2}" orient="auto-start-reverse">
    <polygon points="0 0, ${t} ${e/2}, 0 ${e}" fill="var(--_arrow)" />
  </marker>
  <marker id="seq-arrow-open" markerWidth="${t}" markerHeight="${e}" refX="${t}" refY="${e/2}" orient="auto-start-reverse">
    <polyline points="0 0, ${t} ${e/2}, 0 ${e}" fill="none" stroke="var(--_arrow)" stroke-width="1" />
  </marker>`}function fs(t){let{x:e,y:r,width:n,height:o,label:i,type:c}=t;if(c==="actor"){let l=o/24*.9,d=e-12*l,h=r+(o-24*l)/2,g=xt.outerBox/l,a="var(--_line)";return `<g transform="translate(${d},${h}) scale(${l})">
  <path d="M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" fill="none" stroke="${a}" stroke-width="${g}" />
  <path d="M15 10C15 11.6569 13.6569 13 12 13C10.3431 13 9 11.6569 9 10C9 8.34315 10.3431 7 12 7C13.6569 7 15 8.34315 15 10Z" fill="none" stroke="${a}" stroke-width="${g}" />
  <path d="M5.62842 18.3563C7.08963 17.0398 9.39997 16 12 16C14.6 16 16.9104 17.0398 18.3716 18.3563" fill="none" stroke="${a}" stroke-width="${g}" />
</g>
<text x="${e}" y="${r+o+14}" text-anchor="middle" font-size="${at.nodeLabel}" font-weight="${mt.nodeLabel}" fill="var(--_text)">${de(i)}</text>`}return `<rect x="${e-n/2}" y="${r}" width="${n}" height="${o}" rx="4" ry="4" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="${xt.outerBox}" />
<text x="${e}" y="${r+o/2}" text-anchor="middle" dy="${vt}" font-size="${at.nodeLabel}" font-weight="${mt.nodeLabel}" fill="var(--_text)">${de(i)}</text>`}function us(t){return `<line x1="${t.x}" y1="${t.topY}" x2="${t.x}" y2="${t.bottomY}" stroke="var(--_line)" stroke-width="0.75" stroke-dasharray="6 4" />`}function hs(t){return `<rect x="${t.x}" y="${t.topY}" width="${t.width}" height="${t.bottomY-t.topY}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="${xt.innerBox}" />`}function ms(t){let e=[],r=t.lineStyle==="dashed"?' stroke-dasharray="6 4"':"",n=t.arrowHead==="filled"?"seq-arrow":"seq-arrow-open";if(t.isSelf)e.push(`<polyline points="${t.x1},${t.y} ${t.x1+30},${t.y} ${t.x1+30},${t.y+20} ${t.x2},${t.y+20}" fill="none" stroke="var(--_line)" stroke-width="${xt.connector}"${r} marker-end="url(#${n})" />`),e.push(`<text x="${t.x1+30+6}" y="${t.y+20/2}" dy="${vt}" font-size="${at.edgeLabel}" font-weight="${mt.edgeLabel}" fill="var(--_text-muted)">${de(t.label)}</text>`);else {e.push(`<line x1="${t.x1}" y1="${t.y}" x2="${t.x2}" y2="${t.y}" stroke="var(--_line)" stroke-width="${xt.connector}"${r} marker-end="url(#${n})" />`);let o=(t.x1+t.x2)/2;e.push(`<text x="${o}" y="${t.y-6}" text-anchor="middle" font-size="${at.edgeLabel}" font-weight="${mt.edgeLabel}" fill="var(--_text-muted)">${de(t.label)}</text>`);}return e.join(`
`)}function ps(t){let e=[];e.push(`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" rx="0" ry="0" fill="none" stroke="var(--_node-stroke)" stroke-width="${xt.outerBox}" />`);let r=`${t.type}${t.label?` [${t.label}]`:""}`,n=wt(r,at.edgeLabel,mt.groupHeader)+16,o=18;e.push(`<rect x="${t.x}" y="${t.y}" width="${n}" height="${o}" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="${xt.outerBox}" />`),e.push(`<text x="${t.x+6}" y="${t.y+o/2}" dy="${vt}" font-size="${at.edgeLabel}" font-weight="${mt.groupHeader}" fill="var(--_text-sec)">${de(r)}</text>`);for(let i of t.dividers)e.push(`<line x1="${t.x}" y1="${i.y}" x2="${t.x+t.width}" y2="${i.y}" stroke="var(--_line)" stroke-width="0.75" stroke-dasharray="6 4" />`),i.label&&e.push(`<text x="${t.x+8}" y="${i.y+14}" font-size="${at.edgeLabel}" font-weight="${mt.edgeLabel}" fill="var(--_text-muted)">[${de(i.label)}]</text>`);return e.join(`
`)}function gs(t){return `<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="${xt.innerBox}" />
<polygon points="${t.x+t.width-6},${t.y} ${t.x+t.width},${t.y+6} ${t.x+t.width-6},${t.y+6}" fill="var(--_inner-stroke)" />
<text x="${t.x+t.width/2}" y="${t.y+t.height/2}" text-anchor="middle" dy="${vt}" font-size="${at.edgeLabel}" font-weight="${mt.edgeLabel}" fill="var(--_text-muted)">${de(t.text)}</text>`}function de(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}var vn=Ke(Fe());var Ct={padding:40,boxPadX:8,headerBaseHeight:32,annotationHeight:16,memberRowHeight:20,sectionPadY:8,emptySectionHeight:8,minWidth:120,memberFontSize:11,nodeSpacing:40,layerSpacing:60};async function co(t,e={}){if(t.classes.length===0)return {width:0,height:0,classes:[],relationships:[]};let r=new Map;for(let s of t.classes){let l=s.annotation?Ct.headerBaseHeight+Ct.annotationHeight:Ct.headerBaseHeight,d=s.attributes.length>0?s.attributes.length*Ct.memberRowHeight+Ct.sectionPadY:Ct.emptySectionHeight,h=s.methods.length>0?s.methods.length*Ct.memberRowHeight+Ct.sectionPadY:Ct.emptySectionHeight,g=wt(s.label,at.nodeLabel,mt.nodeLabel),a=ao(s.attributes),f=ao(s.methods),p=Math.max(Ct.minWidth,g+Ct.boxPadX*2,a+Ct.boxPadX*2,f+Ct.boxPadX*2),x=l+d+h;r.set(s.id,{width:p,height:x,headerHeight:l,attrHeight:d,methodHeight:h});}let n=new vn.default.graphlib.Graph({directed:true});n.setGraph({rankdir:"TB",acyclicer:"greedy",nodesep:Ct.nodeSpacing,ranksep:Ct.layerSpacing,marginx:Ct.padding,marginy:Ct.padding}),n.setDefaultEdgeLabel(()=>({}));for(let s of t.classes){let l=r.get(s.id);n.setNode(s.id,{width:l.width,height:l.height});}for(let s=0;s<t.relationships.length;s++){let l=t.relationships[s],d={_index:s};l.label&&(d.label=l.label,d.width=wt(l.label,at.edgeLabel,mt.edgeLabel)+8,d.height=at.edgeLabel+6,d.labelpos="c"),n.setEdge(l.from,l.to,d);}try{vn.default.layout(n);}catch(s){let l=s instanceof Error?s.message:String(s);throw new Error(`Dagre layout failed (class diagram): ${l}`)}let o=new Map;for(let s of t.classes)o.set(s.id,s);let i=t.classes.map(s=>{let l=n.node(s.id),d=r.get(s.id),h=zt(l.x,l.y,l.width,l.height);return {id:s.id,label:s.label,annotation:s.annotation,attributes:s.attributes,methods:s.methods,x:h.x,y:h.y,width:l.width??d.width,height:l.height??d.height,headerHeight:d.headerHeight,attrHeight:d.attrHeight,methodHeight:d.methodHeight}}),c=n.edges().map(s=>{let l=n.edge(s),d=t.relationships[l._index],h=l.points??[],g=te(h,true),a=n.node(s.v),f=n.node(s.w),p=ce(g,a?{cx:a.x,cy:a.y,hw:a.width/2,hh:a.height/2}:null,f?{cx:f.x,cy:f.y,hw:f.width/2,hh:f.height/2}:null),x;return d.label&&l.x!=null&&l.y!=null&&(x={x:l.x,y:l.y}),{from:d.from,to:d.to,type:d.type,markerAt:d.markerAt,label:d.label,fromCardinality:d.fromCardinality,toCardinality:d.toCardinality,points:p,labelPosition:x}});return {width:n.graph().width??600,height:n.graph().height??400,classes:i,relationships:c}}function ao(t){if(t.length===0)return 0;let e=0;for(let r of t){let n=xs(r),o=He(n,Ct.memberFontSize);o>e&&(e=o);}return e}function xs(t){let e=t.visibility?`${t.visibility} `:"",r=t.type?`: ${t.type}`:"";return `${e}${t.name}${r}`}var je={memberSize:11,memberWeight:400,annotationSize:10,annotationWeight:500};function uo(t,e,r="Inter",n=false){let o=[];o.push(Jt(t.width,t.height,e,n)),o.push(qt(r,true)),o.push("<defs>"),o.push(bs()),o.push("</defs>");for(let i of t.relationships)o.push(ws(i));for(let i of t.classes)o.push(ys(i));for(let i of t.relationships)o.push(Ss(i));return o.push("</svg>"),o.join(`
`)}function bs(){return `  <marker id="cls-inherit" markerWidth="12" markerHeight="10" refX="12" refY="5" orient="auto-start-reverse">
    <polygon points="0 0, 12 5, 0 10" fill="var(--bg)" stroke="var(--_arrow)" stroke-width="1.5" />
  </marker>
  <marker id="cls-composition" markerWidth="12" markerHeight="10" refX="0" refY="5" orient="auto-start-reverse">
    <polygon points="6 0, 12 5, 6 10, 0 5" fill="var(--_arrow)" stroke="var(--_arrow)" stroke-width="1" />
  </marker>
  <marker id="cls-aggregation" markerWidth="12" markerHeight="10" refX="0" refY="5" orient="auto-start-reverse">
    <polygon points="6 0, 12 5, 6 10, 0 5" fill="var(--bg)" stroke="var(--_arrow)" stroke-width="1.5" />
  </marker>
  <marker id="cls-arrow" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto-start-reverse">
    <polyline points="0 0, 8 3, 0 6" fill="none" stroke="var(--_arrow)" stroke-width="1.5" />
  </marker>`}function ys(t){let{x:e,y:r,width:n,height:o,headerHeight:i,attrHeight:c,methodHeight:s}=t,l=[];l.push(`<rect x="${e}" y="${r}" width="${n}" height="${o}" rx="0" ry="0" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="${xt.outerBox}" />`),l.push(`<rect x="${e}" y="${r}" width="${n}" height="${i}" rx="0" ry="0" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="${xt.outerBox}" />`);let d=r+i/2;if(t.annotation){let f=r+12;l.push(`<text x="${e+n/2}" y="${f}" text-anchor="middle" dy="${vt}" font-size="${je.annotationSize}" font-weight="${je.annotationWeight}" font-style="italic" fill="var(--_text-muted)">&lt;&lt;${ee(t.annotation)}&gt;&gt;</text>`),d=r+i/2+6;}l.push(`<text x="${e+n/2}" y="${d}" text-anchor="middle" dy="${vt}" font-size="${at.nodeLabel}" font-weight="700" fill="var(--_text)">${ee(t.label)}</text>`);let h=r+i;l.push(`<line x1="${e}" y1="${h}" x2="${e+n}" y2="${h}" stroke="var(--_node-stroke)" stroke-width="${xt.innerBox}" />`);let g=20;for(let f=0;f<t.attributes.length;f++){let p=t.attributes[f],x=h+4+f*g+g/2;l.push(lo(p,e+Ct.boxPadX,x));}let a=h+c;l.push(`<line x1="${e}" y1="${a}" x2="${e+n}" y2="${a}" stroke="var(--_node-stroke)" stroke-width="${xt.innerBox}" />`);for(let f=0;f<t.methods.length;f++){let p=t.methods[f],x=a+4+f*g+g/2;l.push(lo(p,e+Ct.boxPadX,x));}return l.join(`
`)}function lo(t,e,r){let n=t.isAbstract?' font-style="italic"':"",o=t.isStatic?' text-decoration="underline"':"",i=[];return t.visibility&&i.push(`<tspan fill="var(--_text-faint)">${ee(t.visibility)} </tspan>`),i.push(`<tspan fill="var(--_text-sec)">${ee(t.name)}</tspan>`),t.type&&(i.push('<tspan fill="var(--_text-faint)">: </tspan>'),i.push(`<tspan fill="var(--_text-muted)">${ee(t.type)}</tspan>`)),`<text x="${e}" y="${r}" class="mono" dy="${vt}" font-size="${je.memberSize}" font-weight="${je.memberWeight}"${n}${o}>${i.join("")}</text>`}function ws(t){if(t.points.length<2)return "";let e=t.points.map(i=>`${i.x},${i.y}`).join(" "),n=t.type==="dependency"||t.type==="realization"?' stroke-dasharray="6 4"':"",o=Ms(t.type,t.markerAt);return `<polyline points="${e}" fill="none" stroke="var(--_line)" stroke-width="${xt.connector}"${n}${o} />`}function Ms(t,e){let r=Cs(t);return r?e==="from"?` marker-start="url(#${r})"`:` marker-end="url(#${r})"`:""}function Cs(t){switch(t){case "inheritance":case "realization":return "cls-inherit";case "composition":return "cls-composition";case "aggregation":return "cls-aggregation";case "association":case "dependency":return "cls-arrow";default:return null}}function Ss(t){if(!t.label&&!t.fromCardinality&&!t.toCardinality||t.points.length<2)return "";let e=[];if(t.label){let r=t.labelPosition??vs(t.points);e.push(`<text x="${r.x}" y="${r.y-8}" text-anchor="middle" font-size="${at.edgeLabel}" font-weight="${mt.edgeLabel}" fill="var(--_text-muted)">${ee(t.label)}</text>`);}if(t.fromCardinality){let r=t.points[0],n=t.points[1],o=fo(r,n);e.push(`<text x="${r.x+o.x}" y="${r.y+o.y}" text-anchor="middle" font-size="${at.edgeLabel}" font-weight="${mt.edgeLabel}" fill="var(--_text-muted)">${ee(t.fromCardinality)}</text>`);}if(t.toCardinality){let r=t.points[t.points.length-1],n=t.points[t.points.length-2],o=fo(r,n);e.push(`<text x="${r.x+o.x}" y="${r.y+o.y}" text-anchor="middle" font-size="${at.edgeLabel}" font-weight="${mt.edgeLabel}" fill="var(--_text-muted)">${ee(t.toCardinality)}</text>`);}return e.join(`
`)}function vs(t){if(t.length===0)return {x:0,y:0};let e=Math.floor(t.length/2);return t[e]}function fo(t,e){let r=e.x-t.x,n=e.y-t.y;return Math.abs(r)>Math.abs(n)?{x:r>0?14:-14,y:-10}:{x:-14,y:n>0?14:-14}}function ee(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}var kn=Ke(Fe());var Xt={padding:40,boxPadX:12,headerHeight:32,rowHeight:22,minWidth:140,attrFontSize:11,nodeSpacing:50,layerSpacing:70};async function ho(t,e={}){if(t.entities.length===0)return {width:0,height:0,entities:[],relationships:[]};let r=new Map;for(let s of t.entities){let l=wt(s.label,at.nodeLabel,mt.nodeLabel),d=0;for(let a of s.attributes){let f=`${a.type}  ${a.name}${a.keys.length>0?"  "+a.keys.join(","):""}`,p=He(f,Xt.attrFontSize);p>d&&(d=p);}let h=Math.max(Xt.minWidth,l+Xt.boxPadX*2,d+Xt.boxPadX*2),g=Xt.headerHeight+Math.max(s.attributes.length,1)*Xt.rowHeight;r.set(s.id,{width:h,height:g});}let n=new kn.default.graphlib.Graph({directed:true});n.setGraph({rankdir:"LR",acyclicer:"greedy",nodesep:Xt.nodeSpacing,ranksep:Xt.layerSpacing,marginx:Xt.padding,marginy:Xt.padding}),n.setDefaultEdgeLabel(()=>({}));for(let s of t.entities){let l=r.get(s.id);n.setNode(s.id,{width:l.width,height:l.height});}for(let s=0;s<t.relationships.length;s++){let l=t.relationships[s];n.setEdge(l.entity1,l.entity2,{_index:s,label:l.label,width:wt(l.label,at.edgeLabel,mt.edgeLabel)+8,height:at.edgeLabel+6,labelpos:"c"});}try{kn.default.layout(n);}catch(s){let l=s instanceof Error?s.message:String(s);throw new Error(`Dagre layout failed (ER diagram): ${l}`)}let o=new Map;for(let s of t.entities)o.set(s.id,s);let i=t.entities.map(s=>{let l=n.node(s.id),d=zt(l.x,l.y,l.width,l.height);return {id:s.id,label:s.label,attributes:s.attributes,x:d.x,y:d.y,width:l.width??r.get(s.id).width,height:l.height??r.get(s.id).height,headerHeight:Xt.headerHeight,rowHeight:Xt.rowHeight}}),c=n.edges().map(s=>{let l=n.edge(s),d=t.relationships[l._index],h=l.points??[],g=te(h,false),a=n.node(s.v),f=n.node(s.w),p=ce(g,a?{cx:a.x,cy:a.y,hw:a.width/2,hh:a.height/2}:null,f?{cx:f.x,cy:f.y,hw:f.width/2,hh:f.height/2}:null);return {entity1:d.entity1,entity2:d.entity2,cardinality1:d.cardinality1,cardinality2:d.cardinality2,label:d.label,identifying:d.identifying,points:p}});return {width:n.graph().width??600,height:n.graph().height??400,entities:i,relationships:c}}var Vt={attrSize:11,attrWeight:400,keySize:9,keyWeight:600};function po(t,e,r="Inter",n=false){let o=[];o.push(Jt(t.width,t.height,e,n)),o.push(qt(r,true)),o.push("<defs>"),o.push("</defs>");for(let i of t.relationships)o.push($s(i));for(let i of t.entities)o.push(ks(i));for(let i of t.relationships)o.push(Ls(i));for(let i of t.relationships)o.push(As(i));return o.push("</svg>"),o.join(`
`)}function ks(t){let{x:e,y:r,width:n,height:o,headerHeight:i,rowHeight:c,label:s,attributes:l}=t,d=[];d.push(`<rect x="${e}" y="${r}" width="${n}" height="${o}" rx="0" ry="0" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="${xt.outerBox}" />`),d.push(`<rect x="${e}" y="${r}" width="${n}" height="${i}" rx="0" ry="0" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="${xt.outerBox}" />`),d.push(`<text x="${e+n/2}" y="${r+i/2}" text-anchor="middle" dy="${vt}" font-size="${at.nodeLabel}" font-weight="700" fill="var(--_text)">${ze(s)}</text>`);let h=r+i;d.push(`<line x1="${e}" y1="${h}" x2="${e+n}" y2="${h}" stroke="var(--_node-stroke)" stroke-width="${xt.innerBox}" />`);for(let g=0;g<l.length;g++){let a=l[g],f=h+g*c+c/2;d.push(Es(a,e,f,n));}return l.length===0&&d.push(`<text x="${e+n/2}" y="${h+c/2}" text-anchor="middle" dy="${vt}" font-size="${Vt.attrSize}" fill="var(--_text-faint)" font-style="italic">(no attributes)</text>`),d.join(`
`)}function Es(t,e,r,n){let o=[],i=0;if(t.keys.length>0){let l=t.keys.join(",");i=wt(l,Vt.keySize,Vt.keyWeight)+8,o.push(`<rect x="${e+6}" y="${r-7}" width="${i}" height="14" rx="2" ry="2" fill="var(--_key-badge)" />`),o.push(`<text x="${e+6+i/2}" y="${r}" text-anchor="middle" dy="${vt}" font-size="${Vt.keySize}" font-weight="${Vt.keyWeight}" fill="var(--_text-sec)">${t.keys.join(",")}</text>`);}let c=e+8+(i>0?i+6:0);o.push(`<text x="${c}" y="${r}" class="mono" dy="${vt}" font-size="${Vt.attrSize}" font-weight="${Vt.attrWeight}"><tspan fill="var(--_text-muted)">${ze(t.type)}</tspan></text>`);let s=e+n-8;return o.push(`<text x="${s}" y="${r}" class="mono" text-anchor="end" dy="${vt}" font-size="${Vt.attrSize}" font-weight="${Vt.attrWeight}"><tspan fill="var(--_text-sec)">${ze(t.name)}</tspan></text>`),o.join(`
`)}function $s(t){if(t.points.length<2)return "";let e=t.points.map(n=>`${n.x},${n.y}`).join(" "),r=t.identifying?"":' stroke-dasharray="6 4"';return `<polyline points="${e}" fill="none" stroke="var(--_line)" stroke-width="${xt.connector}"${r} />`}function As(t){if(!t.label||t.points.length<2)return "";let e=_s(t.points),n=wt(t.label,at.edgeLabel,mt.edgeLabel)+8,o=at.edgeLabel+6;return `<rect x="${e.x-n/2}" y="${e.y-o/2}" width="${n}" height="${o}" rx="2" ry="2" fill="var(--bg)" stroke="var(--_inner-stroke)" stroke-width="0.5" />
<text x="${e.x}" y="${e.y}" text-anchor="middle" dy="${vt}" font-size="${at.edgeLabel}" font-weight="${mt.edgeLabel}" fill="var(--_text-muted)">${ze(t.label)}</text>`}function Ls(t){if(t.points.length<2)return "";let e=[],r=t.points[0],n=t.points[1];e.push(mo(r,n,t.cardinality1));let o=t.points[t.points.length-1],i=t.points[t.points.length-2];return e.push(mo(o,i,t.cardinality2)),e.join(`
`)}function mo(t,e,r){let n=[],o=xt.connector+.25,i=t.x-e.x,c=t.y-e.y,s=Math.sqrt(i*i+c*c);if(s===0)return "";let l=i/s,d=c/s,h=-d,g=l,a=t.x-l*4,f=t.y-d*4,p=t.x-l*16,x=t.y-d*16,m=r==="one"||r==="zero-one",u=r==="many"||r==="zero-many",b=r==="zero-one"||r==="zero-many";if(m){n.push(`<line x1="${a+h*6}" y1="${f+g*6}" x2="${a-h*6}" y2="${f-g*6}" stroke="var(--_line)" stroke-width="${o}" />`);let M=a-l*4,A=f-d*4;n.push(`<line x1="${M+h*6}" y1="${A+g*6}" x2="${M-h*6}" y2="${A-g*6}" stroke="var(--_line)" stroke-width="${o}" />`);}if(u){let M=a,A=f;n.push(`<line x1="${M+h*7}" y1="${A+g*7}" x2="${p}" y2="${x}" stroke="var(--_line)" stroke-width="${o}" />`),n.push(`<line x1="${M}" y1="${A}" x2="${p}" y2="${x}" stroke="var(--_line)" stroke-width="${o}" />`),n.push(`<line x1="${M-h*7}" y1="${A-g*7}" x2="${p}" y2="${x}" stroke="var(--_line)" stroke-width="${o}" />`);}if(b){let y=u?20:12,M=t.x-l*y,A=t.y-d*y;n.push(`<circle cx="${M}" cy="${A}" r="4" fill="var(--bg)" stroke="var(--_line)" stroke-width="${o}" />`);}return n.join(`
`)}function _s(t){if(t.length===0)return {x:0,y:0};if(t.length===1)return t[0];let e=0;for(let o=1;o<t.length;o++){let i=t[o].x-t[o-1].x,c=t[o].y-t[o-1].y;e+=Math.sqrt(i*i+c*c);}if(e===0)return t[0];let r=e/2,n=0;for(let o=1;o<t.length;o++){let i=t[o].x-t[o-1].x,c=t[o].y-t[o-1].y,s=Math.sqrt(i*i+c*c);if(n+s>=r){let l=s>0?(r-n)/s:0;return {x:t[o-1].x+i*l,y:t[o-1].y+c*l}}n+=s;}return t[t.length-1]}function ze(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function Ts(t){let e=t.trim().split(/[\n;]/)[0]?.trim().toLowerCase()??"";return /^sequencediagram\s*$/.test(e)?"sequence":/^classdiagram\s*$/.test(e)?"class":/^erdiagram\s*$/.test(e)?"er":"flowchart"}function Ds(t){return {bg:t.bg??fe.bg,fg:t.fg??fe.fg,line:t.line,accent:t.accent,muted:t.muted,surface:t.surface,border:t.border}}async function go(t,e={}){let r=Ds(e),n=e.font??"Inter",o=e.transparent??false,i=Ts(t),c=t.split(/[\n;]/).map(s=>s.trim()).filter(s=>s.length>0&&!s.startsWith("%%"));switch(i){case "sequence":{let s=Ne(c),l=io(s,e);return so(l,r,n,o)}case "class":{let s=Xe(c),l=await co(s,e);return uo(l,r,n,o)}case "er":{let s=Be(c),l=await ho(s,e);return po(l,r,n,o)}default:{let s=Ce(t),l=await jr(s,e);return ro(l,r,n,o)}}}typeof window<"u"&&(window.__mermaid={renderMermaid:go,renderMermaidAscii:Ye,renderMermaidAsciiWithMeta:xn,THEMES:qe,DEFAULTS:fe,fromShikiTheme:Je});exports.DEFAULTS=fe;exports.THEMES=qe;exports.fromShikiTheme=Je;exports.renderMermaid=go;exports.renderMermaidAscii=Ye;exports.renderMermaidAsciiWithMeta=xn;return exports;})({});//# sourceMappingURL=beautiful-mermaid.browser.global.js.map
//# sourceMappingURL=beautiful-mermaid.browser.global.js.map