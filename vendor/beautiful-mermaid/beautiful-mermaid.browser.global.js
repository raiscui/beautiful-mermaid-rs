var beautifulMermaid=(function(exports){'use strict';var Jn=Object.create;var Wt=Object.defineProperty;var Zn=Object.getOwnPropertyDescriptor;var Qn=Object.getOwnPropertyNames;var er=Object.getPrototypeOf,tr=Object.prototype.hasOwnProperty;var qe=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var nr=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var rr=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Qn(t))!tr.call(e,o)&&o!==r&&Wt(e,o,{get:()=>t[o],enumerable:!(n=Zn(t,o))||n.enumerable});return e};var bt=(e,t,r)=>(r=e!=null?Jn(er(e)):{},rr(Wt(r,"default",{value:e,enumerable:true}),e));var ut=nr((xn,Lt)=>{(function(e){if(typeof xn=="object"&&typeof Lt<"u")Lt.exports=e();else if(typeof define=="function"&&define.amd)define([],e);else {var t;typeof window<"u"?t=window:typeof global<"u"?t=global:typeof self<"u"?t=self:t=this,t.dagre=e();}})(function(){return (function(){function n(o,i,c){function s(f,u){if(!i[f]){if(!o[f]){var a=typeof qe=="function"&&qe;if(!u&&a)return a(f,true);if(l)return l(f,true);var d=new Error("Cannot find module '"+f+"'");throw d.code="MODULE_NOT_FOUND",d}var p=i[f]={exports:{}};o[f][0].call(p.exports,function(x){var g=o[f][1][x];return s(g||x)},p,p.exports,n,o,i,c);}return i[f].exports}for(var l=typeof qe=="function"&&qe,h=0;h<c.length;h++)s(c[h]);return s}return n})()({1:[function(n,o,i){o.exports={graphlib:n("@dagrejs/graphlib"),layout:n("./lib/layout"),debug:n("./lib/debug"),util:{time:n("./lib/util").time,notime:n("./lib/util").notime},version:n("./lib/version")};},{"./lib/debug":6,"./lib/layout":8,"./lib/util":27,"./lib/version":28,"@dagrejs/graphlib":29}],2:[function(n,o,i){let c=n("./greedy-fas"),s=n("./util").uniqueId;o.exports={run:l,undo:f};function l(u){(u.graph().acyclicer==="greedy"?c(u,d(u)):h(u)).forEach(p=>{let x=u.edge(p);u.removeEdge(p),x.forwardName=p.name,x.reversed=true,u.setEdge(p.w,p.v,x,s("rev"));});function d(p){return x=>p.edge(x).weight}}function h(u){let a=[],d={},p={};function x(g){Object.hasOwn(p,g)||(p[g]=true,d[g]=true,u.outEdges(g).forEach(m=>{Object.hasOwn(d,m.w)?a.push(m):x(m.w);}),delete d[g]);}return u.nodes().forEach(x),a}function f(u){u.edges().forEach(a=>{let d=u.edge(a);if(d.reversed){u.removeEdge(a);let p=d.forwardName;delete d.reversed,delete d.forwardName,u.setEdge(a.w,a.v,d,p);}});}},{"./greedy-fas":7,"./util":27}],3:[function(n,o,i){let c=n("./util");o.exports=s;function s(h){function f(u){let a=h.children(u),d=h.node(u);if(a.length&&a.forEach(f),Object.hasOwn(d,"minRank")){d.borderLeft=[],d.borderRight=[];for(let p=d.minRank,x=d.maxRank+1;p<x;++p)l(h,"borderLeft","_bl",u,d,p),l(h,"borderRight","_br",u,d,p);}}h.children().forEach(f);}function l(h,f,u,a,d,p){let x={width:0,height:0,rank:p,borderType:f},g=d[f][p-1],m=c.addDummyNode(h,"border",x,u);d[f][p]=m,h.setParent(m,a),g&&h.setEdge(g,m,{weight:1});}},{"./util":27}],4:[function(n,o,i){o.exports={adjust:c,undo:s};function c(p){let x=p.graph().rankdir.toLowerCase();(x==="lr"||x==="rl")&&l(p);}function s(p){let x=p.graph().rankdir.toLowerCase();(x==="bt"||x==="rl")&&f(p),(x==="lr"||x==="rl")&&(a(p),l(p));}function l(p){p.nodes().forEach(x=>h(p.node(x))),p.edges().forEach(x=>h(p.edge(x)));}function h(p){let x=p.width;p.width=p.height,p.height=x;}function f(p){p.nodes().forEach(x=>u(p.node(x))),p.edges().forEach(x=>{let g=p.edge(x);g.points.forEach(u),Object.hasOwn(g,"y")&&u(g);});}function u(p){p.y=-p.y;}function a(p){p.nodes().forEach(x=>d(p.node(x))),p.edges().forEach(x=>{let g=p.edge(x);g.points.forEach(d),Object.hasOwn(g,"x")&&d(g);});}function d(p){let x=p.x;p.x=p.y,p.y=x;}},{}],5:[function(n,o,i){class c{constructor(){let f={};f._next=f._prev=f,this._sentinel=f;}dequeue(){let f=this._sentinel,u=f._prev;if(u!==f)return s(u),u}enqueue(f){let u=this._sentinel;f._prev&&f._next&&s(f),f._next=u._next,u._next._prev=f,u._next=f,f._prev=u;}toString(){let f=[],u=this._sentinel,a=u._prev;for(;a!==u;)f.push(JSON.stringify(a,l)),a=a._prev;return "["+f.join(", ")+"]"}}function s(h){h._prev._next=h._next,h._next._prev=h._prev,delete h._next,delete h._prev;}function l(h,f){if(h!=="_next"&&h!=="_prev")return f}o.exports=c;},{}],6:[function(n,o,i){let c=n("./util"),s=n("@dagrejs/graphlib").Graph;o.exports={debugOrdering:l};function l(h){let f=c.buildLayerMatrix(h),u=new s({compound:true,multigraph:true}).setGraph({});return h.nodes().forEach(a=>{u.setNode(a,{label:a}),u.setParent(a,"layer"+h.node(a).rank);}),h.edges().forEach(a=>u.setEdge(a.v,a.w,{},a.name)),f.forEach((a,d)=>{let p="layer"+d;u.setNode(p,{rank:"same"}),a.reduce((x,g)=>(u.setEdge(x,g,{style:"invis"}),g));}),u}},{"./util":27,"@dagrejs/graphlib":29}],7:[function(n,o,i){let c=n("@dagrejs/graphlib").Graph,s=n("./data/list");o.exports=h;let l=()=>1;function h(x,g){if(x.nodeCount()<=1)return [];let m=a(x,g||l);return f(m.graph,m.buckets,m.zeroIdx).flatMap(C=>x.outEdges(C.v,C.w))}function f(x,g,m){let w=[],C=g[g.length-1],E=g[0],L;for(;x.nodeCount();){for(;L=E.dequeue();)u(x,g,m,L);for(;L=C.dequeue();)u(x,g,m,L);if(x.nodeCount()){for(let y=g.length-2;y>0;--y)if(L=g[y].dequeue(),L){w=w.concat(u(x,g,m,L,true));break}}}return w}function u(x,g,m,w,C){let E=C?[]:void 0;return x.inEdges(w.v).forEach(L=>{let y=x.edge(L),b=x.node(L.v);C&&E.push({v:L.v,w:L.w}),b.out-=y,d(g,m,b);}),x.outEdges(w.v).forEach(L=>{let y=x.edge(L),b=L.w,v=x.node(b);v.in-=y,d(g,m,v);}),x.removeNode(w.v),E}function a(x,g){let m=new c,w=0,C=0;x.nodes().forEach(y=>{m.setNode(y,{v:y,in:0,out:0});}),x.edges().forEach(y=>{let b=m.edge(y.v,y.w)||0,v=g(y),M=b+v;m.setEdge(y.v,y.w,M),C=Math.max(C,m.node(y.v).out+=v),w=Math.max(w,m.node(y.w).in+=v);});let E=p(C+w+3).map(()=>new s),L=w+1;return m.nodes().forEach(y=>{d(E,L,m.node(y));}),{graph:m,buckets:E,zeroIdx:L}}function d(x,g,m){m.out?m.in?x[m.out-m.in+g].enqueue(m):x[x.length-1].enqueue(m):x[0].enqueue(m);}function p(x){let g=[];for(let m=0;m<x;m++)g.push(m);return g}},{"./data/list":5,"@dagrejs/graphlib":29}],8:[function(n,o,i){let c=n("./acyclic"),s=n("./normalize"),l=n("./rank"),h=n("./util").normalizeRanks,f=n("./parent-dummy-chains"),u=n("./util").removeEmptyRanks,a=n("./nesting-graph"),d=n("./add-border-segments"),p=n("./coordinate-system"),x=n("./order"),g=n("./position"),m=n("./util"),w=n("@dagrejs/graphlib").Graph;o.exports=C;function C(_,G){let P=G&&G.debugTiming?m.time:m.notime;P("layout",()=>{let j=P("  buildLayoutGraph",()=>$(_));P("  runLayout",()=>E(j,P,G)),P("  updateInputGraph",()=>L(_,j));});}function E(_,G,P){G("    makeSpaceForEdgeLabels",()=>k(_)),G("    removeSelfEdges",()=>H(_)),G("    acyclic",()=>c.run(_)),G("    nestingGraph.run",()=>a.run(_)),G("    rank",()=>l(m.asNonCompoundGraph(_))),G("    injectEdgeLabelProxies",()=>D(_)),G("    removeEmptyRanks",()=>u(_)),G("    nestingGraph.cleanup",()=>a.cleanup(_)),G("    normalizeRanks",()=>h(_)),G("    assignRankMinMax",()=>T(_)),G("    removeEdgeLabelProxies",()=>S(_)),G("    normalize.run",()=>s.run(_)),G("    parentDummyChains",()=>f(_)),G("    addBorderSegments",()=>d(_)),G("    order",()=>x(_,P)),G("    insertSelfEdges",()=>B(_)),G("    adjustCoordinateSystem",()=>p.adjust(_)),G("    position",()=>g(_)),G("    positionSelfEdges",()=>W(_)),G("    removeBorderNodes",()=>X(_)),G("    normalize.undo",()=>s.undo(_)),G("    fixupEdgeLabelCoords",()=>A(_)),G("    undoCoordinateSystem",()=>p.undo(_)),G("    translateGraph",()=>F(_)),G("    assignNodeIntersects",()=>q(_)),G("    reversePoints",()=>Y(_)),G("    acyclic.undo",()=>c.undo(_));}function L(_,G){_.nodes().forEach(P=>{let j=_.node(P),J=G.node(P);j&&(j.x=J.x,j.y=J.y,j.rank=J.rank,G.children(P).length&&(j.width=J.width,j.height=J.height));}),_.edges().forEach(P=>{let j=_.edge(P),J=G.edge(P);j.points=J.points,Object.hasOwn(J,"x")&&(j.x=J.x,j.y=J.y);}),_.graph().width=G.graph().width,_.graph().height=G.graph().height;}let y=["nodesep","edgesep","ranksep","marginx","marginy"],b={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},v=["acyclicer","ranker","rankdir","align"],M=["width","height","rank"],R={width:0,height:0},O=["minlen","weight","width","height","labeloffset"],I={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},N=["labelpos"];function $(_){let G=new w({multigraph:true,compound:true}),P=V(_.graph());return G.setGraph(Object.assign({},b,z(P,y),m.pick(P,v))),_.nodes().forEach(j=>{let J=V(_.node(j)),Q=z(J,M);Object.keys(R).forEach(ne=>{Q[ne]===void 0&&(Q[ne]=R[ne]);}),G.setNode(j,Q),G.setParent(j,_.parent(j));}),_.edges().forEach(j=>{let J=V(_.edge(j));G.setEdge(j,Object.assign({},I,z(J,O),m.pick(J,N)));}),G}function k(_){let G=_.graph();G.ranksep/=2,_.edges().forEach(P=>{let j=_.edge(P);j.minlen*=2,j.labelpos.toLowerCase()!=="c"&&(G.rankdir==="TB"||G.rankdir==="BT"?j.width+=j.labeloffset:j.height+=j.labeloffset);});}function D(_){_.edges().forEach(G=>{let P=_.edge(G);if(P.width&&P.height){let j=_.node(G.v),Q={rank:(_.node(G.w).rank-j.rank)/2+j.rank,e:G};m.addDummyNode(_,"edge-proxy",Q,"_ep");}});}function T(_){let G=0;_.nodes().forEach(P=>{let j=_.node(P);j.borderTop&&(j.minRank=_.node(j.borderTop).rank,j.maxRank=_.node(j.borderBottom).rank,G=Math.max(G,j.maxRank));}),_.graph().maxRank=G;}function S(_){_.nodes().forEach(G=>{let P=_.node(G);P.dummy==="edge-proxy"&&(_.edge(P.e).labelRank=P.rank,_.removeNode(G));});}function F(_){let G=Number.POSITIVE_INFINITY,P=0,j=Number.POSITIVE_INFINITY,J=0,Q=_.graph(),ne=Q.marginx||0,ue=Q.marginy||0;function ve(ge){let pe=ge.x,Ue=ge.y,Rt=ge.width,Ot=ge.height;G=Math.min(G,pe-Rt/2),P=Math.max(P,pe+Rt/2),j=Math.min(j,Ue-Ot/2),J=Math.max(J,Ue+Ot/2);}_.nodes().forEach(ge=>ve(_.node(ge))),_.edges().forEach(ge=>{let pe=_.edge(ge);Object.hasOwn(pe,"x")&&ve(pe);}),G-=ne,j-=ue,_.nodes().forEach(ge=>{let pe=_.node(ge);pe.x-=G,pe.y-=j;}),_.edges().forEach(ge=>{let pe=_.edge(ge);pe.points.forEach(Ue=>{Ue.x-=G,Ue.y-=j;}),Object.hasOwn(pe,"x")&&(pe.x-=G),Object.hasOwn(pe,"y")&&(pe.y-=j);}),Q.width=P-G+ne,Q.height=J-j+ue;}function q(_){_.edges().forEach(G=>{let P=_.edge(G),j=_.node(G.v),J=_.node(G.w),Q,ne;P.points?(Q=P.points[0],ne=P.points[P.points.length-1]):(P.points=[],Q=J,ne=j),P.points.unshift(m.intersectRect(j,Q)),P.points.push(m.intersectRect(J,ne));});}function A(_){_.edges().forEach(G=>{let P=_.edge(G);if(Object.hasOwn(P,"x"))switch((P.labelpos==="l"||P.labelpos==="r")&&(P.width-=P.labeloffset),P.labelpos){case "l":P.x-=P.width/2+P.labeloffset;break;case "r":P.x+=P.width/2+P.labeloffset;break}});}function Y(_){_.edges().forEach(G=>{let P=_.edge(G);P.reversed&&P.points.reverse();});}function X(_){_.nodes().forEach(G=>{if(_.children(G).length){let P=_.node(G),j=_.node(P.borderTop),J=_.node(P.borderBottom),Q=_.node(P.borderLeft[P.borderLeft.length-1]),ne=_.node(P.borderRight[P.borderRight.length-1]);P.width=Math.abs(ne.x-Q.x),P.height=Math.abs(J.y-j.y),P.x=Q.x+P.width/2,P.y=j.y+P.height/2;}}),_.nodes().forEach(G=>{_.node(G).dummy==="border"&&_.removeNode(G);});}function H(_){_.edges().forEach(G=>{if(G.v===G.w){var P=_.node(G.v);P.selfEdges||(P.selfEdges=[]),P.selfEdges.push({e:G,label:_.edge(G)}),_.removeEdge(G);}});}function B(_){var G=m.buildLayerMatrix(_);G.forEach(P=>{var j=0;P.forEach((J,Q)=>{var ne=_.node(J);ne.order=Q+j,(ne.selfEdges||[]).forEach(ue=>{m.addDummyNode(_,"selfedge",{width:ue.label.width,height:ue.label.height,rank:ne.rank,order:Q+ ++j,e:ue.e,label:ue.label},"_se");}),delete ne.selfEdges;});});}function W(_){_.nodes().forEach(G=>{var P=_.node(G);if(P.dummy==="selfedge"){var j=_.node(P.e.v),J=j.x+j.width/2,Q=j.y,ne=P.x-J,ue=j.height/2;_.setEdge(P.e,P.label),_.removeNode(G),P.label.points=[{x:J+2*ne/3,y:Q-ue},{x:J+5*ne/6,y:Q-ue},{x:J+ne,y:Q},{x:J+5*ne/6,y:Q+ue},{x:J+2*ne/3,y:Q+ue}],P.label.x=P.x,P.label.y=P.y;}});}function z(_,G){return m.mapValues(m.pick(_,G),Number)}function V(_){var G={};return _&&Object.entries(_).forEach(([P,j])=>{typeof P=="string"&&(P=P.toLowerCase()),G[P]=j;}),G}},{"./acyclic":2,"./add-border-segments":3,"./coordinate-system":4,"./nesting-graph":9,"./normalize":10,"./order":15,"./parent-dummy-chains":20,"./position":22,"./rank":24,"./util":27,"@dagrejs/graphlib":29}],9:[function(n,o,i){let c=n("./util");o.exports={run:s,cleanup:u};function s(a){let d=c.addDummyNode(a,"root",{},"_root"),p=h(a),x=Object.values(p),g=c.applyWithChunking(Math.max,x)-1,m=2*g+1;a.graph().nestingRoot=d,a.edges().forEach(C=>a.edge(C).minlen*=m);let w=f(a)+1;a.children().forEach(C=>l(a,d,m,w,g,p,C)),a.graph().nodeRankFactor=m;}function l(a,d,p,x,g,m,w){let C=a.children(w);if(!C.length){w!==d&&a.setEdge(d,w,{weight:0,minlen:p});return}let E=c.addBorderNode(a,"_bt"),L=c.addBorderNode(a,"_bb"),y=a.node(w);a.setParent(E,w),y.borderTop=E,a.setParent(L,w),y.borderBottom=L,C.forEach(b=>{l(a,d,p,x,g,m,b);let v=a.node(b),M=v.borderTop?v.borderTop:b,R=v.borderBottom?v.borderBottom:b,O=v.borderTop?x:2*x,I=M!==R?1:g-m[w]+1;a.setEdge(E,M,{weight:O,minlen:I,nestingEdge:true}),a.setEdge(R,L,{weight:O,minlen:I,nestingEdge:true});}),a.parent(w)||a.setEdge(d,E,{weight:0,minlen:g+m[w]});}function h(a){var d={};function p(x,g){var m=a.children(x);m&&m.length&&m.forEach(w=>p(w,g+1)),d[x]=g;}return a.children().forEach(x=>p(x,1)),d}function f(a){return a.edges().reduce((d,p)=>d+a.edge(p).weight,0)}function u(a){var d=a.graph();a.removeNode(d.nestingRoot),delete d.nestingRoot,a.edges().forEach(p=>{var x=a.edge(p);x.nestingEdge&&a.removeEdge(p);});}},{"./util":27}],10:[function(n,o,i){let c=n("./util");o.exports={run:s,undo:h};function s(f){f.graph().dummyChains=[],f.edges().forEach(u=>l(f,u));}function l(f,u){let a=u.v,d=f.node(a).rank,p=u.w,x=f.node(p).rank,g=u.name,m=f.edge(u),w=m.labelRank;if(x===d+1)return;f.removeEdge(u);let C,E,L;for(L=0,++d;d<x;++L,++d)m.points=[],E={width:0,height:0,edgeLabel:m,edgeObj:u,rank:d},C=c.addDummyNode(f,"edge",E,"_d"),d===w&&(E.width=m.width,E.height=m.height,E.dummy="edge-label",E.labelpos=m.labelpos),f.setEdge(a,C,{weight:m.weight},g),L===0&&f.graph().dummyChains.push(C),a=C;f.setEdge(a,p,{weight:m.weight},g);}function h(f){f.graph().dummyChains.forEach(u=>{let a=f.node(u),d=a.edgeLabel,p;for(f.setEdge(a.edgeObj,d);a.dummy;)p=f.successors(u)[0],f.removeNode(u),d.points.push({x:a.x,y:a.y}),a.dummy==="edge-label"&&(d.x=a.x,d.y=a.y,d.width=a.width,d.height=a.height),u=p,a=f.node(u);});}},{"./util":27}],11:[function(n,o,i){o.exports=c;function c(s,l,h){let f={},u;h.forEach(a=>{let d=s.parent(a),p,x;for(;d;){if(p=s.parent(d),p?(x=f[p],f[p]=d):(x=u,u=d),x&&x!==d){l.setEdge(x,d);return}d=p;}});}},{}],12:[function(n,o,i){o.exports=c;function c(s,l=[]){return l.map(h=>{let f=s.inEdges(h);if(f.length){let u=f.reduce((a,d)=>{let p=s.edge(d),x=s.node(d.v);return {sum:a.sum+p.weight*x.order,weight:a.weight+p.weight}},{sum:0,weight:0});return {v:h,barycenter:u.sum/u.weight,weight:u.weight}}else return {v:h}})}},{}],13:[function(n,o,i){let c=n("@dagrejs/graphlib").Graph,s=n("../util");o.exports=l;function l(f,u,a,d){d||(d=f.nodes());let p=h(f),x=new c({compound:true}).setGraph({root:p}).setDefaultNodeLabel(g=>f.node(g));return d.forEach(g=>{let m=f.node(g),w=f.parent(g);(m.rank===u||m.minRank<=u&&u<=m.maxRank)&&(x.setNode(g),x.setParent(g,w||p),f[a](g).forEach(C=>{let E=C.v===g?C.w:C.v,L=x.edge(E,g),y=L!==void 0?L.weight:0;x.setEdge(E,g,{weight:f.edge(C).weight+y});}),Object.hasOwn(m,"minRank")&&x.setNode(g,{borderLeft:m.borderLeft[u],borderRight:m.borderRight[u]}));}),x}function h(f){for(var u;f.hasNode(u=s.uniqueId("_root")););return u}},{"../util":27,"@dagrejs/graphlib":29}],14:[function(n,o,i){let c=n("../util").zipObject;o.exports=s;function s(h,f){let u=0;for(let a=1;a<f.length;++a)u+=l(h,f[a-1],f[a]);return u}function l(h,f,u){let a=c(u,u.map((w,C)=>C)),d=f.flatMap(w=>h.outEdges(w).map(C=>({pos:a[C.w],weight:h.edge(C).weight})).sort((C,E)=>C.pos-E.pos)),p=1;for(;p<u.length;)p<<=1;let x=2*p-1;p-=1;let g=new Array(x).fill(0),m=0;return d.forEach(w=>{let C=w.pos+p;g[C]+=w.weight;let E=0;for(;C>0;)C%2&&(E+=g[C+1]),C=C-1>>1,g[C]+=w.weight;m+=w.weight*E;}),m}},{"../util":27}],15:[function(n,o,i){let c=n("./init-order"),s=n("./cross-count"),l=n("./sort-subgraph"),h=n("./build-layer-graph"),f=n("./add-subgraph-constraints"),u=n("@dagrejs/graphlib").Graph,a=n("../util");o.exports=d;function d(m,w){if(w&&typeof w.customOrder=="function"){w.customOrder(m,d);return}let C=a.maxRank(m),E=p(m,a.range(1,C+1),"inEdges"),L=p(m,a.range(C-1,-1,-1),"outEdges"),y=c(m);if(g(m,y),w&&w.disableOptimalOrderHeuristic)return;let b=Number.POSITIVE_INFINITY,v;for(let M=0,R=0;R<4;++M,++R){x(M%2?E:L,M%4>=2),y=a.buildLayerMatrix(m);let O=s(m,y);O<b&&(R=0,v=Object.assign({},y),b=O);}g(m,v);}function p(m,w,C){let E=new Map,L=(y,b)=>{E.has(y)||E.set(y,[]),E.get(y).push(b);};for(let y of m.nodes()){let b=m.node(y);if(typeof b.rank=="number"&&L(b.rank,y),typeof b.minRank=="number"&&typeof b.maxRank=="number")for(let v=b.minRank;v<=b.maxRank;v++)v!==b.rank&&L(v,y);}return w.map(function(y){return h(m,y,C,E.get(y)||[])})}function x(m,w){let C=new u;m.forEach(function(E){let L=E.graph().root,y=l(E,L,C,w);y.vs.forEach((b,v)=>E.node(b).order=v),f(E,C,y.vs);});}function g(m,w){Object.values(w).forEach(C=>C.forEach((E,L)=>m.node(E).order=L));}},{"../util":27,"./add-subgraph-constraints":11,"./build-layer-graph":13,"./cross-count":14,"./init-order":16,"./sort-subgraph":18,"@dagrejs/graphlib":29}],16:[function(n,o,i){let c=n("../util");o.exports=s;function s(l){let h={},f=l.nodes().filter(g=>!l.children(g).length),u=f.map(g=>l.node(g).rank),a=c.applyWithChunking(Math.max,u),d=c.range(a+1).map(()=>[]);function p(g){if(h[g])return;h[g]=true;let m=l.node(g);d[m.rank].push(g),l.successors(g).forEach(p);}return f.sort((g,m)=>l.node(g).rank-l.node(m).rank).forEach(p),d}},{"../util":27}],17:[function(n,o,i){let c=n("../util");o.exports=s;function s(f,u){let a={};f.forEach((p,x)=>{let g=a[p.v]={indegree:0,in:[],out:[],vs:[p.v],i:x};p.barycenter!==void 0&&(g.barycenter=p.barycenter,g.weight=p.weight);}),u.edges().forEach(p=>{let x=a[p.v],g=a[p.w];x!==void 0&&g!==void 0&&(g.indegree++,x.out.push(a[p.w]));});let d=Object.values(a).filter(p=>!p.indegree);return l(d)}function l(f){let u=[];function a(p){return x=>{x.merged||(x.barycenter===void 0||p.barycenter===void 0||x.barycenter>=p.barycenter)&&h(p,x);}}function d(p){return x=>{x.in.push(p),--x.indegree===0&&f.push(x);}}for(;f.length;){let p=f.pop();u.push(p),p.in.reverse().forEach(a(p)),p.out.forEach(d(p));}return u.filter(p=>!p.merged).map(p=>c.pick(p,["vs","i","barycenter","weight"]))}function h(f,u){let a=0,d=0;f.weight&&(a+=f.barycenter*f.weight,d+=f.weight),u.weight&&(a+=u.barycenter*u.weight,d+=u.weight),f.vs=u.vs.concat(f.vs),f.barycenter=a/d,f.weight=d,f.i=Math.min(u.i,f.i),u.merged=true;}},{"../util":27}],18:[function(n,o,i){let c=n("./barycenter"),s=n("./resolve-conflicts"),l=n("./sort");o.exports=h;function h(a,d,p,x){let g=a.children(d),m=a.node(d),w=m?m.borderLeft:void 0,C=m?m.borderRight:void 0,E={};w&&(g=g.filter(v=>v!==w&&v!==C));let L=c(a,g);L.forEach(v=>{if(a.children(v.v).length){let M=h(a,v.v,p,x);E[v.v]=M,Object.hasOwn(M,"barycenter")&&u(v,M);}});let y=s(L,p);f(y,E);let b=l(y,x);if(w&&(b.vs=[w,b.vs,C].flat(true),a.predecessors(w).length)){let v=a.node(a.predecessors(w)[0]),M=a.node(a.predecessors(C)[0]);Object.hasOwn(b,"barycenter")||(b.barycenter=0,b.weight=0),b.barycenter=(b.barycenter*b.weight+v.order+M.order)/(b.weight+2),b.weight+=2;}return b}function f(a,d){a.forEach(p=>{p.vs=p.vs.flatMap(x=>d[x]?d[x].vs:x);});}function u(a,d){a.barycenter!==void 0?(a.barycenter=(a.barycenter*a.weight+d.barycenter*d.weight)/(a.weight+d.weight),a.weight+=d.weight):(a.barycenter=d.barycenter,a.weight=d.weight);}},{"./barycenter":12,"./resolve-conflicts":17,"./sort":19}],19:[function(n,o,i){let c=n("../util");o.exports=s;function s(f,u){let a=c.partition(f,E=>Object.hasOwn(E,"barycenter")),d=a.lhs,p=a.rhs.sort((E,L)=>L.i-E.i),x=[],g=0,m=0,w=0;d.sort(h(!!u)),w=l(x,p,w),d.forEach(E=>{w+=E.vs.length,x.push(E.vs),g+=E.barycenter*E.weight,m+=E.weight,w=l(x,p,w);});let C={vs:x.flat(true)};return m&&(C.barycenter=g/m,C.weight=m),C}function l(f,u,a){let d;for(;u.length&&(d=u[u.length-1]).i<=a;)u.pop(),f.push(d.vs),a++;return a}function h(f){return (u,a)=>u.barycenter<a.barycenter?-1:u.barycenter>a.barycenter?1:f?a.i-u.i:u.i-a.i}},{"../util":27}],20:[function(n,o,i){o.exports=c;function c(h){let f=l(h);h.graph().dummyChains.forEach(u=>{let a=h.node(u),d=a.edgeObj,p=s(h,f,d.v,d.w),x=p.path,g=p.lca,m=0,w=x[m],C=true;for(;u!==d.w;){if(a=h.node(u),C){for(;(w=x[m])!==g&&h.node(w).maxRank<a.rank;)m++;w===g&&(C=false);}if(!C){for(;m<x.length-1&&h.node(w=x[m+1]).minRank<=a.rank;)m++;w=x[m];}h.setParent(u,w),u=h.successors(u)[0];}});}function s(h,f,u,a){let d=[],p=[],x=Math.min(f[u].low,f[a].low),g=Math.max(f[u].lim,f[a].lim),m,w;m=u;do m=h.parent(m),d.push(m);while(m&&(f[m].low>x||g>f[m].lim));for(w=m,m=a;(m=h.parent(m))!==w;)p.push(m);return {path:d.concat(p.reverse()),lca:w}}function l(h){let f={},u=0;function a(d){let p=u;h.children(d).forEach(a),f[d]={low:p,lim:u++};}return h.children().forEach(a),f}},{}],21:[function(n,o,i){let c=n("@dagrejs/graphlib").Graph,s=n("../util");o.exports={positionX:C,findType1Conflicts:l,findType2Conflicts:h,addConflict:u,hasConflict:a,verticalAlignment:d,horizontalCompaction:p,alignCoordinates:m,findSmallestWidthAlignment:g,balance:w};function l(y,b){let v={};function M(R,O){let I=0,N=0,$=R.length,k=O[O.length-1];return O.forEach((D,T)=>{let S=f(y,D),F=S?y.node(S).order:$;(S||D===k)&&(O.slice(N,T+1).forEach(q=>{y.predecessors(q).forEach(A=>{let Y=y.node(A),X=Y.order;(X<I||F<X)&&!(Y.dummy&&y.node(q).dummy)&&u(v,A,q);});}),N=T+1,I=F);}),O}return b.length&&b.reduce(M),v}function h(y,b){let v={};function M(O,I,N,$,k){let D;s.range(I,N).forEach(T=>{D=O[T],y.node(D).dummy&&y.predecessors(D).forEach(S=>{let F=y.node(S);F.dummy&&(F.order<$||F.order>k)&&u(v,S,D);});});}function R(O,I){let N=-1,$,k=0;return I.forEach((D,T)=>{if(y.node(D).dummy==="border"){let S=y.predecessors(D);S.length&&($=y.node(S[0]).order,M(I,k,T,N,$),k=T,N=$);}M(I,k,I.length,$,O.length);}),I}return b.length&&b.reduce(R),v}function f(y,b){if(y.node(b).dummy)return y.predecessors(b).find(v=>y.node(v).dummy)}function u(y,b,v){if(b>v){let R=b;b=v,v=R;}let M=y[b];M||(y[b]=M={}),M[v]=true;}function a(y,b,v){if(b>v){let M=b;b=v,v=M;}return !!y[b]&&Object.hasOwn(y[b],v)}function d(y,b,v,M){let R={},O={},I={};return b.forEach(N=>{N.forEach(($,k)=>{R[$]=$,O[$]=$,I[$]=k;});}),b.forEach(N=>{let $=-1;N.forEach(k=>{let D=M(k);if(D.length){D=D.sort((S,F)=>I[S]-I[F]);let T=(D.length-1)/2;for(let S=Math.floor(T),F=Math.ceil(T);S<=F;++S){let q=D[S];O[k]===k&&$<I[q]&&!a(v,k,q)&&(O[q]=k,O[k]=R[k]=R[q],$=I[q]);}}});}),{root:R,align:O}}function p(y,b,v,M,R){let O={},I=x(y,b,v,R),N=R?"borderLeft":"borderRight";function $(T,S){let F=I.nodes(),q=F.pop(),A={};for(;q;)A[q]?T(q):(A[q]=true,F.push(q),F=F.concat(S(q))),q=F.pop();}function k(T){O[T]=I.inEdges(T).reduce((S,F)=>Math.max(S,O[F.v]+I.edge(F)),0);}function D(T){let S=I.outEdges(T).reduce((q,A)=>Math.min(q,O[A.w]-I.edge(A)),Number.POSITIVE_INFINITY),F=y.node(T);S!==Number.POSITIVE_INFINITY&&F.borderType!==N&&(O[T]=Math.max(O[T],S));}return $(k,I.predecessors.bind(I)),$(D,I.successors.bind(I)),Object.keys(M).forEach(T=>O[T]=O[v[T]]),O}function x(y,b,v,M){let R=new c,O=y.graph(),I=E(O.nodesep,O.edgesep,M);return b.forEach(N=>{let $;N.forEach(k=>{let D=v[k];if(R.setNode(D),$){var T=v[$],S=R.edge(T,D);R.setEdge(T,D,Math.max(I(y,k,$),S||0));}$=k;});}),R}function g(y,b){return Object.values(b).reduce((v,M)=>{let R=Number.NEGATIVE_INFINITY,O=Number.POSITIVE_INFINITY;Object.entries(M).forEach(([N,$])=>{let k=L(y,N)/2;R=Math.max($+k,R),O=Math.min($-k,O);});let I=R-O;return I<v[0]&&(v=[I,M]),v},[Number.POSITIVE_INFINITY,null])[1]}function m(y,b){let v=Object.values(b),M=s.applyWithChunking(Math.min,v),R=s.applyWithChunking(Math.max,v);["u","d"].forEach(O=>{["l","r"].forEach(I=>{let N=O+I,$=y[N];if($===b)return;let k=Object.values($),D=M-s.applyWithChunking(Math.min,k);I!=="l"&&(D=R-s.applyWithChunking(Math.max,k)),D&&(y[N]=s.mapValues($,T=>T+D));});});}function w(y,b){return s.mapValues(y.ul,(v,M)=>{if(b)return y[b.toLowerCase()][M];{let R=Object.values(y).map(O=>O[M]).sort((O,I)=>O-I);return (R[1]+R[2])/2}})}function C(y){let b=s.buildLayerMatrix(y),v=Object.assign(l(y,b),h(y,b)),M={},R;["u","d"].forEach(I=>{R=I==="u"?b:Object.values(b).reverse(),["l","r"].forEach(N=>{N==="r"&&(R=R.map(T=>Object.values(T).reverse()));let $=(I==="u"?y.predecessors:y.successors).bind(y),k=d(y,R,v,$),D=p(y,R,k.root,k.align,N==="r");N==="r"&&(D=s.mapValues(D,T=>-T)),M[I+N]=D;});});let O=g(y,M);return m(M,O),w(M,y.graph().align)}function E(y,b,v){return (M,R,O)=>{let I=M.node(R),N=M.node(O),$=0,k;if($+=I.width/2,Object.hasOwn(I,"labelpos"))switch(I.labelpos.toLowerCase()){case "l":k=-I.width/2;break;case "r":k=I.width/2;break}if(k&&($+=v?k:-k),k=0,$+=(I.dummy?b:y)/2,$+=(N.dummy?b:y)/2,$+=N.width/2,Object.hasOwn(N,"labelpos"))switch(N.labelpos.toLowerCase()){case "l":k=N.width/2;break;case "r":k=-N.width/2;break}return k&&($+=v?k:-k),k=0,$}}function L(y,b){return y.node(b).width}},{"../util":27,"@dagrejs/graphlib":29}],22:[function(n,o,i){let c=n("../util"),s=n("./bk").positionX;o.exports=l;function l(f){f=c.asNonCompoundGraph(f),h(f),Object.entries(s(f)).forEach(([u,a])=>f.node(u).x=a);}function h(f){let u=c.buildLayerMatrix(f),a=f.graph().ranksep,d=0;u.forEach(p=>{let x=p.reduce((g,m)=>{let w=f.node(m).height;return g>w?g:w},0);p.forEach(g=>f.node(g).y=d+x/2),d+=x+a;});}},{"../util":27,"./bk":21}],23:[function(n,o,i){var c=n("@dagrejs/graphlib").Graph,s=n("./util").slack;o.exports=l;function l(a){var d=new c({directed:false}),p=a.nodes()[0],x=a.nodeCount();d.setNode(p,{});for(var g,m;h(d,a)<x;)g=f(d,a),m=d.hasNode(g.v)?s(a,g):-s(a,g),u(d,a,m);return d}function h(a,d){function p(x){d.nodeEdges(x).forEach(g=>{var m=g.v,w=x===m?g.w:m;!a.hasNode(w)&&!s(d,g)&&(a.setNode(w,{}),a.setEdge(x,w,{}),p(w));});}return a.nodes().forEach(p),a.nodeCount()}function f(a,d){return d.edges().reduce((x,g)=>{let m=Number.POSITIVE_INFINITY;return a.hasNode(g.v)!==a.hasNode(g.w)&&(m=s(d,g)),m<x[0]?[m,g]:x},[Number.POSITIVE_INFINITY,null])[1]}function u(a,d,p){a.nodes().forEach(x=>d.node(x).rank+=p);}},{"./util":26,"@dagrejs/graphlib":29}],24:[function(n,o,i){var c=n("./util"),s=c.longestPath,l=n("./feasible-tree"),h=n("./network-simplex");o.exports=f;function f(p){var x=p.graph().ranker;if(x instanceof Function)return x(p);switch(p.graph().ranker){case "network-simplex":d(p);break;case "tight-tree":a(p);break;case "longest-path":u(p);break;case "none":break;default:d(p);}}var u=s;function a(p){s(p),l(p);}function d(p){h(p);}},{"./feasible-tree":23,"./network-simplex":25,"./util":26}],25:[function(n,o,i){var c=n("./feasible-tree"),s=n("./util").slack,l=n("./util").longestPath,h=n("@dagrejs/graphlib").alg.preorder,f=n("@dagrejs/graphlib").alg.postorder,u=n("../util").simplify;o.exports=a,a.initLowLimValues=g,a.initCutValues=d,a.calcCutValue=x,a.leaveEdge=w,a.enterEdge=C,a.exchangeEdges=E;function a(v){v=u(v),l(v);var M=c(v);g(M),d(M,v);for(var R,O;R=w(M);)O=C(M,v,R),E(M,v,R,O);}function d(v,M){var R=f(v,v.nodes());R=R.slice(0,R.length-1),R.forEach(O=>p(v,M,O));}function p(v,M,R){var O=v.node(R),I=O.parent;v.edge(R,I).cutvalue=x(v,M,R);}function x(v,M,R){var O=v.node(R),I=O.parent,N=true,$=M.edge(R,I),k=0;return $||(N=false,$=M.edge(I,R)),k=$.weight,M.nodeEdges(R).forEach(D=>{var T=D.v===R,S=T?D.w:D.v;if(S!==I){var F=T===N,q=M.edge(D).weight;if(k+=F?q:-q,y(v,R,S)){var A=v.edge(R,S).cutvalue;k+=F?-A:A;}}}),k}function g(v,M){arguments.length<2&&(M=v.nodes()[0]),m(v,{},1,M);}function m(v,M,R,O,I){var N=R,$=v.node(O);return M[O]=true,v.neighbors(O).forEach(k=>{Object.hasOwn(M,k)||(R=m(v,M,R,k,O));}),$.low=N,$.lim=R++,I?$.parent=I:delete $.parent,R}function w(v){return v.edges().find(M=>v.edge(M).cutvalue<0)}function C(v,M,R){var O=R.v,I=R.w;M.hasEdge(O,I)||(O=R.w,I=R.v);var N=v.node(O),$=v.node(I),k=N,D=false;N.lim>$.lim&&(k=$,D=true);var T=M.edges().filter(S=>D===b(v,v.node(S.v),k)&&D!==b(v,v.node(S.w),k));return T.reduce((S,F)=>s(M,F)<s(M,S)?F:S)}function E(v,M,R,O){var I=R.v,N=R.w;v.removeEdge(I,N),v.setEdge(O.v,O.w,{}),g(v),d(v,M),L(v,M);}function L(v,M){var R=v.nodes().find(I=>!M.node(I).parent),O=h(v,R);O=O.slice(1),O.forEach(I=>{var N=v.node(I).parent,$=M.edge(I,N),k=false;$||($=M.edge(N,I),k=true),M.node(I).rank=M.node(N).rank+(k?$.minlen:-$.minlen);});}function y(v,M,R){return v.hasEdge(M,R)}function b(v,M,R){return R.low<=M.lim&&M.lim<=R.lim}},{"../util":27,"./feasible-tree":23,"./util":26,"@dagrejs/graphlib":29}],26:[function(n,o,i){let{applyWithChunking:c}=n("../util");o.exports={longestPath:s,slack:l};function s(h){var f={};function u(a){var d=h.node(a);if(Object.hasOwn(f,a))return d.rank;f[a]=true;let p=h.outEdges(a).map(g=>g==null?Number.POSITIVE_INFINITY:u(g.w)-h.edge(g).minlen);var x=c(Math.min,p);return x===Number.POSITIVE_INFINITY&&(x=0),d.rank=x}h.sources().forEach(u);}function l(h,f){return h.node(f.w).rank-h.node(f.v).rank-h.edge(f).minlen}},{"../util":27}],27:[function(n,o,i){let c=n("@dagrejs/graphlib").Graph;o.exports={addBorderNode:g,addDummyNode:s,applyWithChunking:C,asNonCompoundGraph:h,buildLayerMatrix:d,intersectRect:a,mapValues:I,maxRank:E,normalizeRanks:p,notime:b,partition:L,pick:O,predecessorWeights:u,range:R,removeEmptyRanks:x,simplify:l,successorWeights:f,time:y,uniqueId:M,zipObject:N};function s($,k,D,T){for(var S=T;$.hasNode(S);)S=M(T);return D.dummy=k,$.setNode(S,D),S}function l($){let k=new c().setGraph($.graph());return $.nodes().forEach(D=>k.setNode(D,$.node(D))),$.edges().forEach(D=>{let T=k.edge(D.v,D.w)||{weight:0,minlen:1},S=$.edge(D);k.setEdge(D.v,D.w,{weight:T.weight+S.weight,minlen:Math.max(T.minlen,S.minlen)});}),k}function h($){let k=new c({multigraph:$.isMultigraph()}).setGraph($.graph());return $.nodes().forEach(D=>{$.children(D).length||k.setNode(D,$.node(D));}),$.edges().forEach(D=>{k.setEdge(D,$.edge(D));}),k}function f($){let k=$.nodes().map(D=>{let T={};return $.outEdges(D).forEach(S=>{T[S.w]=(T[S.w]||0)+$.edge(S).weight;}),T});return N($.nodes(),k)}function u($){let k=$.nodes().map(D=>{let T={};return $.inEdges(D).forEach(S=>{T[S.v]=(T[S.v]||0)+$.edge(S).weight;}),T});return N($.nodes(),k)}function a($,k){let D=$.x,T=$.y,S=k.x-D,F=k.y-T,q=$.width/2,A=$.height/2;if(!S&&!F)throw new Error("Not possible to find intersection inside of the rectangle");let Y,X;return Math.abs(F)*q>Math.abs(S)*A?(F<0&&(A=-A),Y=A*S/F,X=A):(S<0&&(q=-q),Y=q,X=q*F/S),{x:D+Y,y:T+X}}function d($){let k=R(E($)+1).map(()=>[]);return $.nodes().forEach(D=>{let T=$.node(D),S=T.rank;S!==void 0&&(k[S][T.order]=D);}),k}function p($){let k=$.nodes().map(T=>{let S=$.node(T).rank;return S===void 0?Number.MAX_VALUE:S}),D=C(Math.min,k);$.nodes().forEach(T=>{let S=$.node(T);Object.hasOwn(S,"rank")&&(S.rank-=D);});}function x($){let k=$.nodes().map(q=>$.node(q).rank),D=C(Math.min,k),T=[];$.nodes().forEach(q=>{let A=$.node(q).rank-D;T[A]||(T[A]=[]),T[A].push(q);});let S=0,F=$.graph().nodeRankFactor;Array.from(T).forEach((q,A)=>{q===void 0&&A%F!==0?--S:q!==void 0&&S&&q.forEach(Y=>$.node(Y).rank+=S);});}function g($,k,D,T){let S={width:0,height:0};return arguments.length>=4&&(S.rank=D,S.order=T),s($,"border",S,k)}function m($,k=w){let D=[];for(let T=0;T<$.length;T+=k){let S=$.slice(T,T+k);D.push(S);}return D}let w=65535;function C($,k){if(k.length>w){let D=m(k);return $.apply(null,D.map(T=>$.apply(null,T)))}else return $.apply(null,k)}function E($){let D=$.nodes().map(T=>{let S=$.node(T).rank;return S===void 0?Number.MIN_VALUE:S});return C(Math.max,D)}function L($,k){let D={lhs:[],rhs:[]};return $.forEach(T=>{k(T)?D.lhs.push(T):D.rhs.push(T);}),D}function y($,k){let D=Date.now();try{return k()}finally{console.log($+" time: "+(Date.now()-D)+"ms");}}function b($,k){return k()}let v=0;function M($){var k=++v;return $+(""+k)}function R($,k,D=1){k==null&&(k=$,$=0);let T=F=>F<k;D<0&&(T=F=>k<F);let S=[];for(let F=$;T(F);F+=D)S.push(F);return S}function O($,k){let D={};for(let T of k)$[T]!==void 0&&(D[T]=$[T]);return D}function I($,k){let D=k;return typeof k=="string"&&(D=T=>T[k]),Object.entries($).reduce((T,[S,F])=>(T[S]=D(F,S),T),{})}function N($,k){return $.reduce((D,T,S)=>(D[T]=k[S],D),{})}},{"@dagrejs/graphlib":29}],28:[function(n,o,i){o.exports="1.1.8";},{}],29:[function(n,o,i){var c=n("./lib");o.exports={Graph:c.Graph,json:n("./lib/json"),alg:n("./lib/alg"),version:c.version};},{"./lib":45,"./lib/alg":36,"./lib/json":46}],30:[function(n,o,i){o.exports=c;function c(s){var l={},h=[],f;function u(a){Object.hasOwn(l,a)||(l[a]=true,f.push(a),s.successors(a).forEach(u),s.predecessors(a).forEach(u));}return s.nodes().forEach(function(a){f=[],u(a),f.length&&h.push(f);}),h}},{}],31:[function(n,o,i){o.exports=c;function c(f,u,a){Array.isArray(u)||(u=[u]);var d=f.isDirected()?m=>f.successors(m):m=>f.neighbors(m),p=a==="post"?s:l,x=[],g={};return u.forEach(m=>{if(!f.hasNode(m))throw new Error("Graph does not have node: "+m);p(m,d,g,x);}),x}function s(f,u,a,d){for(var p=[[f,false]];p.length>0;){var x=p.pop();x[1]?d.push(x[0]):Object.hasOwn(a,x[0])||(a[x[0]]=true,p.push([x[0],true]),h(u(x[0]),g=>p.push([g,false])));}}function l(f,u,a,d){for(var p=[f];p.length>0;){var x=p.pop();Object.hasOwn(a,x)||(a[x]=true,d.push(x),h(u(x),g=>p.push(g)));}}function h(f,u){for(var a=f.length;a--;)u(f[a],a,f);return f}},{}],32:[function(n,o,i){var c=n("./dijkstra");o.exports=s;function s(l,h,f){return l.nodes().reduce(function(u,a){return u[a]=c(l,a,h,f),u},{})}},{"./dijkstra":33}],33:[function(n,o,i){var c=n("../data/priority-queue");o.exports=l;var s=()=>1;function l(f,u,a,d){return h(f,String(u),a||s,d||function(p){return f.outEdges(p)})}function h(f,u,a,d){var p={},x=new c,g,m,w=function(C){var E=C.v!==g?C.v:C.w,L=p[E],y=a(C),b=m.distance+y;if(y<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+C+" Weight: "+y);b<L.distance&&(L.distance=b,L.predecessor=g,x.decrease(E,b));};for(f.nodes().forEach(function(C){var E=C===u?0:Number.POSITIVE_INFINITY;p[C]={distance:E},x.add(C,E);});x.size()>0&&(g=x.removeMin(),m=p[g],m.distance!==Number.POSITIVE_INFINITY);)d(g).forEach(w);return p}},{"../data/priority-queue":43}],34:[function(n,o,i){var c=n("./tarjan");o.exports=s;function s(l){return c(l).filter(function(h){return h.length>1||h.length===1&&l.hasEdge(h[0],h[0])})}},{"./tarjan":41}],35:[function(n,o,i){o.exports=s;var c=()=>1;function s(h,f,u){return l(h,f||c,u||function(a){return h.outEdges(a)})}function l(h,f,u){var a={},d=h.nodes();return d.forEach(function(p){a[p]={},a[p][p]={distance:0},d.forEach(function(x){p!==x&&(a[p][x]={distance:Number.POSITIVE_INFINITY});}),u(p).forEach(function(x){var g=x.v===p?x.w:x.v,m=f(x);a[p][g]={distance:m,predecessor:p};});}),d.forEach(function(p){var x=a[p];d.forEach(function(g){var m=a[g];d.forEach(function(w){var C=m[p],E=x[w],L=m[w],y=C.distance+E.distance;y<L.distance&&(L.distance=y,L.predecessor=E.predecessor);});});}),a}},{}],36:[function(n,o,i){o.exports={components:n("./components"),dijkstra:n("./dijkstra"),dijkstraAll:n("./dijkstra-all"),findCycles:n("./find-cycles"),floydWarshall:n("./floyd-warshall"),isAcyclic:n("./is-acyclic"),postorder:n("./postorder"),preorder:n("./preorder"),prim:n("./prim"),tarjan:n("./tarjan"),topsort:n("./topsort")};},{"./components":30,"./dijkstra":33,"./dijkstra-all":32,"./find-cycles":34,"./floyd-warshall":35,"./is-acyclic":37,"./postorder":38,"./preorder":39,"./prim":40,"./tarjan":41,"./topsort":42}],37:[function(n,o,i){var c=n("./topsort");o.exports=s;function s(l){try{c(l);}catch(h){if(h instanceof c.CycleException)return  false;throw h}return  true}},{"./topsort":42}],38:[function(n,o,i){var c=n("./dfs");o.exports=s;function s(l,h){return c(l,h,"post")}},{"./dfs":31}],39:[function(n,o,i){var c=n("./dfs");o.exports=s;function s(l,h){return c(l,h,"pre")}},{"./dfs":31}],40:[function(n,o,i){var c=n("../graph"),s=n("../data/priority-queue");o.exports=l;function l(h,f){var u=new c,a={},d=new s,p;function x(m){var w=m.v===p?m.w:m.v,C=d.priority(w);if(C!==void 0){var E=f(m);E<C&&(a[w]=p,d.decrease(w,E));}}if(h.nodeCount()===0)return u;h.nodes().forEach(function(m){d.add(m,Number.POSITIVE_INFINITY),u.setNode(m);}),d.decrease(h.nodes()[0],0);for(var g=false;d.size()>0;){if(p=d.removeMin(),Object.hasOwn(a,p))u.setEdge(p,a[p]);else {if(g)throw new Error("Input graph is not connected: "+h);g=true;}h.nodeEdges(p).forEach(x);}return u}},{"../data/priority-queue":43,"../graph":44}],41:[function(n,o,i){o.exports=c;function c(s){var l=0,h=[],f={},u=[];function a(d){var p=f[d]={onStack:true,lowlink:l,index:l++};if(h.push(d),s.successors(d).forEach(function(m){Object.hasOwn(f,m)?f[m].onStack&&(p.lowlink=Math.min(p.lowlink,f[m].index)):(a(m),p.lowlink=Math.min(p.lowlink,f[m].lowlink));}),p.lowlink===p.index){var x=[],g;do g=h.pop(),f[g].onStack=false,x.push(g);while(d!==g);u.push(x);}}return s.nodes().forEach(function(d){Object.hasOwn(f,d)||a(d);}),u}},{}],42:[function(n,o,i){function c(l){var h={},f={},u=[];function a(d){if(Object.hasOwn(f,d))throw new s;Object.hasOwn(h,d)||(f[d]=true,h[d]=true,l.predecessors(d).forEach(a),delete f[d],u.push(d));}if(l.sinks().forEach(a),Object.keys(h).length!==l.nodeCount())throw new s;return u}class s extends Error{constructor(){super(...arguments);}}o.exports=c,c.CycleException=s;},{}],43:[function(n,o,i){class c{_arr=[];_keyIndices={};size(){return this._arr.length}keys(){return this._arr.map(function(l){return l.key})}has(l){return Object.hasOwn(this._keyIndices,l)}priority(l){var h=this._keyIndices[l];if(h!==void 0)return this._arr[h].priority}min(){if(this.size()===0)throw new Error("Queue underflow");return this._arr[0].key}add(l,h){var f=this._keyIndices;if(l=String(l),!Object.hasOwn(f,l)){var u=this._arr,a=u.length;return f[l]=a,u.push({key:l,priority:h}),this._decrease(a),true}return  false}removeMin(){this._swap(0,this._arr.length-1);var l=this._arr.pop();return delete this._keyIndices[l.key],this._heapify(0),l.key}decrease(l,h){var f=this._keyIndices[l];if(h>this._arr[f].priority)throw new Error("New priority is greater than current priority. Key: "+l+" Old: "+this._arr[f].priority+" New: "+h);this._arr[f].priority=h,this._decrease(f);}_heapify(l){var h=this._arr,f=2*l,u=f+1,a=l;f<h.length&&(a=h[f].priority<h[a].priority?f:a,u<h.length&&(a=h[u].priority<h[a].priority?u:a),a!==l&&(this._swap(l,a),this._heapify(a)));}_decrease(l){for(var h=this._arr,f=h[l].priority,u;l!==0&&(u=l>>1,!(h[u].priority<f));)this._swap(l,u),l=u;}_swap(l,h){var f=this._arr,u=this._keyIndices,a=f[l],d=f[h];f[l]=d,f[h]=a,u[d.key]=l,u[a.key]=h;}}o.exports=c;},{}],44:[function(n,o,i){var c="\0",s="\0",l="";class h{_isDirected=true;_isMultigraph=false;_isCompound=false;_label;_defaultNodeLabelFn=()=>{};_defaultEdgeLabelFn=()=>{};_nodes={};_in={};_preds={};_out={};_sucs={};_edgeObjs={};_edgeLabels={};_nodeCount=0;_edgeCount=0;_parent;_children;constructor(g){g&&(this._isDirected=Object.hasOwn(g,"directed")?g.directed:true,this._isMultigraph=Object.hasOwn(g,"multigraph")?g.multigraph:false,this._isCompound=Object.hasOwn(g,"compound")?g.compound:false),this._isCompound&&(this._parent={},this._children={},this._children[s]={});}isDirected(){return this._isDirected}isMultigraph(){return this._isMultigraph}isCompound(){return this._isCompound}setGraph(g){return this._label=g,this}graph(){return this._label}setDefaultNodeLabel(g){return this._defaultNodeLabelFn=g,typeof g!="function"&&(this._defaultNodeLabelFn=()=>g),this}nodeCount(){return this._nodeCount}nodes(){return Object.keys(this._nodes)}sources(){var g=this;return this.nodes().filter(m=>Object.keys(g._in[m]).length===0)}sinks(){var g=this;return this.nodes().filter(m=>Object.keys(g._out[m]).length===0)}setNodes(g,m){var w=arguments,C=this;return g.forEach(function(E){w.length>1?C.setNode(E,m):C.setNode(E);}),this}setNode(g,m){return Object.hasOwn(this._nodes,g)?(arguments.length>1&&(this._nodes[g]=m),this):(this._nodes[g]=arguments.length>1?m:this._defaultNodeLabelFn(g),this._isCompound&&(this._parent[g]=s,this._children[g]={},this._children[s][g]=true),this._in[g]={},this._preds[g]={},this._out[g]={},this._sucs[g]={},++this._nodeCount,this)}node(g){return this._nodes[g]}hasNode(g){return Object.hasOwn(this._nodes,g)}removeNode(g){var m=this;if(Object.hasOwn(this._nodes,g)){var w=C=>m.removeEdge(m._edgeObjs[C]);delete this._nodes[g],this._isCompound&&(this._removeFromParentsChildList(g),delete this._parent[g],this.children(g).forEach(function(C){m.setParent(C);}),delete this._children[g]),Object.keys(this._in[g]).forEach(w),delete this._in[g],delete this._preds[g],Object.keys(this._out[g]).forEach(w),delete this._out[g],delete this._sucs[g],--this._nodeCount;}return this}setParent(g,m){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(m===void 0)m=s;else {m+="";for(var w=m;w!==void 0;w=this.parent(w))if(w===g)throw new Error("Setting "+m+" as parent of "+g+" would create a cycle");this.setNode(m);}return this.setNode(g),this._removeFromParentsChildList(g),this._parent[g]=m,this._children[m][g]=true,this}_removeFromParentsChildList(g){delete this._children[this._parent[g]][g];}parent(g){if(this._isCompound){var m=this._parent[g];if(m!==s)return m}}children(g=s){if(this._isCompound){var m=this._children[g];if(m)return Object.keys(m)}else {if(g===s)return this.nodes();if(this.hasNode(g))return []}}predecessors(g){var m=this._preds[g];if(m)return Object.keys(m)}successors(g){var m=this._sucs[g];if(m)return Object.keys(m)}neighbors(g){var m=this.predecessors(g);if(m){let C=new Set(m);for(var w of this.successors(g))C.add(w);return Array.from(C.values())}}isLeaf(g){var m;return this.isDirected()?m=this.successors(g):m=this.neighbors(g),m.length===0}filterNodes(g){var m=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});m.setGraph(this.graph());var w=this;Object.entries(this._nodes).forEach(function([L,y]){g(L)&&m.setNode(L,y);}),Object.values(this._edgeObjs).forEach(function(L){m.hasNode(L.v)&&m.hasNode(L.w)&&m.setEdge(L,w.edge(L));});var C={};function E(L){var y=w.parent(L);return y===void 0||m.hasNode(y)?(C[L]=y,y):y in C?C[y]:E(y)}return this._isCompound&&m.nodes().forEach(L=>m.setParent(L,E(L))),m}setDefaultEdgeLabel(g){return this._defaultEdgeLabelFn=g,typeof g!="function"&&(this._defaultEdgeLabelFn=()=>g),this}edgeCount(){return this._edgeCount}edges(){return Object.values(this._edgeObjs)}setPath(g,m){var w=this,C=arguments;return g.reduce(function(E,L){return C.length>1?w.setEdge(E,L,m):w.setEdge(E,L),L}),this}setEdge(){var g,m,w,C,E=false,L=arguments[0];typeof L=="object"&&L!==null&&"v"in L?(g=L.v,m=L.w,w=L.name,arguments.length===2&&(C=arguments[1],E=true)):(g=L,m=arguments[1],w=arguments[3],arguments.length>2&&(C=arguments[2],E=true)),g=""+g,m=""+m,w!==void 0&&(w=""+w);var y=a(this._isDirected,g,m,w);if(Object.hasOwn(this._edgeLabels,y))return E&&(this._edgeLabels[y]=C),this;if(w!==void 0&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(g),this.setNode(m),this._edgeLabels[y]=E?C:this._defaultEdgeLabelFn(g,m,w);var b=d(this._isDirected,g,m,w);return g=b.v,m=b.w,Object.freeze(b),this._edgeObjs[y]=b,f(this._preds[m],g),f(this._sucs[g],m),this._in[m][y]=b,this._out[g][y]=b,this._edgeCount++,this}edge(g,m,w){var C=arguments.length===1?p(this._isDirected,arguments[0]):a(this._isDirected,g,m,w);return this._edgeLabels[C]}edgeAsObj(){let g=this.edge(...arguments);return typeof g!="object"?{label:g}:g}hasEdge(g,m,w){var C=arguments.length===1?p(this._isDirected,arguments[0]):a(this._isDirected,g,m,w);return Object.hasOwn(this._edgeLabels,C)}removeEdge(g,m,w){var C=arguments.length===1?p(this._isDirected,arguments[0]):a(this._isDirected,g,m,w),E=this._edgeObjs[C];return E&&(g=E.v,m=E.w,delete this._edgeLabels[C],delete this._edgeObjs[C],u(this._preds[m],g),u(this._sucs[g],m),delete this._in[m][C],delete this._out[g][C],this._edgeCount--),this}inEdges(g,m){var w=this._in[g];if(w){var C=Object.values(w);return m?C.filter(E=>E.v===m):C}}outEdges(g,m){var w=this._out[g];if(w){var C=Object.values(w);return m?C.filter(E=>E.w===m):C}}nodeEdges(g,m){var w=this.inEdges(g,m);if(w)return w.concat(this.outEdges(g,m))}}function f(x,g){x[g]?x[g]++:x[g]=1;}function u(x,g){--x[g]||delete x[g];}function a(x,g,m,w){var C=""+g,E=""+m;if(!x&&C>E){var L=C;C=E,E=L;}return C+l+E+l+(w===void 0?c:w)}function d(x,g,m,w){var C=""+g,E=""+m;if(!x&&C>E){var L=C;C=E,E=L;}var y={v:C,w:E};return w&&(y.name=w),y}function p(x,g){return a(x,g.v,g.w,g.name)}o.exports=h;},{}],45:[function(n,o,i){o.exports={Graph:n("./graph"),version:n("./version")};},{"./graph":44,"./version":47}],46:[function(n,o,i){var c=n("./graph");o.exports={write:s,read:f};function s(u){var a={options:{directed:u.isDirected(),multigraph:u.isMultigraph(),compound:u.isCompound()},nodes:l(u),edges:h(u)};return u.graph()!==void 0&&(a.value=structuredClone(u.graph())),a}function l(u){return u.nodes().map(function(a){var d=u.node(a),p=u.parent(a),x={v:a};return d!==void 0&&(x.value=d),p!==void 0&&(x.parent=p),x})}function h(u){return u.edges().map(function(a){var d=u.edge(a),p={v:a.v,w:a.w};return a.name!==void 0&&(p.name=a.name),d!==void 0&&(p.value=d),p})}function f(u){var a=new c(u.options).setGraph(u.value);return u.nodes.forEach(function(d){a.setNode(d.v,d.value),d.parent&&a.setParent(d.v,d.parent);}),u.edges.forEach(function(d){a.setEdge({v:d.v,w:d.w,name:d.name},d.value);}),a}},{"./graph":44}],47:[function(n,o,i){o.exports="2.2.4";},{}]},{},[1])(1)});});var We={bg:"#FFFFFF",fg:"#27272A"},Ce={textSec:60,textMuted:40,textFaint:25,line:30,arrow:50,nodeFill:3,nodeStroke:20,groupHeader:5,innerStroke:12,keyBadge:10},wt={"zinc-light":{bg:"#FFFFFF",fg:"#27272A"},"zinc-dark":{bg:"#18181B",fg:"#FAFAFA"},"tokyo-night":{bg:"#1a1b26",fg:"#a9b1d6",line:"#3d59a1",accent:"#7aa2f7",muted:"#565f89"},"tokyo-night-storm":{bg:"#24283b",fg:"#a9b1d6",line:"#3d59a1",accent:"#7aa2f7",muted:"#565f89"},"tokyo-night-light":{bg:"#d5d6db",fg:"#343b58",line:"#34548a",accent:"#34548a",muted:"#9699a3"},"catppuccin-mocha":{bg:"#1e1e2e",fg:"#cdd6f4",line:"#585b70",accent:"#cba6f7",muted:"#6c7086"},"catppuccin-latte":{bg:"#eff1f5",fg:"#4c4f69",line:"#9ca0b0",accent:"#8839ef",muted:"#9ca0b0"},nord:{bg:"#2e3440",fg:"#d8dee9",line:"#4c566a",accent:"#88c0d0",muted:"#616e88"},"nord-light":{bg:"#eceff4",fg:"#2e3440",line:"#aab1c0",accent:"#5e81ac",muted:"#7b88a1"},dracula:{bg:"#282a36",fg:"#f8f8f2",line:"#6272a4",accent:"#bd93f9",muted:"#6272a4"},"github-light":{bg:"#ffffff",fg:"#1f2328",line:"#d1d9e0",accent:"#0969da",muted:"#59636e"},"github-dark":{bg:"#0d1117",fg:"#e6edf3",line:"#3d444d",accent:"#4493f8",muted:"#9198a1"},"solarized-light":{bg:"#fdf6e3",fg:"#657b83",line:"#93a1a1",accent:"#268bd2",muted:"#93a1a1"},"solarized-dark":{bg:"#002b36",fg:"#839496",line:"#586e75",accent:"#268bd2",muted:"#586e75"},"one-dark":{bg:"#282c34",fg:"#abb2bf",line:"#4b5263",accent:"#c678dd",muted:"#5c6370"}};function vt(e){let t=e.colors??{},r=e.type==="dark",n=o=>e.tokenColors?.find(i=>Array.isArray(i.scope)?i.scope.includes(o):i.scope===o)?.settings?.foreground;return {bg:t["editor.background"]??(r?"#1e1e1e":"#ffffff"),fg:t["editor.foreground"]??(r?"#d4d4d4":"#333333"),line:t["editorLineNumber.foreground"]??void 0,accent:t.focusBorder??n("keyword")??void 0,muted:n("comment")??t["editorLineNumber.foreground"]??void 0,surface:t["editor.selectionBackground"]??void 0,border:t["editorWidget.border"]??void 0}}function Se(e,t){let r=[`@import url('https://fonts.googleapis.com/css2?family=${encodeURIComponent(e)}:wght@400;500;600;700&amp;display=swap');`,...t?["@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&amp;display=swap');"]:[]],n=`
    /* Derived from --bg and --fg (overridable via --line, --accent, etc.) */
    --_text:          var(--fg);
    --_text-sec:      var(--muted, color-mix(in srgb, var(--fg) ${Ce.textSec}%, var(--bg)));
    --_text-muted:    var(--muted, color-mix(in srgb, var(--fg) ${Ce.textMuted}%, var(--bg)));
    --_text-faint:    color-mix(in srgb, var(--fg) ${Ce.textFaint}%, var(--bg));
    --_line:          var(--line, color-mix(in srgb, var(--fg) ${Ce.line}%, var(--bg)));
    --_arrow:         var(--accent, color-mix(in srgb, var(--fg) ${Ce.arrow}%, var(--bg)));
    --_node-fill:     var(--surface, color-mix(in srgb, var(--fg) ${Ce.nodeFill}%, var(--bg)));
    --_node-stroke:   var(--border, color-mix(in srgb, var(--fg) ${Ce.nodeStroke}%, var(--bg)));
    --_group-fill:    var(--bg);
    --_group-hdr:     color-mix(in srgb, var(--fg) ${Ce.groupHeader}%, var(--bg));
    --_inner-stroke:  color-mix(in srgb, var(--fg) ${Ce.innerStroke}%, var(--bg));
    --_key-badge:     color-mix(in srgb, var(--fg) ${Ce.keyBadge}%, var(--bg));`;return ["<style>",`  ${r.join(`
  `)}`,`  text { font-family: '${e}', system-ui, sans-serif; }`,...t?["  .mono { font-family: 'JetBrains Mono', 'SF Mono', 'Fira Code', ui-monospace, monospace; }"]:[],`  svg {${n}`,"  }","</style>"].join(`
`)}function _e(e,t,r,n){let o=[`--bg:${r.bg}`,`--fg:${r.fg}`,r.line?`--line:${r.line}`:"",r.accent?`--accent:${r.accent}`:"",r.muted?`--muted:${r.muted}`:"",r.surface?`--surface:${r.surface}`:"",r.border?`--border:${r.border}`:""].filter(Boolean).join(";");return `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${e} ${t}" width="${e}" height="${t}" style="${o}${n?"":";background:var(--bg)"}">`}function Je(e){let t=e.split(/[\n;]/).map(n=>n.trim()).filter(n=>n.length>0&&!n.startsWith("%%"));if(t.length===0)throw new Error("Empty mermaid diagram");let r=t[0];return /^stateDiagram(-v2)?\s*$/i.test(r)?ir(t):or(t)}function or(e){let t=e[0].match(/^(?:graph|flowchart)\s+(TD|TB|LR|BT|RL)\s*$/i);if(!t)throw new Error(`Invalid mermaid header: "${e[0]}". Expected "graph TD", "flowchart LR", "stateDiagram-v2", etc.`);let n={direction:t[1].toUpperCase(),nodes:new Map,edges:[],subgraphs:[],classDefs:new Map,classAssignments:new Map,nodeStyles:new Map},o=[];for(let i=1;i<e.length;i++){let c=e[i],s=c.match(/^classDef\s+(\w+)\s+(.+)$/);if(s){let a=s[1],d=s[2],p=Ht(d);n.classDefs.set(a,p);continue}let l=c.match(/^class\s+([^\s]+)\s+(\w+)$/);if(l){let a=l[1].split(",").map(p=>p.trim()),d=l[2];for(let p of a)n.classAssignments.set(p,d);continue}let h=c.match(/^style\s+([^\s]+)\s+(.+)$/);if(h){let a=h[1].split(",").map(p=>p.trim()),d=Ht(h[2]);for(let p of a)n.nodeStyles.set(p,{...n.nodeStyles.get(p),...d});continue}let f=c.match(/^direction\s+(TD|TB|LR|BT|RL)\s*$/i);if(f&&o.length>0){o[o.length-1].direction=f[1].toUpperCase();continue}let u=c.match(/^subgraph\s+(.+)$/);if(u){let a=u[1].trim(),d=a.match(/^([\p{L}\p{N}_-]+)\s*\[(.+)\]$/u),p,x;d?(p=d[1],x=d[2]):(x=a,p=a.replace(/\s+/g,"_").replace(/[^\p{L}\p{N}_]/gu,""));let g={id:p,label:x,nodeIds:[],children:[]};o.push(g);continue}if(c==="end"){let a=o.pop();a&&(o.length>0?o[o.length-1].children.push(a):n.subgraphs.push(a));continue}dr(c,n,o);}return n}function ir(e){let t={direction:"TD",nodes:new Map,edges:[],subgraphs:[],classDefs:new Map,classAssignments:new Map,nodeStyles:new Map},r=[],n=0,o=0;for(let i=1;i<e.length;i++){let c=e[i],s=c.match(/^direction\s+(TD|TB|LR|BT|RL)\s*$/i);if(s){r.length>0?r[r.length-1].direction=s[1].toUpperCase():t.direction=s[1].toUpperCase();continue}let l=c.match(/^state\s+(?:"([^"]+)"\s+as\s+)?([\p{L}\p{N}_-]+)\s*\{$/u);if(l){let a=l[1]??l[2],p={id:l[2],label:a,nodeIds:[],children:[]};r.push(p);continue}if(c==="}"){let a=r.pop();a&&(r.length>0?r[r.length-1].children.push(a):t.subgraphs.push(a));continue}let h=c.match(/^state\s+"([^"]+)"\s+as\s+([\p{L}\p{N}_-]+)\s*$/u);if(h){let a=h[1],d=h[2];Ke(t,r,{id:d,label:a,shape:"rounded"});continue}let f=c.match(/^(\[\*\]|[\p{L}\p{N}_-]+)\s*(-->)\s*(\[\*\]|[\p{L}\p{N}_-]+)(?:\s*:\s*(.+))?$/u);if(f){let a=f[1],d=f[3],p=f[4]?.trim()||void 0;a==="[*]"?(n++,a=`_start${n>1?n:""}`,Ke(t,r,{id:a,label:"",shape:"state-start"})):Ft(t,r,a),d==="[*]"?(o++,d=`_end${o>1?o:""}`,Ke(t,r,{id:d,label:"",shape:"state-end"})):Ft(t,r,d),t.edges.push({source:a,target:d,label:p,style:"solid",hasArrowStart:false,hasArrowEnd:true});continue}let u=c.match(/^([\p{L}\p{N}_-]+)\s*:\s*(.+)$/u);if(u){let a=u[1],d=u[2].trim();Ke(t,r,{id:a,label:d,shape:"rounded"});continue}}return t}function Ke(e,t,r){if(!e.nodes.has(r.id)&&e.nodes.set(r.id,r),t.length>0){let o=t[t.length-1];o.nodeIds.includes(r.id)||o.nodeIds.push(r.id);}}function Ft(e,t,r){if(!e.nodes.has(r))Ke(e,t,{id:r,label:r,shape:"rounded"});else if(t.length>0){let n=t[t.length-1];n.nodeIds.includes(r)||n.nodeIds.push(r);}}function Ht(e){let t={};for(let r of e.split(",")){let n=r.indexOf(":");if(n>0){let o=r.slice(0,n).trim(),i=r.slice(n+1).trim();o&&i&&(t[o]=i);}}return t}var sr=/^(<)?(-->|-.->|==>|---|-\.-|===)(?:\|([^|]*)\|)?/,ar=[{regex:/^([\p{L}\p{N}_-]+)\(\(\((.+?)\)\)\)/u,shape:"doublecircle"},{regex:/^([\p{L}\p{N}_-]+)\(\[(.+?)\]\)/u,shape:"stadium"},{regex:/^([\p{L}\p{N}_-]+)\(\((.+?)\)\)/u,shape:"circle"},{regex:/^([\p{L}\p{N}_-]+)\[\[(.+?)\]\]/u,shape:"subroutine"},{regex:/^([\p{L}\p{N}_-]+)\[\((.+?)\)\]/u,shape:"cylinder"},{regex:/^([\p{L}\p{N}_-]+)\[\/(.+?)\\\]/u,shape:"trapezoid"},{regex:/^([\p{L}\p{N}_-]+)\[\\(.+?)\/\]/u,shape:"trapezoid-alt"},{regex:/^([\p{L}\p{N}_-]+)>(.+?)\]/u,shape:"asymmetric"},{regex:/^([\p{L}\p{N}_-]+)\{\{(.+?)\}\}/u,shape:"hexagon"},{regex:/^([\p{L}\p{N}_-]+)\[(.+?)\]/u,shape:"rectangle"},{regex:/^([\p{L}\p{N}_-]+)\((.+?)\)/u,shape:"rounded"},{regex:/^([\p{L}\p{N}_-]+)\{(.+?)\}/u,shape:"diamond"}],cr=/^([\p{L}\p{N}_-]+)/u,lr=/^:::([\w][\w-]*)/;function dr(e,t,r){let n=e.trim(),o=Bt(n,t,r);if(!o||o.ids.length===0)return;n=o.remaining.trim();let i=o.ids;for(;n.length>0;){let c=n.match(sr);if(!c)break;let s=!!c[1],l=c[2],h=c[3]?.trim()||void 0;n=n.slice(c[0].length).trim();let f=hr(l),u=l.endsWith(">"),a=Bt(n,t,r);if(!a||a.ids.length===0)break;n=a.remaining.trim();for(let d of i)for(let p of a.ids)t.edges.push({source:d,target:p,label:h,style:f,hasArrowStart:s,hasArrowEnd:u});i=a.ids;}}function Bt(e,t,r){let n=Yt(e,t,r);if(!n)return null;let o=[n.id],i=n.remaining.trim();for(;i.startsWith("&");){i=i.slice(1).trim();let c=Yt(i,t,r);if(!c)break;o.push(c.id),i=c.remaining.trim();}return {ids:o,remaining:i}}function Yt(e,t,r){let n=null,o=e;for(let{regex:c,shape:s}of ar){let l=e.match(c);if(l){n=l[1];let h=l[2];Xt(t,r,{id:n,label:h,shape:s}),o=e.slice(l[0].length);break}}if(n===null){let c=e.match(cr);c&&(n=c[1],t.nodes.has(n)?jt(r,n):Xt(t,r,{id:n,label:n,shape:"rectangle"}),o=e.slice(c[0].length));}if(n===null)return null;let i=o.match(lr);return i&&(t.classAssignments.set(n,i[1]),o=o.slice(i[0].length)),{id:n,remaining:o}}function Xt(e,t,r){!e.nodes.has(r.id)&&e.nodes.set(r.id,r),jt(t,r.id);}function jt(e,t){if(e.length>0){let r=e[e.length-1];r.nodeIds.includes(t)||r.nodeIds.push(t);}}function hr(e){return e==="-.->"||e==="-.-"?"dotted":e==="==>"||e==="==="?"thick":"solid"}var ie={x:1,y:0},ee={x:1,y:2},se={x:0,y:1},re={x:2,y:1},xe={x:2,y:0},me={x:0,y:0},we={x:2,y:2},ye={x:0,y:2},it={x:1,y:1};function Fe(e,t){return e.x===t.x&&e.y===t.y}function zt(e,t){return e.x===t.x&&e.y===t.y}function Ie(e,t){return {x:e.x+t.x,y:e.y+t.y}}function $e(e){return `${e.x},${e.y}`}var Vt={name:"",styles:{}};function fr(e){return e>=768&&e<=879||e>=6832&&e<=6911||e>=7616&&e<=7679||e>=8400&&e<=8447||e>=65056&&e<=65071}function ur(e){return e>=4352&&e<=4447||e>=11904&&e<=42191||e>=44032&&e<=55203||e>=63744&&e<=64255||e>=65040&&e<=65049||e>=65072&&e<=65135||e>=65280&&e<=65376||e>=65504&&e<=65510||e>=127744&&e<=129791||e>=129280&&e<=129535}function Qe(e){let t=e.codePointAt(0);return t==null||t===0||t<32||t>=127&&t<160||fr(t)?0:ur(t)?2:1}function ae(e){let t=0;for(let r of e)t+=Qe(r);return t}function Ge(e,t){if(t<=0)return "";let r=0,n="";for(let o of e){let i=Qe(o);if(r+i>t)break;n+=o,r+=i;}return n}function qt(e,t){if(t<=0)return e;let r=0,n="";for(let o of e){let i=Qe(o);if(r<t){r+=i;continue}n+=o;}return n}function he(e,t){let r=[];for(let n=0;n<=e;n++){let o=[];for(let i=0;i<=t;i++)o.push(" ");r.push(o);}return r}function Ne(e){let[t,r]=Ze(e);return he(t,r)}function Ze(e){return [e.length-1,(e[0]?.length??1)-1]}function He(e,t,r){let[n,o]=Ze(e),i=Math.max(t,n),c=Math.max(r,o),s=he(i,c);for(let l=0;l<s.length;l++)for(let h=0;h<s[0].length;h++)l<e.length&&h<e[0].length&&(s[l][h]=e[l][h]);return e.length=0,e.push(...s),e}var pr=new Set(["\u2500","\u2502","\u250C","\u2510","\u2514","\u2518","\u251C","\u2524","\u252C","\u2534","\u253C","\u2574","\u2575","\u2576","\u2577"]);function Ut(e){return pr.has(e)}var mr={"\u2500":{"\u2502":"\u253C","\u250C":"\u252C","\u2510":"\u252C","\u2514":"\u2534","\u2518":"\u2534","\u251C":"\u253C","\u2524":"\u253C","\u252C":"\u252C","\u2534":"\u2534"},"\u2502":{"\u2500":"\u253C","\u250C":"\u251C","\u2510":"\u2524","\u2514":"\u251C","\u2518":"\u2524","\u251C":"\u251C","\u2524":"\u2524","\u252C":"\u253C","\u2534":"\u253C"},"\u250C":{"\u2500":"\u252C","\u2502":"\u251C","\u2510":"\u252C","\u2514":"\u251C","\u2518":"\u253C","\u251C":"\u251C","\u2524":"\u253C","\u252C":"\u252C","\u2534":"\u253C"},"\u2510":{"\u2500":"\u252C","\u2502":"\u2524","\u250C":"\u252C","\u2514":"\u253C","\u2518":"\u2524","\u251C":"\u253C","\u2524":"\u2524","\u252C":"\u252C","\u2534":"\u253C"},"\u2514":{"\u2500":"\u2534","\u2502":"\u251C","\u250C":"\u251C","\u2510":"\u253C","\u2518":"\u2534","\u251C":"\u251C","\u2524":"\u253C","\u252C":"\u253C","\u2534":"\u2534"},"\u2518":{"\u2500":"\u2534","\u2502":"\u2524","\u250C":"\u253C","\u2510":"\u2524","\u2514":"\u2534","\u251C":"\u253C","\u2524":"\u2524","\u252C":"\u253C","\u2534":"\u2534"},"\u251C":{"\u2500":"\u253C","\u2502":"\u251C","\u250C":"\u251C","\u2510":"\u253C","\u2514":"\u251C","\u2518":"\u253C","\u2524":"\u253C","\u252C":"\u253C","\u2534":"\u253C"},"\u2524":{"\u2500":"\u253C","\u2502":"\u2524","\u250C":"\u253C","\u2510":"\u2524","\u2514":"\u253C","\u2518":"\u2524","\u251C":"\u253C","\u252C":"\u253C","\u2534":"\u253C"},"\u252C":{"\u2500":"\u252C","\u2502":"\u253C","\u250C":"\u252C","\u2510":"\u252C","\u2514":"\u253C","\u2518":"\u253C","\u251C":"\u253C","\u2524":"\u253C","\u2534":"\u253C"},"\u2534":{"\u2500":"\u2534","\u2502":"\u253C","\u250C":"\u253C","\u2510":"\u253C","\u2514":"\u2534","\u2518":"\u2534","\u251C":"\u253C","\u2524":"\u253C","\u252C":"\u253C"}};function gr(e,t){return mr[e]?.[t]??e}function Ee(e,t,r,...n){let[o,i]=Ze(e);for(let s of n){let[l,h]=Ze(s);o=Math.max(o,l+t.x),i=Math.max(i,h+t.y);}let c=he(o,i);for(let s=0;s<=o;s++)for(let l=0;l<=i;l++)s<e.length&&l<e[0].length&&(c[s][l]=e[s][l]);for(let s of n)for(let l=0;l<s.length;l++)for(let h=0;h<s[0].length;h++){let f=s[l][h];if(f!==" "){let u=l+t.x,a=h+t.y,d=c[u][a];!r&&Ut(f)&&Ut(d)?c[u][a]=gr(d,f):c[u][a]=f;}}return c}function Le(e){let[t,r]=Ze(e),n=[];for(let o=0;o<=r;o++){let i="";for(let c=0;c<=t;c++){let s=e[c][o];i+=s,Qe(s)===2&&(c+=1);}n.push(i);}return n.join(`
`)}var xr={"\u25B2":"\u25BC","\u25BC":"\u25B2","\u25E4":"\u25E3","\u25E3":"\u25E4","\u25E5":"\u25E2","\u25E2":"\u25E5","^":"v",v:"^","\u250C":"\u2514","\u2514":"\u250C","\u2510":"\u2518","\u2518":"\u2510","\u252C":"\u2534","\u2534":"\u252C","\u2575":"\u2577","\u2577":"\u2575"};function Kt(e){for(let t of e)t.reverse();for(let t of e)for(let r=0;r<t.length;r++){let n=xr[t[r]];n&&(t[r]=n);}return e}function fe(e,t,r){He(e,t.x+ae(r),t.y);let n=t.x;for(let o of r)e[n][t.y]=o,n+=Qe(o);}function Jt(e,t,r){let n=0,o=0;for(let i of t.values())n+=i;for(let i of r.values())o+=i;He(e,n-1,o-1);}function Zt(e,t){let r=new Map,n=0;for(let[s,l]of e.nodes){let h={name:s,displayLabel:l.label,index:n,gridCoord:null,drawingCoord:null,drawing:null,drawn:false,styleClassName:"",styleClass:Vt};r.set(s,h),n++;}let o=[...r.values()],i=[];for(let s of e.edges){let l=r.get(s.source),h=r.get(s.target);!l||!h||i.push({from:l,to:h,text:s.label??"",path:[],labelLine:[],startDir:{x:0,y:0},endDir:{x:0,y:0}});}let c=[];for(let s of e.subgraphs)Qt(s,null,r,c);yr(e.subgraphs,c,r);for(let[s,l]of e.classAssignments){let h=r.get(s),f=e.classDefs.get(l);h&&f&&(h.styleClassName=l,h.styleClass={name:l,styles:f});}return {nodes:o,edges:i,canvas:he(0,0),grid:new Map,columnWidth:new Map,rowHeight:new Map,subgraphs:c,config:t,offsetX:0,offsetY:0}}function Qt(e,t,r,n){let o={name:e.label,nodes:[],parent:t,children:[],minX:0,minY:0,maxX:0,maxY:0};for(let i of e.nodeIds){let c=r.get(i);c&&o.nodes.push(c);}n.push(o);for(let i of e.children){let c=Qt(i,o,r,n);o.children.push(c);for(let s of c.nodes)o.nodes.includes(s)||o.nodes.push(s);}return o}function yr(e,t,r,n){let o=new Map;wr(e,t,o);let i=new Map;function c(s){let l=o.get(s);if(l){for(let h of s.children)c(h);for(let h of s.nodeIds)i.has(h)||i.set(h,l);}}for(let s of e)c(s);for(let s of t)s.nodes=s.nodes.filter(l=>{let h;for(let[u,a]of r)if(a===l){h=u;break}if(!h)return  false;let f=i.get(h);return f?br(s,f):true});}function br(e,t){let r=t;for(;r!==null;){if(r===e)return  true;r=r.parent;}return  false}function wr(e,t,r){let n=[];function o(i){for(let c of i)n.push(c),o(c.children);}o(e);for(let i=0;i<n.length&&i<t.length;i++)r.set(n[i],t[i]);}var Ct=class{items=[];get length(){return this.items.length}push(t){this.items.push(t),this.bubbleUp(this.items.length-1);}pop(){if(this.items.length===0)return;let t=this.items[0],r=this.items.pop();return this.items.length>0&&(this.items[0]=r,this.sinkDown(0)),t}bubbleUp(t){for(;t>0;){let r=t-1>>1;if(this.items[t].priority<this.items[r].priority)[this.items[t],this.items[r]]=[this.items[r],this.items[t]],t=r;else break}}sinkDown(t){let r=this.items.length;for(;;){let n=t,o=2*t+1,i=2*t+2;if(o<r&&this.items[o].priority<this.items[n].priority&&(n=o),i<r&&this.items[i].priority<this.items[n].priority&&(n=i),n!==t)[this.items[t],this.items[n]]=[this.items[n],this.items[t]],t=n;else break}}};function vr(e,t){let r=Math.abs(e.x-t.x),n=Math.abs(e.y-t.y);return r===0||n===0?r+n:r+n+1}var Cr=[{x:1,y:0},{x:-1,y:0},{x:0,y:1},{x:0,y:-1}];function $r(e,t){return t.x<0||t.y<0?false:!e.has($e(t))}function st(e,t,r,n,o){let i=new Ct;i.push({coord:t,priority:0});let c=new Map;c.set($e(t),0);let s=new Map;for(s.set($e(t),null);i.length>0;){let l=i.pop().coord;if(Fe(l,r)){let f=[],u=l;for(;u!==null;)f.unshift(u),u=s.get($e(u))??null;return f}let h=c.get($e(l));for(let f of Cr){let u={x:l.x+f.x,y:l.y+f.y};if(o&&(u.x>o.maxX||u.y>o.maxY)||!$r(e,u)&&!Fe(u,r))continue;let a=n?n(l,u):1;if(a===null)continue;let d=h+a,p=$e(u),x=c.get(p);if(x===void 0||d<x){c.set(p,d);let g=d+vr(u,r);i.push({coord:u,priority:g}),s.set(p,l);}}}return null}function Be(e){if(e.length<=2)return e;let t=new Set,r=e[0],n=e[1];for(let o=2;o<e.length;o++){let i=e[o],c=n.x-r.x,s=n.y-r.y,l=i.x-n.x,h=i.y-n.y;c===l&&s===h&&t.add(o-1),r=n,n=i;}return e.filter((o,i)=>!t.has(i))}function at(e){return e===ie?ee:e===ee?ie:e===se?re:e===re?se:e===xe?ye:e===me?we:e===we?me:e===ye?xe:it}function U(e,t){return e.x===t.x&&e.y===t.y}function Ae(e,t){return e.x===t.x?e.y<t.y?ee:ie:e.y===t.y?e.x<t.x?re:se:e.x<t.x?e.y<t.y?we:xe:e.y<t.y?ye:me}function Er(e){return e==="LR"?[re,ee,ee,re]:[ee,re,re,ee]}function kr(e,t){if(e.from===e.to)return Er(t);let r=Ae(e.from.gridCoord,e.to.gridCoord),n,o,i,c,s=t==="LR"?U(r,se)||U(r,me)||U(r,ye):U(r,ie)||U(r,me)||U(r,xe);return U(r,we)?t==="LR"?(n=ee,o=se,i=re,c=ie):(n=re,o=ie,i=ee,c=se):U(r,xe)?t==="LR"?(n=ie,o=se,i=re,c=ee):(n=re,o=ee,i=ie,c=se):U(r,ye)?t==="LR"?(n=ee,o=ee,i=se,c=ie):(n=se,o=ie,i=ee,c=re):U(r,me)?t==="LR"?(n=ee,o=ee,i=se,c=ee):(n=re,o=re,i=ie,c=re):s?t==="LR"&&U(r,se)?(n=ee,o=ee,i=se,c=re):t==="TD"&&U(r,ie)?(n=re,o=re,i=ie,c=ee):(n=r,o=at(r),i=r,c=at(r)):(n=r,o=at(r),i=r,c=at(r)),[n,o,i,c]}var Mr=1e3;function $t(e,t){let r=e.x<t.x||e.x===t.x&&e.y<t.y,n=r?`${e.x},${e.y}`:`${t.x},${t.y}`,o=r?`${t.x},${t.y}`:`${e.x},${e.y}`;return `${n}|${o}`}function Sr(e,t,r){if(!(r.length<2))for(let n=1;n<r.length;n++){let o=r[n-1],i=r[n],c=$t(o,i),s=n===1,l=n===r.length-1,h=e.get(c);h||(h={startSources:new Set,endTargets:new Set,usedAsMiddle:false},e.set(c,h)),s&&h.startSources.add(t.from.name),l&&h.endTargets.add(t.to.name),!s&&!l&&(h.usedAsMiddle=true);}}function tn(e,t,r,n,o,i){if(i.usedAsMiddle)return  false;let c=Fe(n,t),s=Fe(o,r);if(c&&s){let l=i.startSources.size===0||i.startSources.size===1&&i.startSources.has(e.from.name),h=i.endTargets.size===0||i.endTargets.size===1&&i.endTargets.has(e.to.name);return l&&h}return c?i.endTargets.size===0&&i.startSources.size===1&&i.startSources.has(e.from.name):s?i.startSources.size===0&&i.endTargets.size===1&&i.endTargets.has(e.to.name):false}function _r(e,t,r,n){return (o,i)=>{let c=e.get($t(o,i));return !c||tn(t,r,n,o,i,c)?1:null}}function Lr(e,t,r,n){return (o,i)=>{let c=e.get($t(o,i));return !c||tn(t,r,n,o,i,c)?1:1+Mr}}function Ar(e,t){if(e.length<2)return 0;if(!t)return e.length-1;let r=0;for(let n=1;n<e.length;n++){let o=t(e[n-1],e[n]);if(o===null)return Number.POSITIVE_INFINITY;r+=o;}return r}function nn(e,t,r){let[n,o,i,c]=kr(t,e.config.graphDirection);function s(L){let y=[];for(let b of L)y.some(v=>U(v,b))||y.push(b);return y}function l(L,y){let b=[];for(let v of L)for(let M of y)b.push({startDir:v,endDir:M,routeFrom:Ie(t.from.gridCoord,v),routeTo:Ie(t.to.gridCoord,M)});return b}let h=[];h.push({startDir:n,endDir:o,routeFrom:Ie(t.from.gridCoord,n),routeTo:Ie(t.to.gridCoord,o)}),(!U(n,i)||!U(o,c))&&h.push({startDir:i,endDir:c,routeFrom:Ie(t.from.gridCoord,i),routeTo:Ie(t.to.gridCoord,c)});let f=s([o,c]),u=s([n,i,re,se,ee,ie,xe,me,we,ye]),a=s([o,c,re,se,ee,ie,xe,me,we,ye]),d=l(u,f),p=l(u,a),x=[12,24,48,96];function g(L,y,b){let v=Math.max(L.x,y.x),M=Math.max(L.y,y.y);for(let R of e.nodes)R.gridCoord&&(v=Math.max(v,R.gridCoord.x+2),M=Math.max(M,R.gridCoord.y+2));return {maxX:v+b,maxY:M+b}}function m(L){let y=null;for(let b of L){let v=st(e.grid,b.routeFrom,b.routeTo);if(!v)continue;let M=Be(v).length;(!y||M<y.cost)&&(y={candidate:b,path:v,cost:M});}return y}function w(L){if(!r||r.size===0)return null;for(let y of x){let b=null;for(let v of L){let M=_r(r,t,v.routeFrom,v.routeTo),R=g(v.routeFrom,v.routeTo,y),O=st(e.grid,v.routeFrom,v.routeTo,M,R);if(!O)continue;let I=Be(O).length;(!b||I<b.cost)&&(b={candidate:v,path:O,cost:I});}if(b)return b}return null}function C(L){if(!r||r.size===0)return null;for(let y of x){let b=null;for(let v of L){let M=Lr(r,t,v.routeFrom,v.routeTo),R=g(v.routeFrom,v.routeTo,y),O=st(e.grid,v.routeFrom,v.routeTo,M,R);if(!O)continue;let I=Ar(O,M);if(!b){b={candidate:v,path:O,cost:I};continue}if(I<b.cost){b={candidate:v,path:O,cost:I};continue}if(I===b.cost){let N=Be(O).length,$=Be(b.path).length;N<$&&(b={candidate:v,path:O,cost:I});}}if(b)return b}return null}let E=null;if(!r||r.size===0)E=m(h);else {E=w(h)??w(d)??w(p);let L=y=>{let b=Math.max(0,y.path.length-1);return y.cost>b};if(!E){if(E=C(h),E&&L(E)){let y=C(d);y&&y.cost<E.cost&&(E=y);}if(E&&L(E)){let y=C(p);y&&y.cost<E.cost&&(E=y);}}E||(E=m(p));}if(!E){t.startDir=n,t.endDir=o,t.path=[];return}t.startDir=E.candidate.startDir,t.endDir=E.candidate.endDir,t.path=Be(E.path),r&&Sr(r,t,E.path);}function rn(e,t){if(t.text.length===0||t.path.length<2)return;let r=ae(t.text),n=Ir(e),o=t.path[0],i=null,c=[o,t.path[1]],s=0,l=false,h=null,f=-1;for(let x=1;x<t.path.length;x++){let g=t.path[x],m=[o,g],w=Dr(e,m);l||(w>=r?(c=m,l=true):w>s&&(s=w,c=m));let C=on(e,m,t.text);if(!(C?n.some(L=>Tr(L,C)):false)&&(w>f&&(f=w,h=m),w>=r)){i=m;break}o=g;}i===null&&(i=h??c);let u=Math.min(i[0].x,i[1].x),a=Math.max(i[0].x,i[1].x),d=u+Math.floor((a-u)/2),p=e.columnWidth.get(d)??0;e.columnWidth.set(d,Math.max(p,r+2)),t.labelLine=[i[0],i[1]];}function Dr(e,t){let r=0,n=Math.min(t[0].x,t[1].x),o=Math.max(t[0].x,t[1].x);for(let i=n;i<=o;i++)r+=e.columnWidth.get(i)??0;return r}function en(e,t){let r=e.offsetX;for(let c=0;c<t.x;c++)r+=e.columnWidth.get(c)??0;let n=e.offsetY;for(let c=0;c<t.y;c++)n+=e.rowHeight.get(c)??0;let o=e.columnWidth.get(t.x)??0,i=e.rowHeight.get(t.y)??0;return {x:r+Math.floor(o/2),y:n+Math.floor(i/2)}}function on(e,t,r){let n=ae(r);if(n<=0)return null;let o=en(e,t[0]),i=en(e,t[1]),c=Math.min(o.x,i.x),s=Math.max(o.x,i.x),l=Math.min(o.y,i.y),h=Math.max(o.y,i.y),f=c+Math.floor((s-c)/2),u=l+Math.floor((h-l)/2),a=f-Math.floor(n/2);return {y:u,startX:a,endX:a+n-1}}function Tr(e,t){return e.y!==t.y?false:!(e.endX<t.startX||t.endX<e.startX)}function Ir(e){let t=[];for(let r of e.edges){if(r.text.length===0||r.labelLine.length<2)continue;let n=on(e,[r.labelLine[0],r.labelLine[1]],r.text);n&&t.push(n);}return t}function sn(e,t){let r=e.gridCoord,n=t.config.useAscii,o=0;for(let d=0;d<2;d++)o+=t.columnWidth.get(r.x+d)??0;let i=0;for(let d=0;d<2;d++)i+=t.rowHeight.get(r.y+d)??0;let c={x:0,y:0},s={x:o,y:i},l=he(Math.max(c.x,s.x),Math.max(c.y,s.y));if(n){for(let d=c.x+1;d<s.x;d++)l[d][c.y]="-";for(let d=c.x+1;d<s.x;d++)l[d][s.y]="-";for(let d=c.y+1;d<s.y;d++)l[c.x][d]="|";for(let d=c.y+1;d<s.y;d++)l[s.x][d]="|";l[c.x][c.y]="+",l[s.x][c.y]="+",l[c.x][s.y]="+",l[s.x][s.y]="+";}else {for(let d=c.x+1;d<s.x;d++)l[d][c.y]="\u2500";for(let d=c.x+1;d<s.x;d++)l[d][s.y]="\u2500";for(let d=c.y+1;d<s.y;d++)l[c.x][d]="\u2502";for(let d=c.y+1;d<s.y;d++)l[s.x][d]="\u2502";l[c.x][c.y]="\u250C",l[s.x][c.y]="\u2510",l[c.x][s.y]="\u2514",l[s.x][s.y]="\u2518";}let h=e.displayLabel,f=c.y+Math.floor(i/2),u=ae(h),a=c.x+Math.floor(o/2)-Math.ceil(u/2)+1;return fe(l,{x:a,y:f},h),l}function ct(e,t,r=1){let n=0;for(let C of e)for(let E of C)n=Math.max(n,ae(E));let i=n+2*r+2,c=0;for(let C of e)c+=Math.max(C.length,1);let s=e.length-1,l=c+s+2,h=t?"-":"\u2500",f=t?"|":"\u2502",u=t?"+":"\u250C",a=t?"+":"\u2510",d=t?"+":"\u2514",p=t?"+":"\u2518",x=t?"+":"\u251C",g=t?"+":"\u2524",m=he(i-1,l-1);m[0][0]=u;for(let C=1;C<i-1;C++)m[C][0]=h;m[i-1][0]=a,m[0][l-1]=d;for(let C=1;C<i-1;C++)m[C][l-1]=h;m[i-1][l-1]=p;for(let C=1;C<l-1;C++)m[0][C]=f,m[i-1][C]=f;let w=1;for(let C=0;C<e.length;C++){let E=e[C],L=E.length>0?E:[""];for(let y of L){let b=1+r;fe(m,{x:b,y:w},y),w++;}if(C<e.length-1){m[0][w]=x;for(let y=1;y<i-1;y++)m[y][w]=h;m[i-1][w]=g,w++;}}return m}function Gr(e,t,r,n,o,i){let c=Ae(t,r),s=[],l=i?"-":"\u2500",h=i?"|":"\u2502",f=i?"\\":"\u2572",u=i?"/":"\u2571";if(U(c,ie))for(let a=t.y-n;a>=r.y-o;a--)s.push({x:t.x,y:a}),e[t.x][a]=h;else if(U(c,ee))for(let a=t.y+n;a<=r.y+o;a++)s.push({x:t.x,y:a}),e[t.x][a]=h;else if(U(c,se))for(let a=t.x-n;a>=r.x-o;a--)s.push({x:a,y:t.y}),e[a][t.y]=l;else if(U(c,re))for(let a=t.x+n;a<=r.x+o;a++)s.push({x:a,y:t.y}),e[a][t.y]=l;else if(U(c,me))for(let a=t.x,d=t.y-n;a>=r.x-o&&d>=r.y-o;a--,d--)s.push({x:a,y:d}),e[a][d]=f;else if(U(c,xe))for(let a=t.x,d=t.y-n;a<=r.x+o&&d>=r.y-o;a++,d--)s.push({x:a,y:d}),e[a][d]=u;else if(U(c,ye))for(let a=t.x,d=t.y+n;a>=r.x-o&&d<=r.y+o;a--,d++)s.push({x:a,y:d}),e[a][d]=u;else if(U(c,we))for(let a=t.x,d=t.y+n;a<=r.x+o&&d<=r.y+o;a++,d++)s.push({x:a,y:d}),e[a][d]=f;return s}function Nr(e,t){if(t.path.length===0){let h=Ne(e.canvas);return [h,h,h,h,h]}let r=Fr(e,t),[n,o,i]=Pr(e,t.path),c=Rr(e,t.path,o[0]),s=Or(e,o[o.length-1],i[i.length-1]),l=Wr(e,t.path);return [n,c,s,l,r]}function Pr(e,t){let r=Ne(e.canvas),n=t[0],o=[],i=[];for(let c=1;c<t.length;c++){let s=t[c],l=Ye(e,n),h=Ye(e,s);if(zt(l,h)){n=s;continue}let f=Ae(n,s),u=Gr(r,l,h,1,-1,e.config.useAscii);u.length===0&&u.push(l),o.push(u),i.push(f),n=s;}return [r,o,i]}function Rr(e,t,r){let n=Ne(e.canvas);if(e.config.useAscii)return n;let o=r[0],i=Ae(t[0],t[1]);return U(i,ie)?n[o.x][o.y+1]="\u2534":U(i,ee)?n[o.x][o.y-1]="\u252C":U(i,se)?n[o.x+1][o.y]="\u2524":U(i,re)&&(n[o.x-1][o.y]="\u251C"),n}function Or(e,t,r){let n=Ne(e.canvas);if(t.length===0)return n;let o=t[0],i=t[t.length-1],c=Ae(o,i);(t.length===1||U(c,it))&&(c=r);let s;return e.config.useAscii?U(c,ie)?s="^":U(c,ee)?s="v":U(c,se)?s="<":U(c,re)?s=">":U(r,ie)?s="^":U(r,ee)?s="v":U(r,se)?s="<":U(r,re)?s=">":s="*":U(c,ie)?s="\u25B2":U(c,ee)?s="\u25BC":U(c,se)?s="\u25C4":U(c,re)?s="\u25BA":U(c,xe)?s="\u25E5":U(c,me)?s="\u25E4":U(c,we)?s="\u25E2":U(c,ye)?s="\u25E3":U(r,ie)?s="\u25B2":U(r,ee)?s="\u25BC":U(r,se)?s="\u25C4":U(r,re)?s="\u25BA":U(r,xe)?s="\u25E5":U(r,me)?s="\u25E4":U(r,we)?s="\u25E2":U(r,ye)?s="\u25E3":s="\u25CF",n[i.x][i.y]=s,n}function Wr(e,t){let r=Ne(e.canvas);for(let n=1;n<t.length-1;n++){let o=t[n],i=Ye(e,o),c=Ae(t[n-1],o),s=Ae(o,t[n+1]),l;e.config.useAscii?l="+":U(c,re)&&U(s,ee)||U(c,ie)&&U(s,se)?l="\u2510":U(c,re)&&U(s,ie)||U(c,ee)&&U(s,se)?l="\u2518":U(c,se)&&U(s,ee)||U(c,ie)&&U(s,re)?l="\u250C":U(c,se)&&U(s,ie)||U(c,ee)&&U(s,re)?l="\u2514":l="+",r[i.x][i.y]=l;}return r}function Fr(e,t){let r=Ne(e.canvas);if(t.text.length===0)return r;let n=cn(e,t.labelLine);return Hr(r,n,t.text),r}function Hr(e,t,r){if(t.length<2)return;let n=Math.min(t[0].x,t[1].x),o=Math.max(t[0].x,t[1].x),i=Math.min(t[0].y,t[1].y),c=Math.max(t[0].y,t[1].y),s=n+Math.floor((o-n)/2),l=i+Math.floor((c-i)/2),h=s-Math.floor(ae(r)/2);fe(e,{x:h,y:l},r);}function Br(e,t){let r=e.maxX-e.minX,n=e.maxY-e.minY;if(r<=0||n<=0)return he(0,0);let o={x:0,y:0},i={x:r,y:n},c=he(r,n);if(t.config.useAscii){for(let s=o.x+1;s<i.x;s++)c[s][o.y]="-";for(let s=o.x+1;s<i.x;s++)c[s][i.y]="-";for(let s=o.y+1;s<i.y;s++)c[o.x][s]="|";for(let s=o.y+1;s<i.y;s++)c[i.x][s]="|";c[o.x][o.y]="+",c[i.x][o.y]="+",c[o.x][i.y]="+",c[i.x][i.y]="+";}else {for(let s=o.x+1;s<i.x;s++)c[s][o.y]="\u2500";for(let s=o.x+1;s<i.x;s++)c[s][i.y]="\u2500";for(let s=o.y+1;s<i.y;s++)c[o.x][s]="\u2502";for(let s=o.y+1;s<i.y;s++)c[i.x][s]="\u2502";c[o.x][o.y]="\u250C",c[i.x][o.y]="\u2510",c[o.x][i.y]="\u2514",c[i.x][i.y]="\u2518";}return c}function Yr(e,t){let r=e.maxX-e.minX,n=e.maxY-e.minY;if(r<=0||n<=0)return [he(0,0),{x:0,y:0}];let o=he(r,n),i=1,c=Math.floor(r/2)-Math.floor(ae(e.name)/2);return c<1&&(c=1),fe(o,{x:c,y:i},e.name),[o,{x:e.minX,y:e.minY}]}function Xr(e){function t(n){return n.parent===null?0:1+t(n.parent)}let r=[...e];return r.sort((n,o)=>t(n)-t(o)),r}function an(e){let t=e.config.useAscii,r=Xr(e.subgraphs);for(let h of r){let f=Br(h,e),u={x:h.minX,y:h.minY};e.canvas=Ee(e.canvas,u,t,f);}for(let h of e.nodes)!h.drawn&&h.drawingCoord&&h.drawing&&(e.canvas=Ee(e.canvas,h.drawingCoord,t,h.drawing),h.drawn=true);let n=[],o=[],i=[],c=[],s=[];for(let h of e.edges){let[f,u,a,d,p]=Nr(e,h);n.push(f),o.push(d),i.push(a),c.push(u),s.push(p);}let l={x:0,y:0};e.canvas=Ee(e.canvas,l,t,...n),e.canvas=Ee(e.canvas,l,t,...o),e.canvas=Ee(e.canvas,l,t,...i),e.canvas=Ee(e.canvas,l,t,...c),e.canvas=Ee(e.canvas,l,t,...s);for(let h of e.subgraphs){if(h.nodes.length===0)continue;let[f,u]=Yr(h);e.canvas=Ee(e.canvas,u,t,f);}return e.canvas}function Ye(e,t,r){let n=t,o=0;for(let l=0;l<n.x;l++)o+=e.columnWidth.get(l)??0;let i=0;for(let l=0;l<n.y;l++)i+=e.rowHeight.get(l)??0;let c=e.columnWidth.get(n.x)??0,s=e.rowHeight.get(n.y)??0;return {x:o+Math.floor(c/2)+e.offsetX,y:i+Math.floor(s/2)+e.offsetY}}function cn(e,t){return t.map(r=>Ye(e,r))}function et(e,t,r){if(e.grid.has($e(r)))return e.config.graphDirection==="LR"?et(e,t,{x:r.x,y:r.y+4}):et(e,t,{x:r.x+4,y:r.y});for(let n=0;n<3;n++)for(let o=0;o<3;o++){let i={x:r.x+n,y:r.y+o};e.grid.set($e(i),t);}return t.gridCoord=r,r}function jr(e,t){let r=t.gridCoord,n=e.config.boxBorderPadding,o=[1,2*n+ae(t.displayLabel),1],i=[1,1+2*n,1];for(let c=0;c<o.length;c++){let s=r.x+c,l=e.columnWidth.get(s)??0;e.columnWidth.set(s,Math.max(l,o[c]));}for(let c=0;c<i.length;c++){let s=r.y+c,l=e.rowHeight.get(s)??0;e.rowHeight.set(s,Math.max(l,i[c]));}if(r.x>0){let c=e.columnWidth.get(r.x-1)??0;e.columnWidth.set(r.x-1,Math.max(c,e.config.paddingX));}if(r.y>0){let c=e.config.paddingY;Vr(e,t)&&(c+=4);let s=e.rowHeight.get(r.y-1)??0;e.rowHeight.set(r.y-1,Math.max(s,c));}}function zr(e,t){if(t.length===0)return;function r(o){e.columnWidth.has(o.x)||e.columnWidth.set(o.x,Math.floor(e.config.paddingX/2)),e.rowHeight.has(o.y)||e.rowHeight.set(o.y,Math.floor(e.config.paddingY/2));}let n=t[0];r(n);for(let o=1;o<t.length;o++){let i=t[o];if(n.x===i.x){let c=i.y>n.y?1:-1;for(let s=n.y;s!==i.y;s+=c)r({x:n.x,y:s}),r({x:n.x,y:s+c});}else if(n.y===i.y){let c=i.x>n.x?1:-1;for(let s=n.x;s!==i.x;s+=c)r({x:s,y:n.y}),r({x:s+c,y:n.y});}else r(i);n=i;}}function Et(e,t){return e.subgraphs.some(r=>r.nodes.includes(t))}function kt(e,t){for(let r of e.subgraphs)if(r.nodes.includes(t))return r;return null}function Vr(e,t){let r=kt(e,t);if(!r)return  false;let n=false;for(let o of e.edges)if(o.to===t&&kt(e,o.from)!==r){n=true;break}if(!n)return  false;for(let o of r.nodes){if(o===t||!o.gridCoord)continue;let i=false;for(let c of e.edges)if(c.to===o&&kt(e,c.from)!==r){i=true;break}if(i&&o.gridCoord.y<t.gridCoord.y)return  false}return  true}function ln(e,t){if(t.nodes.length===0)return;let r=1e6,n=1e6,o=-1e6,i=-1e6;for(let l of t.children)ln(e,l),l.nodes.length>0&&(r=Math.min(r,l.minX),n=Math.min(n,l.minY),o=Math.max(o,l.maxX),i=Math.max(i,l.maxY));for(let l of t.nodes){if(!l.drawingCoord||!l.drawing)continue;let h=l.drawingCoord.x,f=l.drawingCoord.y,u=h+l.drawing.length-1,a=f+l.drawing[0].length-1;r=Math.min(r,h),n=Math.min(n,f),o=Math.max(o,u),i=Math.max(i,a);}let c=2,s=2;t.minX=r-c,t.minY=n-c-s,t.maxX=o+c,t.maxY=i+c;}function Ur(e){let r=e.subgraphs.filter(n=>n.parent===null&&n.nodes.length>0);for(let n=0;n<r.length;n++)for(let o=n+1;o<r.length;o++){let i=r[n],c=r[o];i.minX<c.maxX&&i.maxX>c.minX&&(i.maxY>=c.minY-1&&i.minY<c.minY?c.minY=i.maxY+1+1:c.maxY>=i.minY-1&&c.minY<i.minY&&(i.minY=c.maxY+1+1)),i.minY<c.maxY&&i.maxY>c.minY&&(i.maxX>=c.minX-1&&i.minX<c.minX?c.minX=i.maxX+1+1:c.maxX>=i.minX-1&&c.minX<i.minX&&(i.minX=c.maxX+1+1));}}function qr(e){for(let t of e.subgraphs)ln(e,t);Ur(e);}function Kr(e){if(e.subgraphs.length===0)return;let t=0,r=0;for(let i of e.subgraphs)t=Math.min(t,i.minX),r=Math.min(r,i.minY);let n=-t,o=-r;if(!(n===0&&o===0)){e.offsetX=n,e.offsetY=o;for(let i of e.subgraphs)i.minX+=n,i.minY+=o,i.maxX+=n,i.maxY+=o;for(let i of e.nodes)i.drawingCoord&&(i.drawingCoord.x+=n,i.drawingCoord.y+=o);}}function dn(e){let t=e.config.graphDirection,r=new Array(100).fill(0),n=new Map,o=new Set,i=[];for(let u of e.nodes){o.has(u.name)||i.push(u),o.add(u.name);for(let a of Mt(e,u))o.add(a.name);}let c=false,s=false;for(let u of i)Et(e,u)?Mt(e,u).length>0&&(s=true):c=true;let l=t==="LR"&&c&&s,h,f=[];l?(h=i.filter(u=>!Et(e,u)),f=i.filter(u=>Et(e,u))):h=i;for(let u of h){let a=t==="LR"?{x:0,y:r[0]}:{x:r[0],y:0};et(e,e.nodes[u.index],a),r[0]=r[0]+4;}if(l&&f.length>0)for(let a of f){let d=t==="LR"?{x:4,y:r[4]}:{x:r[4],y:4};et(e,e.nodes[a.index],d),r[4]=r[4]+4;}for(let u of e.nodes){let a=u.gridCoord,d=t==="LR"?a.x+4:a.y+4,p=r[d];for(let x of Mt(e,u)){if(x.gridCoord!==null)continue;let g=t==="LR"?{x:d,y:p}:{x:p,y:d};et(e,e.nodes[x.index],g),r[d]=p+4,p=r[d];}}for(let u of e.nodes)jr(e,u);for(let u of e.edges)nn(e,u,n),zr(e,u.path),rn(e,u);for(let u of e.nodes)u.drawingCoord=Ye(e,u.gridCoord),u.drawing=sn(u,e);Jt(e.canvas,e.columnWidth,e.rowHeight),qr(e),Kr(e);}function Jr(e,t){return e.edges.filter(r=>r.from.name===t.name)}function Mt(e,t){return Jr(e,t).map(r=>r.to)}function lt(e){let t={actors:[],messages:[],blocks:[],notes:[]},r=new Set,n=[];for(let o=1;o<e.length;o++){let i=e[o],c=i.match(/^(participant|actor)\s+(\S+?)(?:\s+as\s+(.+))?$/);if(c){let a=c[1],d=c[2],p=c[3]?.trim()??d;r.has(d)||(r.add(d),t.actors.push({id:d,label:p,type:a}));continue}let s=i.match(/^Note\s+(left of|right of|over)\s+([^:]+):\s*(.+)$/i);if(s){let a=s[1].toLowerCase(),d=s[2].trim(),p=s[3].trim(),x=d.split(",").map(m=>m.trim());for(let m of x)tt(t,r,m);let g="over";a==="left of"?g="left":a==="right of"&&(g="right"),t.notes.push({actorIds:x,text:p,position:g,afterIndex:t.messages.length-1});continue}let l=i.match(/^(loop|alt|opt|par|critical|break|rect)\s*(.*)$/);if(l){let a=l[1],d=l[2]?.trim()??"";n.push({type:a,label:d,startIndex:t.messages.length,dividers:[]});continue}let h=i.match(/^(else|and)\s*(.*)$/);if(h&&n.length>0){let a=h[2]?.trim()??"";n[n.length-1].dividers.push({index:t.messages.length,label:a});continue}if(i==="end"&&n.length>0){let a=n.pop();t.blocks.push({type:a.type,label:a.label,startIndex:a.startIndex,endIndex:Math.max(t.messages.length-1,a.startIndex),dividers:a.dividers});continue}let f=i.match(/^(\S+?)\s*(--?>?>|--?[)x]|--?>>|--?>)\s*([+-]?)(\S+?)\s*:\s*(.+)$/);if(f){let a=f[1],d=f[2],p=f[3],x=f[4],g=f[5].trim();tt(t,r,a),tt(t,r,x);let m=d.startsWith("--")?"dashed":"solid",w=d.includes(">>")||d.includes("x")?"filled":"open",C={from:a,to:x,label:g,lineStyle:m,arrowHead:w};p==="+"&&(C.activate=true),p==="-"&&(C.deactivate=true),t.messages.push(C);continue}let u=i.match(/^(\S+?)\s*(->>|-->>|-\)|--\)|-x|--x|->|-->)\s*([+-]?)(\S+?)\s*:\s*(.+)$/);if(u){let a=u[1],d=u[2],p=u[3],x=u[4],g=u[5].trim();tt(t,r,a),tt(t,r,x);let m=d.startsWith("--")?"dashed":"solid",w=d.includes(">>")||d.includes("x")?"filled":"open",C={from:a,to:x,label:g,lineStyle:m,arrowHead:w};p==="+"&&(C.activate=true),p==="-"&&(C.deactivate=true),t.messages.push(C);continue}}return t}function tt(e,t,r){t.has(r)||(t.add(r),e.actors.push({id:r,label:r,type:"participant"}));}function hn(e,t){let r=e.split(`
`).map(A=>A.trim()).filter(A=>A.length>0&&!A.startsWith("%%")),n=lt(r);if(n.actors.length===0)return "";let o=t.useAscii,i=o?"-":"\u2500",c=o?"|":"\u2502",s=o?"+":"\u250C",l=o?"+":"\u2510",h=o?"+":"\u2514",f=o?"+":"\u2518",u=o?"+":"\u252C",a=o?"+":"\u2534",d=o?"+":"\u251C",p=o?"+":"\u2524",x=new Map;n.actors.forEach((A,Y)=>x.set(A.id,Y));let g=1,w=n.actors.map(A=>ae(A.label)+2*g+2).map(A=>Math.ceil(A/2)),C=3,E=new Array(Math.max(n.actors.length-1,0)).fill(0);for(let A of n.messages){let Y=x.get(A.from),X=x.get(A.to);if(Y===X)continue;let H=Math.min(Y,X),B=Math.max(Y,X),W=ae(A.label)+4,z=B-H,V=Math.ceil(W/z);for(let _=H;_<B;_++)E[_]=Math.max(E[_],V);}let L=[w[0]];for(let A=1;A<n.actors.length;A++){let Y=Math.max(w[A-1]+w[A]+2,E[A-1]+2,10);L[A]=L[A-1]+Y;}let y=[],b=[],v=new Map,M=new Map,R=new Map,O=[],I=C;for(let A=0;A<n.messages.length;A++){for(let H=0;H<n.blocks.length;H++)n.blocks[H].startIndex===A&&(I+=2,v.set(H,I-1));for(let H=0;H<n.blocks.length;H++)for(let B=0;B<n.blocks[H].dividers.length;B++)n.blocks[H].dividers[B].index===A&&(I+=1,R.set(`${H}:${B}`,I),I+=1);I+=1;let Y=n.messages[A];Y.from===Y.to?(b[A]=I+1,y[A]=I,I+=3):(b[A]=I,y[A]=I+1,I+=2);for(let H=0;H<n.notes.length;H++)if(n.notes[H].afterIndex===A){I+=1;let B=n.notes[H],W=B.text.split("\\n"),z=Math.max(...W.map(P=>ae(P)))+4,V=W.length+2,_=x.get(B.actorIds[0])??0,G;if(B.position==="left")G=L[_]-z-1;else if(B.position==="right")G=L[_]+2;else if(B.actorIds.length>=2){let P=x.get(B.actorIds[1])??_;G=Math.floor((L[_]+L[P])/2)-Math.floor(z/2);}else G=L[_]-Math.floor(z/2);G=Math.max(0,G),O.push({x:G,y:I,width:z,height:V,lines:W}),I+=V;}for(let H=0;H<n.blocks.length;H++)n.blocks[H].endIndex===A&&(I+=1,M.set(H,I),I+=1);}I+=1;let N=I,$=N+C,k=L[L.length-1]??0,D=w[w.length-1]??0,T=k+D+2;for(let A=0;A<n.messages.length;A++){let Y=n.messages[A];if(Y.from===Y.to){let X=x.get(Y.from),H=L[X]+6+2+ae(Y.label);T=Math.max(T,H+1);}}for(let A of O)T=Math.max(T,A.x+A.width+1);let S=he(T,$-1);function F(A,Y,X){let H=ae(X)+2*g+2,B=A-Math.floor(H/2);S[B][Y]=s;for(let z=1;z<H-1;z++)S[B+z][Y]=i;S[B+H-1][Y]=l,S[B][Y+1]=c,S[B+H-1][Y+1]=c;let W=B+1+g;fe(S,{x:W,y:Y+1},X),S[B][Y+2]=h;for(let z=1;z<H-1;z++)S[B+z][Y+2]=i;S[B+H-1][Y+2]=f;}for(let A=0;A<n.actors.length;A++){let Y=L[A];for(let X=C;X<=N;X++)S[Y][X]=c;}for(let A=0;A<n.actors.length;A++){let Y=n.actors[A];F(L[A],0,Y.label),F(L[A],N,Y.label),o||(S[L[A]][C-1]=u,S[L[A]][N]=a);}for(let A=0;A<n.messages.length;A++){let Y=n.messages[A],X=x.get(Y.from),H=x.get(Y.to),B=L[X],W=L[H],z=X===H,V=Y.lineStyle==="dashed",_=Y.arrowHead==="filled",G=V?o?".":"\u254C":i;if(z){let P=y[A],j=Math.max(4,4);S[B][P]=d;for(let ne=B+1;ne<B+j;ne++)S[ne][P]=G;S[B+j][P]=o?"+":"\u2510",S[B+j][P+1]=c;let J=B+j+2;fe(S,{x:J,y:P+1},Y.label);let Q=_?o?"<":"\u25C0":o?"<":"\u25C1";S[B][P+2]=Q;for(let ne=B+1;ne<B+j;ne++)S[ne][P+2]=G;S[B+j][P+2]=o?"+":"\u2518";}else {let P=b[A],j=y[A],J=B<W,ne=Math.floor((B+W)/2)-Math.floor(ae(Y.label)/2);if(fe(S,{x:Math.max(0,ne),y:P},Y.label),J){for(let ve=B+1;ve<W;ve++)S[ve][j]=G;let ue=_?o?">":"\u25B6":o?">":"\u25B7";S[W][j]=ue;}else {for(let ve=W+1;ve<B;ve++)S[ve][j]=G;let ue=_?o?"<":"\u25C0":o?"<":"\u25C1";S[W][j]=ue;}}}for(let A=0;A<n.blocks.length;A++){let Y=n.blocks[A],X=v.get(A),H=M.get(A);if(X===void 0||H===void 0)continue;let B=T,W=0;for(let G=Y.startIndex;G<=Y.endIndex&&!(G>=n.messages.length);G++){let P=n.messages[G],j=x.get(P.from)??0,J=x.get(P.to)??0;B=Math.min(B,L[Math.min(j,J)]),W=Math.max(W,L[Math.max(j,J)]);}let z=Math.max(0,B-4),V=Math.min(T-1,W+4);S[z][X]=s;for(let G=z+1;G<V;G++)S[G][X]=i;S[V][X]=l;let _=Y.label?`${Y.type} [${Y.label}]`:Y.type;fe(S,{x:z+1,y:X},Ge(_,V-(z+1))),S[z][H]=h;for(let G=z+1;G<V;G++)S[G][H]=i;S[V][H]=f;for(let G=X+1;G<H;G++)S[z][G]=c,S[V][G]=c;for(let G=0;G<Y.dividers.length;G++){let P=R.get(`${A}:${G}`);if(P===void 0)continue;let j=q();S[z][P]=d;for(let Q=z+1;Q<V;Q++)S[Q][P]=j;S[V][P]=p;let J=Y.dividers[G].label;if(J){let Q=`[${J}]`;fe(S,{x:z+1,y:P},Ge(Q,V-(z+1)));}}}for(let A of O){He(S,A.x+A.width,A.y+A.height),S[A.x][A.y]=s;for(let X=1;X<A.width-1;X++)S[A.x+X][A.y]=i;S[A.x+A.width-1][A.y]=l;for(let X=0;X<A.lines.length;X++){let H=A.y+1+X;S[A.x][H]=c,S[A.x+A.width-1][H]=c,fe(S,{x:A.x+2,y:H},A.lines[X]);}let Y=A.y+A.height-1;S[A.x][Y]=h;for(let X=1;X<A.width-1;X++)S[A.x+X][Y]=i;S[A.x+A.width-1][Y]=f;}return Le(S);function q(){return o?"-":"\u254C"}}function dt(e){let t={classes:[],relationships:[],namespaces:[]},r=new Map,n=null,o=null,i=0;for(let c=1;c<e.length;c++){let s=e[c];if(o&&i>0){if(s==="}"){i--,i===0&&(o=null);continue}let p=s.match(/^<<(\w+)>>$/);if(p){o.annotation=p[1];continue}let x=fn(s);x&&(x.isMethod?o.methods.push(x.member):o.attributes.push(x.member));continue}let l=s.match(/^namespace\s+(\S+)\s*\{$/);if(l){n={name:l[1],classIds:[]};continue}if(s==="}"&&n){t.namespaces.push(n),n=null;continue}let h=s.match(/^class\s+(\S+?)(?:\s*~(\w+)~)?\s*\{$/);if(h){let p=h[1],x=h[2],g=Xe(r,p);x&&(g.label=`${p}<${x}>`),o=g,i=1,n&&n.classIds.push(p);continue}let f=s.match(/^class\s+(\S+?)(?:\s*~(\w+)~)?\s*$/);if(f){let p=f[1],x=f[2],g=Xe(r,p);x&&(g.label=`${p}<${x}>`),n&&n.classIds.push(p);continue}let u=s.match(/^class\s+(\S+?)\s*\{\s*<<(\w+)>>\s*\}$/);if(u){let p=Xe(r,u[1]);p.annotation=u[2];continue}let a=s.match(/^(\S+?)\s*:\s*(.+)$/);if(a){let p=a[2];if(!p.match(/<\|--|--|\*--|o--|-->|\.\.>|\.\.\|>/)){let x=Xe(r,a[1]),g=fn(p);g&&(g.isMethod?x.methods.push(g.member):x.attributes.push(g.member));continue}}let d=Zr(s);if(d){Xe(r,d.from),Xe(r,d.to),t.relationships.push(d);continue}}return t.classes=[...r.values()],t}function Xe(e,t){let r=e.get(t);return r||(r={id:t,label:t,attributes:[],methods:[]},e.set(t,r)),r}function fn(e){let t=e.trim().replace(/;$/,"");if(!t)return null;let r="",n=t;/^[+\-#~]/.test(n)&&(r=n[0],n=n.slice(1).trim());let o=n.match(/^(.+?)\(([^)]*)\)(?:\s*(.+))?$/);if(o){let f=o[1].trim(),u=o[3]?.trim(),a=f.endsWith("$")||n.includes("$"),d=f.endsWith("*")||n.includes("*");return {member:{visibility:r,name:f.replace(/[$*]$/,""),type:u||void 0,isStatic:a,isAbstract:d},isMethod:true}}let i=n.split(/\s+/),c,s;i.length>=2?(s=i[0],c=i.slice(1).join(" ")):c=i[0]??n;let l=c.endsWith("$"),h=c.endsWith("*");return {member:{visibility:r,name:c.replace(/[$*]$/,""),type:s||void 0,isStatic:l,isAbstract:h},isMethod:false}}function Zr(e){let t=e.match(/^(\S+?)\s+(?:"([^"]*?)"\s+)?(<\|--|<\|\.\.|\*--|o--|-->|--\*|--o|--|>\s*|\.\.>|\.\.\|>|--)\s+(?:"([^"]*?)"\s+)?(\S+?)(?:\s*:\s*(.+))?$/);if(!t)return null;let r=t[1],n=t[2]||void 0,o=t[3].trim(),i=t[4]||void 0,c=t[5],s=t[6]?.trim()||void 0,l=Qr(o);return l?{from:r,to:c,type:l.type,markerAt:l.markerAt,label:s,fromCardinality:n,toCardinality:i}:null}function Qr(e){switch(e){case "<|--":return {type:"inheritance",markerAt:"from"};case "<|..":return {type:"realization",markerAt:"from"};case "*--":return {type:"composition",markerAt:"from"};case "--*":return {type:"composition",markerAt:"to"};case "o--":return {type:"aggregation",markerAt:"from"};case "--o":return {type:"aggregation",markerAt:"to"};case "-->":return {type:"association",markerAt:"to"};case "..>":return {type:"dependency",markerAt:"to"};case "..|>":return {type:"realization",markerAt:"to"};case "--":return {type:"association",markerAt:"to"};default:return null}}function un(e){let t=e.visibility||"",r=e.type?`: ${e.type}`:"";return `${t}${e.name}${r}`}function eo(e){let t=[];e.annotation&&t.push(`<<${e.annotation}>>`),t.push(e.label);let r=e.attributes.map(un),n=e.methods.map(un);return r.length===0&&n.length===0?[t]:n.length===0?[t,r]:[t,r,n]}function to(e,t){return {type:e,markerAt:t,dashed:e==="dependency"||e==="realization"}}function je(e,t,r){switch(e){case "inheritance":case "realization":return r==="down"?t?"^":"\u25B3":r==="up"?t?"v":"\u25BD":r==="left"?t?">":"\u25C1":t?"<":"\u25B7";case "composition":return t?"*":"\u25C6";case "aggregation":return t?"o":"\u25C7";case "association":case "dependency":return r==="down"?t?"v":"\u25BC":r==="up"?t?"^":"\u25B2":r==="left"?t?"<":"\u25C0":t?">":"\u25B6"}}function pn(e,t){let r=e.split(`
`).map(N=>N.trim()).filter(N=>N.length>0&&!N.startsWith("%%")),n=dt(r);if(n.classes.length===0)return "";let o=t.useAscii,i=4,c=3,s=new Map,l=new Map,h=new Map;for(let N of n.classes){let $=eo(N);s.set(N.id,$);let k=0;for(let F of $)for(let q of F)k=Math.max(k,ae(q));let D=k+4,T=0;for(let F of $)T+=Math.max(F.length,1);let S=T+($.length-1)+2;l.set(N.id,D),h.set(N.id,S);}let f=new Map;for(let N of n.classes)f.set(N.id,N);let u=new Map,a=new Map;for(let N of n.relationships){let $=N.type==="inheritance"||N.type==="realization",k=$&&N.markerAt==="to"?N.to:N.from,D=$&&N.markerAt==="to"?N.from:N.to;u.has(D)||u.set(D,new Set),u.get(D).add(k),a.has(k)||a.set(k,new Set),a.get(k).add(D);}let d=new Map,x=n.classes.filter(N=>!u.has(N.id)||u.get(N.id).size===0).map(N=>N.id);for(let N of x)d.set(N,0);let g=n.classes.length-1,m=0;for(;m<x.length;){let N=x[m++],$=a.get(N);if($)for(let k of $){let D=(d.get(N)??0)+1;D>g||(!d.has(k)||d.get(k)<D)&&(d.set(k,D),x.push(k));}}for(let N of n.classes)d.has(N.id)||d.set(N.id,0);let w=Math.max(...d.values(),0),C=Array.from({length:w+1},()=>[]);for(let N of n.classes)C[d.get(N.id)].push(N.id);let E=new Map,L=0;for(let N=0;N<=w;N++){let $=C[N];if($.length===0)continue;let k=0,D=0;for(let T of $){let S=f.get(T),F=l.get(T),q=h.get(T);E.set(T,{cls:S,sections:s.get(T),x:k,y:L,width:F,height:q}),k+=F+i,D=Math.max(D,q);}L+=D+c;}let y=0,b=0;for(let N of E.values())y=Math.max(y,N.x+N.width),b=Math.max(b,N.y+N.height);y+=4,b+=2;let v=he(y-1,b-1);for(let N of E.values()){let $=ct(N.sections,o);for(let k=0;k<$.length;k++)for(let D=0;D<$[0].length;D++){let T=$[k][D];if(T!==" "){let S=N.x+k,F=N.y+D;S<y&&F<b&&(v[S][F]=T);}}}let M=o?"-":"\u2500",R=o?"|":"\u2502",O=o?".":"\u254C",I=o?":":"\u250A";for(let N of n.relationships){let $=E.get(N.from),k=E.get(N.to);if(!$||!k)continue;let D=to(N.type,N.markerAt),T=D.dashed?O:M,S=D.dashed?I:R,F=$.x+Math.floor($.width/2),q=$.y+$.height-1,A=k.x+Math.floor(k.width/2),Y=k.y;if(q<Y){let X=q+Math.floor((Y-q)/2);for(let H=q+1;H<=X;H++)H<b&&(v[F][H]=S);if(F!==A){let H=Math.min(F,A),B=Math.max(F,A);for(let W=H;W<=B;W++)W<y&&X<b&&(v[W][X]=T);!o&&X<b&&(F<A?(v[F][X]="\u2514",v[A][X]="\u2510"):(v[F][X]="\u2518",v[A][X]="\u250C"));}for(let H=X+1;H<Y;H++)H<b&&(v[A][H]=S);if(D.markerAt==="to"){let H=je(D.type,o,"down"),B=Y-1;if(B>=0&&B<b)for(let W=0;W<H.length;W++){let z=A-Math.floor(H.length/2)+W;z>=0&&z<y&&(v[z][B]=H[W]);}}if(D.markerAt==="from"){let H=je(D.type,o,"down"),B=q+1;if(B<b)for(let W=0;W<H.length;W++){let z=F-Math.floor(H.length/2)+W;z>=0&&z<y&&(v[z][B]=H[W]);}}}else if(k.y+k.height-1<$.y){let X=$.y,H=k.y+k.height-1,B=H+Math.floor((X-H)/2);for(let W=X-1;W>=B;W--)W>=0&&W<b&&(v[F][W]=S);if(F!==A){let W=Math.min(F,A),z=Math.max(F,A);for(let V=W;V<=z;V++)V<y&&B>=0&&B<b&&(v[V][B]=T);!o&&B>=0&&B<b&&(F<A?(v[F][B]="\u250C",v[A][B]="\u2518"):(v[F][B]="\u2510",v[A][B]="\u2514"));}for(let W=B-1;W>H;W--)W>=0&&W<b&&(v[A][W]=S);if(D.markerAt==="from"){let W=je(D.type,o,"up"),z=X-1;if(z>=0&&z<b)for(let V=0;V<W.length;V++){let _=F-Math.floor(W.length/2)+V;_>=0&&_<y&&(v[_][z]=W[V]);}}if(D.markerAt==="to"){let z=D.type==="inheritance"||D.type==="realization"?"down":"up",V=je(D.type,o,z),_=H+1;if(_<b)for(let G=0;G<V.length;G++){let P=A-Math.floor(V.length/2)+G;P>=0&&P<y&&(v[P][_]=V[G]);}}}else {let X=Math.max(q,k.y+k.height-1)+2;He(v,y,X+1);for(let W=q+1;W<=X;W++)v[F][W]=S;let H=Math.min(F,A),B=Math.max(F,A);for(let W=H;W<=B;W++)v[W][X]=T;for(let W=X-1;W>=k.y+k.height;W--)v[A][W]=S;if(D.markerAt==="from"){let W=je(D.type,o,"down"),z=q+1;if(z<b)for(let V=0;V<W.length;V++){let _=F-Math.floor(W.length/2)+V;_>=0&&_<y&&(v[_][z]=W[V]);}}if(D.markerAt==="to"){let W=je(D.type,o,"up"),z=k.y+k.height;if(z<b)for(let V=0;V<W.length;V++){let _=A-Math.floor(W.length/2)+V;_>=0&&_<y&&(v[_][z]=W[V]);}}}if(N.label){let X=` ${N.label} `,H=Math.floor((F+A)/2),B;if(q<Y)B=Math.floor((q+1+Y-1)/2);else if(k.y+k.height-1<$.y){let _=k.y+k.height-1;B=Math.floor((_+1+$.y-1)/2);}else B=Math.max(q,k.y+k.height-1)+2;let z=H-Math.floor(ae(X)/2),V=X;if(z<0&&(V=qt(V,-z),z=0),B>=0&&B<b){let _=Math.max(0,y-z);fe(v,{x:z,y:B},Ge(V,_));}}}return Le(v)}function ht(e){let t={entities:[],relationships:[]},r=new Map,n=null;for(let o=1;o<e.length;o++){let i=e[o];if(n){if(i==="}"){n=null;continue}let l=no(i);l&&n.attributes.push(l);continue}let c=i.match(/^(\S+)\s*\{$/);if(c){let l=c[1];n=St(r,l);continue}let s=ro(i);if(s){St(r,s.entity1),St(r,s.entity2),t.relationships.push(s);continue}}return t.entities=[...r.values()],t}function St(e,t){let r=e.get(t);return r||(r={id:t,label:t,attributes:[]},e.set(t,r)),r}function no(e){let t=e.match(/^(\S+)\s+(\S+)(?:\s+(.+))?$/);if(!t)return null;let r=t[1],n=t[2],o=t[3]?.trim()??"",i=[],c,s=o.match(/"([^"]*)"/);s&&(c=s[1]);let l=o.replace(/"[^"]*"/,"").trim();for(let h of l.split(/\s+/)){let f=h.toUpperCase();(f==="PK"||f==="FK"||f==="UK")&&i.push(f);}return {type:r,name:n,keys:i,comment:c}}function ro(e){let t=e.match(/^(\S+)\s+([|o}{]+(?:--|\.\.)[|o}{]+)\s+(\S+)\s*:\s*(.+)$/);if(!t)return null;let r=t[1],n=t[2],o=t[3],i=t[4].trim(),c=n.match(/^([|o}{]+)(--|\.\.?)([|o}{]+)$/);if(!c)return null;let s=c[1],l=c[2],h=c[3],f=mn(s),u=mn(h),a=l==="--";return !f||!u?null:{entity1:r,entity2:o,cardinality1:f,cardinality2:u,label:i,identifying:a}}function mn(e){let t=e.split("").sort().join("");return t==="||"?"one":t==="o|"?"zero-one":t==="|}"||t==="{|"?"many":t==="{o"||t==="o{"?"zero-many":null}function oo(e){return `${e.keys.length>0?e.keys.join(",")+" ":"   "}${e.type} ${e.name}`}function io(e){let t=[e.label],r=e.attributes.map(oo);return r.length===0?[t]:[t,r]}function ft(e,t){if(t)switch(e){case "one":return "||";case "zero-one":return "o|";case "many":return "}|";case "zero-many":return "o{"}else switch(e){case "one":return "\u2551";case "zero-one":return "o\u2551";case "many":return "\u255F";case "zero-many":return "o\u255F"}}function gn(e,t){let r=e.split(`
`).map(b=>b.trim()).filter(b=>b.length>0&&!b.startsWith("%%")),n=ht(r);if(n.entities.length===0)return "";let o=t.useAscii,i=6,c=4,s=new Map,l=new Map,h=new Map;for(let b of n.entities){let v=io(b);s.set(b.id,v);let M=0;for(let N of v)for(let $ of N)M=Math.max(M,ae($));let R=M+4,O=0;for(let N of v)O+=Math.max(N.length,1);let I=O+(v.length-1)+2;l.set(b.id,R),h.set(b.id,I);}let f=Math.max(2,Math.ceil(Math.sqrt(n.entities.length))),u=new Map,a=0,d=0,p=0,x=0;for(let b of n.entities){let v=l.get(b.id),M=h.get(b.id);x>=f&&(d+=p+c,a=0,p=0,x=0),u.set(b.id,{entity:b,sections:s.get(b.id),x:a,y:d,width:v,height:M}),a+=v+i,p=Math.max(p,M),x++;}let g=0,m=0;for(let b of u.values())g=Math.max(g,b.x+b.width),m=Math.max(m,b.y+b.height);g+=4,m+=2;let w=he(g-1,m-1);for(let b of u.values()){let v=ct(b.sections,o);for(let M=0;M<v.length;M++)for(let R=0;R<v[0].length;R++){let O=v[M][R];if(O!==" "){let I=b.x+M,N=b.y+R;I<g&&N<m&&(w[I][N]=O);}}}let C=o?"-":"\u2500",E=o?"|":"\u2502",L=o?".":"\u254C",y=o?":":"\u250A";for(let b of n.relationships){let v=u.get(b.entity1),M=u.get(b.entity2);if(!v||!M)continue;let R=b.identifying?C:L,O=b.identifying?E:y,I=v.x+Math.floor(v.width/2),N=v.y+Math.floor(v.height/2),$=M.x+Math.floor(M.width/2),k=M.y+Math.floor(M.height/2);if(Math.abs(N-k)<Math.max(v.height,M.height)){let[T,S]=I<$?[v,M]:[M,v],[F,q]=I<$?[b.cardinality1,b.cardinality2]:[b.cardinality2,b.cardinality1],A=T.x+T.width,Y=S.x-1,X=T.y+Math.floor(T.height/2);for(let W=A;W<=Y;W++)W<g&&(w[W][X]=R);let H=ft(F,o);for(let W=0;W<H.length;W++){let z=A+W;z<g&&(w[z][X]=H[W]);}let B=ft(q,o);for(let W=0;W<B.length;W++){let z=Y-B.length+1+W;z>=0&&z<g&&(w[z][X]=B[W]);}if(b.label){let W=Math.floor((A+Y)/2),z=Math.max(A,W-Math.floor(ae(b.label)/2)),V=X-1;if(V>=0){let _=Math.max(0,Y-z+1),G=Ge(b.label,_);fe(w,{x:z,y:V},G);}}}else {let[T,S]=N<k?[v,M]:[M,v],[F,q]=N<k?[b.cardinality1,b.cardinality2]:[b.cardinality2,b.cardinality1],A=T.y+T.height,Y=S.y-1,X=T.x+Math.floor(T.width/2);for(let V=A;V<=Y;V++)V<m&&(w[X][V]=O);let H=S.x+Math.floor(S.width/2);if(X!==H){let V=Math.floor((A+Y)/2),_=Math.min(X,H),G=Math.max(X,H);for(let P=_;P<=G;P++)P<g&&V<m&&(w[P][V]=R);for(let P=V+1;P<=Y;P++)P<m&&(w[H][P]=O);}let B=ft(F,o);if(A<m)for(let V=0;V<B.length;V++){let _=X-Math.floor(B.length/2)+V;_>=0&&_<g&&(w[_][A]=B[V]);}let W=X!==H?H:X,z=ft(q,o);if(Y>=0&&Y<m)for(let V=0;V<z.length;V++){let _=W-Math.floor(z.length/2)+V;_>=0&&_<g&&(w[_][Y]=z[V]);}if(b.label){let V=Math.floor((A+Y)/2),_=X+2;V>=0&&fe(w,{x:_,y:V},b.label);}}}return Le(w)}function so(e){let t=e.trim().split(/[\n;]/)[0]?.trim().toLowerCase()??"";return /^sequencediagram\s*$/.test(t)?"sequence":/^classdiagram\s*$/.test(t)?"class":/^erdiagram\s*$/.test(t)?"er":"flowchart"}function _t(e,t={}){let r={useAscii:t.useAscii??false,paddingX:t.paddingX??5,paddingY:t.paddingY??5,boxBorderPadding:t.boxBorderPadding??1,graphDirection:"TD"};switch(so(e)){case "sequence":return hn(e,r);case "class":return pn(e,r);case "er":return gn(e,r);default:{let o=Je(e);o.direction==="LR"||o.direction==="RL"?r.graphDirection="LR":r.graphDirection="TD";let i=Zt(o,r);return dn(i),an(i),o.direction==="BT"&&Kt(i.canvas),Le(i.canvas)}}}var ot=bt(ut());function ce(e,t,r){let n=r>=600?.58:r>=500?.55:.52;return e.length*t*n}function pt(e,t){return e.length*t*.6}var K={nodeLabel:13,edgeLabel:11,groupHeader:12},Z={nodeLabel:500,edgeLabel:400,groupHeader:600},yn=8,ze={horizontal:16,vertical:10,diamondExtra:24},oe={outerBox:1,innerBox:.75,connector:.75},de="0.35em",Ve={width:8,height:4.8};function ke(e,t,r,n){return {x:e-r/2,y:t-n/2}}function nt(e,t,r,n,o){let i=e.x-t,c=e.y-r;if(Math.abs(i)<.5&&Math.abs(c)<.5)return e;let s=1/(Math.abs(i)/n+Math.abs(c)/o);return {x:t+s*i,y:r+s*c}}function rt(e,t,r,n){let o=e.x-t,i=e.y-r,c=Math.sqrt(o*o+i*i);if(c<.5)return e;let s=n/c;return {x:t+s*o,y:r+s*i}}function De(e,t=true){if(e.length<2)return e;let r=[e[0]];for(let n=1;n<e.length;n++){let o=r[r.length-1],i=e[n],c=Math.abs(i.x-o.x),s=Math.abs(i.y-o.y);if(c<1||s<1){r.push(i);continue}t?r.push({x:o.x,y:i.y}):r.push({x:i.x,y:o.y}),r.push(i);}return co(r)}function co(e){if(e.length<3)return e;let t=[e[0]];for(let r=1;r<e.length-1;r++){let n=t[t.length-1],o=e[r],i=e[r+1],c=Math.abs(n.x-o.x)<1&&Math.abs(o.x-i.x)<1,s=Math.abs(n.y-o.y)<1&&Math.abs(o.y-i.y)<1;c||s||t.push(o);}return t.push(e[e.length-1]),t}function Pe(e,t,r){if(e.length<2)return e;let n=e.map(o=>({...o}));if(r){let o=n.length-1;if(e.length===2){let i=n[0],c=n[o],s=Math.abs(c.x-i.x);if(Math.abs(c.y-i.y)>=s){let f=c.y>i.y?r.cy-r.hh:r.cy+r.hh;n[o]={x:c.x,y:f};}else {let f=c.x>i.x?r.cx-r.hw:r.cx+r.hw;n[o]={x:f,y:c.y};}}else {let i=n[o-1],c=n[o],s=Math.abs(c.x-i.x),l=Math.abs(c.y-i.y),h=l<1&&s>=1,f=s<1&&l>=1,u=!h&&!f&&l<s,a=!h&&!f&&s<l;if(h){let p=c.x>i.x?r.cx-r.hw:r.cx+r.hw;n[o]={x:p,y:r.cy},n[o-1]={...i,y:r.cy};}else if(f){let p=c.y>i.y?r.cy-r.hh:r.cy+r.hh;n[o]={x:r.cx,y:p},n[o-1]={...i,x:r.cx};}else if(u){let p=c.x>i.x?r.cx-r.hw:r.cx+r.hw;i.y>=r.cy-r.hh&&i.y<=r.cy+r.hh?n[o]={x:p,y:i.y}:(n[o]={x:p,y:r.cy},n[o-1]={...i,y:r.cy});}else if(a){let p=c.y>i.y?r.cy-r.hh:r.cy+r.hh;i.x>=r.cx-r.hw&&i.x<=r.cx+r.hw?n[o]={x:i.x,y:p}:(n[o]={x:r.cx,y:p},n[o-1]={...i,x:r.cx});}}}if(t&&e.length>=3){let o=n[0],i=n[1],c=Math.abs(i.x-o.x),s=Math.abs(i.y-o.y),l=s<1&&c>=1,h=c<1&&s>=1,f=!l&&!h&&s<c,u=!l&&!h&&c<s;if(l){let d=i.x>o.x?t.cx+t.hw:t.cx-t.hw;n[0]={x:d,y:t.cy},n[1]={...n[1],y:t.cy};}else if(h){let d=i.y>o.y?t.cy+t.hh:t.cy-t.hh;n[0]={x:t.cx,y:d},n[1]={...n[1],x:t.cx};}else if(f){let d=i.x>o.x?t.cx+t.hw:t.cx-t.hw;i.y>=t.cy-t.hh&&i.y<=t.cy+t.hh?n[0]={x:d,y:i.y}:(n[0]={x:d,y:t.cy},n[1]={...n[1],y:t.cy});}else if(u){let d=i.y>o.y?t.cy+t.hh:t.cy-t.hh;i.x>=t.cx-t.hw&&i.x<=t.cx+t.hw?n[0]={x:i.x,y:d}:(n[0]={x:t.cx,y:d},n[1]={...n[1],x:t.cx});}}return n}function bn(e){let t=Array.from(e.nodes.keys());if(t.length===0)return [];let r=new Map,n=new Map;for(let f of t)r.set(f,f),n.set(f,0);function o(f){return r.get(f)!==f&&r.set(f,o(r.get(f))),r.get(f)}function i(f,u){let a=o(f),d=o(u);if(a===d)return;let p=n.get(a),x=n.get(d);p<x?r.set(a,d):p>x?r.set(d,a):(r.set(d,a),n.set(a,p+1));}for(let f of e.edges)r.has(f.source)&&r.has(f.target)&&i(f.source,f.target);function c(f){let u=[...f.nodeIds];for(let a of f.children)s(a,u);if(r.has(f.id)&&u.length>0)for(let a of u)r.has(a)&&i(f.id,a);if(u.length>1){let a=u[0];for(let d=1;d<u.length;d++)r.has(a)&&r.has(u[d])&&i(a,u[d]);}for(let a of f.children)c(a);}function s(f,u){u.push(...f.nodeIds);for(let a of f.children)s(a,u);}for(let f of e.subgraphs)c(f);let l=new Map;for(let f of t){let u=o(f);l.has(u)||l.set(u,new Set),l.get(u).add(f);}let h=[];for(let[f,u]of l){let a={nodeIds:u,subgraphIds:new Set,edgeIndices:new Set};for(let d=0;d<e.edges.length;d++){let p=e.edges[d];u.has(p.source)&&u.has(p.target)&&a.edgeIndices.add(d);}h.push(a);}return wn(e.subgraphs,h),h.sort((f,u)=>{let a=Math.min(...Array.from(f.nodeIds).map(p=>p.charCodeAt(0))),d=Math.min(...Array.from(u.nodeIds).map(p=>p.charCodeAt(0)));return a-d}),h}function wn(e,t){for(let r of e){let n=vn(r);if(n.size>0){let o=n.values().next().value;for(let i of t)if(i.nodeIds.has(o)){i.subgraphIds.add(r.id),Cn(r,i.subgraphIds);break}}wn(r.children,t);}}function vn(e){let t=new Set(e.nodeIds);for(let r of e.children)for(let n of vn(r))t.add(n);return t}function Cn(e,t){for(let r of e.children)t.add(r.id),Cn(r,t);}function $n(e,t,r){if(e.length===0)return {width:0,height:0,nodes:[],edges:[],groups:[]};if(e.length===1)return e[0];let n=t==="TD"||t==="TB"||t==="BT",o={width:0,height:0,nodes:[],edges:[],groups:[]},i=0;for(let c=0;c<e.length;c++){let s=e[c];if(n){for(let l of s.nodes)o.nodes.push({...l,x:l.x+i});for(let l of s.edges)o.edges.push({...l,points:l.points.map(h=>({x:h.x+i,y:h.y})),labelPosition:l.labelPosition?{x:l.labelPosition.x+i,y:l.labelPosition.y}:void 0});for(let l of s.groups)o.groups.push(En(l,i));o.width=i+s.width,o.height=Math.max(o.height,s.height),i+=s.width+r;}else {for(let l of s.nodes)o.nodes.push({...l,y:l.y+i});for(let l of s.edges)o.edges.push({...l,points:l.points.map(h=>({x:h.x,y:h.y+i})),labelPosition:l.labelPosition?{x:l.labelPosition.x,y:l.labelPosition.y+i}:void 0});for(let l of s.groups)o.groups.push(kn(l,i));o.width=Math.max(o.width,s.width),o.height=i+s.height,i+=s.height+r;}}return o}function En(e,t){return {...e,x:e.x+t,children:e.children.map(r=>En(r,t))}}function kn(e,t){return {...e,y:e.y+t,children:e.children.map(r=>kn(r,t))}}var mt=new Set(["circle","doublecircle","state-start","state-end"]),gt=new Set(["diamond","circle","doublecircle","state-start","state-end"]),lo={font:"Inter",padding:40,nodeSpacing:24,layerSpacing:40};function ho(e,t,r){let n=new ot.default.graphlib.Graph({directed:true,compound:true});n.setGraph({rankdir:An(e.direction),acyclicer:"greedy",nodesep:r.nodeSpacing,ranksep:r.layerSpacing,marginx:16,marginy:12}),n.setDefaultEdgeLabel(()=>({}));let o=new Set;o.add(e.id),Tt(e,o);for(let a of e.nodeIds){let d=t.nodes.get(a);if(d){let p=At(a,d.label,d.shape);n.setNode(a,{label:d.label,width:p.width,height:p.height});}}for(let a of e.children)Dt(n,a,t);let i=new Set;for(let a=0;a<t.edges.length;a++){let d=t.edges[a];if(o.has(d.source)&&o.has(d.target)){i.add(a);let p={_index:a};d.label&&(p.label=d.label,p.width=ce(d.label,K.edgeLabel,Z.edgeLabel)+8,p.height=K.edgeLabel+6,p.labelpos="c"),n.setEdge(d.source,d.target,p);}}ot.default.layout(n);let c=e.direction==="TD"||e.direction==="TB"||e.direction==="BT",s=new Set;for(let a of e.children)Gt(a,s);let l=[];for(let a of n.nodes()){if(s.has(a))continue;let d=t.nodes.get(a);if(!d)continue;let p=n.node(a);if(!p)continue;let x=ke(p.x,p.y,p.width,p.height);l.push({id:a,label:d.label,shape:d.shape,x:x.x,y:x.y,width:p.width,height:p.height,inlineStyle:Tn(t,a)});}let h=n.edges().map(a=>{let d=n.edge(a),p=t.edges[d._index],x=d.points??[];if(x.length>0){let b=t.nodes.get(a.v)?.shape;if(b==="diamond"){let M=n.node(a.v);x[0]=nt(x[0],M.x,M.y,M.width/2,M.height/2);}else if(b&&mt.has(b)){let M=n.node(a.v);x[0]=rt(x[0],M.x,M.y,Math.min(M.width,M.height)/2);}let v=t.nodes.get(a.w)?.shape;if(v==="diamond"){let M=n.node(a.w),R=x.length-1;x[R]=nt(x[R],M.x,M.y,M.width/2,M.height/2);}else if(v&&mt.has(v)){let M=n.node(a.w),R=x.length-1;x[R]=rt(x[R],M.x,M.y,Math.min(M.width,M.height)/2);}}let g=De(x,c),m=t.nodes.get(a.v)?.shape,w=t.nodes.get(a.w)?.shape,C=m&&!gt.has(m)||!m?(()=>{let b=n.node(a.v);return b?{cx:b.x,cy:b.y,hw:b.width/2,hh:b.height/2}:null})():null,E=w&&!gt.has(w)||!w?(()=>{let b=n.node(a.w);return b?{cx:b.x,cy:b.y,hw:b.width/2,hh:b.height/2}:null})():null,L=Pe(g,C,E),y;return p.label&&d.x!=null&&d.y!=null&&(y={x:d.x,y:d.y}),{source:p.source,target:p.target,label:p.label,style:p.style,hasArrowStart:p.hasArrowStart,hasArrowEnd:p.hasArrowEnd,points:L,labelPosition:y}}),f=e.children.map(a=>It(n,a)),u=n.graph();return {id:e.id,label:e.label,width:u.width??200,height:u.height??100,nodes:l,edges:h,groups:f,nodeIds:o,internalEdgeIndices:i}}async function Sn(e,t={}){let r={...lo,...t},n=bn(e);if(n.length>1){let o=[];for(let s of n){let l=fo(e,s),h=await Mn(l,r);o.push(h);}let c=(r.componentSpacing??r.nodeSpacing)-2*r.padding;return $n(o,e.direction,c)}return Mn(e,r)}function fo(e,t){let r=new Set,n=Ln(e.subgraphs,t.subgraphIds);for(let c of n)_n(c,r);let o=new Map(Array.from(e.nodes.entries()).filter(([c])=>t.nodeIds.has(c)&&!r.has(c))),i=e.edges.filter((c,s)=>t.edgeIndices.has(s));return {direction:e.direction,nodes:o,edges:i,subgraphs:n,classDefs:e.classDefs,classAssignments:e.classAssignments,nodeStyles:e.nodeStyles}}function _n(e,t){t.add(e.id);for(let r of e.children)_n(r,t);}function Ln(e,t){return e.filter(r=>t.has(r.id)).map(r=>({...r,children:Ln(r.children,t)}))}async function Mn(e,t){let r=new Map;for(let h of e.subgraphs)h.direction&&h.direction!==e.direction&&r.set(h.id,ho(h,e,t));let n=new ot.default.graphlib.Graph({directed:true,compound:true});n.setGraph({rankdir:An(e.direction),acyclicer:"greedy",nodesep:t.nodeSpacing,ranksep:t.layerSpacing,marginx:t.padding,marginy:t.padding}),n.setDefaultEdgeLabel(()=>({}));let o=new Set;for(let h of e.subgraphs)o.add(h.id),Tt(h,o);for(let[h,f]of e.nodes)if(!o.has(h)){let u=At(h,f.label,f.shape);n.setNode(h,{label:f.label,width:u.width,height:u.height});}for(let h of e.subgraphs)if(r.has(h.id)){let f=r.get(h.id);n.setNode(h.id,{width:f.width,height:f.height});}else Dt(n,h,e);let i=new Map,c=new Map;for(let h of e.subgraphs)r.has(h.id)||Dn(h,i,c);for(let[h,f]of r)for(let u of f.nodeIds)i.set(u,h),c.set(u,h);let s=new Set;for(let h of r.values())for(let f of h.internalEdgeIndices)s.add(f);let l=new Set;for(let h=0;h<e.edges.length;h++){if(s.has(h))continue;let f=e.edges[h],u=c.get(f.source)??f.source,a=i.get(f.target)??f.target,d={_index:h};f.label&&(d.label=f.label,d.width=ce(f.label,K.edgeLabel,Z.edgeLabel)+8,d.height=K.edgeLabel+6,d.labelpos="c"),l.has(a)||(d.weight=2,l.add(a)),n.setEdge(u,a,d);}try{ot.default.layout(n);}catch(h){let f=h instanceof Error?h.message:String(h);throw new Error(`Dagre layout failed: ${f}`)}return uo(n,e,t.padding,r)}function An(e){switch(e){case "LR":return "LR";case "RL":return "RL";case "BT":return "BT";default:return "TB"}}function At(e,t,r){let o=ce(t,K.nodeLabel,Z.nodeLabel)+ze.horizontal*2,i=K.nodeLabel+ze.vertical*2;if(r==="diamond"){let c=Math.max(o,i)+ze.diamondExtra;o=c,i=c;}if(r==="circle"||r==="doublecircle"){let c=Math.ceil(Math.sqrt(o*o+i*i))+8;o=r==="doublecircle"?c+12:c,i=o;}return r==="hexagon"&&(o+=ze.horizontal),(r==="trapezoid"||r==="trapezoid-alt")&&(o+=ze.horizontal),r==="asymmetric"&&(o+=12),r==="cylinder"&&(i+=14),(r==="state-start"||r==="state-end")&&(o=28,i=28),o=Math.max(o,60),i=Math.max(i,36),{width:o,height:i}}function Dt(e,t,r,n){e.setNode(t.id,{label:t.label}),n&&e.setParent(t.id,n);for(let o of t.nodeIds){let i=r.nodes.get(o);if(i){let c=At(o,i.label,i.shape);e.setNode(o,{label:i.label,width:c.width,height:c.height}),e.setParent(o,t.id);}}for(let o of t.children)Dt(e,o,r,t.id);}function Dn(e,t,r){for(let c of e.children)Dn(c,t,r);let n=[...e.nodeIds,...e.children.map(c=>c.id)];if(n.length===0){t.set(e.id,e.id),r.set(e.id,e.id);return}let o=n[0],i=n[n.length-1];t.set(e.id,t.get(o)??o),r.set(e.id,r.get(i)??i);}function Tn(e,t){let r=e.classAssignments.get(t),n=r?e.classDefs.get(r):void 0,o=e.nodeStyles.get(t);if(!(!n&&!o))return {...n,...o}}function Tt(e,t){for(let r of e.nodeIds)t.add(r);for(let r of e.children)Tt(r,t);}function uo(e,t,r,n){let o=[],i=[],c=new Set;for(let m of t.subgraphs)Gt(m,c);let s=new Set;if(n)for(let m of n.values())for(let w of m.nodeIds)s.add(w);for(let m of e.nodes()){if(c.has(m))continue;let w=t.nodes.get(m);if(!w)continue;let C=e.node(m);if(!C)continue;let E=ke(C.x,C.y,C.width,C.height);o.push({id:m,label:w.label,shape:w.shape,x:E.x,y:E.y,width:C.width,height:C.height,inlineStyle:Tn(t,m)});}for(let m of t.subgraphs)i.push(It(e,m));let l=t.direction==="TD"||t.direction==="TB"||t.direction==="BT",h=e.edges().map(m=>{let w=e.edge(m),C=t.edges[w._index],E=w.points??[];if(E.length>0){let I=t.nodes.get(m.v)?.shape;if(I==="diamond"){let $=e.node(m.v);E[0]=nt(E[0],$.x,$.y,$.width/2,$.height/2);}else if(I&&mt.has(I)){let $=e.node(m.v);E[0]=rt(E[0],$.x,$.y,Math.min($.width,$.height)/2);}let N=t.nodes.get(m.w)?.shape;if(N==="diamond"){let $=e.node(m.w),k=E.length-1;E[k]=nt(E[k],$.x,$.y,$.width/2,$.height/2);}else if(N&&mt.has(N)){let $=e.node(m.w),k=E.length-1;E[k]=rt(E[k],$.x,$.y,Math.min($.width,$.height)/2);}}let L=De(E,l),y=t.nodes.get(m.v)?.shape,b=t.nodes.get(m.w)?.shape,v=y&&!gt.has(y)||!y?(()=>{let I=e.node(m.v);return I?{cx:I.x,cy:I.y,hw:I.width/2,hh:I.height/2}:null})():null,M=b&&!gt.has(b)||!b?(()=>{let I=e.node(m.w);return I?{cx:I.x,cy:I.y,hw:I.width/2,hh:I.height/2}:null})():null,R=Pe(L,v,M),O;return C.label&&w.x!=null&&w.y!=null&&(O={x:w.x,y:w.y}),{source:C.source,target:C.target,label:C.label,style:C.style,hasArrowStart:C.hasArrowStart,hasArrowEnd:C.hasArrowEnd,points:R,labelPosition:O}});if(n&&n.size>0){let m=new Map;for(let w of o)m.set(w.id,{cx:w.x+w.width/2,cy:w.y+w.height/2});for(let[w,C]of n){let E=e.node(w);if(!E)continue;let L=ke(E.x,E.y,E.width,E.height);for(let b of C.nodes){let v={...b,x:b.x+L.x,y:b.y+L.y};o.push(v),m.set(v.id,{cx:v.x+v.width/2,cy:v.y+v.height/2});}for(let b of C.edges)h.push({...b,points:b.points.map(v=>({x:v.x+L.x,y:v.y+L.y})),labelPosition:b.labelPosition?{x:b.labelPosition.x+L.x,y:b.labelPosition.y+L.y}:void 0});let y=Nn(i,w);y&&C.groups.length>0&&(y.children=C.groups.map(b=>Pn(b,L.x,L.y)));}for(let w of h){if(s.has(w.source)&&s.has(w.target))continue;let C=false;if(s.has(w.source)){let E=m.get(w.source);E&&w.points.length>0&&(w.points[0]={x:E.cx,y:E.cy},C=true);}if(s.has(w.target)){let E=m.get(w.target);E&&w.points.length>0&&(w.points[w.points.length-1]={x:E.cx,y:E.cy},C=true);}C&&(w.points=De(w.points,l));}}let f=K.groupHeader+16;po(i,f);let u=Gn(i),a=[...o.map(m=>m.y),...u.map(m=>m.y)],d=a.length>0?Math.min(...a):r,p=e.graph().width??800,x=e.graph().height??600;if(d<r){let m=r-d;for(let w of o)w.y+=m;for(let w of h){for(let C of w.points)C.y+=m;w.labelPosition&&(w.labelPosition.y+=m);}for(let w of u)w.y+=m;x+=m;}let g=Math.max(...o.map(m=>m.y+m.height),...u.map(m=>m.y+m.height),...h.flatMap(m=>m.points.map(w=>w.y)));return g+r>x&&(x=g+r),{width:p,height:x,nodes:o,edges:h,groups:i}}function It(e,t){let r=e.node(t.id),n=r?ke(r.x,r.y,r.width,r.height):{x:0,y:0};return {id:t.id,label:t.label,x:n.x,y:n.y,width:r?.width??0,height:r?.height??0,children:t.children.map(o=>It(e,o))}}function po(e,t){for(let r of e)In(r,t);}function In(e,t){for(let r of e.children)In(r,t);if(e.children.length>0){let r=e.y,n=e.y+e.height;for(let o of e.children)r=Math.min(r,o.y),n=Math.max(n,o.y+o.height);e.height=n-r,e.y=r;}if(e.label){let r=t+yn;e.y-=r,e.height+=r;}}function Gn(e){let t=[];for(let r of e)t.push(r),t.push(...Gn(r.children));return t}function Nn(e,t){for(let r of e){if(r.id===t)return r;let n=Nn(r.children,t);if(n)return n}}function Pn(e,t,r){return {...e,x:e.x+t,y:e.y+r,children:e.children.map(n=>Pn(n,t,r))}}function Gt(e,t){t.add(e.id);for(let r of e.children)Gt(r,t);}function On(e,t,r="Inter",n=false){let o=[];o.push(_e(e.width,e.height,t,n)),o.push(Se(r,false)),o.push("<defs>"),o.push(mo()),o.push("</defs>");for(let i of e.groups)o.push(Wn(i));for(let i of e.edges)o.push(go(i));for(let i of e.edges)i.label&&o.push(yo(i));for(let i of e.nodes)o.push(wo(i));for(let i of e.nodes)o.push(No(i));return o.push("</svg>"),o.join(`
`)}function mo(){let e=Ve.width,t=Ve.height;return `  <marker id="arrowhead" markerWidth="${e}" markerHeight="${t}" refX="${e}" refY="${t/2}" orient="auto">
    <polygon points="0 0, ${e} ${t/2}, 0 ${t}" fill="var(--_arrow)" />
  </marker>
  <marker id="arrowhead-start" markerWidth="${e}" markerHeight="${t}" refX="0" refY="${t/2}" orient="auto-start-reverse">
    <polygon points="${e} 0, 0 ${t/2}, ${e} ${t}" fill="var(--_arrow)" />
  </marker>`}function Wn(e,t){let r=K.groupHeader+16,n=[];n.push(`<rect x="${e.x}" y="${e.y}" width="${e.width}" height="${e.height}" rx="0" ry="0" fill="var(--_group-fill)" stroke="var(--_node-stroke)" stroke-width="${oe.outerBox}" />`),n.push(`<rect x="${e.x}" y="${e.y}" width="${e.width}" height="${r}" rx="0" ry="0" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="${oe.outerBox}" />`),n.push(`<text x="${e.x+12}" y="${e.y+r/2}" dy="${de}" font-size="${K.groupHeader}" font-weight="${Z.groupHeader}" fill="var(--_text-sec)">${Re(e.label)}</text>`);for(let o of e.children)n.push(Wn(o));return n.join(`
`)}function go(e){if(e.points.length<2)return "";let t=xo(e.points),r=e.style==="dotted"?' stroke-dasharray="4 4"':"",n=e.style==="thick"?oe.connector*2:oe.connector,o="";return e.hasArrowEnd&&(o+=' marker-end="url(#arrowhead)"'),e.hasArrowStart&&(o+=' marker-start="url(#arrowhead-start)"'),`<polyline points="${t}" fill="none" stroke="var(--_line)" stroke-width="${n}"${r}${o} />`}function xo(e){return e.map(t=>`${t.x},${t.y}`).join(" ")}function yo(e,t){let r=e.labelPosition??bo(e.points),n=e.label,o=ce(n,K.edgeLabel,Z.edgeLabel),i=8,c=o+i*2,s=K.edgeLabel+i*2;return `<rect x="${r.x-c/2}" y="${r.y-s/2}" width="${c}" height="${s}" rx="4" ry="4" fill="var(--bg)" stroke="var(--_inner-stroke)" stroke-width="0.5" />
<text x="${r.x}" y="${r.y}" text-anchor="middle" dy="${de}" font-size="${K.edgeLabel}" font-weight="${Z.edgeLabel}" fill="var(--_text-muted)">${Re(n)}</text>`}function bo(e){if(e.length===0)return {x:0,y:0};if(e.length===1)return e[0];let t=0;for(let n=1;n<e.length;n++)t+=Rn(e[n-1],e[n]);let r=t/2;for(let n=1;n<e.length;n++){let o=Rn(e[n-1],e[n]);if(r<=o){let i=r/o;return {x:e[n-1].x+i*(e[n].x-e[n-1].x),y:e[n-1].y+i*(e[n].y-e[n-1].y)}}r-=o;}return e[e.length-1]}function Rn(e,t){return Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2)}function wo(e){let{x:t,y:r,width:n,height:o,shape:i,inlineStyle:c}=e,s=Re(c?.fill??"var(--_node-fill)"),l=Re(c?.stroke??"var(--_node-stroke)"),h=Re(c?.["stroke-width"]??String(oe.innerBox));switch(i){case "diamond":return ko(t,r,n,o,s,l,h);case "rounded":return Co(t,r,n,o,s,l,h);case "stadium":return $o(t,r,n,o,s,l,h);case "circle":return Eo(t,r,n,o,s,l,h);case "subroutine":return Mo(t,r,n,o,s,l,h);case "doublecircle":return So(t,r,n,o,s,l,h);case "hexagon":return _o(t,r,n,o,s,l,h);case "cylinder":return Lo(t,r,n,o,s,l,h);case "asymmetric":return Ao(t,r,n,o,s,l,h);case "trapezoid":return Do(t,r,n,o,s,l,h);case "trapezoid-alt":return To(t,r,n,o,s,l,h);case "state-start":return Io(t,r,n,o);case "state-end":return Go(t,r,n,o);default:return vo(t,r,n,o,s,l,h)}}function vo(e,t,r,n,o,i,c){return `<rect x="${e}" y="${t}" width="${r}" height="${n}" rx="0" ry="0" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function Co(e,t,r,n,o,i,c){return `<rect x="${e}" y="${t}" width="${r}" height="${n}" rx="6" ry="6" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function $o(e,t,r,n,o,i,c){let s=n/2;return `<rect x="${e}" y="${t}" width="${r}" height="${n}" rx="${s}" ry="${s}" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function Eo(e,t,r,n,o,i,c){let s=e+r/2,l=t+n/2,h=Math.min(r,n)/2;return `<circle cx="${s}" cy="${l}" r="${h}" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function ko(e,t,r,n,o,i,c){let s=e+r/2,l=t+n/2,h=r/2,f=n/2;return `<polygon points="${[`${s},${l-f}`,`${s+h},${l}`,`${s},${l+f}`,`${s-h},${l}`].join(" ")}" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function Mo(e,t,r,n,o,i,c){return `<rect x="${e}" y="${t}" width="${r}" height="${n}" rx="0" ry="0" fill="${o}" stroke="${i}" stroke-width="${c}" />
<line x1="${e+8}" y1="${t}" x2="${e+8}" y2="${t+n}" stroke="${i}" stroke-width="${c}" />
<line x1="${e+r-8}" y1="${t}" x2="${e+r-8}" y2="${t+n}" stroke="${i}" stroke-width="${c}" />`}function So(e,t,r,n,o,i,c){let s=e+r/2,l=t+n/2,h=Math.min(r,n)/2,f=h-5;return `<circle cx="${s}" cy="${l}" r="${h}" fill="${o}" stroke="${i}" stroke-width="${c}" />
<circle cx="${s}" cy="${l}" r="${f}" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function _o(e,t,r,n,o,i,c){let s=n/4;return `<polygon points="${[`${e+s},${t}`,`${e+r-s},${t}`,`${e+r},${t+n/2}`,`${e+r-s},${t+n}`,`${e+s},${t+n}`,`${e},${t+n/2}`].join(" ")}" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function Lo(e,t,r,n,o,i,c){let l=e+r/2,h=t+7,f=n-14;return `<rect x="${e}" y="${h}" width="${r}" height="${f}" fill="${o}" stroke="none" />
<line x1="${e}" y1="${h}" x2="${e}" y2="${h+f}" stroke="${i}" stroke-width="${c}" />
<line x1="${e+r}" y1="${h}" x2="${e+r}" y2="${h+f}" stroke="${i}" stroke-width="${c}" />
<ellipse cx="${l}" cy="${t+n-7}" rx="${r/2}" ry="7" fill="${o}" stroke="${i}" stroke-width="${c}" />
<ellipse cx="${l}" cy="${h}" rx="${r/2}" ry="7" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function Ao(e,t,r,n,o,i,c){return `<polygon points="${[`${e+12},${t}`,`${e+r},${t}`,`${e+r},${t+n}`,`${e+12},${t+n}`,`${e},${t+n/2}`].join(" ")}" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function Do(e,t,r,n,o,i,c){let s=r*.15;return `<polygon points="${[`${e+s},${t}`,`${e+r-s},${t}`,`${e+r},${t+n}`,`${e},${t+n}`].join(" ")}" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function To(e,t,r,n,o,i,c){let s=r*.15;return `<polygon points="${[`${e},${t}`,`${e+r},${t}`,`${e+r-s},${t+n}`,`${e+s},${t+n}`].join(" ")}" fill="${o}" stroke="${i}" stroke-width="${c}" />`}function Io(e,t,r,n){let o=e+r/2,i=t+n/2,c=Math.min(r,n)/2-2;return `<circle cx="${o}" cy="${i}" r="${c}" fill="var(--_text)" stroke="none" />`}function Go(e,t,r,n){let o=e+r/2,i=t+n/2,c=Math.min(r,n)/2-2,s=c-4;return `<circle cx="${o}" cy="${i}" r="${c}" fill="none" stroke="var(--_text)" stroke-width="${oe.innerBox*2}" />
<circle cx="${o}" cy="${i}" r="${s}" fill="var(--_text)" stroke="none" />`}function No(e,t){if((e.shape==="state-start"||e.shape==="state-end")&&!e.label)return "";let r=e.x+e.width/2,n=e.y+e.height/2,o=Re(e.inlineStyle?.color??"var(--_text)");return `<text x="${r}" y="${n}" text-anchor="middle" dy="${de}" font-size="${K.nodeLabel}" font-weight="${Z.nodeLabel}" fill="${o}">${Re(e.label)}</text>`}function Re(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}var te={padding:30,actorGap:140,actorHeight:40,actorPadX:16,headerGap:20,messageRowHeight:40,selfMessageHeight:30,activationWidth:10,blockPadX:10,blockPadTop:40,blockPadBottom:8,blockHeaderExtra:28,dividerExtra:24,noteWidth:120,notePadding:8,noteGap:10};function Fn(e,t={}){if(e.actors.length===0)return {width:0,height:0,actors:[],lifelines:[],messages:[],activations:[],blocks:[],notes:[]};let r=e.actors.map(y=>{let b=ce(y.label,K.nodeLabel,Z.nodeLabel);return Math.max(b+te.actorPadX*2,80)}),n=[],o=te.padding+r[0]/2;for(let y=0;y<e.actors.length;y++){if(y>0){let b=Math.max(te.actorGap,(r[y-1]+r[y])/2+40);o+=b;}n.push(o);}let i=new Map;for(let y=0;y<e.actors.length;y++)i.set(e.actors[y].id,y);let c=te.padding,s=e.actors.map((y,b)=>({id:y.id,label:y.label,type:y.type,x:n[b],y:c,width:r[b],height:te.actorHeight})),l=c+te.actorHeight+te.headerGap,h=[],f=new Map;for(let y of e.blocks){let b=f.get(y.startIndex)??0;f.set(y.startIndex,Math.max(b,te.blockHeaderExtra));for(let v of y.dividers){let M=f.get(v.index)??0;f.set(v.index,Math.max(M,te.dividerExtra));}}let u=new Map,a=[];for(let y=0;y<e.messages.length;y++){let b=e.messages[y],v=i.get(b.from)??0,M=i.get(b.to)??0,R=b.from===b.to,O=f.get(y)??0;O>0&&(l+=O);let I=n[v],N=n[M];if(h.push({from:b.from,to:b.to,label:b.label,lineStyle:b.lineStyle,arrowHead:b.arrowHead,x1:I,x2:N,y:l,isSelf:R}),b.activate&&(u.has(b.to)||u.set(b.to,[]),u.get(b.to).push(l)),b.deactivate){let $=u.get(b.from);if($&&$.length>0){let k=$.pop(),D=i.get(b.from)??0;a.push({actorId:b.from,x:n[D]-te.activationWidth/2,topY:k,bottomY:l,width:te.activationWidth});}}l+=R?te.selfMessageHeight+te.messageRowHeight:te.messageRowHeight;}for(let[y,b]of u)for(let v of b){let M=i.get(y)??0;a.push({actorId:y,x:n[M]-te.activationWidth/2,topY:v,bottomY:l-te.messageRowHeight/2,width:te.activationWidth});}let d=e.blocks.map(y=>{let b=h[y.startIndex],v=h[y.endIndex],M=(b?.y??l)-te.blockPadTop,R=(v?.y??l)+te.blockPadBottom+12,O=new Set;for(let T=y.startIndex;T<=y.endIndex;T++){let S=e.messages[T];S&&(O.add(i.get(S.from)??0),O.add(i.get(S.to)??0));}if(O.size===0)for(let T=0;T<e.actors.length;T++)O.add(T);let I=Math.min(...O),N=Math.max(...O),$=n[I]-r[I]/2-te.blockPadX,k=n[N]+r[N]/2+te.blockPadX,D=y.dividers.map(T=>{let S=h[T.index],F=S?.y??l,q=28;if(T.label&&S?.label){let A=`[${T.label}]`,Y=ce(A,K.edgeLabel,Z.edgeLabel),X=$+8,H=X+Y,B=ce(S.label,K.edgeLabel,Z.edgeLabel),W=S.isSelf?S.x1+36:(S.x1+S.x2)/2-B/2,z=W+B;H>W&&X<z&&(q=36);}return {y:F-q,label:T.label}});return {type:y.type,label:y.label,x:$,y:M,width:k-$,height:R-M,dividers:D}}),p=e.notes.map(y=>{let b=Math.max(te.noteWidth,ce(y.text,K.edgeLabel,Z.edgeLabel)+te.notePadding*2),v=K.edgeLabel+te.notePadding*2,R=(h[y.afterIndex]?.y??c+te.actorHeight)+4,O=i.get(y.actorIds[0]??"")??0,I;if(y.position==="left")I=n[O]-r[O]/2-b-te.noteGap;else if(y.position==="right")I=n[O]+r[O]/2+te.noteGap;else if(y.actorIds.length>1){let N=i.get(y.actorIds[y.actorIds.length-1]??"")??O;I=(n[O]+n[N])/2-b/2;}else I=n[O]-b/2;return {text:y.text,x:I,y:R,width:b,height:v}}),x=l+te.padding,g=te.padding,m=0;for(let y of s)g=Math.min(g,y.x-y.width/2),m=Math.max(m,y.x+y.width/2);for(let y of d)g=Math.min(g,y.x),m=Math.max(m,y.x+y.width);for(let y of p)g=Math.min(g,y.x),m=Math.max(m,y.x+y.width);let w=g<te.padding?te.padding-g:0;if(w>0){for(let y of s)y.x+=w;for(let y of h)y.x1+=w,y.x2+=w;for(let y of a)y.x+=w;for(let y of d)y.x+=w;for(let y of p)y.x+=w;for(let y=0;y<n.length;y++)n[y]+=w;}let C=e.actors.map((y,b)=>({actorId:y.id,x:n[b],topY:c+te.actorHeight,bottomY:x-te.padding})),E=m+w+te.padding,L=x;return {width:Math.max(E,200),height:Math.max(L,100),actors:s,lifelines:C,messages:h,activations:a,blocks:d,notes:p}}function Hn(e,t,r="Inter",n=false){let o=[];o.push(_e(e.width,e.height,t,n)),o.push(Se(r,false)),o.push("<defs>"),o.push(Po()),o.push("</defs>");for(let i of e.blocks)o.push(Ho(i));for(let i of e.lifelines)o.push(Oo(i));for(let i of e.activations)o.push(Wo(i));for(let i of e.messages)o.push(Fo(i));for(let i of e.notes)o.push(Bo(i));for(let i of e.actors)o.push(Ro(i));return o.push("</svg>"),o.join(`
`)}function Po(){let e=Ve.width,t=Ve.height;return `  <marker id="seq-arrow" markerWidth="${e}" markerHeight="${t}" refX="${e}" refY="${t/2}" orient="auto-start-reverse">
    <polygon points="0 0, ${e} ${t/2}, 0 ${t}" fill="var(--_arrow)" />
  </marker>
  <marker id="seq-arrow-open" markerWidth="${e}" markerHeight="${t}" refX="${e}" refY="${t/2}" orient="auto-start-reverse">
    <polyline points="0 0, ${e} ${t/2}, 0 ${t}" fill="none" stroke="var(--_arrow)" stroke-width="1" />
  </marker>`}function Ro(e){let{x:t,y:r,width:n,height:o,label:i,type:c}=e;if(c==="actor"){let l=o/24*.9,h=t-12*l,f=r+(o-24*l)/2,u=oe.outerBox/l,a="var(--_line)";return `<g transform="translate(${h},${f}) scale(${l})">
  <path d="M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" fill="none" stroke="${a}" stroke-width="${u}" />
  <path d="M15 10C15 11.6569 13.6569 13 12 13C10.3431 13 9 11.6569 9 10C9 8.34315 10.3431 7 12 7C13.6569 7 15 8.34315 15 10Z" fill="none" stroke="${a}" stroke-width="${u}" />
  <path d="M5.62842 18.3563C7.08963 17.0398 9.39997 16 12 16C14.6 16 16.9104 17.0398 18.3716 18.3563" fill="none" stroke="${a}" stroke-width="${u}" />
</g>
<text x="${t}" y="${r+o+14}" text-anchor="middle" font-size="${K.nodeLabel}" font-weight="${Z.nodeLabel}" fill="var(--_text)">${Oe(i)}</text>`}return `<rect x="${t-n/2}" y="${r}" width="${n}" height="${o}" rx="4" ry="4" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="${oe.outerBox}" />
<text x="${t}" y="${r+o/2}" text-anchor="middle" dy="${de}" font-size="${K.nodeLabel}" font-weight="${Z.nodeLabel}" fill="var(--_text)">${Oe(i)}</text>`}function Oo(e){return `<line x1="${e.x}" y1="${e.topY}" x2="${e.x}" y2="${e.bottomY}" stroke="var(--_line)" stroke-width="0.75" stroke-dasharray="6 4" />`}function Wo(e){return `<rect x="${e.x}" y="${e.topY}" width="${e.width}" height="${e.bottomY-e.topY}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="${oe.innerBox}" />`}function Fo(e){let t=[],r=e.lineStyle==="dashed"?' stroke-dasharray="6 4"':"",n=e.arrowHead==="filled"?"seq-arrow":"seq-arrow-open";if(e.isSelf)t.push(`<polyline points="${e.x1},${e.y} ${e.x1+30},${e.y} ${e.x1+30},${e.y+20} ${e.x2},${e.y+20}" fill="none" stroke="var(--_line)" stroke-width="${oe.connector}"${r} marker-end="url(#${n})" />`),t.push(`<text x="${e.x1+30+6}" y="${e.y+20/2}" dy="${de}" font-size="${K.edgeLabel}" font-weight="${Z.edgeLabel}" fill="var(--_text-muted)">${Oe(e.label)}</text>`);else {t.push(`<line x1="${e.x1}" y1="${e.y}" x2="${e.x2}" y2="${e.y}" stroke="var(--_line)" stroke-width="${oe.connector}"${r} marker-end="url(#${n})" />`);let o=(e.x1+e.x2)/2;t.push(`<text x="${o}" y="${e.y-6}" text-anchor="middle" font-size="${K.edgeLabel}" font-weight="${Z.edgeLabel}" fill="var(--_text-muted)">${Oe(e.label)}</text>`);}return t.join(`
`)}function Ho(e){let t=[];t.push(`<rect x="${e.x}" y="${e.y}" width="${e.width}" height="${e.height}" rx="0" ry="0" fill="none" stroke="var(--_node-stroke)" stroke-width="${oe.outerBox}" />`);let r=`${e.type}${e.label?` [${e.label}]`:""}`,n=ce(r,K.edgeLabel,Z.groupHeader)+16,o=18;t.push(`<rect x="${e.x}" y="${e.y}" width="${n}" height="${o}" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="${oe.outerBox}" />`),t.push(`<text x="${e.x+6}" y="${e.y+o/2}" dy="${de}" font-size="${K.edgeLabel}" font-weight="${Z.groupHeader}" fill="var(--_text-sec)">${Oe(r)}</text>`);for(let i of e.dividers)t.push(`<line x1="${e.x}" y1="${i.y}" x2="${e.x+e.width}" y2="${i.y}" stroke="var(--_line)" stroke-width="0.75" stroke-dasharray="6 4" />`),i.label&&t.push(`<text x="${e.x+8}" y="${i.y+14}" font-size="${K.edgeLabel}" font-weight="${Z.edgeLabel}" fill="var(--_text-muted)">[${Oe(i.label)}]</text>`);return t.join(`
`)}function Bo(e){return `<rect x="${e.x}" y="${e.y}" width="${e.width}" height="${e.height}" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="${oe.innerBox}" />
<polygon points="${e.x+e.width-6},${e.y} ${e.x+e.width},${e.y+6} ${e.x+e.width-6},${e.y+6}" fill="var(--_inner-stroke)" />
<text x="${e.x+e.width/2}" y="${e.y+e.height/2}" text-anchor="middle" dy="${de}" font-size="${K.edgeLabel}" font-weight="${Z.edgeLabel}" fill="var(--_text-muted)">${Oe(e.text)}</text>`}function Oe(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}var Nt=bt(ut());var le={padding:40,boxPadX:8,headerBaseHeight:32,annotationHeight:16,memberRowHeight:20,sectionPadY:8,emptySectionHeight:8,minWidth:120,memberFontSize:11,nodeSpacing:40,layerSpacing:60};async function Yn(e,t={}){if(e.classes.length===0)return {width:0,height:0,classes:[],relationships:[]};let r=new Map;for(let s of e.classes){let l=s.annotation?le.headerBaseHeight+le.annotationHeight:le.headerBaseHeight,h=s.attributes.length>0?s.attributes.length*le.memberRowHeight+le.sectionPadY:le.emptySectionHeight,f=s.methods.length>0?s.methods.length*le.memberRowHeight+le.sectionPadY:le.emptySectionHeight,u=ce(s.label,K.nodeLabel,Z.nodeLabel),a=Bn(s.attributes),d=Bn(s.methods),p=Math.max(le.minWidth,u+le.boxPadX*2,a+le.boxPadX*2,d+le.boxPadX*2),x=l+h+f;r.set(s.id,{width:p,height:x,headerHeight:l,attrHeight:h,methodHeight:f});}let n=new Nt.default.graphlib.Graph({directed:true});n.setGraph({rankdir:"TB",acyclicer:"greedy",nodesep:le.nodeSpacing,ranksep:le.layerSpacing,marginx:le.padding,marginy:le.padding}),n.setDefaultEdgeLabel(()=>({}));for(let s of e.classes){let l=r.get(s.id);n.setNode(s.id,{width:l.width,height:l.height});}for(let s=0;s<e.relationships.length;s++){let l=e.relationships[s],h={_index:s};l.label&&(h.label=l.label,h.width=ce(l.label,K.edgeLabel,Z.edgeLabel)+8,h.height=K.edgeLabel+6,h.labelpos="c"),n.setEdge(l.from,l.to,h);}try{Nt.default.layout(n);}catch(s){let l=s instanceof Error?s.message:String(s);throw new Error(`Dagre layout failed (class diagram): ${l}`)}let o=new Map;for(let s of e.classes)o.set(s.id,s);let i=e.classes.map(s=>{let l=n.node(s.id),h=r.get(s.id),f=ke(l.x,l.y,l.width,l.height);return {id:s.id,label:s.label,annotation:s.annotation,attributes:s.attributes,methods:s.methods,x:f.x,y:f.y,width:l.width??h.width,height:l.height??h.height,headerHeight:h.headerHeight,attrHeight:h.attrHeight,methodHeight:h.methodHeight}}),c=n.edges().map(s=>{let l=n.edge(s),h=e.relationships[l._index],f=l.points??[],u=De(f,true),a=n.node(s.v),d=n.node(s.w),p=Pe(u,a?{cx:a.x,cy:a.y,hw:a.width/2,hh:a.height/2}:null,d?{cx:d.x,cy:d.y,hw:d.width/2,hh:d.height/2}:null),x;return h.label&&l.x!=null&&l.y!=null&&(x={x:l.x,y:l.y}),{from:h.from,to:h.to,type:h.type,markerAt:h.markerAt,label:h.label,fromCardinality:h.fromCardinality,toCardinality:h.toCardinality,points:p,labelPosition:x}});return {width:n.graph().width??600,height:n.graph().height??400,classes:i,relationships:c}}function Bn(e){if(e.length===0)return 0;let t=0;for(let r of e){let n=Yo(r),o=pt(n,le.memberFontSize);o>t&&(t=o);}return t}function Yo(e){let t=e.visibility?`${e.visibility} `:"",r=e.type?`: ${e.type}`:"";return `${t}${e.name}${r}`}var xt={memberSize:11,memberWeight:400,annotationSize:10,annotationWeight:500};function zn(e,t,r="Inter",n=false){let o=[];o.push(_e(e.width,e.height,t,n)),o.push(Se(r,true)),o.push("<defs>"),o.push(Xo()),o.push("</defs>");for(let i of e.relationships)o.push(zo(i));for(let i of e.classes)o.push(jo(i));for(let i of e.relationships)o.push(qo(i));return o.push("</svg>"),o.join(`
`)}function Xo(){return `  <marker id="cls-inherit" markerWidth="12" markerHeight="10" refX="12" refY="5" orient="auto-start-reverse">
    <polygon points="0 0, 12 5, 0 10" fill="var(--bg)" stroke="var(--_arrow)" stroke-width="1.5" />
  </marker>
  <marker id="cls-composition" markerWidth="12" markerHeight="10" refX="0" refY="5" orient="auto-start-reverse">
    <polygon points="6 0, 12 5, 6 10, 0 5" fill="var(--_arrow)" stroke="var(--_arrow)" stroke-width="1" />
  </marker>
  <marker id="cls-aggregation" markerWidth="12" markerHeight="10" refX="0" refY="5" orient="auto-start-reverse">
    <polygon points="6 0, 12 5, 6 10, 0 5" fill="var(--bg)" stroke="var(--_arrow)" stroke-width="1.5" />
  </marker>
  <marker id="cls-arrow" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto-start-reverse">
    <polyline points="0 0, 8 3, 0 6" fill="none" stroke="var(--_arrow)" stroke-width="1.5" />
  </marker>`}function jo(e){let{x:t,y:r,width:n,height:o,headerHeight:i,attrHeight:c,methodHeight:s}=e,l=[];l.push(`<rect x="${t}" y="${r}" width="${n}" height="${o}" rx="0" ry="0" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="${oe.outerBox}" />`),l.push(`<rect x="${t}" y="${r}" width="${n}" height="${i}" rx="0" ry="0" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="${oe.outerBox}" />`);let h=r+i/2;if(e.annotation){let d=r+12;l.push(`<text x="${t+n/2}" y="${d}" text-anchor="middle" dy="${de}" font-size="${xt.annotationSize}" font-weight="${xt.annotationWeight}" font-style="italic" fill="var(--_text-muted)">&lt;&lt;${Te(e.annotation)}&gt;&gt;</text>`),h=r+i/2+6;}l.push(`<text x="${t+n/2}" y="${h}" text-anchor="middle" dy="${de}" font-size="${K.nodeLabel}" font-weight="700" fill="var(--_text)">${Te(e.label)}</text>`);let f=r+i;l.push(`<line x1="${t}" y1="${f}" x2="${t+n}" y2="${f}" stroke="var(--_node-stroke)" stroke-width="${oe.innerBox}" />`);let u=20;for(let d=0;d<e.attributes.length;d++){let p=e.attributes[d],x=f+4+d*u+u/2;l.push(Xn(p,t+le.boxPadX,x));}let a=f+c;l.push(`<line x1="${t}" y1="${a}" x2="${t+n}" y2="${a}" stroke="var(--_node-stroke)" stroke-width="${oe.innerBox}" />`);for(let d=0;d<e.methods.length;d++){let p=e.methods[d],x=a+4+d*u+u/2;l.push(Xn(p,t+le.boxPadX,x));}return l.join(`
`)}function Xn(e,t,r){let n=e.isAbstract?' font-style="italic"':"",o=e.isStatic?' text-decoration="underline"':"",i=[];return e.visibility&&i.push(`<tspan fill="var(--_text-faint)">${Te(e.visibility)} </tspan>`),i.push(`<tspan fill="var(--_text-sec)">${Te(e.name)}</tspan>`),e.type&&(i.push('<tspan fill="var(--_text-faint)">: </tspan>'),i.push(`<tspan fill="var(--_text-muted)">${Te(e.type)}</tspan>`)),`<text x="${t}" y="${r}" class="mono" dy="${de}" font-size="${xt.memberSize}" font-weight="${xt.memberWeight}"${n}${o}>${i.join("")}</text>`}function zo(e){if(e.points.length<2)return "";let t=e.points.map(i=>`${i.x},${i.y}`).join(" "),n=e.type==="dependency"||e.type==="realization"?' stroke-dasharray="6 4"':"",o=Vo(e.type,e.markerAt);return `<polyline points="${t}" fill="none" stroke="var(--_line)" stroke-width="${oe.connector}"${n}${o} />`}function Vo(e,t){let r=Uo(e);return r?t==="from"?` marker-start="url(#${r})"`:` marker-end="url(#${r})"`:""}function Uo(e){switch(e){case "inheritance":case "realization":return "cls-inherit";case "composition":return "cls-composition";case "aggregation":return "cls-aggregation";case "association":case "dependency":return "cls-arrow";default:return null}}function qo(e){if(!e.label&&!e.fromCardinality&&!e.toCardinality||e.points.length<2)return "";let t=[];if(e.label){let r=e.labelPosition??Ko(e.points);t.push(`<text x="${r.x}" y="${r.y-8}" text-anchor="middle" font-size="${K.edgeLabel}" font-weight="${Z.edgeLabel}" fill="var(--_text-muted)">${Te(e.label)}</text>`);}if(e.fromCardinality){let r=e.points[0],n=e.points[1],o=jn(r,n);t.push(`<text x="${r.x+o.x}" y="${r.y+o.y}" text-anchor="middle" font-size="${K.edgeLabel}" font-weight="${Z.edgeLabel}" fill="var(--_text-muted)">${Te(e.fromCardinality)}</text>`);}if(e.toCardinality){let r=e.points[e.points.length-1],n=e.points[e.points.length-2],o=jn(r,n);t.push(`<text x="${r.x+o.x}" y="${r.y+o.y}" text-anchor="middle" font-size="${K.edgeLabel}" font-weight="${Z.edgeLabel}" fill="var(--_text-muted)">${Te(e.toCardinality)}</text>`);}return t.join(`
`)}function Ko(e){if(e.length===0)return {x:0,y:0};let t=Math.floor(e.length/2);return e[t]}function jn(e,t){let r=t.x-e.x,n=t.y-e.y;return Math.abs(r)>Math.abs(n)?{x:r>0?14:-14,y:-10}:{x:-14,y:n>0?14:-14}}function Te(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}var Pt=bt(ut());var be={padding:40,boxPadX:12,headerHeight:32,rowHeight:22,minWidth:140,attrFontSize:11,nodeSpacing:50,layerSpacing:70};async function Vn(e,t={}){if(e.entities.length===0)return {width:0,height:0,entities:[],relationships:[]};let r=new Map;for(let s of e.entities){let l=ce(s.label,K.nodeLabel,Z.nodeLabel),h=0;for(let a of s.attributes){let d=`${a.type}  ${a.name}${a.keys.length>0?"  "+a.keys.join(","):""}`,p=pt(d,be.attrFontSize);p>h&&(h=p);}let f=Math.max(be.minWidth,l+be.boxPadX*2,h+be.boxPadX*2),u=be.headerHeight+Math.max(s.attributes.length,1)*be.rowHeight;r.set(s.id,{width:f,height:u});}let n=new Pt.default.graphlib.Graph({directed:true});n.setGraph({rankdir:"LR",acyclicer:"greedy",nodesep:be.nodeSpacing,ranksep:be.layerSpacing,marginx:be.padding,marginy:be.padding}),n.setDefaultEdgeLabel(()=>({}));for(let s of e.entities){let l=r.get(s.id);n.setNode(s.id,{width:l.width,height:l.height});}for(let s=0;s<e.relationships.length;s++){let l=e.relationships[s];n.setEdge(l.entity1,l.entity2,{_index:s,label:l.label,width:ce(l.label,K.edgeLabel,Z.edgeLabel)+8,height:K.edgeLabel+6,labelpos:"c"});}try{Pt.default.layout(n);}catch(s){let l=s instanceof Error?s.message:String(s);throw new Error(`Dagre layout failed (ER diagram): ${l}`)}let o=new Map;for(let s of e.entities)o.set(s.id,s);let i=e.entities.map(s=>{let l=n.node(s.id),h=ke(l.x,l.y,l.width,l.height);return {id:s.id,label:s.label,attributes:s.attributes,x:h.x,y:h.y,width:l.width??r.get(s.id).width,height:l.height??r.get(s.id).height,headerHeight:be.headerHeight,rowHeight:be.rowHeight}}),c=n.edges().map(s=>{let l=n.edge(s),h=e.relationships[l._index],f=l.points??[],u=De(f,false),a=n.node(s.v),d=n.node(s.w),p=Pe(u,a?{cx:a.x,cy:a.y,hw:a.width/2,hh:a.height/2}:null,d?{cx:d.x,cy:d.y,hw:d.width/2,hh:d.height/2}:null);return {entity1:h.entity1,entity2:h.entity2,cardinality1:h.cardinality1,cardinality2:h.cardinality2,label:h.label,identifying:h.identifying,points:p}});return {width:n.graph().width??600,height:n.graph().height??400,entities:i,relationships:c}}var Me={attrSize:11,attrWeight:400,keySize:9,keyWeight:600};function qn(e,t,r="Inter",n=false){let o=[];o.push(_e(e.width,e.height,t,n)),o.push(Se(r,true)),o.push("<defs>"),o.push("</defs>");for(let i of e.relationships)o.push(Qo(i));for(let i of e.entities)o.push(Jo(i));for(let i of e.relationships)o.push(ti(i));for(let i of e.relationships)o.push(ei(i));return o.push("</svg>"),o.join(`
`)}function Jo(e){let{x:t,y:r,width:n,height:o,headerHeight:i,rowHeight:c,label:s,attributes:l}=e,h=[];h.push(`<rect x="${t}" y="${r}" width="${n}" height="${o}" rx="0" ry="0" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="${oe.outerBox}" />`),h.push(`<rect x="${t}" y="${r}" width="${n}" height="${i}" rx="0" ry="0" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="${oe.outerBox}" />`),h.push(`<text x="${t+n/2}" y="${r+i/2}" text-anchor="middle" dy="${de}" font-size="${K.nodeLabel}" font-weight="700" fill="var(--_text)">${yt(s)}</text>`);let f=r+i;h.push(`<line x1="${t}" y1="${f}" x2="${t+n}" y2="${f}" stroke="var(--_node-stroke)" stroke-width="${oe.innerBox}" />`);for(let u=0;u<l.length;u++){let a=l[u],d=f+u*c+c/2;h.push(Zo(a,t,d,n));}return l.length===0&&h.push(`<text x="${t+n/2}" y="${f+c/2}" text-anchor="middle" dy="${de}" font-size="${Me.attrSize}" fill="var(--_text-faint)" font-style="italic">(no attributes)</text>`),h.join(`
`)}function Zo(e,t,r,n){let o=[],i=0;if(e.keys.length>0){let l=e.keys.join(",");i=ce(l,Me.keySize,Me.keyWeight)+8,o.push(`<rect x="${t+6}" y="${r-7}" width="${i}" height="14" rx="2" ry="2" fill="var(--_key-badge)" />`),o.push(`<text x="${t+6+i/2}" y="${r}" text-anchor="middle" dy="${de}" font-size="${Me.keySize}" font-weight="${Me.keyWeight}" fill="var(--_text-sec)">${e.keys.join(",")}</text>`);}let c=t+8+(i>0?i+6:0);o.push(`<text x="${c}" y="${r}" class="mono" dy="${de}" font-size="${Me.attrSize}" font-weight="${Me.attrWeight}"><tspan fill="var(--_text-muted)">${yt(e.type)}</tspan></text>`);let s=t+n-8;return o.push(`<text x="${s}" y="${r}" class="mono" text-anchor="end" dy="${de}" font-size="${Me.attrSize}" font-weight="${Me.attrWeight}"><tspan fill="var(--_text-sec)">${yt(e.name)}</tspan></text>`),o.join(`
`)}function Qo(e){if(e.points.length<2)return "";let t=e.points.map(n=>`${n.x},${n.y}`).join(" "),r=e.identifying?"":' stroke-dasharray="6 4"';return `<polyline points="${t}" fill="none" stroke="var(--_line)" stroke-width="${oe.connector}"${r} />`}function ei(e){if(!e.label||e.points.length<2)return "";let t=ni(e.points),n=ce(e.label,K.edgeLabel,Z.edgeLabel)+8,o=K.edgeLabel+6;return `<rect x="${t.x-n/2}" y="${t.y-o/2}" width="${n}" height="${o}" rx="2" ry="2" fill="var(--bg)" stroke="var(--_inner-stroke)" stroke-width="0.5" />
<text x="${t.x}" y="${t.y}" text-anchor="middle" dy="${de}" font-size="${K.edgeLabel}" font-weight="${Z.edgeLabel}" fill="var(--_text-muted)">${yt(e.label)}</text>`}function ti(e){if(e.points.length<2)return "";let t=[],r=e.points[0],n=e.points[1];t.push(Un(r,n,e.cardinality1));let o=e.points[e.points.length-1],i=e.points[e.points.length-2];return t.push(Un(o,i,e.cardinality2)),t.join(`
`)}function Un(e,t,r){let n=[],o=oe.connector+.25,i=e.x-t.x,c=e.y-t.y,s=Math.sqrt(i*i+c*c);if(s===0)return "";let l=i/s,h=c/s,f=-h,u=l,a=e.x-l*4,d=e.y-h*4,p=e.x-l*16,x=e.y-h*16,g=r==="one"||r==="zero-one",m=r==="many"||r==="zero-many",w=r==="zero-one"||r==="zero-many";if(g){n.push(`<line x1="${a+f*6}" y1="${d+u*6}" x2="${a-f*6}" y2="${d-u*6}" stroke="var(--_line)" stroke-width="${o}" />`);let E=a-l*4,L=d-h*4;n.push(`<line x1="${E+f*6}" y1="${L+u*6}" x2="${E-f*6}" y2="${L-u*6}" stroke="var(--_line)" stroke-width="${o}" />`);}if(m){let E=a,L=d;n.push(`<line x1="${E+f*7}" y1="${L+u*7}" x2="${p}" y2="${x}" stroke="var(--_line)" stroke-width="${o}" />`),n.push(`<line x1="${E}" y1="${L}" x2="${p}" y2="${x}" stroke="var(--_line)" stroke-width="${o}" />`),n.push(`<line x1="${E-f*7}" y1="${L-u*7}" x2="${p}" y2="${x}" stroke="var(--_line)" stroke-width="${o}" />`);}if(w){let C=m?20:12,E=e.x-l*C,L=e.y-h*C;n.push(`<circle cx="${E}" cy="${L}" r="4" fill="var(--bg)" stroke="var(--_line)" stroke-width="${o}" />`);}return n.join(`
`)}function ni(e){if(e.length===0)return {x:0,y:0};if(e.length===1)return e[0];let t=0;for(let o=1;o<e.length;o++){let i=e[o].x-e[o-1].x,c=e[o].y-e[o-1].y;t+=Math.sqrt(i*i+c*c);}if(t===0)return e[0];let r=t/2,n=0;for(let o=1;o<e.length;o++){let i=e[o].x-e[o-1].x,c=e[o].y-e[o-1].y,s=Math.sqrt(i*i+c*c);if(n+s>=r){let l=s>0?(r-n)/s:0;return {x:e[o-1].x+i*l,y:e[o-1].y+c*l}}n+=s;}return e[e.length-1]}function yt(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function ri(e){let t=e.trim().split(/[\n;]/)[0]?.trim().toLowerCase()??"";return /^sequencediagram\s*$/.test(t)?"sequence":/^classdiagram\s*$/.test(t)?"class":/^erdiagram\s*$/.test(t)?"er":"flowchart"}function oi(e){return {bg:e.bg??We.bg,fg:e.fg??We.fg,line:e.line,accent:e.accent,muted:e.muted,surface:e.surface,border:e.border}}async function Kn(e,t={}){let r=oi(t),n=t.font??"Inter",o=t.transparent??false,i=ri(e),c=e.split(/[\n;]/).map(s=>s.trim()).filter(s=>s.length>0&&!s.startsWith("%%"));switch(i){case "sequence":{let s=lt(c),l=Fn(s,t);return Hn(l,r,n,o)}case "class":{let s=dt(c),l=await Yn(s,t);return zn(l,r,n,o)}case "er":{let s=ht(c),l=await Vn(s,t);return qn(l,r,n,o)}default:{let s=Je(e),l=await Sn(s,t);return On(l,r,n,o)}}}typeof window<"u"&&(window.__mermaid={renderMermaid:Kn,renderMermaidAscii:_t,THEMES:wt,DEFAULTS:We,fromShikiTheme:vt});exports.DEFAULTS=We;exports.THEMES=wt;exports.fromShikiTheme=vt;exports.renderMermaid=Kn;exports.renderMermaidAscii=_t;return exports;})({});//# sourceMappingURL=beautiful-mermaid.browser.global.js.map
//# sourceMappingURL=beautiful-mermaid.browser.global.js.map